8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:34:13  12/07/;3  PAGE    1


DOS 5.0 (038-N) 8086/87/88/186 MACRO ASSEMBLER V3.1 ASSEMBLY OF MODULE TIMER
OBJECT MODULE PLACED IN TIMER.OBJ
ASSEMBLER INVOKED BY:  D:\ASM86.EXE TIMER.ASM


LOC  OBJ                  LINE     SOURCE

                             1 +1  $MOD186
                             2 +1  $EP
                             3     NAME TIMER
                             4     ; Main program for uPD70208 microcomputer system
                             5     ;
                             6     ; Author:       Dr Tay Teng Tiow
                             7     ; Address:      Department of Electrical Engineering 
                             8     ;               National University of Singapore
                             9     ;               10, Kent Ridge Crescent
                            10     ;               Singapore 0511. 
                            11     ; Date:         6th September 1991
                            12     ;
                            13     ; This file contains proprietory information and cannot be copied 
                            14     ; or distributed without prior permission from the author.
                            15     ; =========================================================================
                            16     
                            17     public  serial_rec_action, timer2_action
                            18     extrn   print_char:far, print_2hex:far, iodefine:far
                            19     extrn   set_timer2:far
                            20     
                            21     ;IO Setup for 80C188 
  FFA0                      22             UMCR    EQU    0FFA0H ; Upper Memory Control Register
  FFA2                      23             LMCR    EQU    0FFA2H ; Lower Memory control Register         
  FFA4                      24             PCSBA   EQU    0FFA4H ; Peripheral Chip Select Base Address
  FFA8                      25             MPCS    EQU    0FFA8H ; MMCS and PCS Alter Control Register
  0080                      26             A_8255  EQU    0080H
  0081                      27             B_8255  EQU    0081H
  0082                      28             C_8255  EQU    0082H
  0083                      29             CWR_8255  EQU    0083H
  FF38                      30             INT0CON  EQU   0FF38H
  FF22                      31             EOI EQU 0FF22H
  FF28                      32             IMASK EQU 0FF28H
  FFA6                      33             MMCS    EQU    0FFA6H 
  4000                      34             DAC EQU 4000H
                            35     
                            36     
----                        37     STACK_SEG       SEGMENT
0000 (512                   38                     DB      512 DUP(?)
     ??
     )
0200                        39             TOS     LABEL   WORD
----                        40     STACK_SEG       ENDS
                            41     
                            42     
----                        43     DATA_SEG        SEGMENT
0000 0A                     44             TIMER0_MESS             DB      10,13,'TIMER2 INTERRUPT    '
0001 0D
0002 54494D45523220
     494E5445525255
     505420202020
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:34:13  12/07/;3  PAGE    2


LOC  OBJ                  LINE     SOURCE

0016 18                     45             T_COUNT                 DB      24
0017 18                     46             T_COUNT_SET             DB      24
0018 0A                     47             REC_MESS                DB      10,13,'Period of timer0 =     '
0019 0D
001A 506572696F6420
     6F662074696D65
     7230203D202020
     2020
0031 (32                    48             MESSAGE         DB  32 dup('h')
     68
     )
0051 00                     49             KEYPAD_INPUT    DB  0,0,0,0,0,0,0,0
0052 00
0053 00
0054 00
0055 00
0056 00
0057 00
0058 00
0059 2D                     50             BCD_MESSAGE     DB  '-','-','-','-','-','-'
005A 2D
005B 2D
005C 2D
005D 2D
005E 2D
005F FE                     51             ENABLE_BYTE     DB  11111110b
0060 00                     52             BCD_INDEX       DB  0
0061 0000                   53             KEYPAD_INDEX    DW      0
0063 20                     54             M_SIZE                  DB  32
0064 0040                   55             DAC_BASE        DW  4000H
0066 (15                    56             DAC_ADDR        DB  15 dup(0) 
     00
     )
0075 00                     57             DAC_LEN         DB  0
0076 0000                   58             SI_PTR          DW  0
0078 ??                     59             CHAR                    DB  ?
0079 ??                     60             REG_AL                  DB  ?
007A ??                     61             REG_BH                  DB  ?
007B ??                     62             REG_CL                  DB  ?
007C 00                     63             FLAG            DB  0
007D 00                     64             LONG_PRESS_FLAG DB      0
007E 7231                   65             MY_ID                   DB      'r1'
0080 00                     66             ID_FLAG_@               DB      0
0081 00                     67             ID_FLAG_r               DB      0
0082 4072312F               68             REPLY_MESSAGE   DB      '@r1/'
0086 40302F                 69             FAIL_MESSAGE    DB '@0/'
0089 04                     70             REPLY_COUNT             DB      4
008A 03                     71             FAIL_COUNT              DB      3
008B 00                     72             REPLY_FLAG              DB      0
008C 00                     73             SEND_FLAG       DB  0
008D (13                    74             SEND_BUFFER     DB  13 dup(0)
     00
     )
009A 0000                   75             SEND_BUFFER_LEN DW      0
009C 0000                   76             MAX_INPUT_SIZE  DW      0
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:34:13  12/07/;3  PAGE    3


LOC  OBJ                  LINE     SOURCE

009E 0000                   77             QTY_FLAG                DW      0
00A0 0000                   78             RECEIVE_FLAG    DW      0
00A2 0000                   79             DAC_FLAG                DW      0
00A4 0000                   80             PRICE_FLAG      DW      0
00A6 0100                   81             DECIMAL_FLAG    DW      1
00A8 0000                   82             SCROLL_LEN      DW      0
00AA 0000                   83             DAC_DISABLE     DW  0
00AC 0300                   84             DECIMAL_INDEX   DW  3
00AE 0100                   85             LANG_FLAG       DW  1
00B0 0000                   86             PRICE                   DW      0
00B2 0000                   87             QTY                             DW      0
00B4 0000                   88             TOTAL_PRICE_U   DW      0
00B6 0000                   89             TOTAL_PRICE_L   DW      0
00B8 0000                   90             TOTAL_PRICE_DEC DW      0
00BA (8                     91             TEMP_BCD_ARR    DB  8 dup(0)
     00
     )
00C2 0000                   92             THOUSAND_FLAG   DW  0
00C4 0000                   93             CENT_FLAG               DW      0
00C6 0000                   94             DOLLAR_FLAG             DW      0
00C8 0000                   95             CASH_FLAG               DW      0
00CA (8                     96             CASH_AMT        DB  8 dup(0)
     00
     )
00D2 (8                     97             TEMP_CASH_ARR   DW  8 dup(0)
     0000
     )
00E2 0000                   98             CASH_OK_FLAG    DW  0
00E4 0000                   99             BORROW_POSITION DW  0
00E6 0100                  100             CANCEL_FLAG             DW  1
00E8 0000                  101             TRANSACTION_OVER DW 0
00EA 0100                  102             DATA_ENTER              DW  1
00EC (8                    103             TROLLEY_ARRAY   DB  8 dup(0)
     00
     )
00F4 0000                  104             TROLLEY_INDEX   DW  0
00F6 0000                  105             TROLLEY_FLAG    DW  0
00F8 0000                  106             TROLLEY_ID              DW  0
00FA 0000                  107             TROLLEY_DISABLED DW 0
----                       108     DATA_SEG        ENDS
                           109     
                           110     
----                       111     CODE_SEG        SEGMENT
                           112     
                           113             PUBLIC          START
                           114     
                           115     ASSUME  CS:CODE_SEG, SS:STACK_SEG
                           116     
0000                       117     START:
                           118     ;initialize stack area
0000 B8----         R      119                     MOV     AX,STACK_SEG            
0003 8ED0                  120                     MOV     SS,AX
0005 368B260002            121                     MOV     SP,TOS
                           122                     
                           123     ; Initialize the on-chip pheripherals
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:34:13  12/07/;3  PAGE    4


LOC  OBJ                  LINE     SOURCE

000A 9A0000----     E      124                     CALL    FAR PTR IODEFINE
                           125                     
000F 9A0000----     E      126     call set_timer2
0014 FB                    127                    STI
                           128     
                           129     ; ^^^^^^^^^^^^^^^^^  Start of User Main Routine  ^^^^^^^^^^^^^^^^^^
                           130     
                           131     ;Initialize MMCS
                           132             
0015 BAA6FF                133             MOV DX, MMCS
0018 B80340                134             MOV AX, 4003H
001B EF                    135             OUT DX, AX
                           136     
                           137     ; Initialize MPCS to MAP peripheral to IO address
                           138             
001C BAA8FF                139             MOV DX, MPCS
001F B88320                140             MOV AX, 2083H
0022 EF                    141             OUT DX, AX
                           142        
                           143     ; PCSBA initial, set the parallel port start from 00H
0023 BAA4FF                144             MOV DX, PCSBA
0026 B80300                145             MOV AX, 0003H ; Peripheral starting address 00H no READY, No Waits
0029 EF                    146             OUT DX, AX
                           147     
                           148     ; Initialize LMCS 
002A BAA2FF                149         MOV DX, LMCR
002D B8C401                150         MOV AX, 01C4H  ; Starting address 1FFFH, 8K, No waits, last shoud be 5H for 1 wai
                                   ts      
0030 EF                    151         OUT DX, AX
                           152             
0031 B8----         R      153             MOV AX, DATA_SEG
0034 8ED8                  154             MOV DS, AX
                           155                              
0036 BA8300                156             MOV DX, CWR_8255
0039 B88200                157             MOV AX, 0082h
003C EF                    158             OUT DX, AX
                           159             
003D                       160     NEXT:
003D 9A4400----     R      161             CALL FAR PTR KEYPAD_LOOP
                           162             
0042 EBF9                  163     JMP NEXT
                           164     
0044                       165     KEYPAD_LOOP PROC FAR
0044 50                    166     PUSH AX
0045 53                    167     PUSH BX
0046 51                    168     PUSH CX
0047 52                    169     PUSH DX
                           170             
0048 9A6B06----     R      171                             CALL FAR PTR DEBOUNCE           
                           172                             
004D C606790003            173     WAIT_1:         MOV DS:REG_AL, 03H
0052 BB0000                174                         MOV BX, 0000H
0055 BA8200                175                         MOV DX,C_8255
0058 8AC3                  176                         MOV AL,BL
005A EE                    177                         OUT DX,AL
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:34:13  12/07/;3  PAGE    5


LOC  OBJ                  LINE     SOURCE

                           178                        
005B BA8100                179                         MOV DX,B_8255
005E EC                    180                         IN AL,DX
005F 8AD8                  181                         MOV BL,AL  
0061 80E3FC                182                         AND BL,0FCH
0064 80FBFC                183                         CMP BL,0FCH
                           184                      
0067 744F                  185                     JE LONG_PRESS
                           186                             
0069 B3FE                  187                         MOV BL, 0FEH
006B C6067A0004            188                         MOV DS:REG_BH, 04H
                           189                        
0070                       190     NXTROW: 
0070 C0C307                191                     ROL BL,07H
0073 8AEB                  192                             MOV CH,BL
0075 BA8200                193                             MOV DX,C_8255
0078 8AC3                  194                             MOV AL,BL
007A EE                    195                             OUT DX,AL
                           196                             
007B BA8100                197                             MOV DX,B_8255
007E EC                    198                             IN AL,DX
007F 8AD8                  199                             MOV BL,AL
0081 80E3FC                200                             AND BL,0FCH
0084 C6067B0006            201                             MOV DS:REG_CL,06H
0089 C0DB02                202                             RCR BL,02H
008C D0DB                  203     NXTCOL:         RCR BL,01H
008E 7330                  204                             JNC CODEKY
0090 FE0E7900              205                             DEC DS:REG_AL
0094 FE0E7B00              206                             DEC DS:REG_CL
0098 803E7B0003            207                             CMP DS:REG_CL,03H
009D 7413                  208                             JE KEYPAD4
                           209                             
009F 803E7B0000            210                             CMP DS:REG_CL, 0H
00A4 740F                  211                             JE SUBTRACT3
00A6 EBE4                  212                             JMP NXTCOL
                           213                             
00A8 8ADD                  214                             MOV BL,CH
00AA FE0E7A00              215                             DEC DS:REG_BH
00AE 75C0                  216                             JNZ NXTROW
00B0 EB9B                  217                             JMP WAIT_1
                           218                             
00B2 EB7290                219     KEYPAD4:    JMP KEYPAD3
00B5 EB7290                220     SUBTRACT3:  JMP SUBTRACT2
                           221                             
00B8                       222     LONG_PRESS:
00B8 C6067D0000            223                             MOV DS:LONG_PRESS_FLAG, 0
00BD EB6D90                224                             JMP RETURN2
00C0                       225     CODEKY:
00C0 803E79000B            226                         CMP DS:REG_AL, 11
00C5 7505                  227                             JNE bcd_upd
00C7 C606790000            228                             MOV DS:REG_AL, 0
                           229                             
00CC                       230     bcd_upd:
00CC 803E7D0000            231                             CMP DS:LONG_PRESS_FLAG, 0
00D1 7559                  232                             JNE RETURN2
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:34:13  12/07/;3  PAGE    6


LOC  OBJ                  LINE     SOURCE

                           233                             
00D3 803E790011            234                             CMP DS:REG_AL, 17
00D8 7555                  235                             JNE ENTER_CASH
                           236                             
00DA 833EFA0001            237                             CMP DS:TROLLEY_DISABLED, 1
00DF 7442                  238                             JE SKIP_ENTER_DATA1
                           239                             
00E1 833EC80001            240                             CMP DS:CASH_FLAG, 1
00E6 743B                  241                             JE SKIP_ENTER_DATA1
00E8 9ABA05----     R      242                             CALL FAR PTR BCD_CLEAR
                           243                             
00ED 833EE80000            244                             CMP DS:TRANSACTION_OVER, 0
00F2 7405                  245                             JE NO_RESET_NEEDED1
                           246                             
00F4 9A7804----     R      247                             CALL FAR PTR CLEAR_TEMP_BCD
                           248                             
00F9                       249             NO_RESET_NEEDED1:
00F9 C706EA000100          250                             MOV DS:DATA_ENTER, 1
00FF C706AC000600          251                             MOV DS:DECIMAL_INDEX, 6
0105 C7069C000600          252                             MOV DS:MAX_INPUT_SIZE, 6
010B C706F8000100          253                             MOV DS:TROLLEY_ID, 1
0111 C706AE000000          254                             MOV DS:LANG_FLAG, 0
0117 C706C8000000          255                             MOV DS:CASH_FLAG, 0
011D C706E8000000          256                             MOV DS:TRANSACTION_OVER, 0
0123                       257             SKIP_ENTER_DATA1:
0123 E90002                258                             JMP UPDATE_7SEG2
                           259                             
0126 E9F902                260     KEYPAD3:        JMP KEYPAD_2
                           261                             
0129 E90603                262     SUBTRACT2:   JMP SUBTRACT
                           263     
012C E91103                264     RETURN2:    JMP RETURN
                           265                             
                           266                             
012F                       267     ENTER_CASH:     
012F 803E790014            268                             CMP DS:REG_AL, 20
0134 7521                  269                             JNE SEND_CASH
0136 833EC80000            270                             CMP DS:CASH_FLAG, 0
013B 7417                  271                             JE SKIP_CASH
013D C706EA000100          272                             MOV DS:DATA_ENTER, 1
0143 9ABA05----     R      273                             CALL FAR PTR BCD_CLEAR
0148 C7069C000800          274                             MOV DS:MAX_INPUT_SIZE, 8
014E C706AC000600          275                             MOV DS:DECIMAL_INDEX, 6
0154                       276                     SKIP_CASH:
0154 E9CF01                277                             JMP UPDATE_7SEG2
                           278                             
0157                       279     SEND_CASH:
0157 803E790017            280                             CMP DS:REG_AL, 23
015C 751C                  281                             JNE CLEAR_BUTTON
015E 833EC80000            282                             CMP DS:CASH_FLAG, 0
0163 7412                  283                             JE SKIP_SEND_CASH
0165 833E610000            284                             CMP DS:KEYPAD_INDEX, 0
016A 740B                  285                             JE SKIP_SEND_CASH
016C C706EA000000          286                             MOV DS:DATA_ENTER, 0
0172 9A9006----     R      287                             CALL FAR PTR TAKE_CASH
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:34:13  12/07/;3  PAGE    7


LOC  OBJ                  LINE     SOURCE

0177                       288                     SKIP_SEND_CASH:
0177 E9AC01                289                             JMP UPDATE_7SEG2
                           290                             
017A                       291     CLEAR_BUTTON:
017A 803E79000A            292                             CMP DS:REG_AL, 10
017F 7508                  293                             JNE BACKSPACE
0181 9ABA05----     R      294                             CALL FAR PTR BCD_CLEAR
0186 E99D01                295                             JMP UPDATE_7SEG2
                           296                             
0189 803E79000C            297     BACKSPACE:      CMP DS:REG_AL, 12
018E 7508                  298                             JNE ENTER_DATA
0190 9A4B05----     R      299                             CALL FAR PTR BCD_BACKSPACE
0195 E98E01                300                             JMP UPDATE_7SEG2
                           301     
0198 803E79000D            302     ENTER_DATA:     CMP DS:REG_AL, 13
019D 753F                  303                             JNE END_TRANS
019F 833EC80001            304                             CMP DS:CASH_FLAG, 1
01A4 7435                  305                             JE SKIP_ENTER_DATA
01A6 9ABA05----     R      306                             CALL FAR PTR BCD_CLEAR
                           307                             
01AB 833EE80000            308                             CMP DS:TRANSACTION_OVER, 0
01B0 7405                  309                             JE NO_RESET_NEEDED
                           310                             
01B2 9A7804----     R      311                             CALL FAR PTR CLEAR_TEMP_BCD
                           312                             
01B7                       313             NO_RESET_NEEDED:
01B7 C706EA000100          314                             MOV DS:DATA_ENTER, 1
01BD C706AC000600          315                             MOV DS:DECIMAL_INDEX, 6
01C3 C7069C000800          316                             MOV DS:MAX_INPUT_SIZE, 8
01C9 C706AE000000          317                             MOV DS:LANG_FLAG, 0
01CF C706C8000000          318                             MOV DS:CASH_FLAG, 0
01D5 C706E8000000          319                             MOV DS:TRANSACTION_OVER, 0
01DB                       320             SKIP_ENTER_DATA:
01DB E94801                321                             JMP UPDATE_7SEG2
                           322                             
01DE 803E790010            323     END_TRANS:      CMP DS:REG_AL, 16
01E3 7553                  324                             JNE CANCEL_TRANS
01E5 833EF80001            325                             CMP DS:TROLLEY_ID, 1
01EA 7449                  326                             JE END_TRANS_CONT
01EC 833EC80001            327                             CMP DS:CASH_FLAG, 1
01F1 7442                  328                             JE END_TRANS_CONT
01F3 833EE80000            329                             CMP DS:TRANSACTION_OVER, 0
01F8 7403                  330                             JE TRANSACTION_NOT_OVER
01FA E92901                331                             JMP UPDATE_7SEG2
01FD                       332     TRANSACTION_NOT_OVER:
01FD BB0000                333                             MOV BX, 0
0200 C6878D0024            334                             MOV DS:SEND_BUFFER[BX], '$'
0205 43                    335                             INC BX
0206 C6878D002F            336                             MOV DS:SEND_BUFFER[BX], '/'
020B C7069A000200          337                             MOV DS:SEND_BUFFER_LEN, 2
0211 C6068C0001            338                             MOV DS:SEND_FLAG, 1
0216 C706B8000000          339                             MOV DS:TOTAL_PRICE_DEC, 0
021C C706B6000000          340                             MOV DS:TOTAL_PRICE_L, 0
0222 C706B4000000          341                             MOV DS:TOTAL_PRICE_U, 0
0228 833EE60001            342                             CMP DS:CANCEL_FLAG, 1
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:34:13  12/07/;3  PAGE    8


LOC  OBJ                  LINE     SOURCE

022D 7406                  343                             JE END_TRANS_CONT
022F C706C8000100          344                             MOV DS:CASH_FLAG, 1
0235                       345                     END_TRANS_CONT:
0235 E9EE00                346                             JMP UPDATE_7SEG2
                           347                             
0238                       348     CANCEL_TRANS:   
0238 803E79000F            349                             CMP DS:REG_AL, 15
023D 755A                  350                             JNE SCROLL_LEFT
023F 833EC80001            351                             CMP DS:CASH_FLAG, 1
0244 7503                  352                             JNE CONT_CANCEL
0246 E9DD00                353                             JMP UPDATE_7SEG2
0249                       354                     CONT_CANCEL:
0249 BB0000                355                             MOV BX, 0
024C C6878D003F            356                             MOV DS:SEND_BUFFER[BX], '?'
0251 43                    357                             INC BX
0252 C6878D002F            358                             MOV DS:SEND_BUFFER[BX], '/'
0257 C7069A000200          359                             MOV DS:SEND_BUFFER_LEN, 2
025D C6068C0001            360                             MOV DS:SEND_FLAG, 1
0262 C706B8000000          361                             MOV DS:TOTAL_PRICE_DEC, 0
0268 C706B6000000          362                             MOV DS:TOTAL_PRICE_L, 0
026E C706B4000000          363                             MOV DS:TOTAL_PRICE_U, 0
0274 C706AC000300          364                             MOV DS:DECIMAL_INDEX, 3
027A 9ABA05----     R      365                             CALL FAR PTR BCD_CLEAR
027F C7069C000000          366                             MOV DS:MAX_INPUT_SIZE, 0
                           367                             
0285 9A7804----     R      368                             CALL FAR PTR CLEAR_TEMP_BCD
                           369                             
028A C706E6000100          370                             MOV DS:CANCEL_FLAG, 1
0290 C706FA000000          371                             MOV DS:TROLLEY_DISABLED, 0
0296 E98D00                372                             JMP UPDATE_7SEG2
                           373                             
0299                       374     SCROLL_LEFT:
0299 803E790015            375                             CMP DS:REG_AL, 21
029E 753D                  376                             JNE SCROLL_RIGHT
02A0 833E610006            377                             CMP DS:KEYPAD_INDEX, 6
02A5 7E7F                  378                             JLE UPDATE_7SEG2
02A7 833EA80000            379                             CMP DS:SCROLL_LEN, 0
02AC 7478                  380                             JE UPDATE_7SEG2
02AE FF0EA800              381                             DEC DS:SCROLL_LEN
02B2 FF0EAC00              382                             DEC DS:DECIMAL_INDEX
02B6 FF0E6100              383                             DEC DS:KEYPAD_INDEX
02BA 8B1E6100              384                             MOV BX, DS:KEYPAD_INDEX
02BE 8A4751                385                             MOV AL, DS:KEYPAD_INPUT[BX]
02C1 A27900                386                             MOV DS:REG_AL, AL
02C4 C706AA000100          387                             MOV DS:DAC_DISABLE, 1
02CA 9AE505----     R      388                             CALL FAR PTR BCD_UPDATE
02CF C706AA000000          389                             MOV DS:DAC_DISABLE, 0
02D5 C606790015            390                             MOV DS:REG_AL, 21
02DA EB4A90                391                             JMP UPDATE_7SEG2
                           392     
02DD                       393     SCROLL_RIGHT:
02DD 803E790013            394                             CMP DS:REG_AL, 19
02E2 7545                  395                             JNE LANG_TOGGLE
02E4 833E610006            396                             CMP DS:KEYPAD_INDEX, 6
02E9 7E3B                  397                             JLE UPDATE_7SEG2
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:34:13  12/07/;3  PAGE    9


LOC  OBJ                  LINE     SOURCE

02EB A16100                398                             MOV AX, DS:KEYPAD_INDEX
02EE 2D0600                399                             SUB AX, 6
02F1 3906A800              400                             CMP DS:SCROLL_LEN, AX
02F5 742F                  401                             JE UPDATE_7SEG2
02F7 FF06A800              402                             INC DS:SCROLL_LEN
02FB FF06AC00              403                             INC DS:DECIMAL_INDEX
02FF FF0E6100              404                             DEC DS:KEYPAD_INDEX
0303 8B1E6100              405                             MOV BX, DS:KEYPAD_INDEX
0307 8A4751                406                             MOV AL, DS:KEYPAD_INPUT[BX]
030A A27900                407                             MOV DS:REG_AL, AL
030D C706AA000100          408                             MOV DS:DAC_DISABLE, 1
0313 9AE505----     R      409                             CALL FAR PTR BCD_UPDATE
0318 C706AA000000          410                             MOV DS:DAC_DISABLE, 0
031E C606790013            411                             MOV DS:REG_AL, 19
0323 EB0190                412                             JMP UPDATE_7SEG2
                           413                             
0326 E9DE00                414     UPDATE_7SEG2: JMP UPDATE_7SEG
                           415     
0329                       416     LANG_TOGGLE:
0329 803E790012            417                             CMP DS:REG_AL, 18
032E 7537                  418                             JNE QTY_PROMPT
0330 833EAE0001            419                             CMP DS:LANG_FLAG, 1
0335 75EF                  420                             JNE UPDATE_7SEG2
0337 A16400                421                             MOV AX, DS:DAC_BASE
033A 3D0040                422                             CMP AX, 4000H
033D 7406                  423                             JE MANDRIN
033F B80040                424                             MOV AX, 4000H
0342 EB0490                425                             JMP SEND_TOGGLE
0345                       426             MANDRIN:
0345 B80065                427                             MOV AX, 6500H
0348                       428             SEND_TOGGLE:
0348 A36400                429                             MOV DS:DAC_BASE, AX
034B BB0000                430                             MOV BX, 0
034E C6878D0021            431                             MOV DS:SEND_BUFFER[BX], '!'
0353 43                    432                             INC BX
0354 C6878D002F            433                             MOV DS:SEND_BUFFER[BX], '/'
0359 C7069A000200          434                             MOV DS:SEND_BUFFER_LEN, 2
035F C6068C0001            435                             MOV DS:SEND_FLAG, 1
0364 E9A000                436                             JMP UPDATE_7SEG
0367                       437     QTY_PROMPT:
0367 803E790016            438                             CMP DS:REG_AL, 22
036C 7527                  439                             JNE QUANTITY
036E 833EC80001            440                             CMP DS:CASH_FLAG, 1
0373 7420                  441                             JE QUANTITY
0375 833E610008            442                             CMP DS:KEYPAD_INDEX, 8
037A 7519                  443                             JNE  QUANTITY
                           444                             ; CMP DS:MAX_INPUT_SIZE, 8
                           445                             ; JNE QUANTITY
037C 9A0405----     R      446                             CALL FAR PTR UPDATE_SEND_BUFFER
0381 9ABA05----     R      447                             CALL FAR PTR BCD_CLEAR
0386 C7069C000200          448                             MOV DS:MAX_INPUT_SIZE, 2
038C C7069E000100          449                             MOV DS:QTY_FLAG, 1
0392 EB7390                450                             JMP UPDATE_7SEG
                           451                     
0395                       452     QUANTITY:
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:34:13  12/07/;3  PAGE   10


LOC  OBJ                  LINE     SOURCE

0395 833E610000            453                             CMP DS:KEYPAD_INDEX, 0
039A 746B                  454                             JE  UPDATE_7SEG
                           455                             
039C 803E79000E            456                             CMP DS:REG_AL, 14
03A1 7564                  457                             JNE UPDATE_7SEG
                           458                             
03A3 833EF80001            459                             CMP DS:TROLLEY_ID, 1
03A8 752C                  460                             JNE NORMAL_UPDATE
                           461                             
03AA 833E610006            462                             CMP DS:KEYPAD_INDEX, 6
03AF 7525                  463                             JNE NORMAL_UPDATE
                           464                             
03B1 9A4504----     R      465                             CALL FAR PTR UPDATE_TROLLEY_ID
                           466                             
03B6 C706F8000000          467                             MOV DS:TROLLEY_ID, 0
03BC C6068C0001            468                             MOV DS:SEND_FLAG, 1
03C1 C706EA000000          469                             MOV DS:DATA_ENTER, 0
03C7 C706E6000000          470                             MOV DS:CANCEL_FLAG, 0
03CD C706C8000100          471                             MOV DS:CASH_FLAG, 1
                           472                             
03D3 EB3290                473                             JMP UPDATE_7SEG
                           474                             
03D6                       475                     NORMAL_UPDATE:  
03D6 833E9E0001            476                             CMP DS:QTY_FLAG, 1
03DB 752A                  477                             JNE UPDATE_7SEG
                           478                             
03DD C706EA000000          479                             MOV DS:DATA_ENTER, 0
                           480                             
03E3 C706E6000000          481                             MOV DS:CANCEL_FLAG, 0
                           482                     
03E9 9AB304----     R      483                             CALL FAR PTR UPDATE_THE_QUANTITY
                           484                             
03EE C706FA000100          485                             MOV DS:TROLLEY_DISABLED, 1
03F4 C6068C0001            486                             MOV DS:SEND_FLAG, 1
                           487                             
03F9 C7069E000000          488                             MOV DS:QTY_FLAG, 0
03FF 9ABA05----     R      489                             CALL FAR PTR BCD_CLEAR
0404 EB0190                490                             JMP UPDATE_7SEG
                           491                             
                           492     
0407                       493     UPDATE_7SEG:
0407 803E790009            494                             CMP DS:REG_AL, 9
040C 7F0C                  495                             JG SET_PRESS_FLAG
                           496                             
040E 833EEA0001            497                             CMP DS:DATA_ENTER, 1
0413 7505                  498                             JNE SET_PRESS_FLAG
                           499                             
0415 9AE505----     R      500                             CALL FAR PTR BCD_UPDATE
                           501                             
041A                       502     SET_PRESS_FLAG:
041A C6067D0001            503                             MOV DS:LONG_PRESS_FLAG, 1
041F EB1F90                504                             JMP RETURN
                           505             
0422                       506     KEYPAD_2: 
0422 800679000F            507                 ADD DS:REG_AL,0FH
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:34:13  12/07/;3  PAGE   11


LOC  OBJ                  LINE     SOURCE

0427 E962FC                508                             JMP NXTCOL
042A C606790000            509     ZERO_PRINT: MOV DS:REG_AL,00H
042F E95AFC                510                             JMP NXTCOL
0432 802E790006            511     SUBTRACT:   SUB DS:REG_AL,06H
0437 8ADD                  512                             MOV BL,CH
0439 FE0E7A00              513                             DEC DS:REG_BH
043D E930FC                514                             JMP NXTROW
                           515             
                           516             
0440                       517     RETURN:
0440 5A                    518                             POP DX
0441 59                    519                             POP CX
0442 5B                    520                             POP BX
0443 58                    521                             POP AX
0444 CB                    522                             RET
                           523     
                           524     KEYPAD_LOOP ENDP
                           525     
0445                       526     UPDATE_TROLLEY_ID PROC FAR
0445 50                    527     PUSH AX
0446 53                    528     PUSH BX
0447 51                    529     PUSH CX
0448 52                    530     PUSH DX
0449 BB0000                531             MOV BX, 0
044C C6878D005E            532             MOV DS:SEND_BUFFER[BX], '^'
0451 B90600                533             MOV CX, 6
0454                       534             UPDATE_TROLLEY_BUFFER:
0454 BB0600                535                     MOV BX, 6
0457 2BD9                  536                     SUB BX, CX
                           537                     
0459 8A4751                538                     MOV AL, DS:KEYPAD_INPUT[BX]
                           539                     
045C 43                    540                     INC BX
045D 0430                  541                     ADD AL, 30H
045F 88878D00              542                     MOV DS:SEND_BUFFER[BX], AL
0463 E2EF                  543             LOOP UPDATE_TROLLEY_BUFFER
                           544             
0465 BB0700                545             MOV BX, 7
0468 C6878D002F            546             MOV DS:SEND_BUFFER[BX], '/'
                           547             
046D C7069A000800          548             MOV DS:SEND_BUFFER_LEN, 8
                           549     
0473 5A                    550     POP DX
0474 59                    551     POP CX
0475 5B                    552     POP BX
0476 58                    553     POP AX
0477 CB                    554     RET
                           555     UPDATE_TROLLEY_ID ENDP
                           556     
0478                       557     CLEAR_TEMP_BCD PROC FAR
0478 50                    558     PUSH AX
0479 53                    559     PUSH BX
047A 51                    560     PUSH CX
047B 52                    561     PUSH DX
                           562     
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:34:13  12/07/;3  PAGE   12


LOC  OBJ                  LINE     SOURCE

047C BB0000                563             MOV BX, 0
047F C687BA002D            564             MOV DS:TEMP_BCD_ARR[BX], '-'
0484 43                    565             INC BX
0485 C687BA002D            566             MOV DS:TEMP_BCD_ARR[BX], '-'
048A 43                    567             INC BX
048B C687BA002D            568             MOV DS:TEMP_BCD_ARR[BX], '-'
0490 43                    569             INC BX
0491 C687BA002D            570             MOV DS:TEMP_BCD_ARR[BX], '-'
0496 43                    571             INC BX
0497 C687BA002D            572             MOV DS:TEMP_BCD_ARR[BX], '-'
049C 43                    573             INC BX
049D C687BA002D            574             MOV DS:TEMP_BCD_ARR[BX], '-'
04A2 43                    575             INC BX
04A3 C687BA002D            576             MOV DS:TEMP_BCD_ARR[BX], '-'
04A8 43                    577             INC BX
04A9 C687BA002D            578             MOV DS:TEMP_BCD_ARR[BX], '-'
                           579             
04AE 5A                    580     POP DX
04AF 59                    581     POP CX
04B0 5B                    582     POP BX
04B1 58                    583     POP AX
04B2 CB                    584     RET
                           585     CLEAR_TEMP_BCD ENDP
                           586     
                           587     
04B3                       588     UPDATE_THE_QUANTITY PROC FAR
04B3 50                    589     PUSH AX
04B4 53                    590     PUSH BX
04B5 51                    591     PUSH CX
04B6 52                    592     PUSH DX
04B7 8B0E6100              593             MOV CX, DS:KEYPAD_INDEX
04BB BB0000                594             MOV BX, 0
04BE BA0000                595             MOV DX, 0
04C1                       596             UPD_QTY:
04C1 A1B200                597                     MOV AX, DS:QTY
04C4 53                    598                     PUSH BX
04C5 BB0A00                599                     MOV BX, 10
04C8 F7E3                  600                     MUL BX
04CA 5B                    601                     POP BX
04CB 8A5751                602                     MOV DL, DS:KEYPAD_INPUT[BX]
04CE 03C2                  603                     ADD AX, DX
04D0 A3B200                604                     MOV DS:QTY, AX
04D3 43                    605                     INC BX
04D4 E2EB                  606             LOOP UPD_QTY
                           607             
04D6 8B0E6100              608             MOV CX, DS:KEYPAD_INDEX
04DA 8B1E9A00              609             MOV BX, DS:SEND_BUFFER_LEN
                           610             
04DE                       611             UPD_BUFFER:
04DE 53                    612                     PUSH BX
04DF 8B1E6100              613                     MOV BX, DS:KEYPAD_INDEX
04E3 2BD9                  614                     SUB BX, CX
04E5 8A4751                615                     MOV AL, DS:KEYPAD_INPUT[BX]
04E8 5B                    616                     POP BX
04E9 0430                  617                     ADD AL, 30H
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:34:13  12/07/;3  PAGE   13


LOC  OBJ                  LINE     SOURCE

04EB 88878D00              618                     MOV DS:SEND_BUFFER[BX], AL
                           619                     
04EF 43                    620                     INC BX
04F0 FF069A00              621                     INC DS:SEND_BUFFER_LEN
04F4 E2E8                  622             LOOP UPD_BUFFER
                           623             
04F6 C6878D002F            624             MOV DS:SEND_BUFFER[BX], '/'
04FB FF069A00              625             INC DS:SEND_BUFFER_LEN
                           626                     
04FF 5A                    627     POP DX
0500 59                    628     POP CX
0501 5B                    629     POP BX
0502 58                    630     POP AX
                           631     
0503 CB                    632     RET
                           633     UPDATE_THE_QUANTITY ENDP
                           634     
0504                       635     UPDATE_SEND_BUFFER PROC FAR
0504 50                    636     PUSH AX
0505 53                    637     PUSH BX
0506 51                    638     PUSH CX
0507 52                    639     PUSH DX
                           640     
0508 8B0E6100              641             MOV CX, DS:KEYPAD_INDEX
050C 83F900                642             CMP CX, 0
050F 7435                  643             JE END_UPD_BUFFER
0511 83C102                644             ADD CX, 2
0514 890E9A00              645             MOV DS:SEND_BUFFER_LEN, CX
0518 BB0000                646             MOV BX, 0
051B                       647             BUFFER_LOOP:
051B 83FB00                648                     CMP BX, 0
051E 7508                  649                     JNE ASTERISK
0520 C6878D007E            650                     MOV DS:SEND_BUFFER[BX], '~'
0525 EB1C90                651                     JMP END_BUFFER
0528                       652             ASTERISK:
0528 A16100                653                     MOV AX, DS:KEYPAD_INDEX
052B 40                    654                     INC AX
052C 3BD8                  655                     CMP BX, AX
052E 7508                  656                     JNE CONT
0530 C6878D002A            657                     MOV DS:SEND_BUFFER[BX], '*'
0535 EB0C90                658                     JMP END_BUFFER
0538                       659             CONT:
0538 4B                    660                     DEC BX
0539 8A4751                661                     MOV AL, DS:KEYPAD_INPUT[BX]
053C 0430                  662                     ADD AL, 30H
053E 43                    663                     INC BX
053F 88878D00              664                     MOV DS:SEND_BUFFER[BX], AL
                           665                     
0543                       666             END_BUFFER:
0543 43                    667                     INC BX
0544 E2D5                  668             LOOP BUFFER_LOOP
0546                       669     END_UPD_BUFFER:
0546 5A                    670     POP DX
0547 59                    671     POP CX
0548 5B                    672     POP BX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:34:13  12/07/;3  PAGE   14


LOC  OBJ                  LINE     SOURCE

0549 58                    673     POP AX
054A CB                    674     RET
                           675     UPDATE_SEND_BUFFER ENDP
                           676     
054B                       677     BCD_BACKSPACE PROC FAR
                           678     
054B 50                    679     PUSH AX
054C 53                    680     PUSH BX
054D 51                    681     PUSH CX
054E 52                    682     PUSH DX
                           683     
054F 8A167900              684             MOV DL, DS:REG_AL
0553 833E610000            685             CMP DS:KEYPAD_INDEX, 0
0558 7457                  686             JE RETURN_BACK
                           687             
055A BB0600                688             MOV BX, 6
055D                       689             BCD_CLEAR_LOOP:
055D 4B                    690                     DEC BX
055E C647592D              691                     MOV DS:BCD_MESSAGE[BX], '-'
0562 43                    692                     INC BX
0563 4B                    693                     DEC BX
0564 75F7                  694             JNZ BCD_CLEAR_LOOP
                           695             
0566 833E610001            696             CMP DS:KEYPAD_INDEX, 1
056B 7E2C                  697             JLE less_than_two
                           698             
056D FF0E6100              699             DEC DS:KEYPAD_INDEX
0571 FF0E6100              700             DEC DS:KEYPAD_INDEX
0575 8B1E6100              701             MOV BX, DS:KEYPAD_INDEX
0579 8A4751                702             MOV AL, DS:KEYPAD_INPUT[BX]
057C A27900                703             MOV DS:REG_AL, AL
057F C706A8000000          704             MOV DS:SCROLL_LEN, 0
0585 C706AA000100          705             MOV DS:DAC_DISABLE, 1
058B 9AE505----     R      706             CALL FAR PTR BCD_UPDATE
0590 C706AA000000          707             MOV DS:DAC_DISABLE, 0
0596 EB1990                708             JMP RETURN_BACK
                           709             
0599                       710     less_than_two:
0599 FF0E6100              711             DEC DS:KEYPAD_INDEX
059D C60679002D            712             MOV DS:REG_AL, '-'
05A2 C706A8000000          713             MOV DS:SCROLL_LEN, 0
05A8 9AE505----     R      714             CALL FAR PTR BCD_UPDATE
05AD FF0E6100              715             DEC DS:KEYPAD_INDEX
                           716             
05B1                       717     RETURN_BACK:
05B1 88167900              718             MOV DS:REG_AL, DL
05B5 5A                    719     POP DX
05B6 59                    720     POP CX
05B7 5B                    721     POP BX
05B8 58                    722     POP AX
                           723     
05B9 CB                    724     RET
                           725     BCD_BACKSPACE ENDP
                           726     
05BA                       727     BCD_CLEAR PROC FAR
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:34:13  12/07/;3  PAGE   15


LOC  OBJ                  LINE     SOURCE

05BA 50                    728     PUSH AX
05BB 53                    729     PUSH BX
05BC 51                    730     PUSH CX
05BD 52                    731     PUSH DX
05BE BB0800                732             MOV BX, 8
05C1                       733             CLEAR_LOOP:
05C1 C6475100              734             MOV DS:KEYPAD_INPUT[BX], 0
05C5 4B                    735             DEC BX
05C6 75F9                  736             JNZ CLEAR_LOOP
                           737             
05C8 BB0600                738             MOV BX, 6
05CB                       739             CLEAR_LOOP2:
05CB 4B                    740                     DEC BX
05CC C647592D              741                     MOV DS:BCD_MESSAGE[BX], '-'
05D0 43                    742                     INC BX
05D1 4B                    743                     DEC BX
05D2 75F7                  744             JNZ CLEAR_LOOP2
                           745     
05D4 C70661000000          746             MOV DS:KEYPAD_INDEX, 0
05DA C706A8000000          747             MOV DS:SCROLL_LEN, 0
05E0 5A                    748     POP DX
05E1 59                    749     POP CX
05E2 5B                    750     POP BX
05E3 58                    751     POP AX
05E4 CB                    752     RET
                           753     BCD_CLEAR ENDP
                           754     
05E5                       755     BCD_UPDATE PROC FAR
05E5 50                    756     PUSH AX
05E6 53                    757     PUSH BX
05E7 51                    758     PUSH CX
05E8 52                    759     PUSH DX
05E9 A19C00                760                     MOV AX, DS:MAX_INPUT_SIZE
05EC 39066100              761                     CMP DS:KEYPAD_INDEX, AX
05F0 7D5A                  762                     JGE BCD_RET
                           763                     
05F2 8A0E7900              764                     MOV CL, DS:REG_AL
05F6 80F909                765                     CMP CL, 9
05F9 7F0C                  766                     JG SKIP_PAST
05FB 833EAA0001            767                     CMP DS:DAC_DISABLE, 1
0600 7405                  768                     JE SKIP_PAST
0602 9A5106----     R      769                     CALL FAR PTR DAC_UPDATE
                           770     
0607                       771     SKIP_PAST:              
0607 8A0E7900              772                     MOV CL, DS:REG_AL
                           773     
060B 8B1E6100              774                     MOV BX, DS:KEYPAD_INDEX
                           775                             
060F 884F51                776                     MOV DS:KEYPAD_INPUT[BX], CL
                           777                             
0612 FF066100              778                     INC DS:KEYPAD_INDEX
                           779                             
0616 8B1E6100              780                     MOV BX, DS:KEYPAD_INDEX
                           781                     
061A A1A800                782                     MOV AX, DS:SCROLL_LEN
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:34:13  12/07/;3  PAGE   16


LOC  OBJ                  LINE     SOURCE

061D 2BD8                  783                     SUB BX, AX
                           784                     
061F 8B166100              785                     MOV DX, DS:KEYPAD_INDEX
0623 83FA06                786                     CMP DX, 6
0626 7E03                  787                     JLE update_display
0628 BA0600                788                     MOV DX, 6
                           789                     
062B                       790             update_display:
                           791             
062B B90500                792                     MOV CX, 5
062E 4B                    793                     DEC BX
062F 8A4751                794                     MOV AL, DS:KEYPAD_INPUT[BX]
0632 43                    795                     INC BX
                           796                             
0633 52                    797                     PUSH DX
0634 8B166100              798                     MOV DX, DS:KEYPAD_INDEX
0638 2B16A800              799                     SUB DX, DS:SCROLL_LEN
                           800                     
063C 2BD3                  801                     SUB DX, BX
                           802                             
063E 53                    803                     PUSH BX
                           804                             
063F 2BCA                  805                     SUB CX, DX
0641 8BD9                  806                     MOV BX, CX
0643 884759                807                     MOV DS:BCD_MESSAGE[BX], AL
                           808                             
0646 5B                    809                     POP BX
0647 5A                    810                     POP DX
                           811             
0648 4B                    812                     DEC BX
0649 4A                    813                     DEC DX
064A 75DF                  814             JNZ update_display
                           815     
064C                       816             BCD_RET:
064C 5A                    817                     POP DX
064D 59                    818                     POP CX
064E 5B                    819                     POP BX
064F 58                    820                     POP AX
0650 CB                    821     RET
                           822     BCD_UPDATE ENDP
                           823     
0651                       824     DAC_UPDATE PROC FAR
0651 50                    825             PUSH AX
0652 53                    826             PUSH BX
0653 51                    827             PUSH CX
0654 52                    828             PUSH DX
                           829             
0655 BB0000                830             MOV BX, 0
0658 8A1E7500              831             MOV BL, DS:DAC_LEN
065C A07900                832             MOV AL, DS:REG_AL
                           833             
065F 884766                834             MOV DS:DAC_ADDR[BX], AL
                           835             
0662 FE067500              836             INC DS:DAC_LEN
                           837     
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:34:13  12/07/;3  PAGE   17


LOC  OBJ                  LINE     SOURCE

0666 5A                    838             POP DX
0667 59                    839             POP CX
0668 5B                    840             POP BX
0669 58                    841             POP AX
066A CB                    842     RET
                           843     DAC_UPDATE ENDP
                           844               
066B                       845     DEBOUNCE PROC FAR
066B 51                    846                       PUSH CX
                           847                       
066C B94C09                848                       MOV CX, 094CH
066F 90                    849     BACK:     NOP
0670 E2FD                  850                       LOOP BACK
0672 59                    851                       POP CX
0673 CB                    852                       RET
                           853     DEBOUNCE  ENDP
                           854     
0674                       855     SEND_INPUT PROC FAR
0674 50                    856     PUSH AX
0675 53                    857     PUSH BX
0676 51                    858     PUSH CX
0677 52                    859     PUSH DX
0678 BB0000                860             MOV BX, 0
067B 8B0E9A00              861             MOV CX, DS:SEND_BUFFER_LEN
                           862             
067F                       863             S_BUFF:
067F 8A878D00              864                     MOV AL, DS:SEND_BUFFER[BX]
0683 9A0000----     E      865                     CALL FAR PTR PRINT_CHAR
0688 43                    866                     INC BX
0689 E2F4                  867             LOOP S_BUFF
                           868             
068B                       869     SEND_INPUT_END:
068B 5A                    870     POP DX
068C 59                    871     POP CX
068D 5B                    872     POP BX
068E 58                    873     POP AX
068F CB                    874     RET
                           875     SEND_INPUT ENDP
                           876     
0690                       877     TAKE_CASH PROC FAR
0690 50                    878     PUSH AX
0691 53                    879     PUSH BX
0692 51                    880     PUSH CX
0693 52                    881     PUSH DX
                           882             
0694 B90000                883             MOV CX, 0
0697 B108                  884             MOV CL, 8
0699                       885             CLEAR_CASH_AMT:
0699 8BD9                  886                     MOV BX, CX
069B 4B                    887                     DEC BX
069C C687CA0000            888                     MOV DS:CASH_AMT[BX], 0
06A1 E2F6                  889             LOOP CLEAR_CASH_AMT
                           890             
06A3 8B0E6100              891             MOV CX, DS:KEYPAD_INDEX
06A7 BA0600                892             MOV DX, 6
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:34:13  12/07/;3  PAGE   18


LOC  OBJ                  LINE     SOURCE

                           893             
06AA                       894             UPDATE_CASH_AMT:
06AA 8BD9                  895                     MOV BX, CX
06AC 4B                    896                     DEC BX
                           897                     
06AD 33C0                  898                     XOR AX, AX
06AF 8A4751                899                     MOV AL, DS:KEYPAD_INPUT[BX]
                           900                     
06B2 8BDA                  901                     MOV BX, DX
06B4 4B                    902                     DEC BX
06B5 8887CA00              903                     MOV DS:CASH_AMT[BX], AL
                           904                     
06B9 4A                    905                     DEC DX
06BA E2EE                  906             LOOP UPDATE_CASH_AMT
                           907             
06BC C706E2000100          908             MOV DS:CASH_OK_FLAG, 1
06C2 C706E4000700          909             MOV DS:BORROW_POSITION, 7
06C8 B90800                910             MOV CX, 8
06CB                       911             CHECK_CASH:
06CB BB0800                912                     MOV BX, 8
06CE 2BD9                  913                     SUB BX, CX
06D0 B80000                914                     MOV AX, 0
06D3 8A87BA00              915                     MOV AL, DS:TEMP_BCD_ARR[BX]
06D7 8A97CA00              916                     MOV DL, DS:CASH_AMT[BX]
06DB 3AD0                  917                     CMP DL, AL
06DD 741A                  918                     JE NEXT_CASH_DIGIT
                           919                     
06DF 3AD0                  920                     CMP DL, AL
06E1 7C0D                  921                     JL CASH_NOT_OK
                           922                     
06E3 C706E2000100          923                     MOV DS:CASH_OK_FLAG, 1
06E9 891EE400              924                     MOV DS:BORROW_POSITION, BX
                           925                     
06ED EB0C90                926                     JMP CHEK_CASH_DONE
                           927                     
06F0                       928                     CASH_NOT_OK:
06F0 C706E2000000          929                     MOV DS:CASH_OK_FLAG, 0
06F6 EB0390                930                     JMP CHEK_CASH_DONE
                           931                     
06F9                       932             NEXT_CASH_DIGIT:
06F9 E2D0                  933             LOOP CHECK_CASH
                           934             
06FB                       935     CHEK_CASH_DONE:
                           936             
06FB 833EE20001            937             CMP DS:CASH_OK_FLAG, 1
0700 7464                  938             JE CONTINUE_CASH
0702 B90800                939             MOV CX, 8
0705 C70661000000          940             MOV DS:KEYPAD_INDEX, 0
070B C706AC000300          941             MOV DS:DECIMAL_INDEX, 3
0711                       942             RETAIN_BCD:
0711 BB0800                943                     MOV BX, 8
0714 2BD9                  944                     SUB BX, CX
                           945                     
0716 8A87BA00              946                     MOV AL, DS:TEMP_BCD_ARR[BX]
071A A27900                947                     MOV DS:REG_AL, AL
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:34:13  12/07/;3  PAGE   19


LOC  OBJ                  LINE     SOURCE

                           948                     
071D C706AA000100          949                     MOV DS:DAC_DISABLE, 1
0723 9AE505----     R      950                     CALL FAR PTR BCD_UPDATE
0728 C706AA000000          951                     MOV DS:DAC_DISABLE, 0
072E E2E1                  952             LOOP RETAIN_BCD
0730 813E64000040          953             CMP DS:DAC_BASE, 4000H
0736 7517                  954             JNE MANDARIN_CASH
                           955             
0738 C606790023            956             MOV DS:REG_AL, 35
073D 9A5106----     R      957             CALL FAR PTR DAC_UPDATE
0742 C606790024            958             MOV DS:REG_AL, 36
0747 9A5106----     R      959             CALL FAR PTR DAC_UPDATE
074C E9B200                960             JMP CASH_OVER
                           961             
074F                       962     MANDARIN_CASH:
074F C606790012            963             MOV DS:REG_AL, 18
0754 9A5106----     R      964             CALL FAR PTR DAC_UPDATE
0759 C606790013            965             MOV DS:REG_AL, 19
075E 9A5106----     R      966             CALL FAR PTR DAC_UPDATE
0763 E99B00                967             JMP CASH_OVER
                           968             
0766                       969     CONTINUE_CASH:
0766 8B1EE400              970             MOV BX, DS:BORROW_POSITION
076A B90700                971             MOV CX, 7
076D 2BCB                  972             SUB CX, BX
076F 83F900                973             CMP CX, 0
0772 740C                  974             JE BEGIN_SUB
                           975             
0774                       976             ADJUST_PLACES:
0774 FE8FCA00              977                     DEC DS:CASH_AMT[BX]
0778 43                    978                     INC BX
0779 8087CA000A            979                     ADD DS:CASH_AMT[BX], 10
077E E2F4                  980             LOOP ADJUST_PLACES
                           981             
0780                       982     BEGIN_SUB:
0780 B90800                983             MOV CX, 8
0783                       984             CALC_CHANGE:
0783 BB0800                985                     MOV BX, 8
0786 2BD9                  986                     SUB BX, CX
0788 B80000                987                     MOV AX, 0
078B 8A87CA00              988                     MOV AL, DS:CASH_AMT[BX]
078F BA0000                989                     MOV DX, 0
0792 8A97BA00              990                     MOV DL, DS:TEMP_BCD_ARR[BX]
0796 2BC2                  991                     SUB AX, DX
0798 8987D200              992                     MOV DS:TEMP_CASH_ARR[BX], AX
079C E2E5                  993             LOOP CALC_CHANGE
                           994             
079E B90800                995             MOV CX, 8
07A1                       996             FIX_DIGITS:
07A1 8BD9                  997             MOV BX, CX
07A3 4B                    998             DEC BX
                           999             
07A4 8B87D200             1000             MOV AX, DS:TEMP_CASH_ARR[BX]
07A8 3C0A                 1001             CMP AL, 10
07AA 7C0A                 1002             JL NEXT_DIGIT_TO_FIX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:34:13  12/07/;3  PAGE   20


LOC  OBJ                  LINE     SOURCE

                          1003             
07AC 83AFD2000A           1004             SUB DS:TEMP_CASH_ARR[BX], 10
                          1005             
07B1 4B                   1006             DEC BX
07B2 FF87D200             1007             INC DS:TEMP_CASH_ARR[BX]
                          1008             
07B6                      1009             NEXT_DIGIT_TO_FIX:
                          1010             
07B6 E2E9                 1011             LOOP FIX_DIGITS
                          1012             
07B8 B90800               1013             MOV CX, 8
07BB C70661000000         1014             MOV DS:KEYPAD_INDEX, 0
07C1 C706AC000300         1015             MOV DS:DECIMAL_INDEX, 3
07C7                      1016             UPDATE_BCD_TO_CASH:
07C7 BB0800               1017                     MOV BX, 8
07CA 2BD9                 1018                     SUB BX, CX
07CC 8B87D200             1019                     MOV AX, DS:TEMP_CASH_ARR[BX]
07D0 8887BA00             1020                     MOV DS:TEMP_BCD_ARR[BX], AL
07D4 A27900               1021                     MOV DS:REG_AL, AL
07D7 C706AA000100         1022                     MOV DS:DAC_DISABLE, 1
07DD 9AE505----     R     1023                     CALL FAR PTR BCD_UPDATE
07E2 C706AA000000         1024                     MOV DS:DAC_DISABLE, 0
07E8 E2DD                 1025             LOOP UPDATE_BCD_TO_CASH
                          1026             
07EA 9A0608----     R     1027             CALL FAR PTR CALC_DAC
                          1028             
07EF C706C8000000         1029             MOV DS:CASH_FLAG, 0
07F5 C706E8000100         1030             MOV DS:TRANSACTION_OVER, 1
07FB C706FA000000         1031             MOV DS:TROLLEY_DISABLED, 0
                          1032             
0801                      1033     CASH_OVER:
0801 5A                   1034     POP DX
0802 59                   1035     POP CX
0803 5B                   1036     POP BX
0804 58                   1037     POP AX
                          1038     
0805 CB                   1039     RET
                          1040     TAKE_CASH ENDP
                          1041     
0806                      1042     CALC_DAC PROC FAR
0806 50                   1043     PUSH AX
0807 53                   1044     PUSH BX
0808 51                   1045     PUSH CX
0809 52                   1046     PUSH DX
080A 813E64000040         1047             CMP DS:DAC_BASE, 4000H
0810 7403                 1048             JE ENGLISH_DAC
0812 E98E01               1049             JMP MANDARIN_DAC
                          1050             
0815                      1051     ENGLISH_DAC:
0815 C706C4000000         1052             MOV DS:CENT_FLAG, 0
081B C706C2000000         1053             MOV DS:THOUSAND_FLAG, 0
0821 C706C6000000         1054             MOV DS:DOLLAR_FLAG,     0
0827 BB0000               1055             MOV BX, 0
082A 8A87BA00             1056             MOV AL, DS:TEMP_BCD_ARR[BX]
082E A27900               1057             MOV DS:REG_AL, AL
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:34:13  12/07/;3  PAGE   21


LOC  OBJ                  LINE     SOURCE

0831 3C00                 1058             CMP AL, 0
0833 7415                 1059             JE NEXT_PLACE
0835 C706C6000100         1060             MOV DS:DOLLAR_FLAG, 1
083B 9A5106----     R     1061             CALL FAR PTR DAC_UPDATE
0840 C60679001C           1062             MOV DS:REG_AL, 28
0845 9A5106----     R     1063             CALL FAR PTR DAC_UPDATE
                          1064             
084A                      1065     NEXT_PLACE:     
084A 43                   1066             INC BX
084B 8A87BA00             1067             MOV AL, DS:TEMP_BCD_ARR[BX]
084F 3C01                 1068             CMP AL, 1
0851 751E                 1069             JNE NOT_1
0853 C706C6000100         1070             MOV DS:DOLLAR_FLAG, 1
0859 43                   1071             INC BX
085A 8A87BA00             1072             MOV AL, DS:TEMP_BCD_ARR[BX]
085E 040A                 1073             ADD AL, 10
0860 A27900               1074             MOV DS:REG_AL, AL
0863 9A5106----     R     1075             CALL FAR PTR DAC_UPDATE
0868 C706C2000100         1076             MOV DS:THOUSAND_FLAG, 1
086E EB3890               1077             JMP HUNDREDS_PLACE
0871                      1078     NOT_1:
0871 3C00                 1079             CMP AL, 0
0873 7416                 1080             JE NEXT_PLACE_1
0875 C706C6000100         1081             MOV DS:DOLLAR_FLAG, 1
087B C706C2000100         1082             MOV DS:THOUSAND_FLAG, 1
0881 0412                 1083             ADD AL, 18
0883 A27900               1084             MOV DS:REG_AL, AL
0886 9A5106----     R     1085             CALL FAR PTR DAC_UPDATE
088B                      1086     NEXT_PLACE_1:
088B 43                   1087             INC BX
088C 8A87BA00             1088             MOV AL, DS:TEMP_BCD_ARR[BX]
0890 3C00                 1089             CMP AL, 0
0892 7414                 1090             JE HUNDREDS_PLACE
0894 C706C6000100         1091             MOV DS:DOLLAR_FLAG, 1
089A C706C2000100         1092             MOV DS:THOUSAND_FLAG, 1
08A0 A27900               1093             MOV DS:REG_AL, AL
08A3 9A5106----     R     1094             CALL FAR PTR DAC_UPDATE
                          1095     
08A8                      1096     HUNDREDS_PLACE:
08A8 833EC20000           1097             CMP DS:THOUSAND_FLAG, 0
08AD 7410                 1098             JE NEXT_PLACE_2
08AF C60679001D           1099             MOV DS:REG_AL, 29
08B4 9A5106----     R     1100             CALL FAR PTR DAC_UPDATE
08B9 C706C2000000         1101             MOV DS:THOUSAND_FLAG, 0
                          1102             
08BF                      1103     NEXT_PLACE_2:
08BF 43                   1104             INC BX
08C0 8A87BA00             1105             MOV AL, DS:TEMP_BCD_ARR[BX]
08C4 3C00                 1106             CMP AL, 0
08C6 7418                 1107             JE NEXT_PLACE_3
08C8 C706C6000100         1108             MOV DS:DOLLAR_FLAG, 1
08CE A27900               1109             MOV DS:REG_AL, AL
08D1 9A5106----     R     1110             CALL FAR PTR DAC_UPDATE
08D6 C60679001C           1111             MOV DS:REG_AL, 28
08DB 9A5106----     R     1112             CALL FAR PTR DAC_UPDATE
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:34:13  12/07/;3  PAGE   22


LOC  OBJ                  LINE     SOURCE

                          1113             
08E0                      1114     NEXT_PLACE_3:   
08E0 43                   1115             INC BX
08E1 8A87BA00             1116             MOV AL, DS:TEMP_BCD_ARR[BX]
08E5 3C01                 1117             CMP AL, 1
08E7 7518                 1118             JNE NOT_1_2
08E9 C706C6000100         1119             MOV DS:DOLLAR_FLAG, 1
08EF 43                   1120             INC BX
08F0 8A87BA00             1121             MOV AL, DS:TEMP_BCD_ARR[BX]
08F4 040A                 1122             ADD AL, 10
08F6 A27900               1123             MOV DS:REG_AL, AL
08F9 9A5106----     R     1124             CALL FAR PTR DAC_UPDATE
08FE EB2C90               1125             JMP DECIMAL_DAC
0901                      1126     NOT_1_2:
0901 3C00                 1127             CMP AL, 0
0903 7410                 1128             JE NEXT_PLACE_4
0905 C706C6000100         1129             MOV DS:DOLLAR_FLAG, 1
090B 0412                 1130             ADD AL, 18
090D A27900               1131             MOV DS:REG_AL, AL
0910 9A5106----     R     1132             CALL FAR PTR DAC_UPDATE
0915                      1133     NEXT_PLACE_4:
0915 43                   1134             INC BX
0916 8A87BA00             1135             MOV AL, DS:TEMP_BCD_ARR[BX]
091A 3C00                 1136             CMP AL, 0
091C 740E                 1137             JE DECIMAL_DAC
091E C706C6000100         1138             MOV DS:DOLLAR_FLAG, 1
0924 A27900               1139             MOV DS:REG_AL, AL
0927 9A5106----     R     1140             CALL FAR PTR DAC_UPDATE
                          1141             
092C                      1142     DECIMAL_DAC:
092C 833EC60000           1143             CMP DS:DOLLAR_FLAG, 0
0931 740A                 1144             JE DECIMAL_DAC_CONT
0933 C60679001E           1145             MOV DS:REG_AL, 30
0938 9A5106----     R     1146             CALL FAR PTR DAC_UPDATE
                          1147             
093D                      1148     DECIMAL_DAC_CONT:
093D 43                   1149             INC BX
093E 8A87BA00             1150             MOV AL, DS:TEMP_BCD_ARR[BX]
0942 3C01                 1151             CMP AL, 1
0944 7518                 1152             JNE NOT_1_3
0946 43                   1153             INC BX
0947 C706C4000100         1154             MOV DS:CENT_FLAG, 1
094D 8A87BA00             1155             MOV AL, DS:TEMP_BCD_ARR[BX]
0951 040A                 1156             ADD AL, 10
0953 A27900               1157             MOV DS:REG_AL, AL
0956 9A5106----     R     1158             CALL FAR PTR DAC_UPDATE
095B EB2C90               1159             JMP ENGLISH_END
                          1160             
095E                      1161     NOT_1_3:
095E 3C00                 1162             CMP AL, 0
0960 7410                 1163             JE NEXT_PLACE_5
0962 C706C4000100         1164             MOV DS:CENT_FLAG, 1
0968 0412                 1165             ADD AL, 18
096A A27900               1166             MOV DS:REG_AL, AL
096D 9A5106----     R     1167             CALL FAR PTR DAC_UPDATE
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:34:13  12/07/;3  PAGE   23


LOC  OBJ                  LINE     SOURCE

                          1168             
0972                      1169     NEXT_PLACE_5:
0972 43                   1170             INC BX
0973 8A87BA00             1171             MOV AL, DS:TEMP_BCD_ARR[BX]
0977 3C00                 1172             CMP AL, 0
0979 740E                 1173             JE ENGLISH_END
097B C706C4000100         1174             MOV DS:CENT_FLAG, 1
0981 A27900               1175             MOV DS:REG_AL, AL
0984 9A5106----     R     1176             CALL FAR PTR DAC_UPDATE
                          1177             
0989                      1178     ENGLISH_END:
0989 833EC40000           1179             CMP DS:CENT_FLAG, 0
098E 7410                 1180             JE ENGLISH_END2
0990 C60679001F           1181             MOV DS:REG_AL, 31
0995 9A5106----     R     1182             CALL FAR PTR DAC_UPDATE
099A C706C4000000         1183             MOV DS:CENT_FLAG, 0
09A0                      1184     ENGLISH_END2:
09A0 E94F01               1185             JMP CONT_BCD_UPD_1
                          1186             
09A3                      1187     MANDARIN_DAC:
09A3 C706C4000000         1188             MOV DS:CENT_FLAG, 0
09A9 C706C2000000         1189             MOV DS:THOUSAND_FLAG, 0
09AF C706C6000000         1190             MOV DS:DOLLAR_FLAG,     0
09B5 BB0000               1191             MOV BX, 0
09B8 8A87BA00             1192             MOV AL, DS:TEMP_BCD_ARR[BX]
09BC 3C00                 1193             CMP AL, 0
09BE 741E                 1194             JE NEXT_PLACE_6
09C0 C706C6000100         1195             MOV DS:DOLLAR_FLAG, 1
09C6 C706C2000100         1196             MOV DS:THOUSAND_FLAG, 1
09CC A27900               1197             MOV DS:REG_AL, AL
09CF 9A5106----     R     1198             CALL FAR PTR DAC_UPDATE
09D4 C60679000B           1199             MOV DS:REG_AL, 11
09D9 9A5106----     R     1200             CALL FAR PTR DAC_UPDATE
                          1201             
09DE                      1202     NEXT_PLACE_6:
09DE 43                   1203             INC BX
09DF 8A87BA00             1204             MOV AL, DS:TEMP_BCD_ARR[BX]
09E3 3C00                 1205             CMP AL, 0
09E5 741E                 1206             JE NEXT_PLACE_7
09E7 C706C6000100         1207             MOV DS:DOLLAR_FLAG, 1
09ED C706C2000100         1208             MOV DS:THOUSAND_FLAG, 1
09F3 A27900               1209             MOV DS:REG_AL, AL
09F6 9A5106----     R     1210             CALL FAR PTR DAC_UPDATE
09FB C60679000A           1211             MOV DS:REG_AL, 10
0A00 9A5106----     R     1212             CALL FAR PTR DAC_UPDATE
                          1213             
0A05                      1214     NEXT_PLACE_7:
0A05 43                   1215             INC BX
0A06 8A87BA00             1216             MOV AL, DS:TEMP_BCD_ARR[BX]
0A0A 3C00                 1217             CMP AL, 0
0A0C 7414                 1218             JE NEXT_PLACE_8
0A0E C706C6000100         1219             MOV DS:DOLLAR_FLAG, 1
0A14 C706C2000100         1220             MOV DS:THOUSAND_FLAG, 1
0A1A A27900               1221             MOV DS:REG_AL, AL
0A1D 9A5106----     R     1222             CALL FAR PTR DAC_UPDATE
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:34:13  12/07/;3  PAGE   24


LOC  OBJ                  LINE     SOURCE

                          1223     
0A22                      1224     NEXT_PLACE_8:
0A22 833EC20000           1225             CMP DS:THOUSAND_FLAG, 0
0A27 7410                 1226             JE IGNORE_THOUSAND
0A29 C60679000C           1227             MOV DS:REG_AL, 12
0A2E 9A5106----     R     1228             CALL FAR PTR DAC_UPDATE
0A33 C706C2000000         1229             MOV DS:THOUSAND_FLAG, 0
                          1230             
0A39                      1231     IGNORE_THOUSAND:
0A39 43                   1232             INC BX
0A3A 8A87BA00             1233             MOV AL, DS:TEMP_BCD_ARR[BX]
0A3E 3C00                 1234             CMP AL, 0
0A40 7418                 1235             JE NEXT_PLACE_9
0A42 C706C6000100         1236             MOV DS:DOLLAR_FLAG, 1
0A48 A27900               1237             MOV DS:REG_AL, AL
0A4B 9A5106----     R     1238             CALL FAR PTR DAC_UPDATE
0A50 C60679000B           1239             MOV DS:REG_AL, 11
0A55 9A5106----     R     1240             CALL FAR PTR DAC_UPDATE
                          1241             
0A5A                      1242     NEXT_PLACE_9:
0A5A 43                   1243             INC BX
0A5B 8A87BA00             1244             MOV AL, DS:TEMP_BCD_ARR[BX]
0A5F 3C00                 1245             CMP AL, 0
0A61 7418                 1246             JE NEXT_PLACE_10
0A63 C706C6000100         1247             MOV DS:DOLLAR_FLAG, 1
0A69 A27900               1248             MOV DS:REG_AL, AL
0A6C 9A5106----     R     1249             CALL FAR PTR DAC_UPDATE
0A71 C60679000A           1250             MOV DS:REG_AL, 10
0A76 9A5106----     R     1251             CALL FAR PTR DAC_UPDATE
                          1252             
0A7B                      1253     NEXT_PLACE_10:
0A7B 43                   1254             INC BX
0A7C 8A87BA00             1255             MOV AL, DS:TEMP_BCD_ARR[BX]
0A80 3C00                 1256             CMP AL, 0
0A82 740E                 1257             JE MANDARIN_DEC
0A84 C706C6000100         1258             MOV DS:DOLLAR_FLAG, 1
0A8A A27900               1259             MOV DS:REG_AL, AL
0A8D 9A5106----     R     1260             CALL FAR PTR DAC_UPDATE
                          1261             
0A92                      1262     MANDARIN_DEC:
0A92 833EC60000           1263             CMP DS:DOLLAR_FLAG, 0
0A97 740A                 1264             JE MANDARIN_DAC_CONT
0A99 C60679000D           1265             MOV DS:REG_AL, 13
0A9E 9A5106----     R     1266             CALL FAR PTR DAC_UPDATE
0AA3                      1267     MANDARIN_DAC_CONT:
0AA3 43                   1268             INC BX
0AA4 8A87BA00             1269             MOV AL, DS:TEMP_BCD_ARR[BX]
0AA8 3C00                 1270             CMP AL, 0
0AAA 7418                 1271             JE NEXT_PLACE_11
0AAC C706C4000100         1272             MOV DS:CENT_FLAG, 1
0AB2 A27900               1273             MOV DS:REG_AL, AL
0AB5 9A5106----     R     1274             CALL FAR PTR DAC_UPDATE
0ABA C60679000A           1275             MOV DS:REG_AL, 10
0ABF 9A5106----     R     1276             CALL FAR PTR DAC_UPDATE
                          1277             
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:34:13  12/07/;3  PAGE   25


LOC  OBJ                  LINE     SOURCE

0AC4                      1278     NEXT_PLACE_11:
                          1279     
0AC4 43                   1280             INC BX
0AC5 8A87BA00             1281             MOV AL, DS:TEMP_BCD_ARR[BX]
0AC9 3C00                 1282             CMP AL, 0
0ACB 740E                 1283             JE CONT_BCD_UPD
0ACD C706C4000100         1284             MOV DS:CENT_FLAG, 1
0AD3 A27900               1285             MOV DS:REG_AL, AL
0AD6 9A5106----     R     1286             CALL FAR PTR DAC_UPDATE
                          1287             
0ADB                      1288     CONT_BCD_UPD:
0ADB 833EC40000           1289             CMP DS:CENT_FLAG, 0
0AE0 7410                 1290             JE CONT_BCD_UPD_1
0AE2 C60679000E           1291             MOV DS:REG_AL, 14
0AE7 9A5106----     R     1292             CALL FAR PTR DAC_UPDATE
0AEC C706C4000000         1293             MOV DS:CENT_FLAG, 0
                          1294     
0AF2                      1295     CONT_BCD_UPD_1:
                          1296             
0AF2 5A                   1297     POP DX
0AF3 59                   1298     POP CX
0AF4 5B                   1299     POP BX
0AF5 58                   1300     POP AX
0AF6 CB                   1301     RET
                          1302     CALC_DAC ENDP
                          1303     
0AF7                      1304     CALC_UPD_PRICE PROC FAR
0AF7 50                   1305     PUSH AX
0AF8 53                   1306     PUSH BX
0AF9 51                   1307     PUSH CX
0AFA 52                   1308     PUSH DX
0AFB 833EB20000           1309             CMP DS:QTY, 0
0B00 7503                 1310             JNE CHECK_PRICE_ZERO
0B02 E92B01               1311             JMP CALC_END
0B05                      1312     CHECK_PRICE_ZERO:
0B05 833EB00000           1313             CMP DS:PRICE, 0
0B0A 7503                 1314             JNE START_CALC
0B0C E92101               1315             JMP CALC_END
0B0F                      1316     START_CALC:
0B0F BA0000               1317             MOV DX, 0
0B12 A1B000               1318             MOV AX, DS:PRICE
0B15 8B1EB200             1319             MOV BX, DS:QTY
0B19 F7E3                 1320             MUL BX
                          1321             
0B1B BB6400               1322             MOV BX, 100
0B1E F7F3                 1323             DIV BX
0B20 A3B000               1324             MOV DS:PRICE, AX
0B23 A1B800               1325             MOV AX, DS:TOTAL_PRICE_DEC
0B26 03C2                 1326             ADD AX, DX
0B28 3D6400               1327             CMP AX, 100
0B2B 7C07                 1328             JL NON_DECIMAL
0B2D FF06B600             1329             INC DS:TOTAL_PRICE_L
0B31 2D6400               1330             SUB AX, 100
                          1331             
0B34                      1332     NON_DECIMAL:    
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:34:13  12/07/;3  PAGE   26


LOC  OBJ                  LINE     SOURCE

0B34 A3B800               1333             MOV DS:TOTAL_PRICE_DEC, AX
0B37 A1B600               1334             MOV AX, DS:TOTAL_PRICE_L
0B3A 8B1EB000             1335             MOV BX, DS:PRICE
0B3E 03C3                 1336             ADD AX, BX
0B40 7304                 1337             JNC update_normal
0B42 FF06B400             1338             INC DS:TOTAL_PRICE_U
                          1339             
0B46                      1340     update_normal:
0B46 A3B600               1341             MOV DS:TOTAL_PRICE_L, AX
                          1342             
0B49 BA0000               1343             MOV DX, 0
                          1344             ;CMP DS:TOTAL_PRICE_DEC, 9
                          1345             ;JG DECIMAL_CONT
                          1346             ;MOV CX, 10
                          1347             ;MOV AX, DS:TOTAL_PRICE_DEC
                          1348             ;MUL CX
                          1349             ;MOV DS:TOTAL_PRICE_DEC, AX
                          1350     ;DECIMAL_CONT:
0B4C A1B800               1351             MOV AX, DS:TOTAL_PRICE_DEC
0B4F B90A00               1352             MOV CX, 10
0B52 F7F1                 1353             DIV CX
                          1354             
0B54 BB0700               1355             MOV BX, 7
0B57 8897BA00             1356             MOV DS:TEMP_BCD_ARR[BX], DL
0B5B 4B                   1357             DEC BX
0B5C 8887BA00             1358             MOV DS:TEMP_BCD_ARR[BX], AL
                          1359             
0B60 BB0600               1360             MOV BX, 6
0B63 A1B600               1361             MOV AX, DS:TOTAL_PRICE_L
                          1362             
0B66                      1363             TEMP_UPD_LOOP:
0B66 BA0000               1364                     MOV DX, 0
0B69 B90A00               1365                     MOV CX, 10
0B6C F7F1                 1366                     DIV CX
                          1367                     
0B6E 4B                   1368                     DEC BX
0B6F 8897BA00             1369                     MOV DS:TEMP_BCD_ARR[BX], DL
0B73 43                   1370                     INC BX
                          1371                     
0B74 4B                   1372                     DEC BX
                          1373                     
0B75 75EF                 1374             JNZ TEMP_UPD_LOOP
                          1375             
0B77 8B0EB400             1376             MOV CX, DS:TOTAL_PRICE_U
0B7B 83F900               1377             CMP CX, 0
0B7E 7478                 1378             JE upd_dac_part
0B80                      1379             ADD_EXTRA_PART:
0B80 BB0500               1380                     MOV BX, 5
0B83 8A87BA00             1381                     MOV AL, DS:TEMP_BCD_ARR[BX]
0B87 0406                 1382                     ADD AL, 6
0B89 3C09                 1383                     CMP AL, 9
0B8B 7E08                 1384                     JLE CONT_DIGIT_1
0B8D 2C0A                 1385                     SUB AL, 10
0B8F 4B                   1386                     DEC BX
0B90 FE87BA00             1387                     INC DS:TEMP_BCD_ARR[BX]
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:34:13  12/07/;3  PAGE   27


LOC  OBJ                  LINE     SOURCE

0B94 43                   1388                     INC BX
0B95                      1389             CONT_DIGIT_1:
0B95 8887BA00             1390                     MOV DS:TEMP_BCD_ARR[BX], AL
0B99 4B                   1391                     DEC BX
                          1392                     
0B9A 8A87BA00             1393                     MOV AL, DS:TEMP_BCD_ARR[BX]
0B9E 0403                 1394                     ADD AL, 3
0BA0 3C09                 1395                     CMP AL, 9
0BA2 7E08                 1396                     JLE CONT_DIGIT_2
0BA4 2C0A                 1397                     SUB AL, 10
0BA6 4B                   1398                     DEC BX
0BA7 FE87BA00             1399                     INC DS:TEMP_BCD_ARR[BX]
0BAB 43                   1400                     INC BX
0BAC                      1401             CONT_DIGIT_2:
0BAC 8887BA00             1402                     MOV DS:TEMP_BCD_ARR[BX], AL
0BB0 4B                   1403                     DEC BX
                          1404                     
0BB1 8A87BA00             1405                     MOV AL, DS:TEMP_BCD_ARR[BX]
0BB5 0405                 1406                     ADD AL, 5
0BB7 3C09                 1407                     CMP AL, 9
0BB9 7E08                 1408                     JLE CONT_DIGIT_3
0BBB 2C0A                 1409                     SUB AL, 10
0BBD 4B                   1410                     DEC BX
0BBE FE87BA00             1411                     INC DS:TEMP_BCD_ARR[BX]
0BC2 43                   1412                     INC BX
0BC3                      1413             CONT_DIGIT_3:
0BC3 8887BA00             1414                     MOV DS:TEMP_BCD_ARR[BX], AL
0BC7 4B                   1415                     DEC BX
                          1416                     
                          1417                     
0BC8 8A87BA00             1418                     MOV AL, DS:TEMP_BCD_ARR[BX]
0BCC 0405                 1419                     ADD AL, 5
0BCE 3C09                 1420                     CMP AL, 9
0BD0 7E08                 1421                     JLE CONT_DIGIT_4
0BD2 2C0A                 1422                     SUB AL, 10
0BD4 4B                   1423                     DEC BX
0BD5 FE87BA00             1424                     INC DS:TEMP_BCD_ARR[BX]
0BD9 43                   1425                     INC BX
0BDA                      1426             CONT_DIGIT_4:
0BDA 8887BA00             1427                     MOV DS:TEMP_BCD_ARR[BX], AL
0BDE 4B                   1428                     DEC BX
                          1429                     
0BDF 8A87BA00             1430                     MOV AL, DS:TEMP_BCD_ARR[BX]
0BE3 0406                 1431                     ADD AL, 6
0BE5 3C09                 1432                     CMP AL, 9
0BE7 7E08                 1433                     JLE CONT_DIGIT_5
0BE9 2C0A                 1434                     SUB AL, 10
0BEB 4B                   1435                     DEC BX
0BEC FE87BA00             1436                     INC DS:TEMP_BCD_ARR[BX]
0BF0 43                   1437                     INC BX
0BF1                      1438             CONT_DIGIT_5:
0BF1 8887BA00             1439                     MOV DS:TEMP_BCD_ARR[BX], AL
0BF5 4B                   1440                     DEC BX
                          1441                     
0BF6 E288                 1442             LOOP ADD_EXTRA_PART
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:34:13  12/07/;3  PAGE   28


LOC  OBJ                  LINE     SOURCE

                          1443             
0BF8                      1444     upd_dac_part:
0BF8 9A0608----     R     1445             CALL FAR PTR CALC_DAC
                          1446     
0BFD 9ABA05----     R     1447             CALL FAR PTR BCD_CLEAR
0C02 C70661000000         1448             MOV DS:KEYPAD_INDEX, 0
0C08 C706AC000300         1449             MOV DS:DECIMAL_INDEX, 3
0C0E B90800               1450             MOV CX, 8
0C11                      1451             UPD_BCD:
0C11 BB0800               1452                     MOV BX, 8
0C14 2BD9                 1453                     SUB BX, CX
0C16 8A87BA00             1454                     MOV AL, DS:TEMP_BCD_ARR[BX]
0C1A A27900               1455                     MOV DS:REG_AL, AL
0C1D C706AA000100         1456                     MOV DS:DAC_DISABLE, 1
0C23 9AE505----     R     1457                     CALL FAR PTR BCD_UPDATE
0C28 C706AA000000         1458                     MOV DS:DAC_DISABLE, 0
0C2E E2E1                 1459             LOOP UPD_BCD
                          1460             
0C30                      1461     CALC_END:
0C30 833EB00000           1462             CMP DS:PRICE, 0
0C35 7403                 1463             JE RETAIN_BCD_VALUE
0C37 EB2F90               1464             JMP END_CALC_BCD_DAC
                          1465             
0C3A                      1466     RETAIN_BCD_VALUE:       
0C3A C70661000000         1467             MOV DS:KEYPAD_INDEX, 0
0C40 C706AC000300         1468             MOV DS:DECIMAL_INDEX, 3
0C46 B90800               1469             MOV CX, 8
0C49                      1470             UPD_BCD1:
0C49 BB0800               1471                     MOV BX, 8
0C4C 2BD9                 1472                     SUB BX, CX
0C4E 8A87BA00             1473                     MOV AL, DS:TEMP_BCD_ARR[BX]
0C52 A27900               1474                     MOV DS:REG_AL, AL
0C55 C706AA000100         1475                     MOV DS:DAC_DISABLE, 1
0C5B 9AE505----     R     1476                     CALL FAR PTR BCD_UPDATE
0C60 C706AA000000         1477                     MOV DS:DAC_DISABLE, 0
0C66 E2E1                 1478             LOOP UPD_BCD1
                          1479     
0C68                      1480     END_CALC_BCD_DAC:
0C68 C706B0000000         1481             MOV DS:PRICE, 0
0C6E C706B2000000         1482             MOV DS:QTY, 0
0C74 5A                   1483     POP DX
0C75 59                   1484     POP CX
0C76 5B                   1485     POP BX
0C77 58                   1486     POP AX
0C78 CB                   1487     RET
                          1488     CALC_UPD_PRICE ENDP
                          1489     
0C79                      1490     UPDATE_TROLLEY PROC FAR
0C79 50                   1491     PUSH AX
0C7A 53                   1492     PUSH BX
0C7B 51                   1493     PUSH CX
0C7C 52                   1494     PUSH DX
0C7D B90800               1495             MOV CX, 8
0C80                      1496             CLEAR_TEMP_BCD_TROLLEY:
0C80 8BD9                 1497                     MOV BX, CX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:34:13  12/07/;3  PAGE   29


LOC  OBJ                  LINE     SOURCE

0C82 4B                   1498                     DEC BX
0C83 C687BA0000           1499                     MOV DS:TEMP_BCD_ARR[BX], 0
0C88 E2F6                 1500             LOOP CLEAR_TEMP_BCD_TROLLEY
                          1501             
0C8A 8B0EF400             1502             MOV CX, DS:TROLLEY_INDEX
0C8E BA0800               1503             MOV DX, 8
                          1504             
0C91                      1505             UPD_TROLLEY_PRICE:
0C91 8BD9                 1506                     MOV BX, CX
0C93 4B                   1507                     DEC BX
                          1508                     
0C94 8A87EC00             1509                     MOV AL, DS:TROLLEY_ARRAY[BX]
                          1510                     
0C98 8BDA                 1511                     MOV BX, DX
0C9A 4B                   1512                     DEC BX
                          1513                     
0C9B 8887BA00             1514                     MOV DS:TEMP_BCD_ARR[BX], AL
                          1515                     
0C9F 4A                   1516                     DEC DX
0CA0 E2EF                 1517             LOOP UPD_TROLLEY_PRICE
                          1518             
0CA2 B90800               1519             MOV CX, 8
0CA5 C70661000000         1520             MOV DS:KEYPAD_INDEX, 0
0CAB                      1521             UPDATE_TROLLEY_PRICE_DISPLAY:
0CAB BB0800               1522                     MOV BX, 8
0CAE 2BD9                 1523                     SUB BX, CX
0CB0 8A87BA00             1524                     MOV AL, DS:TEMP_BCD_ARR[BX]
0CB4 A27900               1525                     MOV DS:REG_AL, AL
0CB7 C706AA000100         1526                     MOV DS:DAC_DISABLE, 1
0CBD 9AE505----     R     1527                     CALL FAR PTR BCD_UPDATE
0CC2 C706AA000000         1528                     MOV DS:DAC_DISABLE, 0
0CC8 E2E1                 1529             LOOP UPDATE_TROLLEY_PRICE_DISPLAY
                          1530             
0CCA 9A0608----     R     1531             CALL FAR PTR CALC_DAC
                          1532     
0CCF 5A                   1533     POP DX
0CD0 59                   1534     POP CX
0CD1 5B                   1535     POP BX
0CD2 5A                   1536     POP DX
0CD3 CB                   1537     RET
                          1538     UPDATE_TROLLEY ENDP
                          1539     ; ^^^^^^^^^^^^^^^ End of User main routine ^^^^^^^^^^^^^^^^^^^^^^^^^
0CD4                      1540     SERIAL_REC_ACTION       PROC    FAR
0CD4 51                   1541                     PUSH    CX
0CD5 53                   1542                     PUSH    BX
0CD6 1E                   1543                     PUSH    DS
                          1544                     
0CD7 BB----         R     1545                     MOV     BX,DATA_SEG             ;initialize data segment register
0CDA 8EDB                 1546                     MOV     DS,BX
                          1547                     
0CDC 803E8B0001           1548                     CMP DS:REPLY_FLAG, 1
0CE1 7557                 1549                     JNE next_id1
                          1550                     
0CE3 803E8C0001           1551                     CMP DS:SEND_FLAG, 1
0CE8 7453                 1552                     JE send_input_across1
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:34:13  12/07/;3  PAGE   30


LOC  OBJ                  LINE     SOURCE

                          1553                     
0CEA 833EA00001           1554                     CMP DS:RECEIVE_FLAG, 1
0CEF 754F                 1555                     JNE terminate_session3
                          1556                     
0CF1 3C2F                 1557                     CMP AL, '/'
0CF3 752C                 1558                     JNE CHECK_SEND
0CF5 C706A4000000         1559                     MOV DS:PRICE_FLAG, 0
0CFB C706A0000000         1560                     MOV DS:RECEIVE_FLAG, 0
0D01 C706AE000100         1561                     MOV DS:LANG_FLAG, 1
0D07 833EF60000           1562                     CMP DS:TROLLEY_FLAG, 0
0D0C 7405                 1563                     JE TROLLEY_UPD_SKIP
0D0E 9A790C----     R     1564                     CALL FAR PTR UPDATE_TROLLEY
0D13                      1565             TROLLEY_UPD_SKIP:
0D13 C706F6000000         1566                     MOV DS:TROLLEY_FLAG, 0
0D19 9AF70A----     R     1567                     CALL FAR PTR CALC_UPD_PRICE
0D1E EB2090               1568                     JMP terminate_session3
                          1569             
0D21                      1570             CHECK_SEND:
0D21 3C26                 1571                     CMP AL, '&'
0D23 751E                 1572                     JNE TROLLEY_PRICE
0D25 C706A4000100         1573                     MOV DS:PRICE_FLAG, 1
0D2B C70661000000         1574                     MOV DS:KEYPAD_INDEX, 0
0D31 C7069C000800         1575                     MOV DS:MAX_INPUT_SIZE, 8
0D37 E9AF00               1576                     JMP id_skip2
                          1577             
                          1578             
0D3A                      1579             next_id1:
0D3A E9AF00               1580                     JMP next_id
                          1581                     
0D3D                      1582             send_input_across1:
0D3D E98D00               1583                     JMP send_input_across
                          1584             
0D40                      1585             terminate_session3:
0D40 E9A300               1586                     JMP terminate_session2
                          1587             
                          1588                     
0D43                      1589             TROLLEY_PRICE:
0D43 3C2B                 1590                     CMP AL, '+'
0D45 7515                 1591                     JNE receive_price
0D47 C7069C000800         1592                     MOV DS:MAX_INPUT_SIZE, 8
0D4D C706F6000100         1593                     MOV DS:TROLLEY_FLAG, 1
0D53 C706F4000000         1594                     MOV DS:TROLLEY_INDEX, 0
0D59 E98D00               1595                     JMP id_skip2
                          1596                     
0D5C                      1597             receive_price:
0D5C 3C23                 1598                     CMP AL, '#'
0D5E 750F                 1599                     JNE check_price
0D60 C706A2000100         1600                     MOV DS:DAC_FLAG, 1
0D66 C706A4000000         1601                     MOV DS:PRICE_FLAG, 0
0D6C EB7B90               1602                     JMP id_skip2
                          1603             
0D6F                      1604             check_price:    
                          1605             
0D6F 833EA40001           1606                     CMP DS:PRICE_FLAG, 1
0D74 7440                 1607                     JE update_price_value
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:34:13  12/07/;3  PAGE   31


LOC  OBJ                  LINE     SOURCE

                          1608                     
0D76 833EF60001           1609                     CMP DS:TROLLEY_FLAG, 1
0D7B 7428                 1610                     JE update_trolley_arr
                          1611                     
0D7D 833EA20001           1612                     CMP DS:DAC_FLAG, 1
0D82 7403                 1613                     JE dac_change
0D84 EB6390               1614                     JMP id_skip2
                          1615     
0D87                      1616             dac_change:
0D87 8A1E7900             1617                     MOV BL, DS:REG_AL
0D8B 2C30                 1618                     SUB AL, 30H
0D8D A27900               1619                     MOV DS:REG_AL, AL
0D90 9A5106----     R     1620                     CALL FAR PTR DAC_UPDATE
0D95 881E7900             1621                     MOV DS:REG_AL, BL
0D99 C706A2000000         1622                     MOV DS:DAC_FLAG, 0
0D9F EB4890               1623                     JMP id_skip2
                          1624             
                          1625     
0DA2 EB4590               1626             id_skip3: JMP id_skip2
                          1627             
0DA5                      1628             update_trolley_arr:
0DA5 8B1EF400             1629                     MOV BX, DS:TROLLEY_INDEX
0DA9 2C30                 1630                     SUB AL, 30H
0DAB 8887EC00             1631                     MOV DS:TROLLEY_ARRAY[BX], AL
0DAF FF06F400             1632                     INC DS:TROLLEY_INDEX
0DB3 EB3490               1633                     JMP id_skip2
                          1634                     
0DB6                      1635             update_price_value:
0DB6 2C30                 1636                     SUB AL, 30H
0DB8 B90000               1637                     MOV CX, 0
0DBB 8AC8                 1638                     MOV CL, AL
0DBD A1B000               1639                     MOV AX, DS:PRICE
0DC0 BB0A00               1640                     MOV BX, 10
0DC3 F7E3                 1641                     MUL BX
                          1642                     
0DC5 03C1                 1643                     ADD AX, CX
0DC7 A3B000               1644                     MOV DS:PRICE, AX
0DCA EB1D90               1645                     JMP id_skip2
                          1646                     
0DCD                      1647             send_input_across:
0DCD 9A7406----     R     1648                     CALL FAR PTR SEND_INPUT
                          1649                     
0DD2 C7069A000000         1650                     MOV DS:SEND_BUFFER_LEN, 0
                          1651                     
0DD8 C6068C0000           1652                     MOV DS:SEND_FLAG, 0
                          1653                     
0DDD C706A0000100         1654                     MOV DS:RECEIVE_FLAG, 1
                          1655                     
0DE3 EB0490               1656                     JMP id_skip2
                          1657                     
0DE6 EB3E90               1658                     terminate_session2: JMP terminate_session
0DE9 EB6790               1659                     id_skip2: JMP id_skip
                          1660                     
0DEC                      1661             next_id:
                          1662                     
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:34:13  12/07/;3  PAGE   32


LOC  OBJ                  LINE     SOURCE

0DEC 803E810001           1663                     CMP DS:ID_FLAG_r, 1
0DF1 7513                 1664                     JNE id_flag_label
0DF3 38067F00             1665                     CMP DS:MY_ID[1], AL
0DF7 7559                 1666                     JNE id_skip
                          1667                     ;start writing to pc
0DF9 C6068B0001           1668                     MOV DS:REPLY_FLAG, 1
0DFE C606810000           1669                     MOV DS:ID_FLAG_r, 0
0E03 EB4D90               1670                     JMP id_skip
                          1671             
0E06                      1672             id_flag_label:
                          1673             
0E06 803E800001           1674                     CMP DS:ID_FLAG_@, 1
0E0B 7539                 1675                     JNE protocol_rec
0E0D 3C72                 1676                     CMP AL,'r'
0E0F 750D                 1677                     JNE id_not_r
0E11 C606810001           1678                     MOV DS:ID_FLAG_r,1
0E16 C606800000           1679                     MOV DS:ID_FLAG_@, 0
0E1B EB3590               1680                     JMP S_RET
0E1E                      1681             id_not_r:
0E1E C606800000           1682                     MOV DS:ID_FLAG_@, 0
0E23 EB2D90               1683                     JMP id_skip
                          1684             
0E26                      1685             terminate_session:
0E26 C606810000           1686                     MOV DS:ID_FLAG_r, 0
0E2B 33DB                 1687                     XOR BX,BX
0E2D                      1688             start_send1:
0E2D 50                   1689                     PUSH AX
0E2E 33C0                 1690                     XOR AX,AX
0E30 8A878600             1691                     MOV AL, DS:FAIL_MESSAGE[BX]
0E34 9A0000----     E     1692                     CALL FAR PTR PRINT_CHAR
0E39 58                   1693                     POP AX
0E3A C6068B0000           1694                     MOV DS:REPLY_FLAG, 0
0E3F 43                   1695                     INC BX
0E40 3A1E8A00             1696                     CMP BL, DS:FAIL_COUNT
0E44 75E7                 1697                     JNE start_send1
                          1698                     
0E46                      1699             protocol_rec:
0E46 3C40                 1700                     CMP AL,'@'
0E48 7508                 1701                     JNE id_skip
0E4A C606800001           1702                     MOV DS:ID_FLAG_@,1
0E4F EB0190               1703                     JMP S_RET
                          1704                     
0E52                      1705             id_skip:
                          1706                     ; JMP S_RET
                          1707             
                          1708                     ; CMP   AL,'<'
                          1709                     ; JNE   S_FAST
                          1710     
                          1711                     ; INC   DS:T_COUNT_SET
                          1712                     ; INC   DS:T_COUNT_SET
                          1713     
                          1714                     ; JMP   S_NEXT0
                          1715     ; S_FAST:
                          1716                     ; CMP   AL,'>'
                          1717                     ; JNE   S_RET
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:34:13  12/07/;3  PAGE   33


LOC  OBJ                  LINE     SOURCE

                          1718     
                          1719                     ; DEC   DS:T_COUNT_SET
                          1720                     ; DEC   DS:T_COUNT_SET
                          1721     
                          1722     ; S_NEXT0:
                          1723                     ; MOV   CX,22                   ;initialize counter for message
                          1724                     ; MOV   BX,0
                          1725     
                          1726     ; S_NEXT1:      MOV     AL,DS:REC_MESS[BX]      ;print message
                          1727                     ; call  FAR ptr print_char
                          1728                     ; INC   BX
                          1729                     ; LOOP  S_NEXT1
                          1730     
                          1731                     ; MOV   AL,DS:T_COUNT_SET       ;print current period of timer0
                          1732                     ; CALL  FAR PTR PRINT_2HEX
0E52                      1733     S_RET:
0E52 1F                   1734                     POP     DS
0E53 5B                   1735                     POP     BX
0E54 59                   1736                     POP     CX
0E55 CB                   1737                     RET
                          1738     SERIAL_REC_ACTION       ENDP
                          1739     
0E56                      1740     TIMER2_ACTION   PROC    FAR
0E56 50                   1741                     PUSH    AX
0E57 1E                   1742                     PUSH    DS
0E58 53                   1743                     PUSH    BX
0E59 51                   1744                     PUSH    CX
0E5A 52                   1745                     PUSH    DX
                          1746                     
                          1747                     
0E5B B8----         R     1748                     MOV     AX,DATA_SEG
0E5E 8ED8                 1749                     MOV     DS,AX
                          1750             
0E60 FE0E1600             1751                     DEC     DS:T_COUNT
0E64 754A                 1752                     JNZ     T_NEXT1
0E66 A01700               1753                     MOV     AL,DS:T_COUNT_SET
0E69 A21600               1754                     MOV     DS:T_COUNT,AL
                          1755     
0E6C                      1756     T_NEXT0:
                          1757                     
0E6C 33DB                 1758                     XOR BX, BX
0E6E 8A1E6000             1759                     MOV BL, DS:BCD_INDEX
0E72 8A4759               1760                     MOV AL, DS:BCD_MESSAGE[BX]
                          1761                     
0E75 3B1EAC00             1762                     CMP BX, DS:DECIMAL_INDEX
0E79 7506                 1763                     JNE CALL_FUNC
0E7B C706A6000100         1764                     MOV DS:DECIMAL_FLAG, 1
0E81                      1765     CALL_FUNC:
0E81 9A210F----     R     1766                     CALL FAR PTR BCD_TO_7SEG
0E86 C706A6000000         1767                     MOV DS:DECIMAL_FLAG, 0
                          1768     
0E8C BA0002               1769                     MOV DX, 200H
0E8F EE                   1770                     OUT DX, AL
                          1771                     
0E90 A05F00               1772                     MOV AL, DS:ENABLE_BYTE
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:34:13  12/07/;3  PAGE   34


LOC  OBJ                  LINE     SOURCE

0E93 BA8001               1773                     MOV DX, 180H
0E96 EE                   1774                     OUT DX, AL
                          1775                     
                          1776     
0E97 FE066000             1777                     INC DS:BCD_INDEX
0E9B D0065F00             1778                     ROL DS:ENABLE_BYTE, 1
0E9F 803E5F00BF           1779                     CMP DS:ENABLE_BYTE, 10111111b
0EA4 750A                 1780                     JNE T_NEXT1
0EA6 C6065F00FE           1781                     MOV DS:ENABLE_BYTE, 11111110b 
0EAB C606600000           1782                     MOV DS:BCD_INDEX, 0
                          1783     
                          1784                     
0EB0                      1785     T_NEXT1:
0EB0 803E750000           1786                     CMP DS:DAC_LEN, 0
0EB5 743C                 1787                     JE ISR_END
                          1788                     
                          1789                     
0EB7 8B367600             1790                     MOV SI, DS:SI_PTR
                          1791                             
0EBB BB0000               1792                     MOV BX, 0
0EBE 33C0                 1793                     XOR AX, AX
0EC0 8A4766               1794                     MOV AL, DS:DAC_ADDR[BX]
                          1795                     
0EC3 BB0001               1796                     MOV BX, 100H
0EC6 F7E3                 1797                     MUL BX
                          1798                     
0EC8 8B166400             1799                     MOV DX, DS:DAC_BASE
0ECC 03D0                 1800                     ADD DX, AX
                          1801                     
0ECE 1E                   1802                     PUSH DS
0ECF 8EDA                 1803                     MOV DS, DX
                          1804                     
0ED1 8B04                 1805                     MOV AX, [SI]
                          1806                     
0ED3 BA1001               1807                     MOV DX, 110H
0ED6 EE                   1808                     OUT DX, AL
                          1809                     
0ED7 1F                   1810                     POP DS
                          1811                     
0ED8 FF067600             1812                     INC DS:SI_PTR
0EDC 813E76000010         1813                     CMP DS:SI_PTR, 1000H
0EE2 750F                 1814                     JNE ISR_END
                          1815                     
0EE4 C70676000000         1816                     MOV DS:SI_PTR, 0
0EEA FE0E7500             1817                     DEC DS:DAC_LEN
0EEE 9AF90E----     R     1818                     CALL FAR PTR DAC_SHIFT
                          1819                     
0EF3                      1820     ISR_END:
                          1821                     
0EF3 5A                   1822                     POP DX
0EF4 59                   1823                     POP     CX
0EF5 5B                   1824                     POP     BX
0EF6 1F                   1825                     POP     DS
0EF7 58                   1826                     POP AX
0EF8 CB                   1827                     RET
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:34:13  12/07/;3  PAGE   35


LOC  OBJ                  LINE     SOURCE

                          1828     TIMER2_ACTION   ENDP
                          1829     
                          1830     
0EF9                      1831     DAC_SHIFT PROC FAR
0EF9 50                   1832             PUSH AX
0EFA 53                   1833             PUSH BX
0EFB 51                   1834             PUSH CX
0EFC 52                   1835             PUSH DX
                          1836     
0EFD 33C9                 1837             XOR CX, CX
0EFF 8A0E7500             1838             MOV CL, DS:DAC_LEN
0F03 80F900               1839             CMP CL, 0
0F06 7414                 1840             JE END_SHIFT
                          1841     
0F08                      1842             SHIFT_LOOP:
                          1843     
0F08 33DB                 1844             XOR BX, BX
0F0A 8A1E7500             1845             MOV BL, DS:DAC_LEN
0F0E 2BD9                 1846             SUB BX, CX
0F10 43                   1847             INC BX
                          1848             
0F11 33D2                 1849             XOR DX, DX
0F13 8A5766               1850             MOV DL, DS:DAC_ADDR[BX]
0F16 4B                   1851             DEC BX
0F17 885766               1852             MOV DS:DAC_ADDR[BX], DL
                          1853     
0F1A E2EC                 1854             LOOP SHIFT_LOOP
                          1855             
0F1C                      1856             END_SHIFT:
0F1C 5A                   1857             POP DX
0F1D 59                   1858             POP CX
0F1E 5B                   1859             POP BX
0F1F 58                   1860             POP AX
0F20 CB                   1861             RET
                          1862     DAC_SHIFT ENDP
                          1863     
0F21                      1864     BCD_TO_7SEG PROC FAR
                          1865     
0F21 53                   1866             PUSH BX
0F22 51                   1867             PUSH CX
0F23 52                   1868             PUSH DX
                          1869             
0F24 3C00                 1870             CMP AL, 0
0F26 7511                 1871             JNE one
0F28 833EA60001           1872             CMP DS:DECIMAL_FLAG, 1
0F2D 7405                 1873             JE decimal0
0F2F B03F                 1874             MOV AL, 00111111b
0F31 E9D700               1875             JMP endfunc
0F34                      1876     decimal0:
0F34 B0BF                 1877             MOV AL, 10111111b
0F36 E9D200               1878             JMP endfunc
                          1879             
0F39                      1880             one:
0F39 3C01                 1881             CMP AL, 1
0F3B 7511                 1882             JNE two
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:34:13  12/07/;3  PAGE   36


LOC  OBJ                  LINE     SOURCE

0F3D 833EA60001           1883             CMP DS:DECIMAL_FLAG, 1
0F42 7405                 1884             JE decimal1
0F44 B006                 1885             MOV AL, 00000110b
0F46 E9C200               1886             JMP endfunc
0F49                      1887     decimal1:
0F49 B086                 1888             MOV AL, 10000110b
0F4B E9BD00               1889             JMP endfunc
                          1890             
0F4E                      1891             two:
0F4E 3C02                 1892             CMP AL,2
0F50 7511                 1893             JNE three
0F52 833EA60001           1894             CMP DS:DECIMAL_FLAG, 1
0F57 7405                 1895             JE decimal2
0F59 B05B                 1896             MOV AL, 01011011b
0F5B E9AD00               1897             JMP endfunc
0F5E                      1898     decimal2:
0F5E B0DB                 1899             MOV AL, 11011011b
0F60 E9A800               1900             JMP endfunc
                          1901             
0F63                      1902             three:
0F63 3C03                 1903             CMP AL,3
0F65 7511                 1904             JNE four
0F67 833EA60001           1905             CMP DS:DECIMAL_FLAG, 1
0F6C 7405                 1906             JE decimal3
0F6E B04F                 1907             MOV AL, 01001111b
0F70 E99800               1908             JMP endfunc
0F73                      1909     decimal3:
0F73 B0CF                 1910             MOV AL, 11001111b
0F75 E99300               1911             JMP endfunc
                          1912             
0F78                      1913             four:
0F78 3C04                 1914             CMP AL,4
0F7A 7511                 1915             JNE five
0F7C 833EA60001           1916             CMP DS:DECIMAL_FLAG, 1
0F81 7405                 1917             JE decimal4
0F83 B066                 1918             MOV AL, 01100110b
0F85 E98300               1919             JMP endfunc
0F88                      1920     decimal4:
0F88 B0E6                 1921             MOV AL, 11100110b
0F8A EB7F90               1922             JMP endfunc
                          1923             
0F8D                      1924             five:
0F8D 3C05                 1925             CMP AL,5
0F8F 7511                 1926             JNE six
0F91 833EA60001           1927             CMP DS:DECIMAL_FLAG, 1
0F96 7405                 1928             JE decimal5
0F98 B06D                 1929             MOV AL, 01101101b
0F9A EB6F90               1930             JMP endfunc
0F9D                      1931     decimal5:
0F9D B0ED                 1932             MOV AL, 11101101b
0F9F EB6A90               1933             JMP endfunc
                          1934             
0FA2                      1935             six:
0FA2 3C06                 1936             CMP AL,6
0FA4 7511                 1937             JNE seven
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:34:13  12/07/;3  PAGE   37


LOC  OBJ                  LINE     SOURCE

0FA6 833EA60001           1938             CMP DS:DECIMAL_FLAG, 1
0FAB 7405                 1939             JE decimal6
0FAD B07D                 1940             MOV AL, 01111101b
0FAF EB5A90               1941             JMP endfunc
0FB2                      1942     decimal6:
0FB2 B0FD                 1943             MOV AL, 11111101b
0FB4 EB5590               1944             JMP endfunc
                          1945             
0FB7                      1946             seven:
0FB7 3C07                 1947             CMP AL,7
0FB9 7511                 1948             JNE eight
0FBB 833EA60001           1949             CMP DS:DECIMAL_FLAG, 1
0FC0 7405                 1950             JE decimal7
0FC2 B007                 1951             MOV AL, 00000111b
0FC4 EB4590               1952             JMP endfunc
0FC7                      1953     decimal7:
0FC7 B087                 1954             MOV AL, 10000111b
0FC9 EB4090               1955             JMP endfunc
                          1956             
0FCC                      1957             eight:
0FCC 3C08                 1958             CMP AL,8
0FCE 7511                 1959             JNE nine
0FD0 833EA60001           1960             CMP DS:DECIMAL_FLAG, 1
0FD5 7405                 1961             JE decimal8
0FD7 B07F                 1962             MOV AL, 01111111b
0FD9 EB3090               1963             JMP endfunc
0FDC                      1964     decimal8:
0FDC B0FF                 1965             MOV AL, 11111111b
0FDE EB2B90               1966             JMP endfunc
                          1967             
0FE1                      1968             nine:
0FE1 3C09                 1969             CMP AL,9
0FE3 7511                 1970             JNE hifn
0FE5 833EA60001           1971             CMP DS:DECIMAL_FLAG, 1
0FEA 7405                 1972             JE decimal9
0FEC B06F                 1973             MOV AL, 01101111b
0FEE EB1B90               1974             JMP endfunc
0FF1                      1975     decimal9:
0FF1 B0EF                 1976             MOV AL, 11101111b
0FF3 EB1690               1977             JMP endfunc
                          1978             
0FF6                      1979             hifn:
0FF6 3C2D                 1980             CMP AL,'-'
0FF8 7511                 1981             JNE endfunc
0FFA 833EA60001           1982             CMP DS:DECIMAL_FLAG, 1
0FFF 7405                 1983             JE decimal10
1001 B040                 1984             MOV AL, 01000000b
1003 EB0690               1985             JMP endfunc
1006                      1986     decimal10:
1006 B0C0                 1987             MOV AL, 11000000b
1008 EB0190               1988             JMP endfunc
                          1989             
100B                      1990             endfunc:
100B 5A                   1991             POP DX
100C 59                   1992             POP CX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:34:13  12/07/;3  PAGE   38


LOC  OBJ                  LINE     SOURCE

100D 5B                   1993             POP BX
                          1994     
100E CB                   1995     RET
                          1996     BCD_TO_7SEG ENDP
                          1997     
----                      1998     CODE_SEG        ENDS
                          1999     END

ASSEMBLY COMPLETE, NO ERRORS FOUND
