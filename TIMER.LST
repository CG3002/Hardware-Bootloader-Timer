8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    23:48:05  12/07/;3  PAGE    1


DOS 5.0 (038-N) 8086/87/88/186 MACRO ASSEMBLER V3.1 ASSEMBLY OF MODULE TIMER
OBJECT MODULE PLACED IN TIMER.OBJ
ASSEMBLER INVOKED BY:  D:\ASM86.EXE TIMER.ASM


LOC  OBJ                  LINE     SOURCE

                             1 +1  $MOD186
                             2 +1  $EP
                             3     NAME TIMER
                             4     ; Main program for uPD70208 microcomputer system
                             5     ;
                             6     ; Author:       Dr Tay Teng Tiow
                             7     ; Address:      Department of Electrical Engineering 
                             8     ;               National University of Singapore
                             9     ;               10, Kent Ridge Crescent
                            10     ;               Singapore 0511. 
                            11     ; Date:         6th September 1991
                            12     ;
                            13     ; This file contains proprietory information and cannot be copied 
                            14     ; or distributed without prior permission from the author.
                            15     ; =========================================================================
                            16     
                            17     public  serial_rec_action, timer2_action
                            18     extrn   print_char:far, print_2hex:far, iodefine:far
                            19     extrn   set_timer2:far
                            20     
                            21     ;IO Setup for 80C188 
  FFA0                      22             UMCR    EQU    0FFA0H ; Upper Memory Control Register
  FFA2                      23             LMCR    EQU    0FFA2H ; Lower Memory control Register         
  FFA4                      24             PCSBA   EQU    0FFA4H ; Peripheral Chip Select Base Address
  FFA8                      25             MPCS    EQU    0FFA8H ; MMCS and PCS Alter Control Register
  0080                      26             A_8255  EQU    0080H
  0081                      27             B_8255  EQU    0081H
  0082                      28             C_8255  EQU    0082H
  0083                      29             CWR_8255  EQU    0083H
  FF38                      30             INT0CON  EQU   0FF38H
  FF22                      31             EOI EQU 0FF22H
  FF28                      32             IMASK EQU 0FF28H
  FFA6                      33             MMCS    EQU    0FFA6H 
  4000                      34             DAC EQU 4000H
                            35     
                            36     
----                        37     STACK_SEG       SEGMENT
0000 (512                   38                     DB      512 DUP(?)
     ??
     )
0200                        39             TOS     LABEL   WORD
----                        40     STACK_SEG       ENDS
                            41     
                            42     
----                        43     DATA_SEG        SEGMENT
0000 0A                     44             TIMER0_MESS             DB      10,13,'TIMER2 INTERRUPT    '
0001 0D
0002 54494D45523220
     494E5445525255
     505420202020
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    23:48:05  12/07/;3  PAGE    2


LOC  OBJ                  LINE     SOURCE

0016 18                     45             T_COUNT                 DB      24
0017 18                     46             T_COUNT_SET             DB      24
0018 0A                     47             REC_MESS                DB      10,13,'Period of timer0 =     '
0019 0D
001A 506572696F6420
     6F662074696D65
     7230203D202020
     2020
0031 (32                    48             MESSAGE         DB  32 dup('h')
     68
     )
0051 00                     49             KEYPAD_INPUT    DB  0,0,0,0,0,0,0,0
0052 00
0053 00
0054 00
0055 00
0056 00
0057 00
0058 00
0059 2D                     50             BCD_MESSAGE     DB  '-','-','-','-','-','-'
005A 2D
005B 2D
005C 2D
005D 2D
005E 2D
005F FE                     51             ENABLE_BYTE     DB  11111110b
0060 00                     52             BCD_INDEX       DB  0
0061 0000                   53             KEYPAD_INDEX    DW      0
0063 20                     54             M_SIZE                  DB  32
0064 0040                   55             DAC_BASE        DW  4000H
0066 (15                    56             DAC_ADDR        DB  15 dup(0) 
     00
     )
0075 00                     57             DAC_LEN         DB  0
0076 0000                   58             SI_PTR          DW  0
0078 ??                     59             CHAR                    DB  ?
0079 ??                     60             REG_AL                  DB  ?
007A ??                     61             REG_BH                  DB  ?
007B ??                     62             REG_CL                  DB  ?
007C 00                     63             FLAG            DB  0
007D 00                     64             LONG_PRESS_FLAG DB      0
007E 7231                   65             MY_ID                   DB      'r1'
0080 00                     66             ID_FLAG_@               DB      0
0081 00                     67             ID_FLAG_r               DB      0
0082 4072312F               68             REPLY_MESSAGE   DB      '@r1/'
0086 40302F                 69             FAIL_MESSAGE    DB '@0/'
0089 04                     70             REPLY_COUNT             DB      4
008A 03                     71             FAIL_COUNT              DB      3
008B 00                     72             REPLY_FLAG              DB      0
008C 00                     73             SEND_FLAG       DB  0
008D (20                    74             SEND_BUFFER     DB  20 dup(0)
     00
     )
00A1 0000                   75             SEND_BUFFER_LEN DW      0
00A3 0000                   76             MAX_INPUT_SIZE  DW      0
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    23:48:05  12/07/;3  PAGE    3


LOC  OBJ                  LINE     SOURCE

00A5 0000                   77             QTY_FLAG                DW      0
00A7 0000                   78             RECEIVE_FLAG    DW      0
00A9 0000                   79             DAC_FLAG                DW      0
00AB 0000                   80             PRICE_FLAG      DW      0
00AD 0100                   81             DECIMAL_FLAG    DW      1
00AF 0000                   82             SCROLL_LEN      DW      0
00B1 0000                   83             DAC_DISABLE     DW  0
00B3 0300                   84             DECIMAL_INDEX   DW  3
00B5 0100                   85             LANG_FLAG       DW  1
00B7 0000                   86             PRICE                   DW      0
00B9 0000                   87             QTY                             DW      0
00BB 0000                   88             TOTAL_PRICE_U   DW      0
00BD 0000                   89             TOTAL_PRICE_L   DW      0
00BF 0000                   90             TOTAL_PRICE_DEC DW      0
00C1 (8                     91             TEMP_BCD_ARR    DB  8 dup(0)
     00
     )
00C9 0000                   92             THOUSAND_FLAG   DW  0
00CB 0000                   93             CENT_FLAG               DW      0
00CD 0000                   94             DOLLAR_FLAG             DW      0
00CF 0000                   95             CASH_FLAG               DW      0
00D1 (8                     96             CASH_AMT        DB  8 dup(0)
     00
     )
00D9 (8                     97             TEMP_CASH_ARR   DW  8 dup(0)
     0000
     )
00E9 0000                   98             CASH_OK_FLAG    DW  0
00EB 0000                   99             BORROW_POSITION DW  0
00ED 0100                  100             CANCEL_FLAG             DW  1
00EF 0000                  101             TRANSACTION_OVER DW 0
00F1 0100                  102             DATA_ENTER              DW  1
00F3 (8                    103             TROLLEY_ARRAY   DB  8 dup(0)
     00
     )
00FB 0000                  104             TROLLEY_INDEX   DW  0
00FD 0000                  105             TROLLEY_FLAG    DW  0
00FF 0000                  106             TROLLEY_ID              DW  0
0101 0000                  107             TROLLEY_DISABLED DW 0
0103 0000                  108             TEN_THOUSAND_FLAG DW 0
0105 0000                  109             ZERO_TELL               DW  0
----                       110     DATA_SEG        ENDS
                           111     
                           112     
----                       113     CODE_SEG        SEGMENT
                           114     
                           115             PUBLIC          START
                           116     
                           117     ASSUME  CS:CODE_SEG, SS:STACK_SEG
                           118     
0000                       119     START:
                           120     ;initialize stack area
0000 B8----         R      121                     MOV     AX,STACK_SEG            
0003 8ED0                  122                     MOV     SS,AX
0005 368B260002            123                     MOV     SP,TOS
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    23:48:05  12/07/;3  PAGE    4


LOC  OBJ                  LINE     SOURCE

                           124                     
                           125     ; Initialize the on-chip pheripherals
000A 9A0000----     E      126                     CALL    FAR PTR IODEFINE
                           127                     
000F 9A0000----     E      128     call set_timer2
0014 FB                    129                    STI
                           130     
                           131     ; ^^^^^^^^^^^^^^^^^  Start of User Main Routine  ^^^^^^^^^^^^^^^^^^
                           132     
                           133     ;Initialize MMCS
                           134             
0015 BAA6FF                135             MOV DX, MMCS
0018 B80340                136             MOV AX, 4003H
001B EF                    137             OUT DX, AX
                           138     
                           139     ; Initialize MPCS to MAP peripheral to IO address
                           140             
001C BAA8FF                141             MOV DX, MPCS
001F B88320                142             MOV AX, 2083H
0022 EF                    143             OUT DX, AX
                           144        
                           145     ; PCSBA initial, set the parallel port start from 00H
0023 BAA4FF                146             MOV DX, PCSBA
0026 B80300                147             MOV AX, 0003H ; Peripheral starting address 00H no READY, No Waits
0029 EF                    148             OUT DX, AX
                           149     
                           150     ; Initialize LMCS 
002A BAA2FF                151         MOV DX, LMCR
002D B8C401                152         MOV AX, 01C4H  ; Starting address 1FFFH, 8K, No waits, last shoud be 5H for 1 wai
                                   ts      
0030 EF                    153         OUT DX, AX
                           154             
0031 B8----         R      155             MOV AX, DATA_SEG
0034 8ED8                  156             MOV DS, AX
                           157                              
0036 BA8300                158             MOV DX, CWR_8255
0039 B88200                159             MOV AX, 0082h
003C EF                    160             OUT DX, AX
                           161             
003D                       162     NEXT:
003D 9A4400----     R      163             CALL FAR PTR KEYPAD_LOOP
                           164             
0042 EBF9                  165     JMP NEXT
                           166     
0044                       167     KEYPAD_LOOP PROC FAR
0044 50                    168     PUSH AX
0045 53                    169     PUSH BX
0046 51                    170     PUSH CX
0047 52                    171     PUSH DX
                           172             
0048 9AD006----     R      173                             CALL FAR PTR DEBOUNCE           
                           174                             
004D C606790003            175     WAIT_1:         MOV DS:REG_AL, 03H
0052 BB0000                176                         MOV BX, 0000H
0055 BA8200                177                         MOV DX,C_8255
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    23:48:05  12/07/;3  PAGE    5


LOC  OBJ                  LINE     SOURCE

0058 8AC3                  178                         MOV AL,BL
005A EE                    179                         OUT DX,AL
                           180                        
005B BA8100                181                         MOV DX,B_8255
005E EC                    182                         IN AL,DX
005F 8AD8                  183                         MOV BL,AL  
0061 80E3FC                184                         AND BL,0FCH
0064 80FBFC                185                         CMP BL,0FCH
                           186                      
0067 744F                  187                     JE LONG_PRESS
                           188                             
0069 B3FE                  189                         MOV BL, 0FEH
006B C6067A0004            190                         MOV DS:REG_BH, 04H
                           191                        
0070                       192     NXTROW: 
0070 C0C307                193                     ROL BL,07H
0073 8AEB                  194                             MOV CH,BL
0075 BA8200                195                             MOV DX,C_8255
0078 8AC3                  196                             MOV AL,BL
007A EE                    197                             OUT DX,AL
                           198                             
007B BA8100                199                             MOV DX,B_8255
007E EC                    200                             IN AL,DX
007F 8AD8                  201                             MOV BL,AL
0081 80E3FC                202                             AND BL,0FCH
0084 C6067B0006            203                             MOV DS:REG_CL,06H
0089 C0DB02                204                             RCR BL,02H
008C D0DB                  205     NXTCOL:         RCR BL,01H
008E 7330                  206                             JNC CODEKY
0090 FE0E7900              207                             DEC DS:REG_AL
0094 FE0E7B00              208                             DEC DS:REG_CL
0098 803E7B0003            209                             CMP DS:REG_CL,03H
009D 7413                  210                             JE KEYPAD4
                           211                             
009F 803E7B0000            212                             CMP DS:REG_CL, 0H
00A4 740F                  213                             JE SUBTRACT3
00A6 EBE4                  214                             JMP NXTCOL
                           215                             
00A8 8ADD                  216                             MOV BL,CH
00AA FE0E7A00              217                             DEC DS:REG_BH
00AE 75C0                  218                             JNZ NXTROW
00B0 EB9B                  219                             JMP WAIT_1
                           220                             
00B2 E97F00                221     KEYPAD4:    JMP KEYPAD3
00B5 E97F00                222     SUBTRACT3:  JMP SUBTRACT2
                           223                             
00B8                       224     LONG_PRESS:
00B8 C6067D0000            225                             MOV DS:LONG_PRESS_FLAG, 0
00BD EB7290                226                             JMP RETURN2
00C0                       227     CODEKY:
00C0 803E79000B            228                         CMP DS:REG_AL, 11
00C5 7505                  229                             JNE bcd_upd
00C7 C606790000            230                             MOV DS:REG_AL, 0
                           231                             
00CC                       232     bcd_upd:
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    23:48:05  12/07/;3  PAGE    6


LOC  OBJ                  LINE     SOURCE

00CC 803E7D0000            233                             CMP DS:LONG_PRESS_FLAG, 0
00D1 755E                  234                             JNE RETURN2
                           235                             
00D3 803E790018            236                             CMP DS:REG_AL, 24
00D8 7560                  237                             JNE TROLLEY
00DA 833EEF0000            238                             CMP DS:TRANSACTION_OVER, 0
00DF 7459                  239                             JE TROLLEY
00E1 BB0000                240                             MOV BX, 0
00E4 C6878D003E            241                             MOV DS:SEND_BUFFER[BX], '>'
                           242                             
00E9 B90800                243                             MOV CX, 8
00EC                       244                             SEND_CASH_PRINT:
00EC 53                    245                                     PUSH BX
00ED BB0800                246                                     MOV BX, 8
00F0 2BD9                  247                                     SUB BX, CX
00F2 8A87D100              248                                     MOV AL, DS:CASH_AMT[BX]
00F6 5B                    249                                     POP BX
                           250                                     
00F7 43                    251                                     INC BX
00F8 0430                  252                                     ADD AL, 30H
00FA 88878D00              253                                     MOV DS:SEND_BUFFER[BX], AL
00FE E2EC                  254                             LOOP SEND_CASH_PRINT
                           255                             
0100 43                    256                             INC BX
0101 C6878D0029            257                             MOV DS:SEND_BUFFER[BX], ')'
                           258                             
0106 B90800                259                             MOV CX, 8
0109                       260                             SEND_CHANGE_PRINT:
0109 53                    261                                     PUSH BX
010A BB0800                262                                     MOV BX, 8
010D 2BD9                  263                                     SUB BX, CX
010F 8A87C100              264                                     MOV AL, DS:TEMP_BCD_ARR[BX]
0113 5B                    265                                     POP BX
                           266                                     
0114 43                    267                                     INC BX
0115 0430                  268                                     ADD AL, 30H
0117 88878D00              269                                     MOV DS:SEND_BUFFER[BX], AL
011B E2EC                  270                             LOOP SEND_CHANGE_PRINT
                           271                             
011D 43                    272                             INC BX
011E C6878D002F            273                             MOV DS:SEND_BUFFER[BX], '/'
0123 C706A1001300          274                             MOV DS:SEND_BUFFER_LEN, 19
0129 C6068C0001            275                             MOV DS:SEND_FLAG, 1
012E E95A02                276                             JMP UPDATE_7SEG2
                           277                             
0131 E97103                278     RETURN2:    JMP RETURN
                           279                             
0134 E95003                280     KEYPAD3:        JMP KEYPAD_2
                           281                             
0137 E95D03                282     SUBTRACT2:   JMP SUBTRACT
                           283     
013A                       284     TROLLEY:
013A 803E790011            285                             CMP DS:REG_AL, 17
013F 754C                  286                             JNE ENTER_CASH
                           287                             
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    23:48:05  12/07/;3  PAGE    7


LOC  OBJ                  LINE     SOURCE

0141 833E010101            288                             CMP DS:TROLLEY_DISABLED, 1
0146 7442                  289                             JE SKIP_ENTER_DATA1
                           290                             
0148 833ECF0001            291                             CMP DS:CASH_FLAG, 1
014D 743B                  292                             JE SKIP_ENTER_DATA1
014F 9A1F06----     R      293                             CALL FAR PTR BCD_CLEAR
                           294                             
0154 833EEF0000            295                             CMP DS:TRANSACTION_OVER, 0
0159 7405                  296                             JE NO_RESET_NEEDED1
                           297                             
015B 9ADD04----     R      298                             CALL FAR PTR CLEAR_TEMP_BCD
                           299                             
0160                       300             NO_RESET_NEEDED1:
0160 C706F1000100          301                             MOV DS:DATA_ENTER, 1
0166 C706B3000600          302                             MOV DS:DECIMAL_INDEX, 6
016C C706A3000600          303                             MOV DS:MAX_INPUT_SIZE, 6
0172 C706FF000100          304                             MOV DS:TROLLEY_ID, 1
0178 C706B5000000          305                             MOV DS:LANG_FLAG, 0
017E C706CF000000          306                             MOV DS:CASH_FLAG, 0
0184 C706EF000000          307                             MOV DS:TRANSACTION_OVER, 0
018A                       308             SKIP_ENTER_DATA1:
018A E9FE01                309                             JMP UPDATE_7SEG2
                           310                             
                           311                             
018D                       312     ENTER_CASH:     
018D 803E790014            313                             CMP DS:REG_AL, 20
0192 7521                  314                             JNE SEND_CASH
0194 833ECF0000            315                             CMP DS:CASH_FLAG, 0
0199 7417                  316                             JE SKIP_CASH
019B C706F1000100          317                             MOV DS:DATA_ENTER, 1
01A1 9A1F06----     R      318                             CALL FAR PTR BCD_CLEAR
01A6 C706A3000800          319                             MOV DS:MAX_INPUT_SIZE, 8
01AC C706B3000600          320                             MOV DS:DECIMAL_INDEX, 6
01B2                       321                     SKIP_CASH:
01B2 E9D601                322                             JMP UPDATE_7SEG2
                           323                             
01B5                       324     SEND_CASH:
01B5 803E790017            325                             CMP DS:REG_AL, 23
01BA 7523                  326                             JNE CLEAR_BUTTON
01BC 833ECF0000            327                             CMP DS:CASH_FLAG, 0
01C1 7419                  328                             JE SKIP_SEND_CASH
01C3 833E610000            329                             CMP DS:KEYPAD_INDEX, 0
01C8 7412                  330                             JE SKIP_SEND_CASH
01CA 833EB30003            331                             CMP DS:DECIMAL_INDEX, 3
01CF 740B                  332                             JE SKIP_SEND_CASH
01D1 C706F1000000          333                             MOV DS:DATA_ENTER, 0
01D7 9AF506----     R      334                             CALL FAR PTR TAKE_CASH
01DC                       335                     SKIP_SEND_CASH:
01DC E9AC01                336                             JMP UPDATE_7SEG2
                           337                             
01DF                       338     CLEAR_BUTTON:
01DF 803E79000A            339                             CMP DS:REG_AL, 10
01E4 7508                  340                             JNE BACKSPACE
01E6 9A1F06----     R      341                             CALL FAR PTR BCD_CLEAR
01EB E99D01                342                             JMP UPDATE_7SEG2
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    23:48:05  12/07/;3  PAGE    8


LOC  OBJ                  LINE     SOURCE

                           343                             
01EE 803E79000C            344     BACKSPACE:      CMP DS:REG_AL, 12
01F3 7508                  345                             JNE ENTER_DATA
01F5 9AB005----     R      346                             CALL FAR PTR BCD_BACKSPACE
01FA E98E01                347                             JMP UPDATE_7SEG2
                           348     
01FD 803E79000D            349     ENTER_DATA:     CMP DS:REG_AL, 13
0202 753F                  350                             JNE END_TRANS
0204 833ECF0001            351                             CMP DS:CASH_FLAG, 1
0209 7435                  352                             JE SKIP_ENTER_DATA
020B 9A1F06----     R      353                             CALL FAR PTR BCD_CLEAR
                           354                             
0210 833EEF0000            355                             CMP DS:TRANSACTION_OVER, 0
0215 7405                  356                             JE NO_RESET_NEEDED
                           357                             
0217 9ADD04----     R      358                             CALL FAR PTR CLEAR_TEMP_BCD
                           359                             
021C                       360             NO_RESET_NEEDED:
021C C706F1000100          361                             MOV DS:DATA_ENTER, 1
0222 C706B3000600          362                             MOV DS:DECIMAL_INDEX, 6
0228 C706A3000800          363                             MOV DS:MAX_INPUT_SIZE, 8
022E C706B5000000          364                             MOV DS:LANG_FLAG, 0
0234 C706CF000000          365                             MOV DS:CASH_FLAG, 0
023A C706EF000000          366                             MOV DS:TRANSACTION_OVER, 0
0240                       367             SKIP_ENTER_DATA:
0240 E94801                368                             JMP UPDATE_7SEG2
                           369                             
0243 803E790010            370     END_TRANS:      CMP DS:REG_AL, 16
0248 7553                  371                             JNE CANCEL_TRANS
024A 833EFF0001            372                             CMP DS:TROLLEY_ID, 1
024F 7449                  373                             JE END_TRANS_CONT
0251 833ECF0001            374                             CMP DS:CASH_FLAG, 1
0256 7442                  375                             JE END_TRANS_CONT
0258 833EEF0000            376                             CMP DS:TRANSACTION_OVER, 0
025D 7403                  377                             JE TRANSACTION_NOT_OVER
025F E92901                378                             JMP UPDATE_7SEG2
0262                       379     TRANSACTION_NOT_OVER:
0262 BB0000                380                             MOV BX, 0
0265 C6878D0024            381                             MOV DS:SEND_BUFFER[BX], '$'
026A 43                    382                             INC BX
026B C6878D002F            383                             MOV DS:SEND_BUFFER[BX], '/'
0270 C706A1000200          384                             MOV DS:SEND_BUFFER_LEN, 2
0276 C6068C0001            385                             MOV DS:SEND_FLAG, 1
027B C706BF000000          386                             MOV DS:TOTAL_PRICE_DEC, 0
0281 C706BD000000          387                             MOV DS:TOTAL_PRICE_L, 0
0287 C706BB000000          388                             MOV DS:TOTAL_PRICE_U, 0
028D 833EED0001            389                             CMP DS:CANCEL_FLAG, 1
0292 7406                  390                             JE END_TRANS_CONT
0294 C706CF000100          391                             MOV DS:CASH_FLAG, 1
029A                       392                     END_TRANS_CONT:
029A E9EE00                393                             JMP UPDATE_7SEG2
                           394                             
029D                       395     CANCEL_TRANS:   
029D 803E79000F            396                             CMP DS:REG_AL, 15
02A2 755A                  397                             JNE SCROLL_LEFT
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    23:48:05  12/07/;3  PAGE    9


LOC  OBJ                  LINE     SOURCE

02A4 833ECF0001            398                             CMP DS:CASH_FLAG, 1
02A9 7503                  399                             JNE CONT_CANCEL
02AB E9DD00                400                             JMP UPDATE_7SEG2
02AE                       401                     CONT_CANCEL:
02AE BB0000                402                             MOV BX, 0
02B1 C6878D003F            403                             MOV DS:SEND_BUFFER[BX], '?'
02B6 43                    404                             INC BX
02B7 C6878D002F            405                             MOV DS:SEND_BUFFER[BX], '/'
02BC C706A1000200          406                             MOV DS:SEND_BUFFER_LEN, 2
02C2 C6068C0001            407                             MOV DS:SEND_FLAG, 1
02C7 C706BF000000          408                             MOV DS:TOTAL_PRICE_DEC, 0
02CD C706BD000000          409                             MOV DS:TOTAL_PRICE_L, 0
02D3 C706BB000000          410                             MOV DS:TOTAL_PRICE_U, 0
02D9 C706B3000300          411                             MOV DS:DECIMAL_INDEX, 3
02DF 9A1F06----     R      412                             CALL FAR PTR BCD_CLEAR
02E4 C706A3000000          413                             MOV DS:MAX_INPUT_SIZE, 0
                           414                             
02EA 9ADD04----     R      415                             CALL FAR PTR CLEAR_TEMP_BCD
                           416                             
02EF C706ED000100          417                             MOV DS:CANCEL_FLAG, 1
02F5 C70601010000          418                             MOV DS:TROLLEY_DISABLED, 0
02FB E98D00                419                             JMP UPDATE_7SEG2
                           420                             
02FE                       421     SCROLL_LEFT:
02FE 803E790015            422                             CMP DS:REG_AL, 21
0303 753D                  423                             JNE SCROLL_RIGHT
0305 833E610006            424                             CMP DS:KEYPAD_INDEX, 6
030A 7E7F                  425                             JLE UPDATE_7SEG2
030C 833EAF0000            426                             CMP DS:SCROLL_LEN, 0
0311 7478                  427                             JE UPDATE_7SEG2
0313 FF0EAF00              428                             DEC DS:SCROLL_LEN
0317 FF0EB300              429                             DEC DS:DECIMAL_INDEX
031B FF0E6100              430                             DEC DS:KEYPAD_INDEX
031F 8B1E6100              431                             MOV BX, DS:KEYPAD_INDEX
0323 8A4751                432                             MOV AL, DS:KEYPAD_INPUT[BX]
0326 A27900                433                             MOV DS:REG_AL, AL
0329 C706B1000100          434                             MOV DS:DAC_DISABLE, 1
032F 9A4A06----     R      435                             CALL FAR PTR BCD_UPDATE
0334 C706B1000000          436                             MOV DS:DAC_DISABLE, 0
033A C606790015            437                             MOV DS:REG_AL, 21
033F EB4A90                438                             JMP UPDATE_7SEG2
                           439     
0342                       440     SCROLL_RIGHT:
0342 803E790013            441                             CMP DS:REG_AL, 19
0347 7545                  442                             JNE LANG_TOGGLE
0349 833E610006            443                             CMP DS:KEYPAD_INDEX, 6
034E 7E3B                  444                             JLE UPDATE_7SEG2
0350 A16100                445                             MOV AX, DS:KEYPAD_INDEX
0353 2D0600                446                             SUB AX, 6
0356 3906AF00              447                             CMP DS:SCROLL_LEN, AX
035A 742F                  448                             JE UPDATE_7SEG2
035C FF06AF00              449                             INC DS:SCROLL_LEN
0360 FF06B300              450                             INC DS:DECIMAL_INDEX
0364 FF0E6100              451                             DEC DS:KEYPAD_INDEX
0368 8B1E6100              452                             MOV BX, DS:KEYPAD_INDEX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    23:48:05  12/07/;3  PAGE   10


LOC  OBJ                  LINE     SOURCE

036C 8A4751                453                             MOV AL, DS:KEYPAD_INPUT[BX]
036F A27900                454                             MOV DS:REG_AL, AL
0372 C706B1000100          455                             MOV DS:DAC_DISABLE, 1
0378 9A4A06----     R      456                             CALL FAR PTR BCD_UPDATE
037D C706B1000000          457                             MOV DS:DAC_DISABLE, 0
0383 C606790013            458                             MOV DS:REG_AL, 19
0388 EB0190                459                             JMP UPDATE_7SEG2
                           460                             
038B E9DE00                461     UPDATE_7SEG2: JMP UPDATE_7SEG
                           462     
038E                       463     LANG_TOGGLE:
038E 803E790012            464                             CMP DS:REG_AL, 18
0393 7537                  465                             JNE QTY_PROMPT
0395 833EB50001            466                             CMP DS:LANG_FLAG, 1
039A 75EF                  467                             JNE UPDATE_7SEG2
039C A16400                468                             MOV AX, DS:DAC_BASE
039F 3D0040                469                             CMP AX, 4000H
03A2 7406                  470                             JE MANDRIN
03A4 B80040                471                             MOV AX, 4000H
03A7 EB0490                472                             JMP SEND_TOGGLE
03AA                       473             MANDRIN:
03AA B80066                474                             MOV AX, 6600H
03AD                       475             SEND_TOGGLE:
03AD A36400                476                             MOV DS:DAC_BASE, AX
03B0 BB0000                477                             MOV BX, 0
03B3 C6878D0021            478                             MOV DS:SEND_BUFFER[BX], '!'
03B8 43                    479                             INC BX
03B9 C6878D002F            480                             MOV DS:SEND_BUFFER[BX], '/'
03BE C706A1000200          481                             MOV DS:SEND_BUFFER_LEN, 2
03C4 C6068C0001            482                             MOV DS:SEND_FLAG, 1
03C9 E9A000                483                             JMP UPDATE_7SEG
03CC                       484     QTY_PROMPT:
03CC 803E790016            485                             CMP DS:REG_AL, 22
03D1 7527                  486                             JNE QUANTITY
03D3 833ECF0001            487                             CMP DS:CASH_FLAG, 1
03D8 7420                  488                             JE QUANTITY
03DA 833E610008            489                             CMP DS:KEYPAD_INDEX, 8
03DF 7519                  490                             JNE  QUANTITY
                           491                             ; CMP DS:MAX_INPUT_SIZE, 8
                           492                             ; JNE QUANTITY
03E1 9A6905----     R      493                             CALL FAR PTR UPDATE_SEND_BUFFER
03E6 9A1F06----     R      494                             CALL FAR PTR BCD_CLEAR
03EB C706A3000200          495                             MOV DS:MAX_INPUT_SIZE, 2
03F1 C706A5000100          496                             MOV DS:QTY_FLAG, 1
03F7 EB7390                497                             JMP UPDATE_7SEG
                           498                     
03FA                       499     QUANTITY:
03FA 833E610000            500                             CMP DS:KEYPAD_INDEX, 0
03FF 746B                  501                             JE  UPDATE_7SEG
                           502                             
0401 803E79000E            503                             CMP DS:REG_AL, 14
0406 7564                  504                             JNE UPDATE_7SEG
                           505                             
0408 833EFF0001            506                             CMP DS:TROLLEY_ID, 1
040D 752C                  507                             JNE NORMAL_UPDATE
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    23:48:05  12/07/;3  PAGE   11


LOC  OBJ                  LINE     SOURCE

                           508                             
040F 833E610006            509                             CMP DS:KEYPAD_INDEX, 6
0414 7525                  510                             JNE NORMAL_UPDATE
                           511                             
0416 9AAA04----     R      512                             CALL FAR PTR UPDATE_TROLLEY_ID
                           513                             
041B C706FF000000          514                             MOV DS:TROLLEY_ID, 0
0421 C6068C0001            515                             MOV DS:SEND_FLAG, 1
0426 C706F1000000          516                             MOV DS:DATA_ENTER, 0
042C C706ED000000          517                             MOV DS:CANCEL_FLAG, 0
0432 C706CF000100          518                             MOV DS:CASH_FLAG, 1
                           519                             
0438 EB3290                520                             JMP UPDATE_7SEG
                           521                             
043B                       522                     NORMAL_UPDATE:  
043B 833EA50001            523                             CMP DS:QTY_FLAG, 1
0440 752A                  524                             JNE UPDATE_7SEG
                           525                             
0442 C706F1000000          526                             MOV DS:DATA_ENTER, 0
                           527                             
0448 C706ED000000          528                             MOV DS:CANCEL_FLAG, 0
                           529                     
044E 9A1805----     R      530                             CALL FAR PTR UPDATE_THE_QUANTITY
                           531                             
0453 C70601010100          532                             MOV DS:TROLLEY_DISABLED, 1
0459 C6068C0001            533                             MOV DS:SEND_FLAG, 1
                           534                             
045E C706A5000000          535                             MOV DS:QTY_FLAG, 0
0464 9A1F06----     R      536                             CALL FAR PTR BCD_CLEAR
0469 EB0190                537                             JMP UPDATE_7SEG
                           538                             
                           539     
046C                       540     UPDATE_7SEG:
046C 803E790009            541                             CMP DS:REG_AL, 9
0471 7F0C                  542                             JG SET_PRESS_FLAG
                           543                             
0473 833EF10001            544                             CMP DS:DATA_ENTER, 1
0478 7505                  545                             JNE SET_PRESS_FLAG
                           546                             
047A 9A4A06----     R      547                             CALL FAR PTR BCD_UPDATE
                           548                             
047F                       549     SET_PRESS_FLAG:
047F C6067D0001            550                             MOV DS:LONG_PRESS_FLAG, 1
0484 EB1F90                551                             JMP RETURN
                           552             
0487                       553     KEYPAD_2: 
0487 800679000F            554                 ADD DS:REG_AL,0FH
048C E9FDFB                555                             JMP NXTCOL
048F C606790000            556     ZERO_PRINT: MOV DS:REG_AL,00H
0494 E9F5FB                557                             JMP NXTCOL
0497 802E790006            558     SUBTRACT:   SUB DS:REG_AL,06H
049C 8ADD                  559                             MOV BL,CH
049E FE0E7A00              560                             DEC DS:REG_BH
04A2 E9CBFB                561                             JMP NXTROW
                           562             
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    23:48:05  12/07/;3  PAGE   12


LOC  OBJ                  LINE     SOURCE

                           563             
04A5                       564     RETURN:
04A5 5A                    565                             POP DX
04A6 59                    566                             POP CX
04A7 5B                    567                             POP BX
04A8 58                    568                             POP AX
04A9 CB                    569                             RET
                           570     
                           571     KEYPAD_LOOP ENDP
                           572     
04AA                       573     UPDATE_TROLLEY_ID PROC FAR
04AA 50                    574     PUSH AX
04AB 53                    575     PUSH BX
04AC 51                    576     PUSH CX
04AD 52                    577     PUSH DX
04AE BB0000                578             MOV BX, 0
04B1 C6878D005E            579             MOV DS:SEND_BUFFER[BX], '^'
04B6 B90600                580             MOV CX, 6
04B9                       581             UPDATE_TROLLEY_BUFFER:
04B9 BB0600                582                     MOV BX, 6
04BC 2BD9                  583                     SUB BX, CX
                           584                     
04BE 8A4751                585                     MOV AL, DS:KEYPAD_INPUT[BX]
                           586                     
04C1 43                    587                     INC BX
04C2 0430                  588                     ADD AL, 30H
04C4 88878D00              589                     MOV DS:SEND_BUFFER[BX], AL
04C8 E2EF                  590             LOOP UPDATE_TROLLEY_BUFFER
                           591             
04CA BB0700                592             MOV BX, 7
04CD C6878D002F            593             MOV DS:SEND_BUFFER[BX], '/'
                           594             
04D2 C706A1000800          595             MOV DS:SEND_BUFFER_LEN, 8
                           596     
04D8 5A                    597     POP DX
04D9 59                    598     POP CX
04DA 5B                    599     POP BX
04DB 58                    600     POP AX
04DC CB                    601     RET
                           602     UPDATE_TROLLEY_ID ENDP
                           603     
04DD                       604     CLEAR_TEMP_BCD PROC FAR
04DD 50                    605     PUSH AX
04DE 53                    606     PUSH BX
04DF 51                    607     PUSH CX
04E0 52                    608     PUSH DX
                           609     
04E1 BB0000                610             MOV BX, 0
04E4 C687C1002D            611             MOV DS:TEMP_BCD_ARR[BX], '-'
04E9 43                    612             INC BX
04EA C687C1002D            613             MOV DS:TEMP_BCD_ARR[BX], '-'
04EF 43                    614             INC BX
04F0 C687C1002D            615             MOV DS:TEMP_BCD_ARR[BX], '-'
04F5 43                    616             INC BX
04F6 C687C1002D            617             MOV DS:TEMP_BCD_ARR[BX], '-'
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    23:48:05  12/07/;3  PAGE   13


LOC  OBJ                  LINE     SOURCE

04FB 43                    618             INC BX
04FC C687C1002D            619             MOV DS:TEMP_BCD_ARR[BX], '-'
0501 43                    620             INC BX
0502 C687C1002D            621             MOV DS:TEMP_BCD_ARR[BX], '-'
0507 43                    622             INC BX
0508 C687C1002D            623             MOV DS:TEMP_BCD_ARR[BX], '-'
050D 43                    624             INC BX
050E C687C1002D            625             MOV DS:TEMP_BCD_ARR[BX], '-'
                           626             
0513 5A                    627     POP DX
0514 59                    628     POP CX
0515 5B                    629     POP BX
0516 58                    630     POP AX
0517 CB                    631     RET
                           632     CLEAR_TEMP_BCD ENDP
                           633     
                           634     
0518                       635     UPDATE_THE_QUANTITY PROC FAR
0518 50                    636     PUSH AX
0519 53                    637     PUSH BX
051A 51                    638     PUSH CX
051B 52                    639     PUSH DX
051C 8B0E6100              640             MOV CX, DS:KEYPAD_INDEX
0520 BB0000                641             MOV BX, 0
0523 BA0000                642             MOV DX, 0
0526                       643             UPD_QTY:
0526 A1B900                644                     MOV AX, DS:QTY
0529 53                    645                     PUSH BX
052A BB0A00                646                     MOV BX, 10
052D F7E3                  647                     MUL BX
052F 5B                    648                     POP BX
0530 8A5751                649                     MOV DL, DS:KEYPAD_INPUT[BX]
0533 03C2                  650                     ADD AX, DX
0535 A3B900                651                     MOV DS:QTY, AX
0538 43                    652                     INC BX
0539 E2EB                  653             LOOP UPD_QTY
                           654             
053B 8B0E6100              655             MOV CX, DS:KEYPAD_INDEX
053F 8B1EA100              656             MOV BX, DS:SEND_BUFFER_LEN
                           657             
0543                       658             UPD_BUFFER:
0543 53                    659                     PUSH BX
0544 8B1E6100              660                     MOV BX, DS:KEYPAD_INDEX
0548 2BD9                  661                     SUB BX, CX
054A 8A4751                662                     MOV AL, DS:KEYPAD_INPUT[BX]
054D 5B                    663                     POP BX
054E 0430                  664                     ADD AL, 30H
0550 88878D00              665                     MOV DS:SEND_BUFFER[BX], AL
                           666                     
0554 43                    667                     INC BX
0555 FF06A100              668                     INC DS:SEND_BUFFER_LEN
0559 E2E8                  669             LOOP UPD_BUFFER
                           670             
055B C6878D002F            671             MOV DS:SEND_BUFFER[BX], '/'
0560 FF06A100              672             INC DS:SEND_BUFFER_LEN
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    23:48:05  12/07/;3  PAGE   14


LOC  OBJ                  LINE     SOURCE

                           673                     
0564 5A                    674     POP DX
0565 59                    675     POP CX
0566 5B                    676     POP BX
0567 58                    677     POP AX
                           678     
0568 CB                    679     RET
                           680     UPDATE_THE_QUANTITY ENDP
                           681     
0569                       682     UPDATE_SEND_BUFFER PROC FAR
0569 50                    683     PUSH AX
056A 53                    684     PUSH BX
056B 51                    685     PUSH CX
056C 52                    686     PUSH DX
                           687     
056D 8B0E6100              688             MOV CX, DS:KEYPAD_INDEX
0571 83F900                689             CMP CX, 0
0574 7435                  690             JE END_UPD_BUFFER
0576 83C102                691             ADD CX, 2
0579 890EA100              692             MOV DS:SEND_BUFFER_LEN, CX
057D BB0000                693             MOV BX, 0
0580                       694             BUFFER_LOOP:
0580 83FB00                695                     CMP BX, 0
0583 7508                  696                     JNE ASTERISK
0585 C6878D007E            697                     MOV DS:SEND_BUFFER[BX], '~'
058A EB1C90                698                     JMP END_BUFFER
058D                       699             ASTERISK:
058D A16100                700                     MOV AX, DS:KEYPAD_INDEX
0590 40                    701                     INC AX
0591 3BD8                  702                     CMP BX, AX
0593 7508                  703                     JNE CONT
0595 C6878D002A            704                     MOV DS:SEND_BUFFER[BX], '*'
059A EB0C90                705                     JMP END_BUFFER
059D                       706             CONT:
059D 4B                    707                     DEC BX
059E 8A4751                708                     MOV AL, DS:KEYPAD_INPUT[BX]
05A1 0430                  709                     ADD AL, 30H
05A3 43                    710                     INC BX
05A4 88878D00              711                     MOV DS:SEND_BUFFER[BX], AL
                           712                     
05A8                       713             END_BUFFER:
05A8 43                    714                     INC BX
05A9 E2D5                  715             LOOP BUFFER_LOOP
05AB                       716     END_UPD_BUFFER:
05AB 5A                    717     POP DX
05AC 59                    718     POP CX
05AD 5B                    719     POP BX
05AE 58                    720     POP AX
05AF CB                    721     RET
                           722     UPDATE_SEND_BUFFER ENDP
                           723     
05B0                       724     BCD_BACKSPACE PROC FAR
                           725     
05B0 50                    726     PUSH AX
05B1 53                    727     PUSH BX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    23:48:05  12/07/;3  PAGE   15


LOC  OBJ                  LINE     SOURCE

05B2 51                    728     PUSH CX
05B3 52                    729     PUSH DX
                           730     
05B4 8A167900              731             MOV DL, DS:REG_AL
05B8 833E610000            732             CMP DS:KEYPAD_INDEX, 0
05BD 7457                  733             JE RETURN_BACK
                           734             
05BF BB0600                735             MOV BX, 6
05C2                       736             BCD_CLEAR_LOOP:
05C2 4B                    737                     DEC BX
05C3 C647592D              738                     MOV DS:BCD_MESSAGE[BX], '-'
05C7 43                    739                     INC BX
05C8 4B                    740                     DEC BX
05C9 75F7                  741             JNZ BCD_CLEAR_LOOP
                           742             
05CB 833E610001            743             CMP DS:KEYPAD_INDEX, 1
05D0 7E2C                  744             JLE less_than_two
                           745             
05D2 FF0E6100              746             DEC DS:KEYPAD_INDEX
05D6 FF0E6100              747             DEC DS:KEYPAD_INDEX
05DA 8B1E6100              748             MOV BX, DS:KEYPAD_INDEX
05DE 8A4751                749             MOV AL, DS:KEYPAD_INPUT[BX]
05E1 A27900                750             MOV DS:REG_AL, AL
05E4 C706AF000000          751             MOV DS:SCROLL_LEN, 0
05EA C706B1000100          752             MOV DS:DAC_DISABLE, 1
05F0 9A4A06----     R      753             CALL FAR PTR BCD_UPDATE
05F5 C706B1000000          754             MOV DS:DAC_DISABLE, 0
05FB EB1990                755             JMP RETURN_BACK
                           756             
05FE                       757     less_than_two:
05FE FF0E6100              758             DEC DS:KEYPAD_INDEX
0602 C60679002D            759             MOV DS:REG_AL, '-'
0607 C706AF000000          760             MOV DS:SCROLL_LEN, 0
060D 9A4A06----     R      761             CALL FAR PTR BCD_UPDATE
0612 FF0E6100              762             DEC DS:KEYPAD_INDEX
                           763             
0616                       764     RETURN_BACK:
0616 88167900              765             MOV DS:REG_AL, DL
061A 5A                    766     POP DX
061B 59                    767     POP CX
061C 5B                    768     POP BX
061D 58                    769     POP AX
                           770     
061E CB                    771     RET
                           772     BCD_BACKSPACE ENDP
                           773     
061F                       774     BCD_CLEAR PROC FAR
061F 50                    775     PUSH AX
0620 53                    776     PUSH BX
0621 51                    777     PUSH CX
0622 52                    778     PUSH DX
0623 BB0800                779             MOV BX, 8
0626                       780             CLEAR_LOOP:
0626 C6475100              781             MOV DS:KEYPAD_INPUT[BX], 0
062A 4B                    782             DEC BX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    23:48:05  12/07/;3  PAGE   16


LOC  OBJ                  LINE     SOURCE

062B 75F9                  783             JNZ CLEAR_LOOP
                           784             
062D BB0600                785             MOV BX, 6
0630                       786             CLEAR_LOOP2:
0630 4B                    787                     DEC BX
0631 C647592D              788                     MOV DS:BCD_MESSAGE[BX], '-'
0635 43                    789                     INC BX
0636 4B                    790                     DEC BX
0637 75F7                  791             JNZ CLEAR_LOOP2
                           792     
0639 C70661000000          793             MOV DS:KEYPAD_INDEX, 0
063F C706AF000000          794             MOV DS:SCROLL_LEN, 0
0645 5A                    795     POP DX
0646 59                    796     POP CX
0647 5B                    797     POP BX
0648 58                    798     POP AX
0649 CB                    799     RET
                           800     BCD_CLEAR ENDP
                           801     
064A                       802     BCD_UPDATE PROC FAR
064A 50                    803     PUSH AX
064B 53                    804     PUSH BX
064C 51                    805     PUSH CX
064D 52                    806     PUSH DX
064E A1A300                807                     MOV AX, DS:MAX_INPUT_SIZE
0651 39066100              808                     CMP DS:KEYPAD_INDEX, AX
0655 7D5A                  809                     JGE BCD_RET
                           810                     
0657 8A0E7900              811                     MOV CL, DS:REG_AL
065B 80F909                812                     CMP CL, 9
065E 7F0C                  813                     JG SKIP_PAST
0660 833EB10001            814                     CMP DS:DAC_DISABLE, 1
0665 7405                  815                     JE SKIP_PAST
0667 9AB606----     R      816                     CALL FAR PTR DAC_UPDATE
                           817     
066C                       818     SKIP_PAST:              
066C 8A0E7900              819                     MOV CL, DS:REG_AL
                           820     
0670 8B1E6100              821                     MOV BX, DS:KEYPAD_INDEX
                           822                             
0674 884F51                823                     MOV DS:KEYPAD_INPUT[BX], CL
                           824                             
0677 FF066100              825                     INC DS:KEYPAD_INDEX
                           826                             
067B 8B1E6100              827                     MOV BX, DS:KEYPAD_INDEX
                           828                     
067F A1AF00                829                     MOV AX, DS:SCROLL_LEN
0682 2BD8                  830                     SUB BX, AX
                           831                     
0684 8B166100              832                     MOV DX, DS:KEYPAD_INDEX
0688 83FA06                833                     CMP DX, 6
068B 7E03                  834                     JLE update_display
068D BA0600                835                     MOV DX, 6
                           836                     
0690                       837             update_display:
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    23:48:05  12/07/;3  PAGE   17


LOC  OBJ                  LINE     SOURCE

                           838             
0690 B90500                839                     MOV CX, 5
0693 4B                    840                     DEC BX
0694 8A4751                841                     MOV AL, DS:KEYPAD_INPUT[BX]
0697 43                    842                     INC BX
                           843                             
0698 52                    844                     PUSH DX
0699 8B166100              845                     MOV DX, DS:KEYPAD_INDEX
069D 2B16AF00              846                     SUB DX, DS:SCROLL_LEN
                           847                     
06A1 2BD3                  848                     SUB DX, BX
                           849                             
06A3 53                    850                     PUSH BX
                           851                             
06A4 2BCA                  852                     SUB CX, DX
06A6 8BD9                  853                     MOV BX, CX
06A8 884759                854                     MOV DS:BCD_MESSAGE[BX], AL
                           855                             
06AB 5B                    856                     POP BX
06AC 5A                    857                     POP DX
                           858             
06AD 4B                    859                     DEC BX
06AE 4A                    860                     DEC DX
06AF 75DF                  861             JNZ update_display
                           862     
06B1                       863             BCD_RET:
06B1 5A                    864                     POP DX
06B2 59                    865                     POP CX
06B3 5B                    866                     POP BX
06B4 58                    867                     POP AX
06B5 CB                    868     RET
                           869     BCD_UPDATE ENDP
                           870     
06B6                       871     DAC_UPDATE PROC FAR
06B6 50                    872             PUSH AX
06B7 53                    873             PUSH BX
06B8 51                    874             PUSH CX
06B9 52                    875             PUSH DX
                           876             
06BA BB0000                877             MOV BX, 0
06BD 8A1E7500              878             MOV BL, DS:DAC_LEN
06C1 A07900                879             MOV AL, DS:REG_AL
                           880             
06C4 884766                881             MOV DS:DAC_ADDR[BX], AL
                           882             
06C7 FE067500              883             INC DS:DAC_LEN
                           884     
06CB 5A                    885             POP DX
06CC 59                    886             POP CX
06CD 5B                    887             POP BX
06CE 58                    888             POP AX
06CF CB                    889     RET
                           890     DAC_UPDATE ENDP
                           891               
06D0                       892     DEBOUNCE PROC FAR
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    23:48:05  12/07/;3  PAGE   18


LOC  OBJ                  LINE     SOURCE

06D0 51                    893                       PUSH CX
                           894                       
06D1 B94C09                895                       MOV CX, 094CH
06D4 90                    896     BACK:     NOP
06D5 E2FD                  897                       LOOP BACK
06D7 59                    898                       POP CX
06D8 CB                    899                       RET
                           900     DEBOUNCE  ENDP
                           901     
06D9                       902     SEND_INPUT PROC FAR
06D9 50                    903     PUSH AX
06DA 53                    904     PUSH BX
06DB 51                    905     PUSH CX
06DC 52                    906     PUSH DX
06DD BB0000                907             MOV BX, 0
06E0 8B0EA100              908             MOV CX, DS:SEND_BUFFER_LEN
                           909             
06E4                       910             S_BUFF:
06E4 8A878D00              911                     MOV AL, DS:SEND_BUFFER[BX]
06E8 9A0000----     E      912                     CALL FAR PTR PRINT_CHAR
06ED 43                    913                     INC BX
06EE E2F4                  914             LOOP S_BUFF
                           915             
06F0                       916     SEND_INPUT_END:
06F0 5A                    917     POP DX
06F1 59                    918     POP CX
06F2 5B                    919     POP BX
06F3 58                    920     POP AX
06F4 CB                    921     RET
                           922     SEND_INPUT ENDP
                           923     
06F5                       924     TAKE_CASH PROC FAR
06F5 50                    925     PUSH AX
06F6 53                    926     PUSH BX
06F7 51                    927     PUSH CX
06F8 52                    928     PUSH DX
                           929             
06F9 B90000                930             MOV CX, 0
06FC B108                  931             MOV CL, 8
06FE                       932             CLEAR_CASH_AMT:
06FE 8BD9                  933                     MOV BX, CX
0700 4B                    934                     DEC BX
0701 C687D10000            935                     MOV DS:CASH_AMT[BX], 0
0706 E2F6                  936             LOOP CLEAR_CASH_AMT
                           937             
0708 8B0E6100              938             MOV CX, DS:KEYPAD_INDEX
070C BA0600                939             MOV DX, 6
                           940             
070F                       941             UPDATE_CASH_AMT:
070F 8BD9                  942                     MOV BX, CX
0711 4B                    943                     DEC BX
                           944                     
0712 33C0                  945                     XOR AX, AX
0714 8A4751                946                     MOV AL, DS:KEYPAD_INPUT[BX]
                           947                     
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    23:48:05  12/07/;3  PAGE   19


LOC  OBJ                  LINE     SOURCE

0717 8BDA                  948                     MOV BX, DX
0719 4B                    949                     DEC BX
071A 8887D100              950                     MOV DS:CASH_AMT[BX], AL
                           951                     
071E 4A                    952                     DEC DX
071F E2EE                  953             LOOP UPDATE_CASH_AMT
                           954             
0721 C706E9000100          955             MOV DS:CASH_OK_FLAG, 1
0727 C706EB000700          956             MOV DS:BORROW_POSITION, 7
072D B90800                957             MOV CX, 8
0730                       958             CHECK_CASH:
0730 BB0800                959                     MOV BX, 8
0733 2BD9                  960                     SUB BX, CX
0735 B80000                961                     MOV AX, 0
0738 8A87C100              962                     MOV AL, DS:TEMP_BCD_ARR[BX]
073C 8A97D100              963                     MOV DL, DS:CASH_AMT[BX]
0740 3AD0                  964                     CMP DL, AL
0742 741A                  965                     JE NEXT_CASH_DIGIT
                           966                     
0744 3AD0                  967                     CMP DL, AL
0746 7C0D                  968                     JL CASH_NOT_OK
                           969                     
0748 C706E9000100          970                     MOV DS:CASH_OK_FLAG, 1
074E 891EEB00              971                     MOV DS:BORROW_POSITION, BX
                           972                     
0752 EB0C90                973                     JMP CHEK_CASH_DONE
                           974                     
0755                       975                     CASH_NOT_OK:
0755 C706E9000000          976                     MOV DS:CASH_OK_FLAG, 0
075B EB0390                977                     JMP CHEK_CASH_DONE
                           978                     
075E                       979             NEXT_CASH_DIGIT:
075E E2D0                  980             LOOP CHECK_CASH
                           981             
0760                       982     CHEK_CASH_DONE:
                           983             
0760 833EE90001            984             CMP DS:CASH_OK_FLAG, 1
0765 7464                  985             JE CONTINUE_CASH
0767 B90800                986             MOV CX, 8
076A C70661000000          987             MOV DS:KEYPAD_INDEX, 0
0770 C706B3000300          988             MOV DS:DECIMAL_INDEX, 3
0776                       989             RETAIN_BCD:
0776 BB0800                990                     MOV BX, 8
0779 2BD9                  991                     SUB BX, CX
                           992                     
077B 8A87C100              993                     MOV AL, DS:TEMP_BCD_ARR[BX]
077F A27900                994                     MOV DS:REG_AL, AL
                           995                     
0782 C706B1000100          996                     MOV DS:DAC_DISABLE, 1
0788 9A4A06----     R      997                     CALL FAR PTR BCD_UPDATE
078D C706B1000000          998                     MOV DS:DAC_DISABLE, 0
0793 E2E1                  999             LOOP RETAIN_BCD
0795 813E64000040         1000             CMP DS:DAC_BASE, 4000H
079B 7517                 1001             JNE MANDARIN_CASH
                          1002             
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    23:48:05  12/07/;3  PAGE   20


LOC  OBJ                  LINE     SOURCE

079D C606790023           1003             MOV DS:REG_AL, 35
07A2 9AB606----     R     1004             CALL FAR PTR DAC_UPDATE
07A7 C606790024           1005             MOV DS:REG_AL, 36
07AC 9AB606----     R     1006             CALL FAR PTR DAC_UPDATE
07B1 E9B200               1007             JMP CASH_OVER
                          1008             
07B4                      1009     MANDARIN_CASH:
07B4 C606790012           1010             MOV DS:REG_AL, 18
07B9 9AB606----     R     1011             CALL FAR PTR DAC_UPDATE
07BE C606790013           1012             MOV DS:REG_AL, 19
07C3 9AB606----     R     1013             CALL FAR PTR DAC_UPDATE
07C8 E99B00               1014             JMP CASH_OVER
                          1015             
07CB                      1016     CONTINUE_CASH:
07CB 8B1EEB00             1017             MOV BX, DS:BORROW_POSITION
07CF B90700               1018             MOV CX, 7
07D2 2BCB                 1019             SUB CX, BX
07D4 83F900               1020             CMP CX, 0
07D7 740C                 1021             JE BEGIN_SUB
                          1022             
07D9                      1023             ADJUST_PLACES:
07D9 FE8FD100             1024                     DEC DS:CASH_AMT[BX]
07DD 43                   1025                     INC BX
07DE 8087D1000A           1026                     ADD DS:CASH_AMT[BX], 10
07E3 E2F4                 1027             LOOP ADJUST_PLACES
                          1028             
07E5                      1029     BEGIN_SUB:
07E5 B90800               1030             MOV CX, 8
07E8                      1031             CALC_CHANGE:
07E8 BB0800               1032                     MOV BX, 8
07EB 2BD9                 1033                     SUB BX, CX
07ED B80000               1034                     MOV AX, 0
07F0 8A87D100             1035                     MOV AL, DS:CASH_AMT[BX]
07F4 BA0000               1036                     MOV DX, 0
07F7 8A97C100             1037                     MOV DL, DS:TEMP_BCD_ARR[BX]
07FB 2BC2                 1038                     SUB AX, DX
07FD 8987D900             1039                     MOV DS:TEMP_CASH_ARR[BX], AX
0801 E2E5                 1040             LOOP CALC_CHANGE
                          1041             
0803 B90800               1042             MOV CX, 8
0806                      1043             FIX_DIGITS:
0806 8BD9                 1044             MOV BX, CX
0808 4B                   1045             DEC BX
                          1046             
0809 8B87D900             1047             MOV AX, DS:TEMP_CASH_ARR[BX]
080D 3C0A                 1048             CMP AL, 10
080F 7C0A                 1049             JL NEXT_DIGIT_TO_FIX
                          1050             
0811 83AFD9000A           1051             SUB DS:TEMP_CASH_ARR[BX], 10
                          1052             
0816 4B                   1053             DEC BX
0817 FF87D900             1054             INC DS:TEMP_CASH_ARR[BX]
                          1055             
081B                      1056             NEXT_DIGIT_TO_FIX:
                          1057             
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    23:48:05  12/07/;3  PAGE   21


LOC  OBJ                  LINE     SOURCE

081B E2E9                 1058             LOOP FIX_DIGITS
                          1059             
081D B90800               1060             MOV CX, 8
0820 C70661000000         1061             MOV DS:KEYPAD_INDEX, 0
0826 C706B3000300         1062             MOV DS:DECIMAL_INDEX, 3
082C                      1063             UPDATE_BCD_TO_CASH:
082C BB0800               1064                     MOV BX, 8
082F 2BD9                 1065                     SUB BX, CX
0831 8B87D900             1066                     MOV AX, DS:TEMP_CASH_ARR[BX]
0835 8887C100             1067                     MOV DS:TEMP_BCD_ARR[BX], AL
0839 A27900               1068                     MOV DS:REG_AL, AL
083C C706B1000100         1069                     MOV DS:DAC_DISABLE, 1
0842 9A4A06----     R     1070                     CALL FAR PTR BCD_UPDATE
0847 C706B1000000         1071                     MOV DS:DAC_DISABLE, 0
084D E2DD                 1072             LOOP UPDATE_BCD_TO_CASH
                          1073             
084F 9A6B08----     R     1074             CALL FAR PTR CALC_DAC
                          1075             
0854 C706CF000000         1076             MOV DS:CASH_FLAG, 0
085A C706EF000100         1077             MOV DS:TRANSACTION_OVER, 1
0860 C70601010000         1078             MOV DS:TROLLEY_DISABLED, 0
                          1079             
0866                      1080     CASH_OVER:
0866 5A                   1081     POP DX
0867 59                   1082     POP CX
0868 5B                   1083     POP BX
0869 58                   1084     POP AX
                          1085     
086A CB                   1086     RET
                          1087     TAKE_CASH ENDP
                          1088     
086B                      1089     CALC_DAC PROC FAR
086B 50                   1090     PUSH AX
086C 53                   1091     PUSH BX
086D 51                   1092     PUSH CX
086E 52                   1093     PUSH DX
086F 813E64000040         1094             CMP DS:DAC_BASE, 4000H
0875 7403                 1095             JE ENGLISH_DAC
0877 E98E01               1096             JMP MANDARIN_DAC
                          1097             
087A                      1098     ENGLISH_DAC:
087A C706CB000000         1099             MOV DS:CENT_FLAG, 0
0880 C706C9000000         1100             MOV DS:THOUSAND_FLAG, 0
0886 C706CD000000         1101             MOV DS:DOLLAR_FLAG,     0
088C BB0000               1102             MOV BX, 0
088F 8A87C100             1103             MOV AL, DS:TEMP_BCD_ARR[BX]
0893 A27900               1104             MOV DS:REG_AL, AL
0896 3C00                 1105             CMP AL, 0
0898 7415                 1106             JE NEXT_PLACE
089A C706CD000100         1107             MOV DS:DOLLAR_FLAG, 1
08A0 9AB606----     R     1108             CALL FAR PTR DAC_UPDATE
08A5 C60679001C           1109             MOV DS:REG_AL, 28
08AA 9AB606----     R     1110             CALL FAR PTR DAC_UPDATE
                          1111             
08AF                      1112     NEXT_PLACE:     
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    23:48:05  12/07/;3  PAGE   22


LOC  OBJ                  LINE     SOURCE

08AF 43                   1113             INC BX
08B0 8A87C100             1114             MOV AL, DS:TEMP_BCD_ARR[BX]
08B4 3C01                 1115             CMP AL, 1
08B6 751E                 1116             JNE NOT_1
08B8 C706CD000100         1117             MOV DS:DOLLAR_FLAG, 1
08BE 43                   1118             INC BX
08BF 8A87C100             1119             MOV AL, DS:TEMP_BCD_ARR[BX]
08C3 040A                 1120             ADD AL, 10
08C5 A27900               1121             MOV DS:REG_AL, AL
08C8 9AB606----     R     1122             CALL FAR PTR DAC_UPDATE
08CD C706C9000100         1123             MOV DS:THOUSAND_FLAG, 1
08D3 EB3890               1124             JMP HUNDREDS_PLACE
08D6                      1125     NOT_1:
08D6 3C00                 1126             CMP AL, 0
08D8 7416                 1127             JE NEXT_PLACE_1
08DA C706CD000100         1128             MOV DS:DOLLAR_FLAG, 1
08E0 C706C9000100         1129             MOV DS:THOUSAND_FLAG, 1
08E6 0412                 1130             ADD AL, 18
08E8 A27900               1131             MOV DS:REG_AL, AL
08EB 9AB606----     R     1132             CALL FAR PTR DAC_UPDATE
08F0                      1133     NEXT_PLACE_1:
08F0 43                   1134             INC BX
08F1 8A87C100             1135             MOV AL, DS:TEMP_BCD_ARR[BX]
08F5 3C00                 1136             CMP AL, 0
08F7 7414                 1137             JE HUNDREDS_PLACE
08F9 C706CD000100         1138             MOV DS:DOLLAR_FLAG, 1
08FF C706C9000100         1139             MOV DS:THOUSAND_FLAG, 1
0905 A27900               1140             MOV DS:REG_AL, AL
0908 9AB606----     R     1141             CALL FAR PTR DAC_UPDATE
                          1142     
090D                      1143     HUNDREDS_PLACE:
090D 833EC90000           1144             CMP DS:THOUSAND_FLAG, 0
0912 7410                 1145             JE NEXT_PLACE_2
0914 C60679001D           1146             MOV DS:REG_AL, 29
0919 9AB606----     R     1147             CALL FAR PTR DAC_UPDATE
091E C706C9000000         1148             MOV DS:THOUSAND_FLAG, 0
                          1149             
0924                      1150     NEXT_PLACE_2:
0924 43                   1151             INC BX
0925 8A87C100             1152             MOV AL, DS:TEMP_BCD_ARR[BX]
0929 3C00                 1153             CMP AL, 0
092B 7418                 1154             JE NEXT_PLACE_3
092D C706CD000100         1155             MOV DS:DOLLAR_FLAG, 1
0933 A27900               1156             MOV DS:REG_AL, AL
0936 9AB606----     R     1157             CALL FAR PTR DAC_UPDATE
093B C60679001C           1158             MOV DS:REG_AL, 28
0940 9AB606----     R     1159             CALL FAR PTR DAC_UPDATE
                          1160             
0945                      1161     NEXT_PLACE_3:   
0945 43                   1162             INC BX
0946 8A87C100             1163             MOV AL, DS:TEMP_BCD_ARR[BX]
094A 3C01                 1164             CMP AL, 1
094C 7518                 1165             JNE NOT_1_2
094E C706CD000100         1166             MOV DS:DOLLAR_FLAG, 1
0954 43                   1167             INC BX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    23:48:05  12/07/;3  PAGE   23


LOC  OBJ                  LINE     SOURCE

0955 8A87C100             1168             MOV AL, DS:TEMP_BCD_ARR[BX]
0959 040A                 1169             ADD AL, 10
095B A27900               1170             MOV DS:REG_AL, AL
095E 9AB606----     R     1171             CALL FAR PTR DAC_UPDATE
0963 EB2C90               1172             JMP DECIMAL_DAC
0966                      1173     NOT_1_2:
0966 3C00                 1174             CMP AL, 0
0968 7410                 1175             JE NEXT_PLACE_4
096A C706CD000100         1176             MOV DS:DOLLAR_FLAG, 1
0970 0412                 1177             ADD AL, 18
0972 A27900               1178             MOV DS:REG_AL, AL
0975 9AB606----     R     1179             CALL FAR PTR DAC_UPDATE
097A                      1180     NEXT_PLACE_4:
097A 43                   1181             INC BX
097B 8A87C100             1182             MOV AL, DS:TEMP_BCD_ARR[BX]
097F 3C00                 1183             CMP AL, 0
0981 740E                 1184             JE DECIMAL_DAC
0983 C706CD000100         1185             MOV DS:DOLLAR_FLAG, 1
0989 A27900               1186             MOV DS:REG_AL, AL
098C 9AB606----     R     1187             CALL FAR PTR DAC_UPDATE
                          1188             
0991                      1189     DECIMAL_DAC:
0991 833ECD0000           1190             CMP DS:DOLLAR_FLAG, 0
0996 740A                 1191             JE DECIMAL_DAC_CONT
0998 C60679001E           1192             MOV DS:REG_AL, 30
099D 9AB606----     R     1193             CALL FAR PTR DAC_UPDATE
                          1194             
09A2                      1195     DECIMAL_DAC_CONT:
09A2 43                   1196             INC BX
09A3 8A87C100             1197             MOV AL, DS:TEMP_BCD_ARR[BX]
09A7 3C01                 1198             CMP AL, 1
09A9 7518                 1199             JNE NOT_1_3
09AB 43                   1200             INC BX
09AC C706CB000100         1201             MOV DS:CENT_FLAG, 1
09B2 8A87C100             1202             MOV AL, DS:TEMP_BCD_ARR[BX]
09B6 040A                 1203             ADD AL, 10
09B8 A27900               1204             MOV DS:REG_AL, AL
09BB 9AB606----     R     1205             CALL FAR PTR DAC_UPDATE
09C0 EB2C90               1206             JMP ENGLISH_END
                          1207             
09C3                      1208     NOT_1_3:
09C3 3C00                 1209             CMP AL, 0
09C5 7410                 1210             JE NEXT_PLACE_5
09C7 C706CB000100         1211             MOV DS:CENT_FLAG, 1
09CD 0412                 1212             ADD AL, 18
09CF A27900               1213             MOV DS:REG_AL, AL
09D2 9AB606----     R     1214             CALL FAR PTR DAC_UPDATE
                          1215             
09D7                      1216     NEXT_PLACE_5:
09D7 43                   1217             INC BX
09D8 8A87C100             1218             MOV AL, DS:TEMP_BCD_ARR[BX]
09DC 3C00                 1219             CMP AL, 0
09DE 740E                 1220             JE ENGLISH_END
09E0 C706CB000100         1221             MOV DS:CENT_FLAG, 1
09E6 A27900               1222             MOV DS:REG_AL, AL
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    23:48:05  12/07/;3  PAGE   24


LOC  OBJ                  LINE     SOURCE

09E9 9AB606----     R     1223             CALL FAR PTR DAC_UPDATE
                          1224             
09EE                      1225     ENGLISH_END:
09EE 833ECB0000           1226             CMP DS:CENT_FLAG, 0
09F3 7410                 1227             JE ENGLISH_END2
09F5 C60679001F           1228             MOV DS:REG_AL, 31
09FA 9AB606----     R     1229             CALL FAR PTR DAC_UPDATE
09FF C706CB000000         1230             MOV DS:CENT_FLAG, 0
0A05                      1231     ENGLISH_END2:
0A05 E9CE01               1232             JMP CONT_BCD_UPD_1
                          1233             
0A08                      1234     MANDARIN_DAC:
0A08 C706CB000000         1235             MOV DS:CENT_FLAG, 0
0A0E C706C9000000         1236             MOV DS:THOUSAND_FLAG, 0
0A14 C70603010000         1237             MOV DS:TEN_THOUSAND_FLAG, 0
0A1A C70605010000         1238             MOV DS:ZERO_TELL, 0
0A20 C706CD000000         1239             MOV DS:DOLLAR_FLAG,     0
0A26 BB0000               1240             MOV BX, 0
0A29 8A87C100             1241             MOV AL, DS:TEMP_BCD_ARR[BX]
0A2D 3C00                 1242             CMP AL, 0
0A2F 7424                 1243             JE NEXT_PLACE_6
0A31 C706CD000100         1244             MOV DS:DOLLAR_FLAG, 1
0A37 C70603010100         1245             MOV DS:TEN_THOUSAND_FLAG, 1
0A3D C706C9000000         1246             MOV DS:THOUSAND_FLAG, 0
0A43 A27900               1247             MOV DS:REG_AL, AL
0A46 9AB606----     R     1248             CALL FAR PTR DAC_UPDATE
0A4B C60679000A           1249             MOV DS:REG_AL, 10
0A50 9AB606----     R     1250             CALL FAR PTR DAC_UPDATE
                          1251             
0A55                      1252     NEXT_PLACE_6:
0A55 43                   1253             INC BX
0A56 8A87C100             1254             MOV AL, DS:TEMP_BCD_ARR[BX]
0A5A 3C00                 1255             CMP AL, 0
0A5C 741A                 1256             JE NEXT_PLACE_7
0A5E C706CD000100         1257             MOV DS:DOLLAR_FLAG, 1
0A64 C70603010100         1258             MOV DS:TEN_THOUSAND_FLAG, 1
0A6A C706C9000000         1259             MOV DS:THOUSAND_FLAG, 0
0A70 A27900               1260             MOV DS:REG_AL, AL
0A73 9AB606----     R     1261             CALL FAR PTR DAC_UPDATE
                          1262             
0A78                      1263     NEXT_PLACE_7:
0A78 833E030101           1264             CMP DS:TEN_THOUSAND_FLAG, 1
0A7D 750A                 1265             JNE NO_TEN_THOUSAND
0A7F C60679000D           1266             MOV DS:REG_AL, 13
0A84 9AB606----     R     1267             CALL FAR PTR DAC_UPDATE
0A89                      1268     NO_TEN_THOUSAND:
0A89 43                   1269             INC BX
0A8A 8A87C100             1270             MOV AL, DS:TEMP_BCD_ARR[BX]
0A8E 3C00                 1271             CMP AL, 0
0A90 7509                 1272             JNE CONTINUE_MAND
0A92 C70605010100         1273             MOV DS:ZERO_TELL, 1
0A98 EB1590               1274             JMP NEXT_PLACE_8
0A9B                      1275     CONTINUE_MAND:  
0A9B C706CD000100         1276             MOV DS:DOLLAR_FLAG, 1
0AA1 C706C9000100         1277             MOV DS:THOUSAND_FLAG, 1
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    23:48:05  12/07/;3  PAGE   25


LOC  OBJ                  LINE     SOURCE

                          1278     
0AA7 A27900               1279             MOV DS:REG_AL, AL
0AAA 9AB606----     R     1280             CALL FAR PTR DAC_UPDATE
                          1281     
0AAF                      1282     NEXT_PLACE_8:
0AAF 833EC90000           1283             CMP DS:THOUSAND_FLAG, 0
0AB4 7410                 1284             JE IGNORE_THOUSAND
0AB6 C60679000C           1285             MOV DS:REG_AL, 12
0ABB 9AB606----     R     1286             CALL FAR PTR DAC_UPDATE
0AC0 C706C9000000         1287             MOV DS:THOUSAND_FLAG, 0
                          1288             
0AC6                      1289     IGNORE_THOUSAND:
0AC6 43                   1290             INC BX
0AC7 8A87C100             1291             MOV AL, DS:TEMP_BCD_ARR[BX]
0ACB 3C00                 1292             CMP AL, 0
0ACD 7509                 1293             JNE CONTINUE_MAND1
0ACF C70605010100         1294             MOV DS:ZERO_TELL, 1
0AD5 EB3090               1295             JMP NEXT_PLACE_9
0AD8                      1296     CONTINUE_MAND1:
0AD8 833E050101           1297             CMP DS:ZERO_TELL, 1
0ADD 7510                 1298             JNE DONT_ZERO
0ADF C606790000           1299             MOV DS:REG_AL, 0
0AE4 9AB606----     R     1300             CALL FAR PTR DAC_UPDATE
0AE9 C70605010000         1301             MOV DS:ZERO_TELL, 0
0AEF                      1302     DONT_ZERO:
0AEF C706CD000100         1303             MOV DS:DOLLAR_FLAG, 1
0AF5 A27900               1304             MOV DS:REG_AL, AL
0AF8 9AB606----     R     1305             CALL FAR PTR DAC_UPDATE
0AFD C60679000B           1306             MOV DS:REG_AL, 11
0B02 9AB606----     R     1307             CALL FAR PTR DAC_UPDATE
                          1308             
0B07                      1309     NEXT_PLACE_9:
0B07 43                   1310             INC BX
0B08 8A87C100             1311             MOV AL, DS:TEMP_BCD_ARR[BX]
0B0C 3C00                 1312             CMP AL, 0
0B0E 7509                 1313             JNE CONTINUE_MAND2
0B10 C70605010100         1314             MOV DS:ZERO_TELL, 1
0B16 EB3090               1315             JMP NEXT_PLACE_10
0B19                      1316     CONTINUE_MAND2:
0B19 833E050101           1317             CMP DS:ZERO_TELL, 1
0B1E 7510                 1318             JNE DONT_ZERO1
0B20 C606790000           1319             MOV DS:REG_AL, 0
0B25 9AB606----     R     1320             CALL FAR PTR DAC_UPDATE
0B2A C70605010000         1321             MOV DS:ZERO_TELL, 0
0B30                      1322     DONT_ZERO1:
0B30 C706CD000100         1323             MOV DS:DOLLAR_FLAG, 1
0B36 A27900               1324             MOV DS:REG_AL, AL
0B39 9AB606----     R     1325             CALL FAR PTR DAC_UPDATE
0B3E C60679000A           1326             MOV DS:REG_AL, 10
0B43 9AB606----     R     1327             CALL FAR PTR DAC_UPDATE
                          1328             
0B48                      1329     NEXT_PLACE_10:
0B48 43                   1330             INC BX
0B49 8A87C100             1331             MOV AL, DS:TEMP_BCD_ARR[BX]
0B4D 3C00                 1332             CMP AL, 0
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    23:48:05  12/07/;3  PAGE   26


LOC  OBJ                  LINE     SOURCE

0B4F 7425                 1333             JE MANDARIN_DEC
0B51 833E050101           1334             CMP DS:ZERO_TELL, 1
0B56 7510                 1335             JNE DONT_ZERO2
0B58 C606790000           1336             MOV DS:REG_AL, 0
0B5D 9AB606----     R     1337             CALL FAR PTR DAC_UPDATE
0B62 C70605010000         1338             MOV DS:ZERO_TELL, 0
0B68                      1339     DONT_ZERO2:
0B68 C706CD000100         1340             MOV DS:DOLLAR_FLAG, 1
0B6E A27900               1341             MOV DS:REG_AL, AL
0B71 9AB606----     R     1342             CALL FAR PTR DAC_UPDATE
                          1343             
0B76                      1344     MANDARIN_DEC:
0B76 833ECD0000           1345             CMP DS:DOLLAR_FLAG, 0
0B7B 740A                 1346             JE MANDARIN_DAC_CONT
0B7D C60679000E           1347             MOV DS:REG_AL, 14
0B82 9AB606----     R     1348             CALL FAR PTR DAC_UPDATE
0B87                      1349     MANDARIN_DAC_CONT:
0B87 43                   1350             INC BX
0B88 8A87C100             1351             MOV AL, DS:TEMP_BCD_ARR[BX]
0B8C 3C00                 1352             CMP AL, 0
0B8E 7418                 1353             JE NEXT_PLACE_11
0B90 C706CB000100         1354             MOV DS:CENT_FLAG, 1
0B96 A27900               1355             MOV DS:REG_AL, AL
0B99 9AB606----     R     1356             CALL FAR PTR DAC_UPDATE
0B9E C60679000A           1357             MOV DS:REG_AL, 10
0BA3 9AB606----     R     1358             CALL FAR PTR DAC_UPDATE
                          1359             
0BA8                      1360     NEXT_PLACE_11:
                          1361     
0BA8 43                   1362             INC BX
0BA9 8A87C100             1363             MOV AL, DS:TEMP_BCD_ARR[BX]
0BAD 3C00                 1364             CMP AL, 0
0BAF 740E                 1365             JE CONT_BCD_UPD
0BB1 C706CB000100         1366             MOV DS:CENT_FLAG, 1
0BB7 A27900               1367             MOV DS:REG_AL, AL
0BBA 9AB606----     R     1368             CALL FAR PTR DAC_UPDATE
                          1369             
0BBF                      1370     CONT_BCD_UPD:
0BBF 833ECB0000           1371             CMP DS:CENT_FLAG, 0
0BC4 7410                 1372             JE CONT_BCD_UPD_1
0BC6 C60679000F           1373             MOV DS:REG_AL, 15
0BCB 9AB606----     R     1374             CALL FAR PTR DAC_UPDATE
0BD0 C706CB000000         1375             MOV DS:CENT_FLAG, 0
                          1376     
0BD6                      1377     CONT_BCD_UPD_1:
                          1378             
0BD6 5A                   1379     POP DX
0BD7 59                   1380     POP CX
0BD8 5B                   1381     POP BX
0BD9 58                   1382     POP AX
0BDA CB                   1383     RET
                          1384     CALC_DAC ENDP
                          1385     
0BDB                      1386     CALC_UPD_PRICE PROC FAR
0BDB 50                   1387     PUSH AX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    23:48:05  12/07/;3  PAGE   27


LOC  OBJ                  LINE     SOURCE

0BDC 53                   1388     PUSH BX
0BDD 51                   1389     PUSH CX
0BDE 52                   1390     PUSH DX
0BDF 833EB90000           1391             CMP DS:QTY, 0
0BE4 7503                 1392             JNE CHECK_PRICE_ZERO
0BE6 E92B01               1393             JMP CALC_END
0BE9                      1394     CHECK_PRICE_ZERO:
0BE9 833EB70000           1395             CMP DS:PRICE, 0
0BEE 7503                 1396             JNE START_CALC
0BF0 E92101               1397             JMP CALC_END
0BF3                      1398     START_CALC:
0BF3 BA0000               1399             MOV DX, 0
0BF6 A1B700               1400             MOV AX, DS:PRICE
0BF9 8B1EB900             1401             MOV BX, DS:QTY
0BFD F7E3                 1402             MUL BX
                          1403             
0BFF BB6400               1404             MOV BX, 100
0C02 F7F3                 1405             DIV BX
0C04 A3B700               1406             MOV DS:PRICE, AX
0C07 A1BF00               1407             MOV AX, DS:TOTAL_PRICE_DEC
0C0A 03C2                 1408             ADD AX, DX
0C0C 3D6400               1409             CMP AX, 100
0C0F 7C07                 1410             JL NON_DECIMAL
0C11 FF06BD00             1411             INC DS:TOTAL_PRICE_L
0C15 2D6400               1412             SUB AX, 100
                          1413             
0C18                      1414     NON_DECIMAL:    
0C18 A3BF00               1415             MOV DS:TOTAL_PRICE_DEC, AX
0C1B A1BD00               1416             MOV AX, DS:TOTAL_PRICE_L
0C1E 8B1EB700             1417             MOV BX, DS:PRICE
0C22 03C3                 1418             ADD AX, BX
0C24 7304                 1419             JNC update_normal
0C26 FF06BB00             1420             INC DS:TOTAL_PRICE_U
                          1421             
0C2A                      1422     update_normal:
0C2A A3BD00               1423             MOV DS:TOTAL_PRICE_L, AX
                          1424             
0C2D BA0000               1425             MOV DX, 0
                          1426             ;CMP DS:TOTAL_PRICE_DEC, 9
                          1427             ;JG DECIMAL_CONT
                          1428             ;MOV CX, 10
                          1429             ;MOV AX, DS:TOTAL_PRICE_DEC
                          1430             ;MUL CX
                          1431             ;MOV DS:TOTAL_PRICE_DEC, AX
                          1432     ;DECIMAL_CONT:
0C30 A1BF00               1433             MOV AX, DS:TOTAL_PRICE_DEC
0C33 B90A00               1434             MOV CX, 10
0C36 F7F1                 1435             DIV CX
                          1436             
0C38 BB0700               1437             MOV BX, 7
0C3B 8897C100             1438             MOV DS:TEMP_BCD_ARR[BX], DL
0C3F 4B                   1439             DEC BX
0C40 8887C100             1440             MOV DS:TEMP_BCD_ARR[BX], AL
                          1441             
0C44 BB0600               1442             MOV BX, 6
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    23:48:05  12/07/;3  PAGE   28


LOC  OBJ                  LINE     SOURCE

0C47 A1BD00               1443             MOV AX, DS:TOTAL_PRICE_L
                          1444             
0C4A                      1445             TEMP_UPD_LOOP:
0C4A BA0000               1446                     MOV DX, 0
0C4D B90A00               1447                     MOV CX, 10
0C50 F7F1                 1448                     DIV CX
                          1449                     
0C52 4B                   1450                     DEC BX
0C53 8897C100             1451                     MOV DS:TEMP_BCD_ARR[BX], DL
0C57 43                   1452                     INC BX
                          1453                     
0C58 4B                   1454                     DEC BX
                          1455                     
0C59 75EF                 1456             JNZ TEMP_UPD_LOOP
                          1457             
0C5B 8B0EBB00             1458             MOV CX, DS:TOTAL_PRICE_U
0C5F 83F900               1459             CMP CX, 0
0C62 7478                 1460             JE upd_dac_part
0C64                      1461             ADD_EXTRA_PART:
0C64 BB0500               1462                     MOV BX, 5
0C67 8A87C100             1463                     MOV AL, DS:TEMP_BCD_ARR[BX]
0C6B 0406                 1464                     ADD AL, 6
0C6D 3C09                 1465                     CMP AL, 9
0C6F 7E08                 1466                     JLE CONT_DIGIT_1
0C71 2C0A                 1467                     SUB AL, 10
0C73 4B                   1468                     DEC BX
0C74 FE87C100             1469                     INC DS:TEMP_BCD_ARR[BX]
0C78 43                   1470                     INC BX
0C79                      1471             CONT_DIGIT_1:
0C79 8887C100             1472                     MOV DS:TEMP_BCD_ARR[BX], AL
0C7D 4B                   1473                     DEC BX
                          1474                     
0C7E 8A87C100             1475                     MOV AL, DS:TEMP_BCD_ARR[BX]
0C82 0403                 1476                     ADD AL, 3
0C84 3C09                 1477                     CMP AL, 9
0C86 7E08                 1478                     JLE CONT_DIGIT_2
0C88 2C0A                 1479                     SUB AL, 10
0C8A 4B                   1480                     DEC BX
0C8B FE87C100             1481                     INC DS:TEMP_BCD_ARR[BX]
0C8F 43                   1482                     INC BX
0C90                      1483             CONT_DIGIT_2:
0C90 8887C100             1484                     MOV DS:TEMP_BCD_ARR[BX], AL
0C94 4B                   1485                     DEC BX
                          1486                     
0C95 8A87C100             1487                     MOV AL, DS:TEMP_BCD_ARR[BX]
0C99 0405                 1488                     ADD AL, 5
0C9B 3C09                 1489                     CMP AL, 9
0C9D 7E08                 1490                     JLE CONT_DIGIT_3
0C9F 2C0A                 1491                     SUB AL, 10
0CA1 4B                   1492                     DEC BX
0CA2 FE87C100             1493                     INC DS:TEMP_BCD_ARR[BX]
0CA6 43                   1494                     INC BX
0CA7                      1495             CONT_DIGIT_3:
0CA7 8887C100             1496                     MOV DS:TEMP_BCD_ARR[BX], AL
0CAB 4B                   1497                     DEC BX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    23:48:05  12/07/;3  PAGE   29


LOC  OBJ                  LINE     SOURCE

                          1498                     
                          1499                     
0CAC 8A87C100             1500                     MOV AL, DS:TEMP_BCD_ARR[BX]
0CB0 0405                 1501                     ADD AL, 5
0CB2 3C09                 1502                     CMP AL, 9
0CB4 7E08                 1503                     JLE CONT_DIGIT_4
0CB6 2C0A                 1504                     SUB AL, 10
0CB8 4B                   1505                     DEC BX
0CB9 FE87C100             1506                     INC DS:TEMP_BCD_ARR[BX]
0CBD 43                   1507                     INC BX
0CBE                      1508             CONT_DIGIT_4:
0CBE 8887C100             1509                     MOV DS:TEMP_BCD_ARR[BX], AL
0CC2 4B                   1510                     DEC BX
                          1511                     
0CC3 8A87C100             1512                     MOV AL, DS:TEMP_BCD_ARR[BX]
0CC7 0406                 1513                     ADD AL, 6
0CC9 3C09                 1514                     CMP AL, 9
0CCB 7E08                 1515                     JLE CONT_DIGIT_5
0CCD 2C0A                 1516                     SUB AL, 10
0CCF 4B                   1517                     DEC BX
0CD0 FE87C100             1518                     INC DS:TEMP_BCD_ARR[BX]
0CD4 43                   1519                     INC BX
0CD5                      1520             CONT_DIGIT_5:
0CD5 8887C100             1521                     MOV DS:TEMP_BCD_ARR[BX], AL
0CD9 4B                   1522                     DEC BX
                          1523                     
0CDA E288                 1524             LOOP ADD_EXTRA_PART
                          1525             
0CDC                      1526     upd_dac_part:
0CDC 9A6B08----     R     1527             CALL FAR PTR CALC_DAC
                          1528     
0CE1 9A1F06----     R     1529             CALL FAR PTR BCD_CLEAR
0CE6 C70661000000         1530             MOV DS:KEYPAD_INDEX, 0
0CEC C706B3000300         1531             MOV DS:DECIMAL_INDEX, 3
0CF2 B90800               1532             MOV CX, 8
0CF5                      1533             UPD_BCD:
0CF5 BB0800               1534                     MOV BX, 8
0CF8 2BD9                 1535                     SUB BX, CX
0CFA 8A87C100             1536                     MOV AL, DS:TEMP_BCD_ARR[BX]
0CFE A27900               1537                     MOV DS:REG_AL, AL
0D01 C706B1000100         1538                     MOV DS:DAC_DISABLE, 1
0D07 9A4A06----     R     1539                     CALL FAR PTR BCD_UPDATE
0D0C C706B1000000         1540                     MOV DS:DAC_DISABLE, 0
0D12 E2E1                 1541             LOOP UPD_BCD
                          1542             
0D14                      1543     CALC_END:
0D14 833EB70000           1544             CMP DS:PRICE, 0
0D19 7403                 1545             JE RETAIN_BCD_VALUE
0D1B EB2F90               1546             JMP END_CALC_BCD_DAC
                          1547             
0D1E                      1548     RETAIN_BCD_VALUE:       
0D1E C70661000000         1549             MOV DS:KEYPAD_INDEX, 0
0D24 C706B3000300         1550             MOV DS:DECIMAL_INDEX, 3
0D2A B90800               1551             MOV CX, 8
0D2D                      1552             UPD_BCD1:
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    23:48:05  12/07/;3  PAGE   30


LOC  OBJ                  LINE     SOURCE

0D2D BB0800               1553                     MOV BX, 8
0D30 2BD9                 1554                     SUB BX, CX
0D32 8A87C100             1555                     MOV AL, DS:TEMP_BCD_ARR[BX]
0D36 A27900               1556                     MOV DS:REG_AL, AL
0D39 C706B1000100         1557                     MOV DS:DAC_DISABLE, 1
0D3F 9A4A06----     R     1558                     CALL FAR PTR BCD_UPDATE
0D44 C706B1000000         1559                     MOV DS:DAC_DISABLE, 0
0D4A E2E1                 1560             LOOP UPD_BCD1
                          1561     
0D4C                      1562     END_CALC_BCD_DAC:
0D4C C706B7000000         1563             MOV DS:PRICE, 0
0D52 C706B9000000         1564             MOV DS:QTY, 0
0D58 5A                   1565     POP DX
0D59 59                   1566     POP CX
0D5A 5B                   1567     POP BX
0D5B 58                   1568     POP AX
0D5C CB                   1569     RET
                          1570     CALC_UPD_PRICE ENDP
                          1571     
0D5D                      1572     UPDATE_TROLLEY PROC FAR
0D5D 50                   1573     PUSH AX
0D5E 53                   1574     PUSH BX
0D5F 51                   1575     PUSH CX
0D60 52                   1576     PUSH DX
0D61 B90800               1577             MOV CX, 8
0D64                      1578             CLEAR_TEMP_BCD_TROLLEY:
0D64 8BD9                 1579                     MOV BX, CX
0D66 4B                   1580                     DEC BX
0D67 C687C10000           1581                     MOV DS:TEMP_BCD_ARR[BX], 0
0D6C E2F6                 1582             LOOP CLEAR_TEMP_BCD_TROLLEY
                          1583             
0D6E 8B0EFB00             1584             MOV CX, DS:TROLLEY_INDEX
0D72 BA0800               1585             MOV DX, 8
                          1586             
0D75                      1587             UPD_TROLLEY_PRICE:
0D75 8BD9                 1588                     MOV BX, CX
0D77 4B                   1589                     DEC BX
                          1590                     
0D78 8A87F300             1591                     MOV AL, DS:TROLLEY_ARRAY[BX]
                          1592                     
0D7C 8BDA                 1593                     MOV BX, DX
0D7E 4B                   1594                     DEC BX
                          1595                     
0D7F 8887C100             1596                     MOV DS:TEMP_BCD_ARR[BX], AL
                          1597                     
0D83 4A                   1598                     DEC DX
0D84 E2EF                 1599             LOOP UPD_TROLLEY_PRICE
                          1600             
0D86 B90800               1601             MOV CX, 8
0D89 C70661000000         1602             MOV DS:KEYPAD_INDEX, 0
0D8F                      1603             UPDATE_TROLLEY_PRICE_DISPLAY:
0D8F BB0800               1604                     MOV BX, 8
0D92 2BD9                 1605                     SUB BX, CX
0D94 8A87C100             1606                     MOV AL, DS:TEMP_BCD_ARR[BX]
0D98 A27900               1607                     MOV DS:REG_AL, AL
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    23:48:05  12/07/;3  PAGE   31


LOC  OBJ                  LINE     SOURCE

0D9B C706B1000100         1608                     MOV DS:DAC_DISABLE, 1
0DA1 9A4A06----     R     1609                     CALL FAR PTR BCD_UPDATE
0DA6 C706B1000000         1610                     MOV DS:DAC_DISABLE, 0
0DAC E2E1                 1611             LOOP UPDATE_TROLLEY_PRICE_DISPLAY
                          1612             
0DAE 9A6B08----     R     1613             CALL FAR PTR CALC_DAC
                          1614     
0DB3 5A                   1615     POP DX
0DB4 59                   1616     POP CX
0DB5 5B                   1617     POP BX
0DB6 5A                   1618     POP DX
0DB7 CB                   1619     RET
                          1620     UPDATE_TROLLEY ENDP
                          1621     ; ^^^^^^^^^^^^^^^ End of User main routine ^^^^^^^^^^^^^^^^^^^^^^^^^
0DB8                      1622     SERIAL_REC_ACTION       PROC    FAR
0DB8 51                   1623                     PUSH    CX
0DB9 53                   1624                     PUSH    BX
0DBA 1E                   1625                     PUSH    DS
                          1626                     
0DBB BB----         R     1627                     MOV     BX,DATA_SEG             ;initialize data segment register
0DBE 8EDB                 1628                     MOV     DS,BX
                          1629                     
0DC0 803E8B0001           1630                     CMP DS:REPLY_FLAG, 1
0DC5 7557                 1631                     JNE next_id1
                          1632                     
0DC7 803E8C0001           1633                     CMP DS:SEND_FLAG, 1
0DCC 7453                 1634                     JE send_input_across1
                          1635                     
0DCE 833EA70001           1636                     CMP DS:RECEIVE_FLAG, 1
0DD3 754F                 1637                     JNE terminate_session3
                          1638                     
0DD5 3C2F                 1639                     CMP AL, '/'
0DD7 752C                 1640                     JNE CHECK_SEND
0DD9 C706AB000000         1641                     MOV DS:PRICE_FLAG, 0
0DDF C706A7000000         1642                     MOV DS:RECEIVE_FLAG, 0
0DE5 C706B5000100         1643                     MOV DS:LANG_FLAG, 1
0DEB 833EFD0000           1644                     CMP DS:TROLLEY_FLAG, 0
0DF0 7405                 1645                     JE TROLLEY_UPD_SKIP
0DF2 9A5D0D----     R     1646                     CALL FAR PTR UPDATE_TROLLEY
0DF7                      1647             TROLLEY_UPD_SKIP:
0DF7 C706FD000000         1648                     MOV DS:TROLLEY_FLAG, 0
0DFD 9ADB0B----     R     1649                     CALL FAR PTR CALC_UPD_PRICE
0E02 EB2090               1650                     JMP terminate_session3
                          1651             
0E05                      1652             CHECK_SEND:
0E05 3C26                 1653                     CMP AL, '&'
0E07 751E                 1654                     JNE TROLLEY_PRICE
0E09 C706AB000100         1655                     MOV DS:PRICE_FLAG, 1
0E0F C70661000000         1656                     MOV DS:KEYPAD_INDEX, 0
0E15 C706A3000800         1657                     MOV DS:MAX_INPUT_SIZE, 8
0E1B E9E300               1658                     JMP id_skip2
                          1659             
                          1660             
0E1E                      1661             next_id1:
0E1E E9E300               1662                     JMP next_id
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    23:48:05  12/07/;3  PAGE   32


LOC  OBJ                  LINE     SOURCE

                          1663                     
0E21                      1664             send_input_across1:
0E21 E9C100               1665                     JMP send_input_across
                          1666             
0E24                      1667             terminate_session3:
0E24 E9D700               1668                     JMP terminate_session2
                          1669             
                          1670                     
0E27                      1671             TROLLEY_PRICE:
0E27 3C2B                 1672                     CMP AL, '+'
0E29 7515                 1673                     JNE receive_price
0E2B C706A3000800         1674                     MOV DS:MAX_INPUT_SIZE, 8
0E31 C706FD000100         1675                     MOV DS:TROLLEY_FLAG, 1
0E37 C706FB000000         1676                     MOV DS:TROLLEY_INDEX, 0
0E3D E9C100               1677                     JMP id_skip2
                          1678                     
0E40                      1679             receive_price:
0E40 3C23                 1680                     CMP AL, '#'
0E42 7543                 1681                     JNE check_price
0E44 C706A9000100         1682                     MOV DS:DAC_FLAG, 1
0E4A C706AB000000         1683                     MOV DS:PRICE_FLAG, 0
0E50 C706B7000000         1684                     MOV DS:PRICE, 0
0E56 833EFD0000           1685                     CMP DS:TROLLEY_FLAG, 0
0E5B 7421                 1686                     JE TROLLEY_UPD_SKIP2
0E5D 9A5D0D----     R     1687                     CALL FAR PTR UPDATE_TROLLEY
                          1688                     ;CLEAN STATE
0E62 C706B3000300         1689                     MOV DS:DECIMAL_INDEX, 3
0E68 9A1F06----     R     1690                     CALL FAR PTR BCD_CLEAR
0E6D C706A3000000         1691                     MOV DS:MAX_INPUT_SIZE, 0
0E73 9ADD04----     R     1692                     CALL FAR PTR CLEAR_TEMP_BCD
                          1693                     
0E78 C706CF000000         1694                     MOV DS:CASH_FLAG, 0
                          1695                     
0E7E                      1696             TROLLEY_UPD_SKIP2:
0E7E C706FD000000         1697                     MOV DS:TROLLEY_FLAG, 0
                          1698                     
0E84 EB7B90               1699                     JMP id_skip2
                          1700             
0E87                      1701             check_price:    
                          1702             
0E87 833EAB0001           1703                     CMP DS:PRICE_FLAG, 1
0E8C 7440                 1704                     JE update_price_value
                          1705                     
0E8E 833EFD0001           1706                     CMP DS:TROLLEY_FLAG, 1
0E93 7428                 1707                     JE update_trolley_arr
                          1708                     
0E95 833EA90001           1709                     CMP DS:DAC_FLAG, 1
0E9A 7403                 1710                     JE dac_change
0E9C EB6390               1711                     JMP id_skip2
                          1712     
0E9F                      1713             dac_change:
0E9F 8A1E7900             1714                     MOV BL, DS:REG_AL
0EA3 2C30                 1715                     SUB AL, 30H
0EA5 A27900               1716                     MOV DS:REG_AL, AL
0EA8 9AB606----     R     1717                     CALL FAR PTR DAC_UPDATE
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    23:48:05  12/07/;3  PAGE   33


LOC  OBJ                  LINE     SOURCE

0EAD 881E7900             1718                     MOV DS:REG_AL, BL
0EB1 C706A9000000         1719                     MOV DS:DAC_FLAG, 0
0EB7 EB4890               1720                     JMP id_skip2
                          1721             
                          1722     
0EBA EB4590               1723             id_skip3: JMP id_skip2
                          1724             
0EBD                      1725             update_trolley_arr:
0EBD 8B1EFB00             1726                     MOV BX, DS:TROLLEY_INDEX
0EC1 2C30                 1727                     SUB AL, 30H
0EC3 8887F300             1728                     MOV DS:TROLLEY_ARRAY[BX], AL
0EC7 FF06FB00             1729                     INC DS:TROLLEY_INDEX
0ECB EB3490               1730                     JMP id_skip2
                          1731                     
0ECE                      1732             update_price_value:
0ECE 2C30                 1733                     SUB AL, 30H
0ED0 B90000               1734                     MOV CX, 0
0ED3 8AC8                 1735                     MOV CL, AL
0ED5 A1B700               1736                     MOV AX, DS:PRICE
0ED8 BB0A00               1737                     MOV BX, 10
0EDB F7E3                 1738                     MUL BX
                          1739                     
0EDD 03C1                 1740                     ADD AX, CX
0EDF A3B700               1741                     MOV DS:PRICE, AX
0EE2 EB1D90               1742                     JMP id_skip2
                          1743                     
0EE5                      1744             send_input_across:
0EE5 9AD906----     R     1745                     CALL FAR PTR SEND_INPUT
                          1746                     
0EEA C706A1000000         1747                     MOV DS:SEND_BUFFER_LEN, 0
                          1748                     
0EF0 C6068C0000           1749                     MOV DS:SEND_FLAG, 0
                          1750                     
0EF5 C706A7000100         1751                     MOV DS:RECEIVE_FLAG, 1
                          1752                     
0EFB EB0490               1753                     JMP id_skip2
                          1754                     
0EFE EB3E90               1755                     terminate_session2: JMP terminate_session
0F01 EB6790               1756                     id_skip2: JMP id_skip
                          1757                     
0F04                      1758             next_id:
                          1759                     
0F04 803E810001           1760                     CMP DS:ID_FLAG_r, 1
0F09 7513                 1761                     JNE id_flag_label
0F0B 38067F00             1762                     CMP DS:MY_ID[1], AL
0F0F 7559                 1763                     JNE id_skip
                          1764                     ;start writing to pc
0F11 C6068B0001           1765                     MOV DS:REPLY_FLAG, 1
0F16 C606810000           1766                     MOV DS:ID_FLAG_r, 0
0F1B EB4D90               1767                     JMP id_skip
                          1768             
0F1E                      1769             id_flag_label:
                          1770             
0F1E 803E800001           1771                     CMP DS:ID_FLAG_@, 1
0F23 7539                 1772                     JNE protocol_rec
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    23:48:05  12/07/;3  PAGE   34


LOC  OBJ                  LINE     SOURCE

0F25 3C72                 1773                     CMP AL,'r'
0F27 750D                 1774                     JNE id_not_r
0F29 C606810001           1775                     MOV DS:ID_FLAG_r,1
0F2E C606800000           1776                     MOV DS:ID_FLAG_@, 0
0F33 EB3590               1777                     JMP S_RET
0F36                      1778             id_not_r:
0F36 C606800000           1779                     MOV DS:ID_FLAG_@, 0
0F3B EB2D90               1780                     JMP id_skip
                          1781             
0F3E                      1782             terminate_session:
0F3E C606810000           1783                     MOV DS:ID_FLAG_r, 0
0F43 33DB                 1784                     XOR BX,BX
0F45                      1785             start_send1:
0F45 50                   1786                     PUSH AX
0F46 33C0                 1787                     XOR AX,AX
0F48 8A878600             1788                     MOV AL, DS:FAIL_MESSAGE[BX]
0F4C 9A0000----     E     1789                     CALL FAR PTR PRINT_CHAR
0F51 58                   1790                     POP AX
0F52 C6068B0000           1791                     MOV DS:REPLY_FLAG, 0
0F57 43                   1792                     INC BX
0F58 3A1E8A00             1793                     CMP BL, DS:FAIL_COUNT
0F5C 75E7                 1794                     JNE start_send1
                          1795                     
0F5E                      1796             protocol_rec:
0F5E 3C40                 1797                     CMP AL,'@'
0F60 7508                 1798                     JNE id_skip
0F62 C606800001           1799                     MOV DS:ID_FLAG_@,1
0F67 EB0190               1800                     JMP S_RET
                          1801                     
0F6A                      1802             id_skip:
                          1803                     ; JMP S_RET
                          1804             
                          1805                     ; CMP   AL,'<'
                          1806                     ; JNE   S_FAST
                          1807     
                          1808                     ; INC   DS:T_COUNT_SET
                          1809                     ; INC   DS:T_COUNT_SET
                          1810     
                          1811                     ; JMP   S_NEXT0
                          1812     ; S_FAST:
                          1813                     ; CMP   AL,'>'
                          1814                     ; JNE   S_RET
                          1815     
                          1816                     ; DEC   DS:T_COUNT_SET
                          1817                     ; DEC   DS:T_COUNT_SET
                          1818     
                          1819     ; S_NEXT0:
                          1820                     ; MOV   CX,22                   ;initialize counter for message
                          1821                     ; MOV   BX,0
                          1822     
                          1823     ; S_NEXT1:      MOV     AL,DS:REC_MESS[BX]      ;print message
                          1824                     ; call  FAR ptr print_char
                          1825                     ; INC   BX
                          1826                     ; LOOP  S_NEXT1
                          1827     
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    23:48:05  12/07/;3  PAGE   35


LOC  OBJ                  LINE     SOURCE

                          1828                     ; MOV   AL,DS:T_COUNT_SET       ;print current period of timer0
                          1829                     ; CALL  FAR PTR PRINT_2HEX
0F6A                      1830     S_RET:
0F6A 1F                   1831                     POP     DS
0F6B 5B                   1832                     POP     BX
0F6C 59                   1833                     POP     CX
0F6D CB                   1834                     RET
                          1835     SERIAL_REC_ACTION       ENDP
                          1836     
0F6E                      1837     TIMER2_ACTION   PROC    FAR
0F6E 50                   1838                     PUSH    AX
0F6F 1E                   1839                     PUSH    DS
0F70 53                   1840                     PUSH    BX
0F71 51                   1841                     PUSH    CX
0F72 52                   1842                     PUSH    DX
                          1843                     
                          1844                     
0F73 B8----         R     1845                     MOV     AX,DATA_SEG
0F76 8ED8                 1846                     MOV     DS,AX
                          1847             
0F78 FE0E1600             1848                     DEC     DS:T_COUNT
0F7C 754A                 1849                     JNZ     T_NEXT1
0F7E A01700               1850                     MOV     AL,DS:T_COUNT_SET
0F81 A21600               1851                     MOV     DS:T_COUNT,AL
                          1852     
0F84                      1853     T_NEXT0:
                          1854                     
0F84 33DB                 1855                     XOR BX, BX
0F86 8A1E6000             1856                     MOV BL, DS:BCD_INDEX
0F8A 8A4759               1857                     MOV AL, DS:BCD_MESSAGE[BX]
                          1858                     
0F8D 3B1EB300             1859                     CMP BX, DS:DECIMAL_INDEX
0F91 7506                 1860                     JNE CALL_FUNC
0F93 C706AD000100         1861                     MOV DS:DECIMAL_FLAG, 1
0F99                      1862     CALL_FUNC:
0F99 9A3910----     R     1863                     CALL FAR PTR BCD_TO_7SEG
0F9E C706AD000000         1864                     MOV DS:DECIMAL_FLAG, 0
                          1865     
0FA4 BA0002               1866                     MOV DX, 200H
0FA7 EE                   1867                     OUT DX, AL
                          1868                     
0FA8 A05F00               1869                     MOV AL, DS:ENABLE_BYTE
0FAB BA8001               1870                     MOV DX, 180H
0FAE EE                   1871                     OUT DX, AL
                          1872                     
                          1873     
0FAF FE066000             1874                     INC DS:BCD_INDEX
0FB3 D0065F00             1875                     ROL DS:ENABLE_BYTE, 1
0FB7 803E5F00BF           1876                     CMP DS:ENABLE_BYTE, 10111111b
0FBC 750A                 1877                     JNE T_NEXT1
0FBE C6065F00FE           1878                     MOV DS:ENABLE_BYTE, 11111110b 
0FC3 C606600000           1879                     MOV DS:BCD_INDEX, 0
                          1880     
                          1881                     
0FC8                      1882     T_NEXT1:
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    23:48:05  12/07/;3  PAGE   36


LOC  OBJ                  LINE     SOURCE

0FC8 803E750000           1883                     CMP DS:DAC_LEN, 0
0FCD 743C                 1884                     JE ISR_END
                          1885                     
                          1886                     
0FCF 8B367600             1887                     MOV SI, DS:SI_PTR
                          1888                             
0FD3 BB0000               1889                     MOV BX, 0
0FD6 33C0                 1890                     XOR AX, AX
0FD8 8A4766               1891                     MOV AL, DS:DAC_ADDR[BX]
                          1892                     
0FDB BB0001               1893                     MOV BX, 100H
0FDE F7E3                 1894                     MUL BX
                          1895                     
0FE0 8B166400             1896                     MOV DX, DS:DAC_BASE
0FE4 03D0                 1897                     ADD DX, AX
                          1898                     
0FE6 1E                   1899                     PUSH DS
0FE7 8EDA                 1900                     MOV DS, DX
                          1901                     
0FE9 8B04                 1902                     MOV AX, [SI]
                          1903                     
0FEB BA1001               1904                     MOV DX, 110H
0FEE EE                   1905                     OUT DX, AL
                          1906                     
0FEF 1F                   1907                     POP DS
                          1908                     
0FF0 FF067600             1909                     INC DS:SI_PTR
0FF4 813E76000010         1910                     CMP DS:SI_PTR, 1000H
0FFA 750F                 1911                     JNE ISR_END
                          1912                     
0FFC C70676000000         1913                     MOV DS:SI_PTR, 0
1002 FE0E7500             1914                     DEC DS:DAC_LEN
1006 9A1110----     R     1915                     CALL FAR PTR DAC_SHIFT
                          1916                     
100B                      1917     ISR_END:
                          1918                     
100B 5A                   1919                     POP DX
100C 59                   1920                     POP     CX
100D 5B                   1921                     POP     BX
100E 1F                   1922                     POP     DS
100F 58                   1923                     POP AX
1010 CB                   1924                     RET
                          1925     TIMER2_ACTION   ENDP
                          1926     
                          1927     
1011                      1928     DAC_SHIFT PROC FAR
1011 50                   1929             PUSH AX
1012 53                   1930             PUSH BX
1013 51                   1931             PUSH CX
1014 52                   1932             PUSH DX
                          1933     
1015 33C9                 1934             XOR CX, CX
1017 8A0E7500             1935             MOV CL, DS:DAC_LEN
101B 80F900               1936             CMP CL, 0
101E 7414                 1937             JE END_SHIFT
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    23:48:05  12/07/;3  PAGE   37


LOC  OBJ                  LINE     SOURCE

                          1938     
1020                      1939             SHIFT_LOOP:
                          1940     
1020 33DB                 1941             XOR BX, BX
1022 8A1E7500             1942             MOV BL, DS:DAC_LEN
1026 2BD9                 1943             SUB BX, CX
1028 43                   1944             INC BX
                          1945             
1029 33D2                 1946             XOR DX, DX
102B 8A5766               1947             MOV DL, DS:DAC_ADDR[BX]
102E 4B                   1948             DEC BX
102F 885766               1949             MOV DS:DAC_ADDR[BX], DL
                          1950     
1032 E2EC                 1951             LOOP SHIFT_LOOP
                          1952             
1034                      1953             END_SHIFT:
1034 5A                   1954             POP DX
1035 59                   1955             POP CX
1036 5B                   1956             POP BX
1037 58                   1957             POP AX
1038 CB                   1958             RET
                          1959     DAC_SHIFT ENDP
                          1960     
1039                      1961     BCD_TO_7SEG PROC FAR
                          1962     
1039 53                   1963             PUSH BX
103A 51                   1964             PUSH CX
103B 52                   1965             PUSH DX
                          1966             
103C 3C00                 1967             CMP AL, 0
103E 7511                 1968             JNE one
1040 833EAD0001           1969             CMP DS:DECIMAL_FLAG, 1
1045 7405                 1970             JE decimal0
1047 B03F                 1971             MOV AL, 00111111b
1049 E9D700               1972             JMP endfunc
104C                      1973     decimal0:
104C B0BF                 1974             MOV AL, 10111111b
104E E9D200               1975             JMP endfunc
                          1976             
1051                      1977             one:
1051 3C01                 1978             CMP AL, 1
1053 7511                 1979             JNE two
1055 833EAD0001           1980             CMP DS:DECIMAL_FLAG, 1
105A 7405                 1981             JE decimal1
105C B006                 1982             MOV AL, 00000110b
105E E9C200               1983             JMP endfunc
1061                      1984     decimal1:
1061 B086                 1985             MOV AL, 10000110b
1063 E9BD00               1986             JMP endfunc
                          1987             
1066                      1988             two:
1066 3C02                 1989             CMP AL,2
1068 7511                 1990             JNE three
106A 833EAD0001           1991             CMP DS:DECIMAL_FLAG, 1
106F 7405                 1992             JE decimal2
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    23:48:05  12/07/;3  PAGE   38


LOC  OBJ                  LINE     SOURCE

1071 B05B                 1993             MOV AL, 01011011b
1073 E9AD00               1994             JMP endfunc
1076                      1995     decimal2:
1076 B0DB                 1996             MOV AL, 11011011b
1078 E9A800               1997             JMP endfunc
                          1998             
107B                      1999             three:
107B 3C03                 2000             CMP AL,3
107D 7511                 2001             JNE four
107F 833EAD0001           2002             CMP DS:DECIMAL_FLAG, 1
1084 7405                 2003             JE decimal3
1086 B04F                 2004             MOV AL, 01001111b
1088 E99800               2005             JMP endfunc
108B                      2006     decimal3:
108B B0CF                 2007             MOV AL, 11001111b
108D E99300               2008             JMP endfunc
                          2009             
1090                      2010             four:
1090 3C04                 2011             CMP AL,4
1092 7511                 2012             JNE five
1094 833EAD0001           2013             CMP DS:DECIMAL_FLAG, 1
1099 7405                 2014             JE decimal4
109B B066                 2015             MOV AL, 01100110b
109D E98300               2016             JMP endfunc
10A0                      2017     decimal4:
10A0 B0E6                 2018             MOV AL, 11100110b
10A2 EB7F90               2019             JMP endfunc
                          2020             
10A5                      2021             five:
10A5 3C05                 2022             CMP AL,5
10A7 7511                 2023             JNE six
10A9 833EAD0001           2024             CMP DS:DECIMAL_FLAG, 1
10AE 7405                 2025             JE decimal5
10B0 B06D                 2026             MOV AL, 01101101b
10B2 EB6F90               2027             JMP endfunc
10B5                      2028     decimal5:
10B5 B0ED                 2029             MOV AL, 11101101b
10B7 EB6A90               2030             JMP endfunc
                          2031             
10BA                      2032             six:
10BA 3C06                 2033             CMP AL,6
10BC 7511                 2034             JNE seven
10BE 833EAD0001           2035             CMP DS:DECIMAL_FLAG, 1
10C3 7405                 2036             JE decimal6
10C5 B07D                 2037             MOV AL, 01111101b
10C7 EB5A90               2038             JMP endfunc
10CA                      2039     decimal6:
10CA B0FD                 2040             MOV AL, 11111101b
10CC EB5590               2041             JMP endfunc
                          2042             
10CF                      2043             seven:
10CF 3C07                 2044             CMP AL,7
10D1 7511                 2045             JNE eight
10D3 833EAD0001           2046             CMP DS:DECIMAL_FLAG, 1
10D8 7405                 2047             JE decimal7
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    23:48:05  12/07/;3  PAGE   39


LOC  OBJ                  LINE     SOURCE

10DA B007                 2048             MOV AL, 00000111b
10DC EB4590               2049             JMP endfunc
10DF                      2050     decimal7:
10DF B087                 2051             MOV AL, 10000111b
10E1 EB4090               2052             JMP endfunc
                          2053             
10E4                      2054             eight:
10E4 3C08                 2055             CMP AL,8
10E6 7511                 2056             JNE nine
10E8 833EAD0001           2057             CMP DS:DECIMAL_FLAG, 1
10ED 7405                 2058             JE decimal8
10EF B07F                 2059             MOV AL, 01111111b
10F1 EB3090               2060             JMP endfunc
10F4                      2061     decimal8:
10F4 B0FF                 2062             MOV AL, 11111111b
10F6 EB2B90               2063             JMP endfunc
                          2064             
10F9                      2065             nine:
10F9 3C09                 2066             CMP AL,9
10FB 7511                 2067             JNE hifn
10FD 833EAD0001           2068             CMP DS:DECIMAL_FLAG, 1
1102 7405                 2069             JE decimal9
1104 B06F                 2070             MOV AL, 01101111b
1106 EB1B90               2071             JMP endfunc
1109                      2072     decimal9:
1109 B0EF                 2073             MOV AL, 11101111b
110B EB1690               2074             JMP endfunc
                          2075             
110E                      2076             hifn:
110E 3C2D                 2077             CMP AL,'-'
1110 7511                 2078             JNE endfunc
1112 833EAD0001           2079             CMP DS:DECIMAL_FLAG, 1
1117 7405                 2080             JE decimal10
1119 B040                 2081             MOV AL, 01000000b
111B EB0690               2082             JMP endfunc
111E                      2083     decimal10:
111E B0C0                 2084             MOV AL, 11000000b
1120 EB0190               2085             JMP endfunc
                          2086             
1123                      2087             endfunc:
1123 5A                   2088             POP DX
1124 59                   2089             POP CX
1125 5B                   2090             POP BX
                          2091     
1126 CB                   2092     RET
                          2093     BCD_TO_7SEG ENDP
                          2094     
----                      2095     CODE_SEG        ENDS
                          2096     END

ASSEMBLY COMPLETE, NO ERRORS FOUND
