8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:37:07  12/08/;3  PAGE    1


DOS 5.0 (038-N) 8086/87/88/186 MACRO ASSEMBLER V3.1 ASSEMBLY OF MODULE TIMER
OBJECT MODULE PLACED IN TIMER.OBJ
ASSEMBLER INVOKED BY:  D:\ASM86.EXE TIMER.ASM


LOC  OBJ                  LINE     SOURCE

                             1 +1  $MOD186
                             2 +1  $EP
                             3     NAME TIMER
                             4     ; Main program for uPD70208 microcomputer system
                             5     ;
                             6     ; Author:       Dr Tay Teng Tiow
                             7     ; Address:      Department of Electrical Engineering 
                             8     ;               National University of Singapore
                             9     ;               10, Kent Ridge Crescent
                            10     ;               Singapore 0511. 
                            11     ; Date:         6th September 1991
                            12     ;
                            13     ; This file contains proprietory information and cannot be copied 
                            14     ; or distributed without prior permission from the author.
                            15     ; =========================================================================
                            16     
                            17     public  serial_rec_action, timer2_action
                            18     extrn   print_char:far, print_2hex:far, iodefine:far
                            19     extrn   set_timer2:far
                            20     
                            21     ;IO Setup for 80C188 
  FFA0                      22             UMCR    EQU    0FFA0H ; Upper Memory Control Register
  FFA2                      23             LMCR    EQU    0FFA2H ; Lower Memory control Register         
  FFA4                      24             PCSBA   EQU    0FFA4H ; Peripheral Chip Select Base Address
  FFA8                      25             MPCS    EQU    0FFA8H ; MMCS and PCS Alter Control Register
  0080                      26             A_8255  EQU    0080H
  0081                      27             B_8255  EQU    0081H
  0082                      28             C_8255  EQU    0082H
  0083                      29             CWR_8255  EQU    0083H
  FF38                      30             INT0CON  EQU   0FF38H
  FF22                      31             EOI EQU 0FF22H
  FF28                      32             IMASK EQU 0FF28H
  FFA6                      33             MMCS    EQU    0FFA6H 
  4000                      34             DAC EQU 4000H
                            35     
                            36     
----                        37     STACK_SEG       SEGMENT
0000 (512                   38                     DB      512 DUP(?)
     ??
     )
0200                        39             TOS     LABEL   WORD
----                        40     STACK_SEG       ENDS
                            41     
                            42     
----                        43     DATA_SEG        SEGMENT
0000 0A                     44             TIMER0_MESS             DB      10,13,'TIMER2 INTERRUPT    '
0001 0D
0002 54494D45523220
     494E5445525255
     505420202020
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:37:07  12/08/;3  PAGE    2


LOC  OBJ                  LINE     SOURCE

0016 18                     45             T_COUNT                 DB      24
0017 18                     46             T_COUNT_SET             DB      24
0018 0A                     47             REC_MESS                DB      10,13,'Period of timer0 =     '
0019 0D
001A 506572696F6420
     6F662074696D65
     7230203D202020
     2020
0031 (32                    48             MESSAGE         DB  32 dup('h')
     68
     )
0051 00                     49             KEYPAD_INPUT    DB  0,0,0,0,0,0,0,0
0052 00
0053 00
0054 00
0055 00
0056 00
0057 00
0058 00
0059 2D                     50             BCD_MESSAGE     DB  '-','-','-','-','-','-'
005A 2D
005B 2D
005C 2D
005D 2D
005E 2D
005F FE                     51             ENABLE_BYTE     DB  11111110b
0060 00                     52             BCD_INDEX       DB  0
0061 0000                   53             KEYPAD_INDEX    DW      0
0063 20                     54             M_SIZE                  DB  32
0064 0040                   55             DAC_BASE        DW  4000H
0066 (15                    56             DAC_ADDR        DB  15 dup(0) 
     00
     )
0075 00                     57             DAC_LEN         DB  0
0076 0000                   58             SI_PTR          DW  0
0078 ??                     59             CHAR                    DB  ?
0079 ??                     60             REG_AL                  DB  ?
007A ??                     61             REG_BH                  DB  ?
007B ??                     62             REG_CL                  DB  ?
007C 00                     63             FLAG            DB  0
007D 00                     64             LONG_PRESS_FLAG DB      0
007E 7231                   65             MY_ID                   DB      'r1'
0080 00                     66             ID_FLAG_@               DB      0
0081 00                     67             ID_FLAG_r               DB      0
0082 4072312F               68             REPLY_MESSAGE   DB      '@r1/'
0086 40302F                 69             FAIL_MESSAGE    DB '@0/'
0089 04                     70             REPLY_COUNT             DB      4
008A 03                     71             FAIL_COUNT              DB      3
008B 00                     72             REPLY_FLAG              DB      0
008C 00                     73             SEND_FLAG       DB  0
008D (20                    74             SEND_BUFFER     DB  20 dup(0)
     00
     )
00A1 0000                   75             SEND_BUFFER_LEN DW      0
00A3 0000                   76             MAX_INPUT_SIZE  DW      0
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:37:07  12/08/;3  PAGE    3


LOC  OBJ                  LINE     SOURCE

00A5 0000                   77             QTY_FLAG                DW      0
00A7 0000                   78             RECEIVE_FLAG    DW      0
00A9 0000                   79             DAC_FLAG                DW      0
00AB 0000                   80             PRICE_FLAG      DW      0
00AD 0100                   81             DECIMAL_FLAG    DW      1
00AF 0000                   82             SCROLL_LEN      DW      0
00B1 0000                   83             DAC_DISABLE     DW  0
00B3 0300                   84             DECIMAL_INDEX   DW  3
00B5 0100                   85             LANG_FLAG       DW  1
00B7 0000                   86             PRICE                   DW      0
00B9 0000                   87             QTY                             DW      0
00BB 0000                   88             TOTAL_PRICE_U   DW      0
00BD 0000                   89             TOTAL_PRICE_L   DW      0
00BF 0000                   90             TOTAL_PRICE_DEC DW      0
00C1 (8                     91             TEMP_BCD_ARR    DB  8 dup(0)
     00
     )
00C9 0000                   92             THOUSAND_FLAG   DW  0
00CB 0000                   93             CENT_FLAG               DW      0
00CD 0000                   94             DOLLAR_FLAG             DW      0
00CF 0000                   95             CASH_FLAG               DW      0
00D1 (8                     96             CASH_AMT        DB  8 dup(0)
     00
     )
00D9 (8                     97             TEMP_CASH_ARR   DW  8 dup(0)
     0000
     )
00E9 0000                   98             CASH_OK_FLAG    DW  0
00EB 0000                   99             BORROW_POSITION DW  0
00ED 0100                  100             CANCEL_FLAG             DW  1
00EF 0000                  101             TRANSACTION_OVER DW 0
00F1 0100                  102             DATA_ENTER              DW  1
00F3 (8                    103             TROLLEY_ARRAY   DB  8 dup(0)
     00
     )
00FB 0000                  104             TROLLEY_INDEX   DW  0
00FD 0000                  105             TROLLEY_FLAG    DW  0
00FF 0000                  106             TROLLEY_ID              DW  0
0101 0000                  107             TROLLEY_DISABLED DW 0
0103 0000                  108             TEN_THOUSAND_FLAG DW 0
0105 0000                  109             ZERO_TELL               DW  0
----                       110     DATA_SEG        ENDS
                           111     
                           112     
----                       113     CODE_SEG        SEGMENT
                           114     
                           115             PUBLIC          START
                           116     
                           117     ASSUME  CS:CODE_SEG, SS:STACK_SEG
                           118     
0000                       119     START:
                           120     ;initialize stack area
0000 B8----         R      121                     MOV     AX,STACK_SEG            
0003 8ED0                  122                     MOV     SS,AX
0005 368B260002            123                     MOV     SP,TOS
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:37:07  12/08/;3  PAGE    4


LOC  OBJ                  LINE     SOURCE

                           124                     
                           125     ; Initialize the on-chip pheripherals
000A 9A0000----     E      126                     CALL    FAR PTR IODEFINE
                           127                     
000F 9A0000----     E      128     call set_timer2
0014 FB                    129                    STI
                           130     
                           131     ; ^^^^^^^^^^^^^^^^^  Start of User Main Routine  ^^^^^^^^^^^^^^^^^^
                           132     
                           133     ;Initialize MMCS
                           134             
0015 BAA6FF                135             MOV DX, MMCS
0018 B80340                136             MOV AX, 4003H
001B EF                    137             OUT DX, AX
                           138     
                           139     ; Initialize MPCS to MAP peripheral to IO address
                           140             
001C BAA8FF                141             MOV DX, MPCS
001F B88320                142             MOV AX, 2083H
0022 EF                    143             OUT DX, AX
                           144        
                           145     ; PCSBA initial, set the parallel port start from 00H
0023 BAA4FF                146             MOV DX, PCSBA
0026 B80300                147             MOV AX, 0003H ; Peripheral starting address 00H no READY, No Waits
0029 EF                    148             OUT DX, AX
                           149     
                           150     ; Initialize LMCS 
002A BAA2FF                151         MOV DX, LMCR
002D B8C401                152         MOV AX, 01C4H  ; Starting address 1FFFH, 8K, No waits, last shoud be 5H for 1 wai
                                   ts      
0030 EF                    153         OUT DX, AX
                           154             
0031 B8----         R      155             MOV AX, DATA_SEG
0034 8ED8                  156             MOV DS, AX
                           157                              
0036 BA8300                158             MOV DX, CWR_8255
0039 B88200                159             MOV AX, 0082h
003C EF                    160             OUT DX, AX
                           161             
003D                       162     NEXT:
003D 9A4400----     R      163             CALL FAR PTR KEYPAD_LOOP
                           164             
0042 EBF9                  165     JMP NEXT
                           166     
0044                       167     KEYPAD_LOOP PROC FAR
0044 50                    168     PUSH AX
0045 53                    169     PUSH BX
0046 51                    170     PUSH CX
0047 52                    171     PUSH DX
                           172             
0048 9AD606----     R      173                             CALL FAR PTR DEBOUNCE           
                           174                             
004D C606790003            175     WAIT_1:         MOV DS:REG_AL, 03H
0052 BB0000                176                         MOV BX, 0000H
0055 BA8200                177                         MOV DX,C_8255
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:37:07  12/08/;3  PAGE    5


LOC  OBJ                  LINE     SOURCE

0058 8AC3                  178                         MOV AL,BL
005A EE                    179                         OUT DX,AL
                           180                        
005B BA8100                181                         MOV DX,B_8255
005E EC                    182                         IN AL,DX
005F 8AD8                  183                         MOV BL,AL  
0061 80E3FC                184                         AND BL,0FCH
0064 80FBFC                185                         CMP BL,0FCH
                           186                      
0067 744F                  187                     JE LONG_PRESS
                           188                             
0069 B3FE                  189                         MOV BL, 0FEH
006B C6067A0004            190                         MOV DS:REG_BH, 04H
                           191                        
0070                       192     NXTROW: 
0070 C0C307                193                     ROL BL,07H
0073 8AEB                  194                             MOV CH,BL
0075 BA8200                195                             MOV DX,C_8255
0078 8AC3                  196                             MOV AL,BL
007A EE                    197                             OUT DX,AL
                           198                             
007B BA8100                199                             MOV DX,B_8255
007E EC                    200                             IN AL,DX
007F 8AD8                  201                             MOV BL,AL
0081 80E3FC                202                             AND BL,0FCH
0084 C6067B0006            203                             MOV DS:REG_CL,06H
0089 C0DB02                204                             RCR BL,02H
008C D0DB                  205     NXTCOL:         RCR BL,01H
008E 7330                  206                             JNC CODEKY
0090 FE0E7900              207                             DEC DS:REG_AL
0094 FE0E7B00              208                             DEC DS:REG_CL
0098 803E7B0003            209                             CMP DS:REG_CL,03H
009D 7413                  210                             JE KEYPAD4
                           211                             
009F 803E7B0000            212                             CMP DS:REG_CL, 0H
00A4 740F                  213                             JE SUBTRACT3
00A6 EBE4                  214                             JMP NXTCOL
                           215                             
00A8 8ADD                  216                             MOV BL,CH
00AA FE0E7A00              217                             DEC DS:REG_BH
00AE 75C0                  218                             JNZ NXTROW
00B0 EB9B                  219                             JMP WAIT_1
                           220                             
00B2 E97F00                221     KEYPAD4:    JMP KEYPAD3
00B5 E97F00                222     SUBTRACT3:  JMP SUBTRACT2
                           223                             
00B8                       224     LONG_PRESS:
00B8 C6067D0000            225                             MOV DS:LONG_PRESS_FLAG, 0
00BD EB7290                226                             JMP RETURN2
00C0                       227     CODEKY:
00C0 803E79000B            228                         CMP DS:REG_AL, 11
00C5 7505                  229                             JNE bcd_upd
00C7 C606790000            230                             MOV DS:REG_AL, 0
                           231                             
00CC                       232     bcd_upd:
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:37:07  12/08/;3  PAGE    6


LOC  OBJ                  LINE     SOURCE

00CC 803E7D0000            233                             CMP DS:LONG_PRESS_FLAG, 0
00D1 755E                  234                             JNE RETURN2
                           235                             
00D3 803E790018            236                             CMP DS:REG_AL, 24
00D8 7560                  237                             JNE TROLLEY
00DA 833EEF0000            238                             CMP DS:TRANSACTION_OVER, 0
00DF 7459                  239                             JE TROLLEY
00E1 BB0000                240                             MOV BX, 0
00E4 C6878D003E            241                             MOV DS:SEND_BUFFER[BX], '>'
                           242                             
00E9 B90800                243                             MOV CX, 8
00EC                       244                             SEND_CASH_PRINT:
00EC 53                    245                                     PUSH BX
00ED BB0800                246                                     MOV BX, 8
00F0 2BD9                  247                                     SUB BX, CX
00F2 8A87D100              248                                     MOV AL, DS:CASH_AMT[BX]
00F6 5B                    249                                     POP BX
                           250                                     
00F7 43                    251                                     INC BX
00F8 0430                  252                                     ADD AL, 30H
00FA 88878D00              253                                     MOV DS:SEND_BUFFER[BX], AL
00FE E2EC                  254                             LOOP SEND_CASH_PRINT
                           255                             
0100 43                    256                             INC BX
0101 C6878D0029            257                             MOV DS:SEND_BUFFER[BX], ')'
                           258                             
0106 B90800                259                             MOV CX, 8
0109                       260                             SEND_CHANGE_PRINT:
0109 53                    261                                     PUSH BX
010A BB0800                262                                     MOV BX, 8
010D 2BD9                  263                                     SUB BX, CX
010F 8A87C100              264                                     MOV AL, DS:TEMP_BCD_ARR[BX]
0113 5B                    265                                     POP BX
                           266                                     
0114 43                    267                                     INC BX
0115 0430                  268                                     ADD AL, 30H
0117 88878D00              269                                     MOV DS:SEND_BUFFER[BX], AL
011B E2EC                  270                             LOOP SEND_CHANGE_PRINT
                           271                             
011D 43                    272                             INC BX
011E C6878D002F            273                             MOV DS:SEND_BUFFER[BX], '/'
0123 C706A1001300          274                             MOV DS:SEND_BUFFER_LEN, 19
0129 C6068C0001            275                             MOV DS:SEND_FLAG, 1
012E E96002                276                             JMP UPDATE_7SEG2
                           277                             
0131 E97703                278     RETURN2:    JMP RETURN
                           279                             
0134 E95603                280     KEYPAD3:        JMP KEYPAD_2
                           281                             
0137 E96303                282     SUBTRACT2:   JMP SUBTRACT
                           283     
013A                       284     TROLLEY:
013A 803E790011            285                             CMP DS:REG_AL, 17
013F 754C                  286                             JNE ENTER_CASH
                           287                             
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:37:07  12/08/;3  PAGE    7


LOC  OBJ                  LINE     SOURCE

0141 833E010101            288                             CMP DS:TROLLEY_DISABLED, 1
0146 7442                  289                             JE SKIP_ENTER_DATA1
                           290                             
0148 833ECF0001            291                             CMP DS:CASH_FLAG, 1
014D 743B                  292                             JE SKIP_ENTER_DATA1
014F 9A2506----     R      293                             CALL FAR PTR BCD_CLEAR
                           294                             
0154 833EEF0000            295                             CMP DS:TRANSACTION_OVER, 0
0159 7405                  296                             JE NO_RESET_NEEDED1
                           297                             
015B 9AE304----     R      298                             CALL FAR PTR CLEAR_TEMP_BCD
                           299                             
0160                       300             NO_RESET_NEEDED1:
0160 C706F1000100          301                             MOV DS:DATA_ENTER, 1
0166 C706B3000600          302                             MOV DS:DECIMAL_INDEX, 6
016C C706A3000600          303                             MOV DS:MAX_INPUT_SIZE, 6
0172 C706FF000100          304                             MOV DS:TROLLEY_ID, 1
0178 C706B5000000          305                             MOV DS:LANG_FLAG, 0
017E C706CF000000          306                             MOV DS:CASH_FLAG, 0
0184 C706EF000000          307                             MOV DS:TRANSACTION_OVER, 0
018A                       308             SKIP_ENTER_DATA1:
018A E90402                309                             JMP UPDATE_7SEG2
                           310                             
                           311                             
018D                       312     ENTER_CASH:     
018D 803E790014            313                             CMP DS:REG_AL, 20
0192 7521                  314                             JNE SEND_CASH
0194 833ECF0000            315                             CMP DS:CASH_FLAG, 0
0199 7417                  316                             JE SKIP_CASH
019B C706F1000100          317                             MOV DS:DATA_ENTER, 1
01A1 9A2506----     R      318                             CALL FAR PTR BCD_CLEAR
01A6 C706A3000600          319                             MOV DS:MAX_INPUT_SIZE, 6
01AC C706B3000600          320                             MOV DS:DECIMAL_INDEX, 6
01B2                       321                     SKIP_CASH:
01B2 E9DC01                322                             JMP UPDATE_7SEG2
                           323                             
01B5                       324     SEND_CASH:
01B5 803E790017            325                             CMP DS:REG_AL, 23
01BA 7529                  326                             JNE CLEAR_BUTTON
01BC 833ECF0000            327                             CMP DS:CASH_FLAG, 0
01C1 741F                  328                             JE SKIP_SEND_CASH
01C3 833E610000            329                             CMP DS:KEYPAD_INDEX, 0
01C8 7418                  330                             JE SKIP_SEND_CASH
01CA 833EB30003            331                             CMP DS:DECIMAL_INDEX, 3
01CF 7411                  332                             JE SKIP_SEND_CASH
01D1 C706F1000000          333                             MOV DS:DATA_ENTER, 0
01D7 C706A3000800          334                             MOV DS:MAX_INPUT_SIZE, 8
01DD 9AFB06----     R      335                             CALL FAR PTR TAKE_CASH
01E2                       336                     SKIP_SEND_CASH:
01E2 E9AC01                337                             JMP UPDATE_7SEG2
                           338                             
01E5                       339     CLEAR_BUTTON:
01E5 803E79000A            340                             CMP DS:REG_AL, 10
01EA 7508                  341                             JNE BACKSPACE
01EC 9A2506----     R      342                             CALL FAR PTR BCD_CLEAR
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:37:07  12/08/;3  PAGE    8


LOC  OBJ                  LINE     SOURCE

01F1 E99D01                343                             JMP UPDATE_7SEG2
                           344                             
01F4 803E79000C            345     BACKSPACE:      CMP DS:REG_AL, 12
01F9 7508                  346                             JNE ENTER_DATA
01FB 9AB605----     R      347                             CALL FAR PTR BCD_BACKSPACE
0200 E98E01                348                             JMP UPDATE_7SEG2
                           349     
0203 803E79000D            350     ENTER_DATA:     CMP DS:REG_AL, 13
0208 753F                  351                             JNE END_TRANS
020A 833ECF0001            352                             CMP DS:CASH_FLAG, 1
020F 7435                  353                             JE SKIP_ENTER_DATA
0211 9A2506----     R      354                             CALL FAR PTR BCD_CLEAR
                           355                             
0216 833EEF0000            356                             CMP DS:TRANSACTION_OVER, 0
021B 7405                  357                             JE NO_RESET_NEEDED
                           358                             
021D 9AE304----     R      359                             CALL FAR PTR CLEAR_TEMP_BCD
                           360                             
0222                       361             NO_RESET_NEEDED:
0222 C706F1000100          362                             MOV DS:DATA_ENTER, 1
0228 C706B3000600          363                             MOV DS:DECIMAL_INDEX, 6
022E C706A3000800          364                             MOV DS:MAX_INPUT_SIZE, 8
0234 C706B5000000          365                             MOV DS:LANG_FLAG, 0
023A C706CF000000          366                             MOV DS:CASH_FLAG, 0
0240 C706EF000000          367                             MOV DS:TRANSACTION_OVER, 0
0246                       368             SKIP_ENTER_DATA:
0246 E94801                369                             JMP UPDATE_7SEG2
                           370                             
0249 803E790010            371     END_TRANS:      CMP DS:REG_AL, 16
024E 7553                  372                             JNE CANCEL_TRANS
0250 833EFF0001            373                             CMP DS:TROLLEY_ID, 1
0255 7449                  374                             JE END_TRANS_CONT
0257 833ECF0001            375                             CMP DS:CASH_FLAG, 1
025C 7442                  376                             JE END_TRANS_CONT
025E 833EEF0000            377                             CMP DS:TRANSACTION_OVER, 0
0263 7403                  378                             JE TRANSACTION_NOT_OVER
0265 E92901                379                             JMP UPDATE_7SEG2
0268                       380     TRANSACTION_NOT_OVER:
0268 BB0000                381                             MOV BX, 0
026B C6878D0024            382                             MOV DS:SEND_BUFFER[BX], '$'
0270 43                    383                             INC BX
0271 C6878D002F            384                             MOV DS:SEND_BUFFER[BX], '/'
0276 C706A1000200          385                             MOV DS:SEND_BUFFER_LEN, 2
027C C6068C0001            386                             MOV DS:SEND_FLAG, 1
0281 C706BF000000          387                             MOV DS:TOTAL_PRICE_DEC, 0
0287 C706BD000000          388                             MOV DS:TOTAL_PRICE_L, 0
028D C706BB000000          389                             MOV DS:TOTAL_PRICE_U, 0
0293 833EED0001            390                             CMP DS:CANCEL_FLAG, 1
0298 7406                  391                             JE END_TRANS_CONT
029A C706CF000100          392                             MOV DS:CASH_FLAG, 1
02A0                       393                     END_TRANS_CONT:
02A0 E9EE00                394                             JMP UPDATE_7SEG2
                           395                             
02A3                       396     CANCEL_TRANS:   
02A3 803E79000F            397                             CMP DS:REG_AL, 15
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:37:07  12/08/;3  PAGE    9


LOC  OBJ                  LINE     SOURCE

02A8 755A                  398                             JNE SCROLL_LEFT
02AA 833ECF0001            399                             CMP DS:CASH_FLAG, 1
02AF 7503                  400                             JNE CONT_CANCEL
02B1 E9DD00                401                             JMP UPDATE_7SEG2
02B4                       402                     CONT_CANCEL:
02B4 BB0000                403                             MOV BX, 0
02B7 C6878D003F            404                             MOV DS:SEND_BUFFER[BX], '?'
02BC 43                    405                             INC BX
02BD C6878D002F            406                             MOV DS:SEND_BUFFER[BX], '/'
02C2 C706A1000200          407                             MOV DS:SEND_BUFFER_LEN, 2
02C8 C6068C0001            408                             MOV DS:SEND_FLAG, 1
02CD C706BF000000          409                             MOV DS:TOTAL_PRICE_DEC, 0
02D3 C706BD000000          410                             MOV DS:TOTAL_PRICE_L, 0
02D9 C706BB000000          411                             MOV DS:TOTAL_PRICE_U, 0
02DF C706B3000300          412                             MOV DS:DECIMAL_INDEX, 3
02E5 9A2506----     R      413                             CALL FAR PTR BCD_CLEAR
02EA C706A3000000          414                             MOV DS:MAX_INPUT_SIZE, 0
                           415                             
02F0 9AE304----     R      416                             CALL FAR PTR CLEAR_TEMP_BCD
                           417                             
02F5 C706ED000100          418                             MOV DS:CANCEL_FLAG, 1
02FB C70601010000          419                             MOV DS:TROLLEY_DISABLED, 0
0301 E98D00                420                             JMP UPDATE_7SEG2
                           421                             
0304                       422     SCROLL_LEFT:
0304 803E790015            423                             CMP DS:REG_AL, 21
0309 753D                  424                             JNE SCROLL_RIGHT
030B 833E610006            425                             CMP DS:KEYPAD_INDEX, 6
0310 7E7F                  426                             JLE UPDATE_7SEG2
0312 833EAF0000            427                             CMP DS:SCROLL_LEN, 0
0317 7478                  428                             JE UPDATE_7SEG2
0319 FF0EAF00              429                             DEC DS:SCROLL_LEN
031D FF0EB300              430                             DEC DS:DECIMAL_INDEX
0321 FF0E6100              431                             DEC DS:KEYPAD_INDEX
0325 8B1E6100              432                             MOV BX, DS:KEYPAD_INDEX
0329 8A4751                433                             MOV AL, DS:KEYPAD_INPUT[BX]
032C A27900                434                             MOV DS:REG_AL, AL
032F C706B1000100          435                             MOV DS:DAC_DISABLE, 1
0335 9A5006----     R      436                             CALL FAR PTR BCD_UPDATE
033A C706B1000000          437                             MOV DS:DAC_DISABLE, 0
0340 C606790015            438                             MOV DS:REG_AL, 21
0345 EB4A90                439                             JMP UPDATE_7SEG2
                           440     
0348                       441     SCROLL_RIGHT:
0348 803E790013            442                             CMP DS:REG_AL, 19
034D 7545                  443                             JNE LANG_TOGGLE
034F 833E610006            444                             CMP DS:KEYPAD_INDEX, 6
0354 7E3B                  445                             JLE UPDATE_7SEG2
0356 A16100                446                             MOV AX, DS:KEYPAD_INDEX
0359 2D0600                447                             SUB AX, 6
035C 3906AF00              448                             CMP DS:SCROLL_LEN, AX
0360 742F                  449                             JE UPDATE_7SEG2
0362 FF06AF00              450                             INC DS:SCROLL_LEN
0366 FF06B300              451                             INC DS:DECIMAL_INDEX
036A FF0E6100              452                             DEC DS:KEYPAD_INDEX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:37:07  12/08/;3  PAGE   10


LOC  OBJ                  LINE     SOURCE

036E 8B1E6100              453                             MOV BX, DS:KEYPAD_INDEX
0372 8A4751                454                             MOV AL, DS:KEYPAD_INPUT[BX]
0375 A27900                455                             MOV DS:REG_AL, AL
0378 C706B1000100          456                             MOV DS:DAC_DISABLE, 1
037E 9A5006----     R      457                             CALL FAR PTR BCD_UPDATE
0383 C706B1000000          458                             MOV DS:DAC_DISABLE, 0
0389 C606790013            459                             MOV DS:REG_AL, 19
038E EB0190                460                             JMP UPDATE_7SEG2
                           461                             
0391 E9DE00                462     UPDATE_7SEG2: JMP UPDATE_7SEG
                           463     
0394                       464     LANG_TOGGLE:
0394 803E790012            465                             CMP DS:REG_AL, 18
0399 7537                  466                             JNE QTY_PROMPT
039B 833EB50001            467                             CMP DS:LANG_FLAG, 1
03A0 75EF                  468                             JNE UPDATE_7SEG2
03A2 A16400                469                             MOV AX, DS:DAC_BASE
03A5 3D0040                470                             CMP AX, 4000H
03A8 7406                  471                             JE MANDRIN
03AA B80040                472                             MOV AX, 4000H
03AD EB0490                473                             JMP SEND_TOGGLE
03B0                       474             MANDRIN:
03B0 B80066                475                             MOV AX, 6600H
03B3                       476             SEND_TOGGLE:
03B3 A36400                477                             MOV DS:DAC_BASE, AX
03B6 BB0000                478                             MOV BX, 0
03B9 C6878D0021            479                             MOV DS:SEND_BUFFER[BX], '!'
03BE 43                    480                             INC BX
03BF C6878D002F            481                             MOV DS:SEND_BUFFER[BX], '/'
03C4 C706A1000200          482                             MOV DS:SEND_BUFFER_LEN, 2
03CA C6068C0001            483                             MOV DS:SEND_FLAG, 1
03CF E9A000                484                             JMP UPDATE_7SEG
03D2                       485     QTY_PROMPT:
03D2 803E790016            486                             CMP DS:REG_AL, 22
03D7 7527                  487                             JNE QUANTITY
03D9 833ECF0001            488                             CMP DS:CASH_FLAG, 1
03DE 7420                  489                             JE QUANTITY
03E0 833E610008            490                             CMP DS:KEYPAD_INDEX, 8
03E5 7519                  491                             JNE  QUANTITY
                           492                             ; CMP DS:MAX_INPUT_SIZE, 8
                           493                             ; JNE QUANTITY
03E7 9A6F05----     R      494                             CALL FAR PTR UPDATE_SEND_BUFFER
03EC 9A2506----     R      495                             CALL FAR PTR BCD_CLEAR
03F1 C706A3000200          496                             MOV DS:MAX_INPUT_SIZE, 2
03F7 C706A5000100          497                             MOV DS:QTY_FLAG, 1
03FD EB7390                498                             JMP UPDATE_7SEG
                           499                     
0400                       500     QUANTITY:
0400 833E610000            501                             CMP DS:KEYPAD_INDEX, 0
0405 746B                  502                             JE  UPDATE_7SEG
                           503                             
0407 803E79000E            504                             CMP DS:REG_AL, 14
040C 7564                  505                             JNE UPDATE_7SEG
                           506                             
040E 833EFF0001            507                             CMP DS:TROLLEY_ID, 1
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:37:07  12/08/;3  PAGE   11


LOC  OBJ                  LINE     SOURCE

0413 752C                  508                             JNE NORMAL_UPDATE
                           509                             
0415 833E610006            510                             CMP DS:KEYPAD_INDEX, 6
041A 7525                  511                             JNE NORMAL_UPDATE
                           512                             
041C 9AB004----     R      513                             CALL FAR PTR UPDATE_TROLLEY_ID
                           514                             
0421 C706FF000000          515                             MOV DS:TROLLEY_ID, 0
0427 C6068C0001            516                             MOV DS:SEND_FLAG, 1
042C C706F1000000          517                             MOV DS:DATA_ENTER, 0
0432 C706ED000000          518                             MOV DS:CANCEL_FLAG, 0
0438 C706CF000100          519                             MOV DS:CASH_FLAG, 1
                           520                             
043E EB3290                521                             JMP UPDATE_7SEG
                           522                             
0441                       523                     NORMAL_UPDATE:  
0441 833EA50001            524                             CMP DS:QTY_FLAG, 1
0446 752A                  525                             JNE UPDATE_7SEG
                           526                             
0448 C706F1000000          527                             MOV DS:DATA_ENTER, 0
                           528                             
044E C706ED000000          529                             MOV DS:CANCEL_FLAG, 0
                           530                     
0454 9A1E05----     R      531                             CALL FAR PTR UPDATE_THE_QUANTITY
                           532                             
0459 C70601010100          533                             MOV DS:TROLLEY_DISABLED, 1
045F C6068C0001            534                             MOV DS:SEND_FLAG, 1
                           535                             
0464 C706A5000000          536                             MOV DS:QTY_FLAG, 0
046A 9A2506----     R      537                             CALL FAR PTR BCD_CLEAR
046F EB0190                538                             JMP UPDATE_7SEG
                           539                             
                           540     
0472                       541     UPDATE_7SEG:
0472 803E790009            542                             CMP DS:REG_AL, 9
0477 7F0C                  543                             JG SET_PRESS_FLAG
                           544                             
0479 833EF10001            545                             CMP DS:DATA_ENTER, 1
047E 7505                  546                             JNE SET_PRESS_FLAG
                           547                             
0480 9A5006----     R      548                             CALL FAR PTR BCD_UPDATE
                           549                             
0485                       550     SET_PRESS_FLAG:
0485 C6067D0001            551                             MOV DS:LONG_PRESS_FLAG, 1
048A EB1F90                552                             JMP RETURN
                           553             
048D                       554     KEYPAD_2: 
048D 800679000F            555                 ADD DS:REG_AL,0FH
0492 E9F7FB                556                             JMP NXTCOL
0495 C606790000            557     ZERO_PRINT: MOV DS:REG_AL,00H
049A E9EFFB                558                             JMP NXTCOL
049D 802E790006            559     SUBTRACT:   SUB DS:REG_AL,06H
04A2 8ADD                  560                             MOV BL,CH
04A4 FE0E7A00              561                             DEC DS:REG_BH
04A8 E9C5FB                562                             JMP NXTROW
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:37:07  12/08/;3  PAGE   12


LOC  OBJ                  LINE     SOURCE

                           563             
                           564             
04AB                       565     RETURN:
04AB 5A                    566                             POP DX
04AC 59                    567                             POP CX
04AD 5B                    568                             POP BX
04AE 58                    569                             POP AX
04AF CB                    570                             RET
                           571     
                           572     KEYPAD_LOOP ENDP
                           573     
04B0                       574     UPDATE_TROLLEY_ID PROC FAR
04B0 50                    575     PUSH AX
04B1 53                    576     PUSH BX
04B2 51                    577     PUSH CX
04B3 52                    578     PUSH DX
04B4 BB0000                579             MOV BX, 0
04B7 C6878D005E            580             MOV DS:SEND_BUFFER[BX], '^'
04BC B90600                581             MOV CX, 6
04BF                       582             UPDATE_TROLLEY_BUFFER:
04BF BB0600                583                     MOV BX, 6
04C2 2BD9                  584                     SUB BX, CX
                           585                     
04C4 8A4751                586                     MOV AL, DS:KEYPAD_INPUT[BX]
                           587                     
04C7 43                    588                     INC BX
04C8 0430                  589                     ADD AL, 30H
04CA 88878D00              590                     MOV DS:SEND_BUFFER[BX], AL
04CE E2EF                  591             LOOP UPDATE_TROLLEY_BUFFER
                           592             
04D0 BB0700                593             MOV BX, 7
04D3 C6878D002F            594             MOV DS:SEND_BUFFER[BX], '/'
                           595             
04D8 C706A1000800          596             MOV DS:SEND_BUFFER_LEN, 8
                           597     
04DE 5A                    598     POP DX
04DF 59                    599     POP CX
04E0 5B                    600     POP BX
04E1 58                    601     POP AX
04E2 CB                    602     RET
                           603     UPDATE_TROLLEY_ID ENDP
                           604     
04E3                       605     CLEAR_TEMP_BCD PROC FAR
04E3 50                    606     PUSH AX
04E4 53                    607     PUSH BX
04E5 51                    608     PUSH CX
04E6 52                    609     PUSH DX
                           610     
04E7 BB0000                611             MOV BX, 0
04EA C687C1002D            612             MOV DS:TEMP_BCD_ARR[BX], '-'
04EF 43                    613             INC BX
04F0 C687C1002D            614             MOV DS:TEMP_BCD_ARR[BX], '-'
04F5 43                    615             INC BX
04F6 C687C1002D            616             MOV DS:TEMP_BCD_ARR[BX], '-'
04FB 43                    617             INC BX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:37:07  12/08/;3  PAGE   13


LOC  OBJ                  LINE     SOURCE

04FC C687C1002D            618             MOV DS:TEMP_BCD_ARR[BX], '-'
0501 43                    619             INC BX
0502 C687C1002D            620             MOV DS:TEMP_BCD_ARR[BX], '-'
0507 43                    621             INC BX
0508 C687C1002D            622             MOV DS:TEMP_BCD_ARR[BX], '-'
050D 43                    623             INC BX
050E C687C1002D            624             MOV DS:TEMP_BCD_ARR[BX], '-'
0513 43                    625             INC BX
0514 C687C1002D            626             MOV DS:TEMP_BCD_ARR[BX], '-'
                           627             
0519 5A                    628     POP DX
051A 59                    629     POP CX
051B 5B                    630     POP BX
051C 58                    631     POP AX
051D CB                    632     RET
                           633     CLEAR_TEMP_BCD ENDP
                           634     
                           635     
051E                       636     UPDATE_THE_QUANTITY PROC FAR
051E 50                    637     PUSH AX
051F 53                    638     PUSH BX
0520 51                    639     PUSH CX
0521 52                    640     PUSH DX
0522 8B0E6100              641             MOV CX, DS:KEYPAD_INDEX
0526 BB0000                642             MOV BX, 0
0529 BA0000                643             MOV DX, 0
052C                       644             UPD_QTY:
052C A1B900                645                     MOV AX, DS:QTY
052F 53                    646                     PUSH BX
0530 BB0A00                647                     MOV BX, 10
0533 F7E3                  648                     MUL BX
0535 5B                    649                     POP BX
0536 8A5751                650                     MOV DL, DS:KEYPAD_INPUT[BX]
0539 03C2                  651                     ADD AX, DX
053B A3B900                652                     MOV DS:QTY, AX
053E 43                    653                     INC BX
053F E2EB                  654             LOOP UPD_QTY
                           655             
0541 8B0E6100              656             MOV CX, DS:KEYPAD_INDEX
0545 8B1EA100              657             MOV BX, DS:SEND_BUFFER_LEN
                           658             
0549                       659             UPD_BUFFER:
0549 53                    660                     PUSH BX
054A 8B1E6100              661                     MOV BX, DS:KEYPAD_INDEX
054E 2BD9                  662                     SUB BX, CX
0550 8A4751                663                     MOV AL, DS:KEYPAD_INPUT[BX]
0553 5B                    664                     POP BX
0554 0430                  665                     ADD AL, 30H
0556 88878D00              666                     MOV DS:SEND_BUFFER[BX], AL
                           667                     
055A 43                    668                     INC BX
055B FF06A100              669                     INC DS:SEND_BUFFER_LEN
055F E2E8                  670             LOOP UPD_BUFFER
                           671             
0561 C6878D002F            672             MOV DS:SEND_BUFFER[BX], '/'
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:37:07  12/08/;3  PAGE   14


LOC  OBJ                  LINE     SOURCE

0566 FF06A100              673             INC DS:SEND_BUFFER_LEN
                           674                     
056A 5A                    675     POP DX
056B 59                    676     POP CX
056C 5B                    677     POP BX
056D 58                    678     POP AX
                           679     
056E CB                    680     RET
                           681     UPDATE_THE_QUANTITY ENDP
                           682     
056F                       683     UPDATE_SEND_BUFFER PROC FAR
056F 50                    684     PUSH AX
0570 53                    685     PUSH BX
0571 51                    686     PUSH CX
0572 52                    687     PUSH DX
                           688     
0573 8B0E6100              689             MOV CX, DS:KEYPAD_INDEX
0577 83F900                690             CMP CX, 0
057A 7435                  691             JE END_UPD_BUFFER
057C 83C102                692             ADD CX, 2
057F 890EA100              693             MOV DS:SEND_BUFFER_LEN, CX
0583 BB0000                694             MOV BX, 0
0586                       695             BUFFER_LOOP:
0586 83FB00                696                     CMP BX, 0
0589 7508                  697                     JNE ASTERISK
058B C6878D007E            698                     MOV DS:SEND_BUFFER[BX], '~'
0590 EB1C90                699                     JMP END_BUFFER
0593                       700             ASTERISK:
0593 A16100                701                     MOV AX, DS:KEYPAD_INDEX
0596 40                    702                     INC AX
0597 3BD8                  703                     CMP BX, AX
0599 7508                  704                     JNE CONT
059B C6878D002A            705                     MOV DS:SEND_BUFFER[BX], '*'
05A0 EB0C90                706                     JMP END_BUFFER
05A3                       707             CONT:
05A3 4B                    708                     DEC BX
05A4 8A4751                709                     MOV AL, DS:KEYPAD_INPUT[BX]
05A7 0430                  710                     ADD AL, 30H
05A9 43                    711                     INC BX
05AA 88878D00              712                     MOV DS:SEND_BUFFER[BX], AL
                           713                     
05AE                       714             END_BUFFER:
05AE 43                    715                     INC BX
05AF E2D5                  716             LOOP BUFFER_LOOP
05B1                       717     END_UPD_BUFFER:
05B1 5A                    718     POP DX
05B2 59                    719     POP CX
05B3 5B                    720     POP BX
05B4 58                    721     POP AX
05B5 CB                    722     RET
                           723     UPDATE_SEND_BUFFER ENDP
                           724     
05B6                       725     BCD_BACKSPACE PROC FAR
                           726     
05B6 50                    727     PUSH AX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:37:07  12/08/;3  PAGE   15


LOC  OBJ                  LINE     SOURCE

05B7 53                    728     PUSH BX
05B8 51                    729     PUSH CX
05B9 52                    730     PUSH DX
                           731     
05BA 8A167900              732             MOV DL, DS:REG_AL
05BE 833E610000            733             CMP DS:KEYPAD_INDEX, 0
05C3 7457                  734             JE RETURN_BACK
                           735             
05C5 BB0600                736             MOV BX, 6
05C8                       737             BCD_CLEAR_LOOP:
05C8 4B                    738                     DEC BX
05C9 C647592D              739                     MOV DS:BCD_MESSAGE[BX], '-'
05CD 43                    740                     INC BX
05CE 4B                    741                     DEC BX
05CF 75F7                  742             JNZ BCD_CLEAR_LOOP
                           743             
05D1 833E610001            744             CMP DS:KEYPAD_INDEX, 1
05D6 7E2C                  745             JLE less_than_two
                           746             
05D8 FF0E6100              747             DEC DS:KEYPAD_INDEX
05DC FF0E6100              748             DEC DS:KEYPAD_INDEX
05E0 8B1E6100              749             MOV BX, DS:KEYPAD_INDEX
05E4 8A4751                750             MOV AL, DS:KEYPAD_INPUT[BX]
05E7 A27900                751             MOV DS:REG_AL, AL
05EA C706AF000000          752             MOV DS:SCROLL_LEN, 0
05F0 C706B1000100          753             MOV DS:DAC_DISABLE, 1
05F6 9A5006----     R      754             CALL FAR PTR BCD_UPDATE
05FB C706B1000000          755             MOV DS:DAC_DISABLE, 0
0601 EB1990                756             JMP RETURN_BACK
                           757             
0604                       758     less_than_two:
0604 FF0E6100              759             DEC DS:KEYPAD_INDEX
0608 C60679002D            760             MOV DS:REG_AL, '-'
060D C706AF000000          761             MOV DS:SCROLL_LEN, 0
0613 9A5006----     R      762             CALL FAR PTR BCD_UPDATE
0618 FF0E6100              763             DEC DS:KEYPAD_INDEX
                           764             
061C                       765     RETURN_BACK:
061C 88167900              766             MOV DS:REG_AL, DL
0620 5A                    767     POP DX
0621 59                    768     POP CX
0622 5B                    769     POP BX
0623 58                    770     POP AX
                           771     
0624 CB                    772     RET
                           773     BCD_BACKSPACE ENDP
                           774     
0625                       775     BCD_CLEAR PROC FAR
0625 50                    776     PUSH AX
0626 53                    777     PUSH BX
0627 51                    778     PUSH CX
0628 52                    779     PUSH DX
0629 BB0800                780             MOV BX, 8
062C                       781             CLEAR_LOOP:
062C C6475100              782             MOV DS:KEYPAD_INPUT[BX], 0
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:37:07  12/08/;3  PAGE   16


LOC  OBJ                  LINE     SOURCE

0630 4B                    783             DEC BX
0631 75F9                  784             JNZ CLEAR_LOOP
                           785             
0633 BB0600                786             MOV BX, 6
0636                       787             CLEAR_LOOP2:
0636 4B                    788                     DEC BX
0637 C647592D              789                     MOV DS:BCD_MESSAGE[BX], '-'
063B 43                    790                     INC BX
063C 4B                    791                     DEC BX
063D 75F7                  792             JNZ CLEAR_LOOP2
                           793     
063F C70661000000          794             MOV DS:KEYPAD_INDEX, 0
0645 C706AF000000          795             MOV DS:SCROLL_LEN, 0
064B 5A                    796     POP DX
064C 59                    797     POP CX
064D 5B                    798     POP BX
064E 58                    799     POP AX
064F CB                    800     RET
                           801     BCD_CLEAR ENDP
                           802     
0650                       803     BCD_UPDATE PROC FAR
0650 50                    804     PUSH AX
0651 53                    805     PUSH BX
0652 51                    806     PUSH CX
0653 52                    807     PUSH DX
0654 A1A300                808                     MOV AX, DS:MAX_INPUT_SIZE
0657 39066100              809                     CMP DS:KEYPAD_INDEX, AX
065B 7D5A                  810                     JGE BCD_RET
                           811                     
065D 8A0E7900              812                     MOV CL, DS:REG_AL
0661 80F909                813                     CMP CL, 9
0664 7F0C                  814                     JG SKIP_PAST
0666 833EB10001            815                     CMP DS:DAC_DISABLE, 1
066B 7405                  816                     JE SKIP_PAST
066D 9ABC06----     R      817                     CALL FAR PTR DAC_UPDATE
                           818     
0672                       819     SKIP_PAST:              
0672 8A0E7900              820                     MOV CL, DS:REG_AL
                           821     
0676 8B1E6100              822                     MOV BX, DS:KEYPAD_INDEX
                           823                             
067A 884F51                824                     MOV DS:KEYPAD_INPUT[BX], CL
                           825                             
067D FF066100              826                     INC DS:KEYPAD_INDEX
                           827                             
0681 8B1E6100              828                     MOV BX, DS:KEYPAD_INDEX
                           829                     
0685 A1AF00                830                     MOV AX, DS:SCROLL_LEN
0688 2BD8                  831                     SUB BX, AX
                           832                     
068A 8B166100              833                     MOV DX, DS:KEYPAD_INDEX
068E 83FA06                834                     CMP DX, 6
0691 7E03                  835                     JLE update_display
0693 BA0600                836                     MOV DX, 6
                           837                     
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:37:07  12/08/;3  PAGE   17


LOC  OBJ                  LINE     SOURCE

0696                       838             update_display:
                           839             
0696 B90500                840                     MOV CX, 5
0699 4B                    841                     DEC BX
069A 8A4751                842                     MOV AL, DS:KEYPAD_INPUT[BX]
069D 43                    843                     INC BX
                           844                             
069E 52                    845                     PUSH DX
069F 8B166100              846                     MOV DX, DS:KEYPAD_INDEX
06A3 2B16AF00              847                     SUB DX, DS:SCROLL_LEN
                           848                     
06A7 2BD3                  849                     SUB DX, BX
                           850                             
06A9 53                    851                     PUSH BX
                           852                             
06AA 2BCA                  853                     SUB CX, DX
06AC 8BD9                  854                     MOV BX, CX
06AE 884759                855                     MOV DS:BCD_MESSAGE[BX], AL
                           856                             
06B1 5B                    857                     POP BX
06B2 5A                    858                     POP DX
                           859             
06B3 4B                    860                     DEC BX
06B4 4A                    861                     DEC DX
06B5 75DF                  862             JNZ update_display
                           863     
06B7                       864             BCD_RET:
06B7 5A                    865                     POP DX
06B8 59                    866                     POP CX
06B9 5B                    867                     POP BX
06BA 58                    868                     POP AX
06BB CB                    869     RET
                           870     BCD_UPDATE ENDP
                           871     
06BC                       872     DAC_UPDATE PROC FAR
06BC 50                    873             PUSH AX
06BD 53                    874             PUSH BX
06BE 51                    875             PUSH CX
06BF 52                    876             PUSH DX
                           877             
06C0 BB0000                878             MOV BX, 0
06C3 8A1E7500              879             MOV BL, DS:DAC_LEN
06C7 A07900                880             MOV AL, DS:REG_AL
                           881             
06CA 884766                882             MOV DS:DAC_ADDR[BX], AL
                           883             
06CD FE067500              884             INC DS:DAC_LEN
                           885     
06D1 5A                    886             POP DX
06D2 59                    887             POP CX
06D3 5B                    888             POP BX
06D4 58                    889             POP AX
06D5 CB                    890     RET
                           891     DAC_UPDATE ENDP
                           892               
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:37:07  12/08/;3  PAGE   18


LOC  OBJ                  LINE     SOURCE

06D6                       893     DEBOUNCE PROC FAR
06D6 51                    894                       PUSH CX
                           895                       
06D7 B94C09                896                       MOV CX, 094CH
06DA 90                    897     BACK:     NOP
06DB E2FD                  898                       LOOP BACK
06DD 59                    899                       POP CX
06DE CB                    900                       RET
                           901     DEBOUNCE  ENDP
                           902     
06DF                       903     SEND_INPUT PROC FAR
06DF 50                    904     PUSH AX
06E0 53                    905     PUSH BX
06E1 51                    906     PUSH CX
06E2 52                    907     PUSH DX
06E3 BB0000                908             MOV BX, 0
06E6 8B0EA100              909             MOV CX, DS:SEND_BUFFER_LEN
                           910             
06EA                       911             S_BUFF:
06EA 8A878D00              912                     MOV AL, DS:SEND_BUFFER[BX]
06EE 9A0000----     E      913                     CALL FAR PTR PRINT_CHAR
06F3 43                    914                     INC BX
06F4 E2F4                  915             LOOP S_BUFF
                           916             
06F6                       917     SEND_INPUT_END:
06F6 5A                    918     POP DX
06F7 59                    919     POP CX
06F8 5B                    920     POP BX
06F9 58                    921     POP AX
06FA CB                    922     RET
                           923     SEND_INPUT ENDP
                           924     
06FB                       925     TAKE_CASH PROC FAR
06FB 50                    926     PUSH AX
06FC 53                    927     PUSH BX
06FD 51                    928     PUSH CX
06FE 52                    929     PUSH DX
                           930             
06FF B90000                931             MOV CX, 0
0702 B108                  932             MOV CL, 8
0704                       933             CLEAR_CASH_AMT:
0704 8BD9                  934                     MOV BX, CX
0706 4B                    935                     DEC BX
0707 C687D10000            936                     MOV DS:CASH_AMT[BX], 0
070C E2F6                  937             LOOP CLEAR_CASH_AMT
                           938             
070E 8B0E6100              939             MOV CX, DS:KEYPAD_INDEX
0712 BA0600                940             MOV DX, 6
                           941             
0715                       942             UPDATE_CASH_AMT:
0715 8BD9                  943                     MOV BX, CX
0717 4B                    944                     DEC BX
                           945                     
0718 33C0                  946                     XOR AX, AX
071A 8A4751                947                     MOV AL, DS:KEYPAD_INPUT[BX]
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:37:07  12/08/;3  PAGE   19


LOC  OBJ                  LINE     SOURCE

                           948                     
071D 8BDA                  949                     MOV BX, DX
071F 4B                    950                     DEC BX
0720 8887D100              951                     MOV DS:CASH_AMT[BX], AL
                           952                     
0724 4A                    953                     DEC DX
0725 E2EE                  954             LOOP UPDATE_CASH_AMT
                           955             
0727 C706E9000100          956             MOV DS:CASH_OK_FLAG, 1
072D C706EB000700          957             MOV DS:BORROW_POSITION, 7
0733 B90800                958             MOV CX, 8
0736                       959             CHECK_CASH:
0736 BB0800                960                     MOV BX, 8
0739 2BD9                  961                     SUB BX, CX
073B B80000                962                     MOV AX, 0
073E 8A87C100              963                     MOV AL, DS:TEMP_BCD_ARR[BX]
0742 8A97D100              964                     MOV DL, DS:CASH_AMT[BX]
0746 3AD0                  965                     CMP DL, AL
0748 741A                  966                     JE NEXT_CASH_DIGIT
                           967                     
074A 3AD0                  968                     CMP DL, AL
074C 7C0D                  969                     JL CASH_NOT_OK
                           970                     
074E C706E9000100          971                     MOV DS:CASH_OK_FLAG, 1
0754 891EEB00              972                     MOV DS:BORROW_POSITION, BX
                           973                     
0758 EB0C90                974                     JMP CHEK_CASH_DONE
                           975                     
075B                       976                     CASH_NOT_OK:
075B C706E9000000          977                     MOV DS:CASH_OK_FLAG, 0
0761 EB0390                978                     JMP CHEK_CASH_DONE
                           979                     
0764                       980             NEXT_CASH_DIGIT:
0764 E2D0                  981             LOOP CHECK_CASH
                           982             
0766                       983     CHEK_CASH_DONE:
                           984             
0766 833EE90001            985             CMP DS:CASH_OK_FLAG, 1
076B 7464                  986             JE CONTINUE_CASH
076D B90800                987             MOV CX, 8
0770 C70661000000          988             MOV DS:KEYPAD_INDEX, 0
0776 C706B3000300          989             MOV DS:DECIMAL_INDEX, 3
077C                       990             RETAIN_BCD:
077C BB0800                991                     MOV BX, 8
077F 2BD9                  992                     SUB BX, CX
                           993                     
0781 8A87C100              994                     MOV AL, DS:TEMP_BCD_ARR[BX]
0785 A27900                995                     MOV DS:REG_AL, AL
                           996                     
0788 C706B1000100          997                     MOV DS:DAC_DISABLE, 1
078E 9A5006----     R      998                     CALL FAR PTR BCD_UPDATE
0793 C706B1000000          999                     MOV DS:DAC_DISABLE, 0
0799 E2E1                 1000             LOOP RETAIN_BCD
079B 813E64000040         1001             CMP DS:DAC_BASE, 4000H
07A1 7517                 1002             JNE MANDARIN_CASH
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:37:07  12/08/;3  PAGE   20


LOC  OBJ                  LINE     SOURCE

                          1003             
07A3 C606790023           1004             MOV DS:REG_AL, 35
07A8 9ABC06----     R     1005             CALL FAR PTR DAC_UPDATE
07AD C606790024           1006             MOV DS:REG_AL, 36
07B2 9ABC06----     R     1007             CALL FAR PTR DAC_UPDATE
07B7 E9B200               1008             JMP CASH_OVER
                          1009             
07BA                      1010     MANDARIN_CASH:
07BA C606790013           1011             MOV DS:REG_AL, 19
07BF 9ABC06----     R     1012             CALL FAR PTR DAC_UPDATE
07C4 C606790014           1013             MOV DS:REG_AL, 20
07C9 9ABC06----     R     1014             CALL FAR PTR DAC_UPDATE
07CE E99B00               1015             JMP CASH_OVER
                          1016             
07D1                      1017     CONTINUE_CASH:
07D1 8B1EEB00             1018             MOV BX, DS:BORROW_POSITION
07D5 B90700               1019             MOV CX, 7
07D8 2BCB                 1020             SUB CX, BX
07DA 83F900               1021             CMP CX, 0
07DD 740C                 1022             JE BEGIN_SUB
                          1023             
07DF                      1024             ADJUST_PLACES:
07DF FE8FD100             1025                     DEC DS:CASH_AMT[BX]
07E3 43                   1026                     INC BX
07E4 8087D1000A           1027                     ADD DS:CASH_AMT[BX], 10
07E9 E2F4                 1028             LOOP ADJUST_PLACES
                          1029             
07EB                      1030     BEGIN_SUB:
07EB B90800               1031             MOV CX, 8
07EE                      1032             CALC_CHANGE:
07EE BB0800               1033                     MOV BX, 8
07F1 2BD9                 1034                     SUB BX, CX
07F3 B80000               1035                     MOV AX, 0
07F6 8A87D100             1036                     MOV AL, DS:CASH_AMT[BX]
07FA BA0000               1037                     MOV DX, 0
07FD 8A97C100             1038                     MOV DL, DS:TEMP_BCD_ARR[BX]
0801 2BC2                 1039                     SUB AX, DX
0803 8987D900             1040                     MOV DS:TEMP_CASH_ARR[BX], AX
0807 E2E5                 1041             LOOP CALC_CHANGE
                          1042             
0809 B90800               1043             MOV CX, 8
080C                      1044             FIX_DIGITS:
080C 8BD9                 1045             MOV BX, CX
080E 4B                   1046             DEC BX
                          1047             
080F 8B87D900             1048             MOV AX, DS:TEMP_CASH_ARR[BX]
0813 3C0A                 1049             CMP AL, 10
0815 7C0A                 1050             JL NEXT_DIGIT_TO_FIX
                          1051             
0817 83AFD9000A           1052             SUB DS:TEMP_CASH_ARR[BX], 10
                          1053             
081C 4B                   1054             DEC BX
081D FF87D900             1055             INC DS:TEMP_CASH_ARR[BX]
                          1056             
0821                      1057             NEXT_DIGIT_TO_FIX:
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:37:07  12/08/;3  PAGE   21


LOC  OBJ                  LINE     SOURCE

                          1058             
0821 E2E9                 1059             LOOP FIX_DIGITS
                          1060             
0823 B90800               1061             MOV CX, 8
0826 C70661000000         1062             MOV DS:KEYPAD_INDEX, 0
082C C706B3000300         1063             MOV DS:DECIMAL_INDEX, 3
0832                      1064             UPDATE_BCD_TO_CASH:
0832 BB0800               1065                     MOV BX, 8
0835 2BD9                 1066                     SUB BX, CX
0837 8B87D900             1067                     MOV AX, DS:TEMP_CASH_ARR[BX]
083B 8887C100             1068                     MOV DS:TEMP_BCD_ARR[BX], AL
083F A27900               1069                     MOV DS:REG_AL, AL
0842 C706B1000100         1070                     MOV DS:DAC_DISABLE, 1
0848 9A5006----     R     1071                     CALL FAR PTR BCD_UPDATE
084D C706B1000000         1072                     MOV DS:DAC_DISABLE, 0
0853 E2DD                 1073             LOOP UPDATE_BCD_TO_CASH
                          1074             
0855 9A7108----     R     1075             CALL FAR PTR CALC_DAC
                          1076             
085A C706CF000000         1077             MOV DS:CASH_FLAG, 0
0860 C706EF000100         1078             MOV DS:TRANSACTION_OVER, 1
0866 C70601010000         1079             MOV DS:TROLLEY_DISABLED, 0
                          1080             
086C                      1081     CASH_OVER:
086C 5A                   1082     POP DX
086D 59                   1083     POP CX
086E 5B                   1084     POP BX
086F 58                   1085     POP AX
                          1086     
0870 CB                   1087     RET
                          1088     TAKE_CASH ENDP
                          1089     
0871                      1090     CALC_DAC PROC FAR
0871 50                   1091     PUSH AX
0872 53                   1092     PUSH BX
0873 51                   1093     PUSH CX
0874 52                   1094     PUSH DX
0875 813E64000040         1095             CMP DS:DAC_BASE, 4000H
087B 7403                 1096             JE ENGLISH_DAC
087D E98E01               1097             JMP MANDARIN_DAC
                          1098             
0880                      1099     ENGLISH_DAC:
0880 C706CB000000         1100             MOV DS:CENT_FLAG, 0
0886 C706C9000000         1101             MOV DS:THOUSAND_FLAG, 0
088C C706CD000000         1102             MOV DS:DOLLAR_FLAG,     0
0892 BB0000               1103             MOV BX, 0
0895 8A87C100             1104             MOV AL, DS:TEMP_BCD_ARR[BX]
0899 A27900               1105             MOV DS:REG_AL, AL
089C 3C00                 1106             CMP AL, 0
089E 7415                 1107             JE NEXT_PLACE
08A0 C706CD000100         1108             MOV DS:DOLLAR_FLAG, 1
08A6 9ABC06----     R     1109             CALL FAR PTR DAC_UPDATE
08AB C60679001C           1110             MOV DS:REG_AL, 28
08B0 9ABC06----     R     1111             CALL FAR PTR DAC_UPDATE
                          1112             
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:37:07  12/08/;3  PAGE   22


LOC  OBJ                  LINE     SOURCE

08B5                      1113     NEXT_PLACE:     
08B5 43                   1114             INC BX
08B6 8A87C100             1115             MOV AL, DS:TEMP_BCD_ARR[BX]
08BA 3C01                 1116             CMP AL, 1
08BC 751E                 1117             JNE NOT_1
08BE C706CD000100         1118             MOV DS:DOLLAR_FLAG, 1
08C4 43                   1119             INC BX
08C5 8A87C100             1120             MOV AL, DS:TEMP_BCD_ARR[BX]
08C9 040A                 1121             ADD AL, 10
08CB A27900               1122             MOV DS:REG_AL, AL
08CE 9ABC06----     R     1123             CALL FAR PTR DAC_UPDATE
08D3 C706C9000100         1124             MOV DS:THOUSAND_FLAG, 1
08D9 EB3890               1125             JMP HUNDREDS_PLACE
08DC                      1126     NOT_1:
08DC 3C00                 1127             CMP AL, 0
08DE 7416                 1128             JE NEXT_PLACE_1
08E0 C706CD000100         1129             MOV DS:DOLLAR_FLAG, 1
08E6 C706C9000100         1130             MOV DS:THOUSAND_FLAG, 1
08EC 0412                 1131             ADD AL, 18
08EE A27900               1132             MOV DS:REG_AL, AL
08F1 9ABC06----     R     1133             CALL FAR PTR DAC_UPDATE
08F6                      1134     NEXT_PLACE_1:
08F6 43                   1135             INC BX
08F7 8A87C100             1136             MOV AL, DS:TEMP_BCD_ARR[BX]
08FB 3C00                 1137             CMP AL, 0
08FD 7414                 1138             JE HUNDREDS_PLACE
08FF C706CD000100         1139             MOV DS:DOLLAR_FLAG, 1
0905 C706C9000100         1140             MOV DS:THOUSAND_FLAG, 1
090B A27900               1141             MOV DS:REG_AL, AL
090E 9ABC06----     R     1142             CALL FAR PTR DAC_UPDATE
                          1143     
0913                      1144     HUNDREDS_PLACE:
0913 833EC90000           1145             CMP DS:THOUSAND_FLAG, 0
0918 7410                 1146             JE NEXT_PLACE_2
091A C60679001D           1147             MOV DS:REG_AL, 29
091F 9ABC06----     R     1148             CALL FAR PTR DAC_UPDATE
0924 C706C9000000         1149             MOV DS:THOUSAND_FLAG, 0
                          1150             
092A                      1151     NEXT_PLACE_2:
092A 43                   1152             INC BX
092B 8A87C100             1153             MOV AL, DS:TEMP_BCD_ARR[BX]
092F 3C00                 1154             CMP AL, 0
0931 7418                 1155             JE NEXT_PLACE_3
0933 C706CD000100         1156             MOV DS:DOLLAR_FLAG, 1
0939 A27900               1157             MOV DS:REG_AL, AL
093C 9ABC06----     R     1158             CALL FAR PTR DAC_UPDATE
0941 C60679001C           1159             MOV DS:REG_AL, 28
0946 9ABC06----     R     1160             CALL FAR PTR DAC_UPDATE
                          1161             
094B                      1162     NEXT_PLACE_3:   
094B 43                   1163             INC BX
094C 8A87C100             1164             MOV AL, DS:TEMP_BCD_ARR[BX]
0950 3C01                 1165             CMP AL, 1
0952 7518                 1166             JNE NOT_1_2
0954 C706CD000100         1167             MOV DS:DOLLAR_FLAG, 1
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:37:07  12/08/;3  PAGE   23


LOC  OBJ                  LINE     SOURCE

095A 43                   1168             INC BX
095B 8A87C100             1169             MOV AL, DS:TEMP_BCD_ARR[BX]
095F 040A                 1170             ADD AL, 10
0961 A27900               1171             MOV DS:REG_AL, AL
0964 9ABC06----     R     1172             CALL FAR PTR DAC_UPDATE
0969 EB2C90               1173             JMP DECIMAL_DAC
096C                      1174     NOT_1_2:
096C 3C00                 1175             CMP AL, 0
096E 7410                 1176             JE NEXT_PLACE_4
0970 C706CD000100         1177             MOV DS:DOLLAR_FLAG, 1
0976 0412                 1178             ADD AL, 18
0978 A27900               1179             MOV DS:REG_AL, AL
097B 9ABC06----     R     1180             CALL FAR PTR DAC_UPDATE
0980                      1181     NEXT_PLACE_4:
0980 43                   1182             INC BX
0981 8A87C100             1183             MOV AL, DS:TEMP_BCD_ARR[BX]
0985 3C00                 1184             CMP AL, 0
0987 740E                 1185             JE DECIMAL_DAC
0989 C706CD000100         1186             MOV DS:DOLLAR_FLAG, 1
098F A27900               1187             MOV DS:REG_AL, AL
0992 9ABC06----     R     1188             CALL FAR PTR DAC_UPDATE
                          1189             
0997                      1190     DECIMAL_DAC:
0997 833ECD0000           1191             CMP DS:DOLLAR_FLAG, 0
099C 740A                 1192             JE DECIMAL_DAC_CONT
099E C60679001E           1193             MOV DS:REG_AL, 30
09A3 9ABC06----     R     1194             CALL FAR PTR DAC_UPDATE
                          1195             
09A8                      1196     DECIMAL_DAC_CONT:
09A8 43                   1197             INC BX
09A9 8A87C100             1198             MOV AL, DS:TEMP_BCD_ARR[BX]
09AD 3C01                 1199             CMP AL, 1
09AF 7518                 1200             JNE NOT_1_3
09B1 43                   1201             INC BX
09B2 C706CB000100         1202             MOV DS:CENT_FLAG, 1
09B8 8A87C100             1203             MOV AL, DS:TEMP_BCD_ARR[BX]
09BC 040A                 1204             ADD AL, 10
09BE A27900               1205             MOV DS:REG_AL, AL
09C1 9ABC06----     R     1206             CALL FAR PTR DAC_UPDATE
09C6 EB2C90               1207             JMP ENGLISH_END
                          1208             
09C9                      1209     NOT_1_3:
09C9 3C00                 1210             CMP AL, 0
09CB 7410                 1211             JE NEXT_PLACE_5
09CD C706CB000100         1212             MOV DS:CENT_FLAG, 1
09D3 0412                 1213             ADD AL, 18
09D5 A27900               1214             MOV DS:REG_AL, AL
09D8 9ABC06----     R     1215             CALL FAR PTR DAC_UPDATE
                          1216             
09DD                      1217     NEXT_PLACE_5:
09DD 43                   1218             INC BX
09DE 8A87C100             1219             MOV AL, DS:TEMP_BCD_ARR[BX]
09E2 3C00                 1220             CMP AL, 0
09E4 740E                 1221             JE ENGLISH_END
09E6 C706CB000100         1222             MOV DS:CENT_FLAG, 1
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:37:07  12/08/;3  PAGE   24


LOC  OBJ                  LINE     SOURCE

09EC A27900               1223             MOV DS:REG_AL, AL
09EF 9ABC06----     R     1224             CALL FAR PTR DAC_UPDATE
                          1225             
09F4                      1226     ENGLISH_END:
09F4 833ECB0000           1227             CMP DS:CENT_FLAG, 0
09F9 7410                 1228             JE ENGLISH_END2
09FB C60679001F           1229             MOV DS:REG_AL, 31
0A00 9ABC06----     R     1230             CALL FAR PTR DAC_UPDATE
0A05 C706CB000000         1231             MOV DS:CENT_FLAG, 0
0A0B                      1232     ENGLISH_END2:
0A0B E9CE01               1233             JMP CONT_BCD_UPD_1
                          1234             
0A0E                      1235     MANDARIN_DAC:
0A0E C706CB000000         1236             MOV DS:CENT_FLAG, 0
0A14 C706C9000000         1237             MOV DS:THOUSAND_FLAG, 0
0A1A C70603010000         1238             MOV DS:TEN_THOUSAND_FLAG, 0
0A20 C70605010000         1239             MOV DS:ZERO_TELL, 0
0A26 C706CD000000         1240             MOV DS:DOLLAR_FLAG,     0
0A2C BB0000               1241             MOV BX, 0
0A2F 8A87C100             1242             MOV AL, DS:TEMP_BCD_ARR[BX]
0A33 3C00                 1243             CMP AL, 0
0A35 7424                 1244             JE NEXT_PLACE_6
0A37 C706CD000100         1245             MOV DS:DOLLAR_FLAG, 1
0A3D C70603010100         1246             MOV DS:TEN_THOUSAND_FLAG, 1
0A43 C706C9000000         1247             MOV DS:THOUSAND_FLAG, 0
0A49 A27900               1248             MOV DS:REG_AL, AL
0A4C 9ABC06----     R     1249             CALL FAR PTR DAC_UPDATE
0A51 C60679000A           1250             MOV DS:REG_AL, 10
0A56 9ABC06----     R     1251             CALL FAR PTR DAC_UPDATE
                          1252             
0A5B                      1253     NEXT_PLACE_6:
0A5B 43                   1254             INC BX
0A5C 8A87C100             1255             MOV AL, DS:TEMP_BCD_ARR[BX]
0A60 3C00                 1256             CMP AL, 0
0A62 741A                 1257             JE NEXT_PLACE_7
0A64 C706CD000100         1258             MOV DS:DOLLAR_FLAG, 1
0A6A C70603010100         1259             MOV DS:TEN_THOUSAND_FLAG, 1
0A70 C706C9000000         1260             MOV DS:THOUSAND_FLAG, 0
0A76 A27900               1261             MOV DS:REG_AL, AL
0A79 9ABC06----     R     1262             CALL FAR PTR DAC_UPDATE
                          1263             
0A7E                      1264     NEXT_PLACE_7:
0A7E 833E030101           1265             CMP DS:TEN_THOUSAND_FLAG, 1
0A83 750A                 1266             JNE NO_TEN_THOUSAND
0A85 C60679000D           1267             MOV DS:REG_AL, 13
0A8A 9ABC06----     R     1268             CALL FAR PTR DAC_UPDATE
0A8F                      1269     NO_TEN_THOUSAND:
0A8F 43                   1270             INC BX
0A90 8A87C100             1271             MOV AL, DS:TEMP_BCD_ARR[BX]
0A94 3C00                 1272             CMP AL, 0
0A96 7509                 1273             JNE CONTINUE_MAND
0A98 C70605010100         1274             MOV DS:ZERO_TELL, 1
0A9E EB1590               1275             JMP NEXT_PLACE_8
0AA1                      1276     CONTINUE_MAND:  
0AA1 C706CD000100         1277             MOV DS:DOLLAR_FLAG, 1
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:37:07  12/08/;3  PAGE   25


LOC  OBJ                  LINE     SOURCE

0AA7 C706C9000100         1278             MOV DS:THOUSAND_FLAG, 1
                          1279     
0AAD A27900               1280             MOV DS:REG_AL, AL
0AB0 9ABC06----     R     1281             CALL FAR PTR DAC_UPDATE
                          1282     
0AB5                      1283     NEXT_PLACE_8:
0AB5 833EC90000           1284             CMP DS:THOUSAND_FLAG, 0
0ABA 7410                 1285             JE IGNORE_THOUSAND
0ABC C60679000C           1286             MOV DS:REG_AL, 12
0AC1 9ABC06----     R     1287             CALL FAR PTR DAC_UPDATE
0AC6 C706C9000000         1288             MOV DS:THOUSAND_FLAG, 0
                          1289             
0ACC                      1290     IGNORE_THOUSAND:
0ACC 43                   1291             INC BX
0ACD 8A87C100             1292             MOV AL, DS:TEMP_BCD_ARR[BX]
0AD1 3C00                 1293             CMP AL, 0
0AD3 7509                 1294             JNE CONTINUE_MAND1
0AD5 C70605010100         1295             MOV DS:ZERO_TELL, 1
0ADB EB3090               1296             JMP NEXT_PLACE_9
0ADE                      1297     CONTINUE_MAND1:
0ADE 833E050100           1298             CMP DS:ZERO_TELL, 0
0AE3 7410                 1299             JE DONT_ZERO
0AE5 C606790000           1300             MOV DS:REG_AL, 0
0AEA 9ABC06----     R     1301             CALL FAR PTR DAC_UPDATE
0AEF C70605010000         1302             MOV DS:ZERO_TELL, 0
0AF5                      1303     DONT_ZERO:
0AF5 C706CD000100         1304             MOV DS:DOLLAR_FLAG, 1
0AFB A27900               1305             MOV DS:REG_AL, AL
0AFE 9ABC06----     R     1306             CALL FAR PTR DAC_UPDATE
0B03 C60679000B           1307             MOV DS:REG_AL, 11
0B08 9ABC06----     R     1308             CALL FAR PTR DAC_UPDATE
                          1309             
0B0D                      1310     NEXT_PLACE_9:
0B0D 43                   1311             INC BX
0B0E 8A87C100             1312             MOV AL, DS:TEMP_BCD_ARR[BX]
0B12 3C00                 1313             CMP AL, 0
0B14 7509                 1314             JNE CONTINUE_MAND2
0B16 C70605010100         1315             MOV DS:ZERO_TELL, 1
0B1C EB3090               1316             JMP NEXT_PLACE_10
0B1F                      1317     CONTINUE_MAND2:
0B1F 833E050100           1318             CMP DS:ZERO_TELL, 0
0B24 7410                 1319             JE DONT_ZERO1
0B26 C606790000           1320             MOV DS:REG_AL, 0
0B2B 9ABC06----     R     1321             CALL FAR PTR DAC_UPDATE
0B30 C70605010000         1322             MOV DS:ZERO_TELL, 0
0B36                      1323     DONT_ZERO1:
0B36 C706CD000100         1324             MOV DS:DOLLAR_FLAG, 1
0B3C A27900               1325             MOV DS:REG_AL, AL
0B3F 9ABC06----     R     1326             CALL FAR PTR DAC_UPDATE
0B44 C60679000A           1327             MOV DS:REG_AL, 10
0B49 9ABC06----     R     1328             CALL FAR PTR DAC_UPDATE
                          1329             
0B4E                      1330     NEXT_PLACE_10:
0B4E 43                   1331             INC BX
0B4F 8A87C100             1332             MOV AL, DS:TEMP_BCD_ARR[BX]
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:37:07  12/08/;3  PAGE   26


LOC  OBJ                  LINE     SOURCE

0B53 3C00                 1333             CMP AL, 0
0B55 7425                 1334             JE MANDARIN_DEC
0B57 833E050100           1335             CMP DS:ZERO_TELL, 0
0B5C 7410                 1336             JE DONT_ZERO2
0B5E C606790000           1337             MOV DS:REG_AL, 0
0B63 9ABC06----     R     1338             CALL FAR PTR DAC_UPDATE
0B68 C70605010000         1339             MOV DS:ZERO_TELL, 0
0B6E                      1340     DONT_ZERO2:
0B6E C706CD000100         1341             MOV DS:DOLLAR_FLAG, 1
0B74 A27900               1342             MOV DS:REG_AL, AL
0B77 9ABC06----     R     1343             CALL FAR PTR DAC_UPDATE
                          1344             
0B7C                      1345     MANDARIN_DEC:
0B7C 833ECD0000           1346             CMP DS:DOLLAR_FLAG, 0
0B81 740A                 1347             JE MANDARIN_DAC_CONT
0B83 C60679000E           1348             MOV DS:REG_AL, 14
0B88 9ABC06----     R     1349             CALL FAR PTR DAC_UPDATE
0B8D                      1350     MANDARIN_DAC_CONT:
0B8D 43                   1351             INC BX
0B8E 8A87C100             1352             MOV AL, DS:TEMP_BCD_ARR[BX]
0B92 3C00                 1353             CMP AL, 0
0B94 7418                 1354             JE NEXT_PLACE_11
0B96 C706CB000100         1355             MOV DS:CENT_FLAG, 1
0B9C A27900               1356             MOV DS:REG_AL, AL
0B9F 9ABC06----     R     1357             CALL FAR PTR DAC_UPDATE
0BA4 C60679000A           1358             MOV DS:REG_AL, 10
0BA9 9ABC06----     R     1359             CALL FAR PTR DAC_UPDATE
                          1360             
0BAE                      1361     NEXT_PLACE_11:
                          1362     
0BAE 43                   1363             INC BX
0BAF 8A87C100             1364             MOV AL, DS:TEMP_BCD_ARR[BX]
0BB3 3C00                 1365             CMP AL, 0
0BB5 740E                 1366             JE CONT_BCD_UPD
0BB7 C706CB000100         1367             MOV DS:CENT_FLAG, 1
0BBD A27900               1368             MOV DS:REG_AL, AL
0BC0 9ABC06----     R     1369             CALL FAR PTR DAC_UPDATE
                          1370             
0BC5                      1371     CONT_BCD_UPD:
0BC5 833ECB0000           1372             CMP DS:CENT_FLAG, 0
0BCA 7410                 1373             JE CONT_BCD_UPD_1
0BCC C60679000F           1374             MOV DS:REG_AL, 15
0BD1 9ABC06----     R     1375             CALL FAR PTR DAC_UPDATE
0BD6 C706CB000000         1376             MOV DS:CENT_FLAG, 0
                          1377     
0BDC                      1378     CONT_BCD_UPD_1:
                          1379             
0BDC 5A                   1380     POP DX
0BDD 59                   1381     POP CX
0BDE 5B                   1382     POP BX
0BDF 58                   1383     POP AX
0BE0 CB                   1384     RET
                          1385     CALC_DAC ENDP
                          1386     
0BE1                      1387     CALC_UPD_PRICE PROC FAR
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:37:07  12/08/;3  PAGE   27


LOC  OBJ                  LINE     SOURCE

0BE1 50                   1388     PUSH AX
0BE2 53                   1389     PUSH BX
0BE3 51                   1390     PUSH CX
0BE4 52                   1391     PUSH DX
0BE5 833EB90000           1392             CMP DS:QTY, 0
0BEA 7503                 1393             JNE CHECK_PRICE_ZERO
0BEC E92B01               1394             JMP CALC_END
0BEF                      1395     CHECK_PRICE_ZERO:
0BEF 833EB70000           1396             CMP DS:PRICE, 0
0BF4 7503                 1397             JNE START_CALC
0BF6 E92101               1398             JMP CALC_END
0BF9                      1399     START_CALC:
0BF9 BA0000               1400             MOV DX, 0
0BFC A1B700               1401             MOV AX, DS:PRICE
0BFF 8B1EB900             1402             MOV BX, DS:QTY
0C03 F7E3                 1403             MUL BX
                          1404             
0C05 BB6400               1405             MOV BX, 100
0C08 F7F3                 1406             DIV BX
0C0A A3B700               1407             MOV DS:PRICE, AX
0C0D A1BF00               1408             MOV AX, DS:TOTAL_PRICE_DEC
0C10 03C2                 1409             ADD AX, DX
0C12 3D6400               1410             CMP AX, 100
0C15 7C07                 1411             JL NON_DECIMAL
0C17 FF06BD00             1412             INC DS:TOTAL_PRICE_L
0C1B 2D6400               1413             SUB AX, 100
                          1414             
0C1E                      1415     NON_DECIMAL:    
0C1E A3BF00               1416             MOV DS:TOTAL_PRICE_DEC, AX
0C21 A1BD00               1417             MOV AX, DS:TOTAL_PRICE_L
0C24 8B1EB700             1418             MOV BX, DS:PRICE
0C28 03C3                 1419             ADD AX, BX
0C2A 7304                 1420             JNC update_normal
0C2C FF06BB00             1421             INC DS:TOTAL_PRICE_U
                          1422             
0C30                      1423     update_normal:
0C30 A3BD00               1424             MOV DS:TOTAL_PRICE_L, AX
                          1425             
0C33 BA0000               1426             MOV DX, 0
                          1427             ;CMP DS:TOTAL_PRICE_DEC, 9
                          1428             ;JG DECIMAL_CONT
                          1429             ;MOV CX, 10
                          1430             ;MOV AX, DS:TOTAL_PRICE_DEC
                          1431             ;MUL CX
                          1432             ;MOV DS:TOTAL_PRICE_DEC, AX
                          1433     ;DECIMAL_CONT:
0C36 A1BF00               1434             MOV AX, DS:TOTAL_PRICE_DEC
0C39 B90A00               1435             MOV CX, 10
0C3C F7F1                 1436             DIV CX
                          1437             
0C3E BB0700               1438             MOV BX, 7
0C41 8897C100             1439             MOV DS:TEMP_BCD_ARR[BX], DL
0C45 4B                   1440             DEC BX
0C46 8887C100             1441             MOV DS:TEMP_BCD_ARR[BX], AL
                          1442             
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:37:07  12/08/;3  PAGE   28


LOC  OBJ                  LINE     SOURCE

0C4A BB0600               1443             MOV BX, 6
0C4D A1BD00               1444             MOV AX, DS:TOTAL_PRICE_L
                          1445             
0C50                      1446             TEMP_UPD_LOOP:
0C50 BA0000               1447                     MOV DX, 0
0C53 B90A00               1448                     MOV CX, 10
0C56 F7F1                 1449                     DIV CX
                          1450                     
0C58 4B                   1451                     DEC BX
0C59 8897C100             1452                     MOV DS:TEMP_BCD_ARR[BX], DL
0C5D 43                   1453                     INC BX
                          1454                     
0C5E 4B                   1455                     DEC BX
                          1456                     
0C5F 75EF                 1457             JNZ TEMP_UPD_LOOP
                          1458             
0C61 8B0EBB00             1459             MOV CX, DS:TOTAL_PRICE_U
0C65 83F900               1460             CMP CX, 0
0C68 7478                 1461             JE upd_dac_part
0C6A                      1462             ADD_EXTRA_PART:
0C6A BB0500               1463                     MOV BX, 5
0C6D 8A87C100             1464                     MOV AL, DS:TEMP_BCD_ARR[BX]
0C71 0406                 1465                     ADD AL, 6
0C73 3C09                 1466                     CMP AL, 9
0C75 7E08                 1467                     JLE CONT_DIGIT_1
0C77 2C0A                 1468                     SUB AL, 10
0C79 4B                   1469                     DEC BX
0C7A FE87C100             1470                     INC DS:TEMP_BCD_ARR[BX]
0C7E 43                   1471                     INC BX
0C7F                      1472             CONT_DIGIT_1:
0C7F 8887C100             1473                     MOV DS:TEMP_BCD_ARR[BX], AL
0C83 4B                   1474                     DEC BX
                          1475                     
0C84 8A87C100             1476                     MOV AL, DS:TEMP_BCD_ARR[BX]
0C88 0403                 1477                     ADD AL, 3
0C8A 3C09                 1478                     CMP AL, 9
0C8C 7E08                 1479                     JLE CONT_DIGIT_2
0C8E 2C0A                 1480                     SUB AL, 10
0C90 4B                   1481                     DEC BX
0C91 FE87C100             1482                     INC DS:TEMP_BCD_ARR[BX]
0C95 43                   1483                     INC BX
0C96                      1484             CONT_DIGIT_2:
0C96 8887C100             1485                     MOV DS:TEMP_BCD_ARR[BX], AL
0C9A 4B                   1486                     DEC BX
                          1487                     
0C9B 8A87C100             1488                     MOV AL, DS:TEMP_BCD_ARR[BX]
0C9F 0405                 1489                     ADD AL, 5
0CA1 3C09                 1490                     CMP AL, 9
0CA3 7E08                 1491                     JLE CONT_DIGIT_3
0CA5 2C0A                 1492                     SUB AL, 10
0CA7 4B                   1493                     DEC BX
0CA8 FE87C100             1494                     INC DS:TEMP_BCD_ARR[BX]
0CAC 43                   1495                     INC BX
0CAD                      1496             CONT_DIGIT_3:
0CAD 8887C100             1497                     MOV DS:TEMP_BCD_ARR[BX], AL
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:37:07  12/08/;3  PAGE   29


LOC  OBJ                  LINE     SOURCE

0CB1 4B                   1498                     DEC BX
                          1499                     
                          1500                     
0CB2 8A87C100             1501                     MOV AL, DS:TEMP_BCD_ARR[BX]
0CB6 0405                 1502                     ADD AL, 5
0CB8 3C09                 1503                     CMP AL, 9
0CBA 7E08                 1504                     JLE CONT_DIGIT_4
0CBC 2C0A                 1505                     SUB AL, 10
0CBE 4B                   1506                     DEC BX
0CBF FE87C100             1507                     INC DS:TEMP_BCD_ARR[BX]
0CC3 43                   1508                     INC BX
0CC4                      1509             CONT_DIGIT_4:
0CC4 8887C100             1510                     MOV DS:TEMP_BCD_ARR[BX], AL
0CC8 4B                   1511                     DEC BX
                          1512                     
0CC9 8A87C100             1513                     MOV AL, DS:TEMP_BCD_ARR[BX]
0CCD 0406                 1514                     ADD AL, 6
0CCF 3C09                 1515                     CMP AL, 9
0CD1 7E08                 1516                     JLE CONT_DIGIT_5
0CD3 2C0A                 1517                     SUB AL, 10
0CD5 4B                   1518                     DEC BX
0CD6 FE87C100             1519                     INC DS:TEMP_BCD_ARR[BX]
0CDA 43                   1520                     INC BX
0CDB                      1521             CONT_DIGIT_5:
0CDB 8887C100             1522                     MOV DS:TEMP_BCD_ARR[BX], AL
0CDF 4B                   1523                     DEC BX
                          1524                     
0CE0 E288                 1525             LOOP ADD_EXTRA_PART
                          1526             
0CE2                      1527     upd_dac_part:
0CE2 9A7108----     R     1528             CALL FAR PTR CALC_DAC
                          1529     
0CE7 9A2506----     R     1530             CALL FAR PTR BCD_CLEAR
0CEC C70661000000         1531             MOV DS:KEYPAD_INDEX, 0
0CF2 C706B3000300         1532             MOV DS:DECIMAL_INDEX, 3
0CF8 B90800               1533             MOV CX, 8
0CFB                      1534             UPD_BCD:
0CFB BB0800               1535                     MOV BX, 8
0CFE 2BD9                 1536                     SUB BX, CX
0D00 8A87C100             1537                     MOV AL, DS:TEMP_BCD_ARR[BX]
0D04 A27900               1538                     MOV DS:REG_AL, AL
0D07 C706B1000100         1539                     MOV DS:DAC_DISABLE, 1
0D0D 9A5006----     R     1540                     CALL FAR PTR BCD_UPDATE
0D12 C706B1000000         1541                     MOV DS:DAC_DISABLE, 0
0D18 E2E1                 1542             LOOP UPD_BCD
                          1543             
0D1A                      1544     CALC_END:
0D1A 833EB70000           1545             CMP DS:PRICE, 0
0D1F 7403                 1546             JE RETAIN_BCD_VALUE
0D21 EB2F90               1547             JMP END_CALC_BCD_DAC
                          1548             
0D24                      1549     RETAIN_BCD_VALUE:       
0D24 C70661000000         1550             MOV DS:KEYPAD_INDEX, 0
0D2A C706B3000300         1551             MOV DS:DECIMAL_INDEX, 3
0D30 B90800               1552             MOV CX, 8
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:37:07  12/08/;3  PAGE   30


LOC  OBJ                  LINE     SOURCE

0D33                      1553             UPD_BCD1:
0D33 BB0800               1554                     MOV BX, 8
0D36 2BD9                 1555                     SUB BX, CX
0D38 8A87C100             1556                     MOV AL, DS:TEMP_BCD_ARR[BX]
0D3C A27900               1557                     MOV DS:REG_AL, AL
0D3F C706B1000100         1558                     MOV DS:DAC_DISABLE, 1
0D45 9A5006----     R     1559                     CALL FAR PTR BCD_UPDATE
0D4A C706B1000000         1560                     MOV DS:DAC_DISABLE, 0
0D50 E2E1                 1561             LOOP UPD_BCD1
                          1562     
0D52                      1563     END_CALC_BCD_DAC:
0D52 C706B7000000         1564             MOV DS:PRICE, 0
0D58 C706B9000000         1565             MOV DS:QTY, 0
0D5E 5A                   1566     POP DX
0D5F 59                   1567     POP CX
0D60 5B                   1568     POP BX
0D61 58                   1569     POP AX
0D62 CB                   1570     RET
                          1571     CALC_UPD_PRICE ENDP
                          1572     
0D63                      1573     UPDATE_TROLLEY PROC FAR
0D63 50                   1574     PUSH AX
0D64 53                   1575     PUSH BX
0D65 51                   1576     PUSH CX
0D66 52                   1577     PUSH DX
0D67 B90800               1578             MOV CX, 8
0D6A                      1579             CLEAR_TEMP_BCD_TROLLEY:
0D6A 8BD9                 1580                     MOV BX, CX
0D6C 4B                   1581                     DEC BX
0D6D C687C10000           1582                     MOV DS:TEMP_BCD_ARR[BX], 0
0D72 E2F6                 1583             LOOP CLEAR_TEMP_BCD_TROLLEY
                          1584             
0D74 8B0EFB00             1585             MOV CX, DS:TROLLEY_INDEX
0D78 BA0800               1586             MOV DX, 8
                          1587             
0D7B                      1588             UPD_TROLLEY_PRICE:
0D7B 8BD9                 1589                     MOV BX, CX
0D7D 4B                   1590                     DEC BX
                          1591                     
0D7E 8A87F300             1592                     MOV AL, DS:TROLLEY_ARRAY[BX]
                          1593                     
0D82 8BDA                 1594                     MOV BX, DX
0D84 4B                   1595                     DEC BX
                          1596                     
0D85 8887C100             1597                     MOV DS:TEMP_BCD_ARR[BX], AL
                          1598                     
0D89 4A                   1599                     DEC DX
0D8A E2EF                 1600             LOOP UPD_TROLLEY_PRICE
                          1601             
0D8C B90800               1602             MOV CX, 8
0D8F C70661000000         1603             MOV DS:KEYPAD_INDEX, 0
0D95                      1604             UPDATE_TROLLEY_PRICE_DISPLAY:
0D95 BB0800               1605                     MOV BX, 8
0D98 2BD9                 1606                     SUB BX, CX
0D9A 8A87C100             1607                     MOV AL, DS:TEMP_BCD_ARR[BX]
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:37:07  12/08/;3  PAGE   31


LOC  OBJ                  LINE     SOURCE

0D9E A27900               1608                     MOV DS:REG_AL, AL
0DA1 C706B1000100         1609                     MOV DS:DAC_DISABLE, 1
0DA7 9A5006----     R     1610                     CALL FAR PTR BCD_UPDATE
0DAC C706B1000000         1611                     MOV DS:DAC_DISABLE, 0
0DB2 E2E1                 1612             LOOP UPDATE_TROLLEY_PRICE_DISPLAY
                          1613             
0DB4 9A7108----     R     1614             CALL FAR PTR CALC_DAC
                          1615     
0DB9 5A                   1616     POP DX
0DBA 59                   1617     POP CX
0DBB 5B                   1618     POP BX
0DBC 5A                   1619     POP DX
0DBD CB                   1620     RET
                          1621     UPDATE_TROLLEY ENDP
                          1622     ; ^^^^^^^^^^^^^^^ End of User main routine ^^^^^^^^^^^^^^^^^^^^^^^^^
0DBE                      1623     SERIAL_REC_ACTION       PROC    FAR
0DBE 51                   1624                     PUSH    CX
0DBF 53                   1625                     PUSH    BX
0DC0 1E                   1626                     PUSH    DS
                          1627                     
0DC1 BB----         R     1628                     MOV     BX,DATA_SEG             ;initialize data segment register
0DC4 8EDB                 1629                     MOV     DS,BX
                          1630                     
0DC6 803E8B0001           1631                     CMP DS:REPLY_FLAG, 1
0DCB 7557                 1632                     JNE next_id1
                          1633                     
0DCD 803E8C0001           1634                     CMP DS:SEND_FLAG, 1
0DD2 7453                 1635                     JE send_input_across1
                          1636                     
0DD4 833EA70001           1637                     CMP DS:RECEIVE_FLAG, 1
0DD9 754F                 1638                     JNE terminate_session3
                          1639                     
0DDB 3C2F                 1640                     CMP AL, '/'
0DDD 752C                 1641                     JNE CHECK_SEND
0DDF C706AB000000         1642                     MOV DS:PRICE_FLAG, 0
0DE5 C706A7000000         1643                     MOV DS:RECEIVE_FLAG, 0
0DEB C706B5000100         1644                     MOV DS:LANG_FLAG, 1
0DF1 833EFD0000           1645                     CMP DS:TROLLEY_FLAG, 0
0DF6 7405                 1646                     JE TROLLEY_UPD_SKIP
0DF8 9A630D----     R     1647                     CALL FAR PTR UPDATE_TROLLEY
0DFD                      1648             TROLLEY_UPD_SKIP:
0DFD C706FD000000         1649                     MOV DS:TROLLEY_FLAG, 0
0E03 9AE10B----     R     1650                     CALL FAR PTR CALC_UPD_PRICE
0E08 EB2090               1651                     JMP terminate_session3
                          1652             
0E0B                      1653             CHECK_SEND:
0E0B 3C26                 1654                     CMP AL, '&'
0E0D 751E                 1655                     JNE TROLLEY_PRICE
0E0F C706AB000100         1656                     MOV DS:PRICE_FLAG, 1
0E15 C70661000000         1657                     MOV DS:KEYPAD_INDEX, 0
0E1B C706A3000800         1658                     MOV DS:MAX_INPUT_SIZE, 8
0E21 E9E300               1659                     JMP id_skip2
                          1660             
                          1661             
0E24                      1662             next_id1:
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:37:07  12/08/;3  PAGE   32


LOC  OBJ                  LINE     SOURCE

0E24 E9E300               1663                     JMP next_id
                          1664                     
0E27                      1665             send_input_across1:
0E27 E9C100               1666                     JMP send_input_across
                          1667             
0E2A                      1668             terminate_session3:
0E2A E9D700               1669                     JMP terminate_session2
                          1670             
                          1671                     
0E2D                      1672             TROLLEY_PRICE:
0E2D 3C2B                 1673                     CMP AL, '+'
0E2F 7515                 1674                     JNE receive_price
0E31 C706A3000800         1675                     MOV DS:MAX_INPUT_SIZE, 8
0E37 C706FD000100         1676                     MOV DS:TROLLEY_FLAG, 1
0E3D C706FB000000         1677                     MOV DS:TROLLEY_INDEX, 0
0E43 E9C100               1678                     JMP id_skip2
                          1679                     
0E46                      1680             receive_price:
0E46 3C23                 1681                     CMP AL, '#'
0E48 7543                 1682                     JNE check_price
0E4A C706A9000100         1683                     MOV DS:DAC_FLAG, 1
0E50 C706AB000000         1684                     MOV DS:PRICE_FLAG, 0
0E56 C706B7000000         1685                     MOV DS:PRICE, 0
0E5C 833EFD0000           1686                     CMP DS:TROLLEY_FLAG, 0
0E61 7421                 1687                     JE TROLLEY_UPD_SKIP2
0E63 9A630D----     R     1688                     CALL FAR PTR UPDATE_TROLLEY
                          1689                     ;CLEAN STATE
0E68 C706B3000300         1690                     MOV DS:DECIMAL_INDEX, 3
0E6E 9A2506----     R     1691                     CALL FAR PTR BCD_CLEAR
0E73 C706A3000000         1692                     MOV DS:MAX_INPUT_SIZE, 0
0E79 9AE304----     R     1693                     CALL FAR PTR CLEAR_TEMP_BCD
                          1694                     
0E7E C706CF000000         1695                     MOV DS:CASH_FLAG, 0
                          1696                     
0E84                      1697             TROLLEY_UPD_SKIP2:
0E84 C706FD000000         1698                     MOV DS:TROLLEY_FLAG, 0
                          1699                     
0E8A EB7B90               1700                     JMP id_skip2
                          1701             
0E8D                      1702             check_price:    
                          1703             
0E8D 833EAB0001           1704                     CMP DS:PRICE_FLAG, 1
0E92 7440                 1705                     JE update_price_value
                          1706                     
0E94 833EFD0001           1707                     CMP DS:TROLLEY_FLAG, 1
0E99 7428                 1708                     JE update_trolley_arr
                          1709                     
0E9B 833EA90001           1710                     CMP DS:DAC_FLAG, 1
0EA0 7403                 1711                     JE dac_change
0EA2 EB6390               1712                     JMP id_skip2
                          1713     
0EA5                      1714             dac_change:
0EA5 8A1E7900             1715                     MOV BL, DS:REG_AL
0EA9 2C30                 1716                     SUB AL, 30H
0EAB A27900               1717                     MOV DS:REG_AL, AL
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:37:07  12/08/;3  PAGE   33


LOC  OBJ                  LINE     SOURCE

0EAE 9ABC06----     R     1718                     CALL FAR PTR DAC_UPDATE
0EB3 881E7900             1719                     MOV DS:REG_AL, BL
0EB7 C706A9000000         1720                     MOV DS:DAC_FLAG, 0
0EBD EB4890               1721                     JMP id_skip2
                          1722             
                          1723     
0EC0 EB4590               1724             id_skip3: JMP id_skip2
                          1725             
0EC3                      1726             update_trolley_arr:
0EC3 8B1EFB00             1727                     MOV BX, DS:TROLLEY_INDEX
0EC7 2C30                 1728                     SUB AL, 30H
0EC9 8887F300             1729                     MOV DS:TROLLEY_ARRAY[BX], AL
0ECD FF06FB00             1730                     INC DS:TROLLEY_INDEX
0ED1 EB3490               1731                     JMP id_skip2
                          1732                     
0ED4                      1733             update_price_value:
0ED4 2C30                 1734                     SUB AL, 30H
0ED6 B90000               1735                     MOV CX, 0
0ED9 8AC8                 1736                     MOV CL, AL
0EDB A1B700               1737                     MOV AX, DS:PRICE
0EDE BB0A00               1738                     MOV BX, 10
0EE1 F7E3                 1739                     MUL BX
                          1740                     
0EE3 03C1                 1741                     ADD AX, CX
0EE5 A3B700               1742                     MOV DS:PRICE, AX
0EE8 EB1D90               1743                     JMP id_skip2
                          1744                     
0EEB                      1745             send_input_across:
0EEB 9ADF06----     R     1746                     CALL FAR PTR SEND_INPUT
                          1747                     
0EF0 C706A1000000         1748                     MOV DS:SEND_BUFFER_LEN, 0
                          1749                     
0EF6 C6068C0000           1750                     MOV DS:SEND_FLAG, 0
                          1751                     
0EFB C706A7000100         1752                     MOV DS:RECEIVE_FLAG, 1
                          1753                     
0F01 EB0490               1754                     JMP id_skip2
                          1755                     
0F04 EB3E90               1756                     terminate_session2: JMP terminate_session
0F07 EB6790               1757                     id_skip2: JMP id_skip
                          1758                     
0F0A                      1759             next_id:
                          1760                     
0F0A 803E810001           1761                     CMP DS:ID_FLAG_r, 1
0F0F 7513                 1762                     JNE id_flag_label
0F11 38067F00             1763                     CMP DS:MY_ID[1], AL
0F15 7559                 1764                     JNE id_skip
                          1765                     ;start writing to pc
0F17 C6068B0001           1766                     MOV DS:REPLY_FLAG, 1
0F1C C606810000           1767                     MOV DS:ID_FLAG_r, 0
0F21 EB4D90               1768                     JMP id_skip
                          1769             
0F24                      1770             id_flag_label:
                          1771             
0F24 803E800001           1772                     CMP DS:ID_FLAG_@, 1
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:37:07  12/08/;3  PAGE   34


LOC  OBJ                  LINE     SOURCE

0F29 7539                 1773                     JNE protocol_rec
0F2B 3C72                 1774                     CMP AL,'r'
0F2D 750D                 1775                     JNE id_not_r
0F2F C606810001           1776                     MOV DS:ID_FLAG_r,1
0F34 C606800000           1777                     MOV DS:ID_FLAG_@, 0
0F39 EB3590               1778                     JMP S_RET
0F3C                      1779             id_not_r:
0F3C C606800000           1780                     MOV DS:ID_FLAG_@, 0
0F41 EB2D90               1781                     JMP id_skip
                          1782             
0F44                      1783             terminate_session:
0F44 C606810000           1784                     MOV DS:ID_FLAG_r, 0
0F49 33DB                 1785                     XOR BX,BX
0F4B                      1786             start_send1:
0F4B 50                   1787                     PUSH AX
0F4C 33C0                 1788                     XOR AX,AX
0F4E 8A878600             1789                     MOV AL, DS:FAIL_MESSAGE[BX]
0F52 9A0000----     E     1790                     CALL FAR PTR PRINT_CHAR
0F57 58                   1791                     POP AX
0F58 C6068B0000           1792                     MOV DS:REPLY_FLAG, 0
0F5D 43                   1793                     INC BX
0F5E 3A1E8A00             1794                     CMP BL, DS:FAIL_COUNT
0F62 75E7                 1795                     JNE start_send1
                          1796                     
0F64                      1797             protocol_rec:
0F64 3C40                 1798                     CMP AL,'@'
0F66 7508                 1799                     JNE id_skip
0F68 C606800001           1800                     MOV DS:ID_FLAG_@,1
0F6D EB0190               1801                     JMP S_RET
                          1802                     
0F70                      1803             id_skip:
                          1804                     ; JMP S_RET
                          1805             
                          1806                     ; CMP   AL,'<'
                          1807                     ; JNE   S_FAST
                          1808     
                          1809                     ; INC   DS:T_COUNT_SET
                          1810                     ; INC   DS:T_COUNT_SET
                          1811     
                          1812                     ; JMP   S_NEXT0
                          1813     ; S_FAST:
                          1814                     ; CMP   AL,'>'
                          1815                     ; JNE   S_RET
                          1816     
                          1817                     ; DEC   DS:T_COUNT_SET
                          1818                     ; DEC   DS:T_COUNT_SET
                          1819     
                          1820     ; S_NEXT0:
                          1821                     ; MOV   CX,22                   ;initialize counter for message
                          1822                     ; MOV   BX,0
                          1823     
                          1824     ; S_NEXT1:      MOV     AL,DS:REC_MESS[BX]      ;print message
                          1825                     ; call  FAR ptr print_char
                          1826                     ; INC   BX
                          1827                     ; LOOP  S_NEXT1
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:37:07  12/08/;3  PAGE   35


LOC  OBJ                  LINE     SOURCE

                          1828     
                          1829                     ; MOV   AL,DS:T_COUNT_SET       ;print current period of timer0
                          1830                     ; CALL  FAR PTR PRINT_2HEX
0F70                      1831     S_RET:
0F70 1F                   1832                     POP     DS
0F71 5B                   1833                     POP     BX
0F72 59                   1834                     POP     CX
0F73 CB                   1835                     RET
                          1836     SERIAL_REC_ACTION       ENDP
                          1837     
0F74                      1838     TIMER2_ACTION   PROC    FAR
0F74 50                   1839                     PUSH    AX
0F75 1E                   1840                     PUSH    DS
0F76 53                   1841                     PUSH    BX
0F77 51                   1842                     PUSH    CX
0F78 52                   1843                     PUSH    DX
                          1844                     
                          1845                     
0F79 B8----         R     1846                     MOV     AX,DATA_SEG
0F7C 8ED8                 1847                     MOV     DS,AX
                          1848             
0F7E FE0E1600             1849                     DEC     DS:T_COUNT
0F82 754A                 1850                     JNZ     T_NEXT1
0F84 A01700               1851                     MOV     AL,DS:T_COUNT_SET
0F87 A21600               1852                     MOV     DS:T_COUNT,AL
                          1853     
0F8A                      1854     T_NEXT0:
                          1855                     
0F8A 33DB                 1856                     XOR BX, BX
0F8C 8A1E6000             1857                     MOV BL, DS:BCD_INDEX
0F90 8A4759               1858                     MOV AL, DS:BCD_MESSAGE[BX]
                          1859                     
0F93 3B1EB300             1860                     CMP BX, DS:DECIMAL_INDEX
0F97 7506                 1861                     JNE CALL_FUNC
0F99 C706AD000100         1862                     MOV DS:DECIMAL_FLAG, 1
0F9F                      1863     CALL_FUNC:
0F9F 9A3F10----     R     1864                     CALL FAR PTR BCD_TO_7SEG
0FA4 C706AD000000         1865                     MOV DS:DECIMAL_FLAG, 0
                          1866     
0FAA BA0002               1867                     MOV DX, 200H
0FAD EE                   1868                     OUT DX, AL
                          1869                     
0FAE A05F00               1870                     MOV AL, DS:ENABLE_BYTE
0FB1 BA8001               1871                     MOV DX, 180H
0FB4 EE                   1872                     OUT DX, AL
                          1873                     
                          1874     
0FB5 FE066000             1875                     INC DS:BCD_INDEX
0FB9 D0065F00             1876                     ROL DS:ENABLE_BYTE, 1
0FBD 803E5F00BF           1877                     CMP DS:ENABLE_BYTE, 10111111b
0FC2 750A                 1878                     JNE T_NEXT1
0FC4 C6065F00FE           1879                     MOV DS:ENABLE_BYTE, 11111110b 
0FC9 C606600000           1880                     MOV DS:BCD_INDEX, 0
                          1881     
                          1882                     
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:37:07  12/08/;3  PAGE   36


LOC  OBJ                  LINE     SOURCE

0FCE                      1883     T_NEXT1:
0FCE 803E750000           1884                     CMP DS:DAC_LEN, 0
0FD3 743C                 1885                     JE ISR_END
                          1886                     
                          1887                     
0FD5 8B367600             1888                     MOV SI, DS:SI_PTR
                          1889                             
0FD9 BB0000               1890                     MOV BX, 0
0FDC 33C0                 1891                     XOR AX, AX
0FDE 8A4766               1892                     MOV AL, DS:DAC_ADDR[BX]
                          1893                     
0FE1 BB0001               1894                     MOV BX, 100H
0FE4 F7E3                 1895                     MUL BX
                          1896                     
0FE6 8B166400             1897                     MOV DX, DS:DAC_BASE
0FEA 03D0                 1898                     ADD DX, AX
                          1899                     
0FEC 1E                   1900                     PUSH DS
0FED 8EDA                 1901                     MOV DS, DX
                          1902                     
0FEF 8B04                 1903                     MOV AX, [SI]
                          1904                     
0FF1 BA1001               1905                     MOV DX, 110H
0FF4 EE                   1906                     OUT DX, AL
                          1907                     
0FF5 1F                   1908                     POP DS
                          1909                     
0FF6 FF067600             1910                     INC DS:SI_PTR
0FFA 813E76000010         1911                     CMP DS:SI_PTR, 1000H
1000 750F                 1912                     JNE ISR_END
                          1913                     
1002 C70676000000         1914                     MOV DS:SI_PTR, 0
1008 FE0E7500             1915                     DEC DS:DAC_LEN
100C 9A1710----     R     1916                     CALL FAR PTR DAC_SHIFT
                          1917                     
1011                      1918     ISR_END:
                          1919                     
1011 5A                   1920                     POP DX
1012 59                   1921                     POP     CX
1013 5B                   1922                     POP     BX
1014 1F                   1923                     POP     DS
1015 58                   1924                     POP AX
1016 CB                   1925                     RET
                          1926     TIMER2_ACTION   ENDP
                          1927     
                          1928     
1017                      1929     DAC_SHIFT PROC FAR
1017 50                   1930             PUSH AX
1018 53                   1931             PUSH BX
1019 51                   1932             PUSH CX
101A 52                   1933             PUSH DX
                          1934     
101B 33C9                 1935             XOR CX, CX
101D 8A0E7500             1936             MOV CL, DS:DAC_LEN
1021 80F900               1937             CMP CL, 0
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:37:07  12/08/;3  PAGE   37


LOC  OBJ                  LINE     SOURCE

1024 7414                 1938             JE END_SHIFT
                          1939     
1026                      1940             SHIFT_LOOP:
                          1941     
1026 33DB                 1942             XOR BX, BX
1028 8A1E7500             1943             MOV BL, DS:DAC_LEN
102C 2BD9                 1944             SUB BX, CX
102E 43                   1945             INC BX
                          1946             
102F 33D2                 1947             XOR DX, DX
1031 8A5766               1948             MOV DL, DS:DAC_ADDR[BX]
1034 4B                   1949             DEC BX
1035 885766               1950             MOV DS:DAC_ADDR[BX], DL
                          1951     
1038 E2EC                 1952             LOOP SHIFT_LOOP
                          1953             
103A                      1954             END_SHIFT:
103A 5A                   1955             POP DX
103B 59                   1956             POP CX
103C 5B                   1957             POP BX
103D 58                   1958             POP AX
103E CB                   1959             RET
                          1960     DAC_SHIFT ENDP
                          1961     
103F                      1962     BCD_TO_7SEG PROC FAR
                          1963     
103F 53                   1964             PUSH BX
1040 51                   1965             PUSH CX
1041 52                   1966             PUSH DX
                          1967             
1042 3C00                 1968             CMP AL, 0
1044 7511                 1969             JNE one
1046 833EAD0001           1970             CMP DS:DECIMAL_FLAG, 1
104B 7405                 1971             JE decimal0
104D B03F                 1972             MOV AL, 00111111b
104F E9D700               1973             JMP endfunc
1052                      1974     decimal0:
1052 B0BF                 1975             MOV AL, 10111111b
1054 E9D200               1976             JMP endfunc
                          1977             
1057                      1978             one:
1057 3C01                 1979             CMP AL, 1
1059 7511                 1980             JNE two
105B 833EAD0001           1981             CMP DS:DECIMAL_FLAG, 1
1060 7405                 1982             JE decimal1
1062 B006                 1983             MOV AL, 00000110b
1064 E9C200               1984             JMP endfunc
1067                      1985     decimal1:
1067 B086                 1986             MOV AL, 10000110b
1069 E9BD00               1987             JMP endfunc
                          1988             
106C                      1989             two:
106C 3C02                 1990             CMP AL,2
106E 7511                 1991             JNE three
1070 833EAD0001           1992             CMP DS:DECIMAL_FLAG, 1
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:37:07  12/08/;3  PAGE   38


LOC  OBJ                  LINE     SOURCE

1075 7405                 1993             JE decimal2
1077 B05B                 1994             MOV AL, 01011011b
1079 E9AD00               1995             JMP endfunc
107C                      1996     decimal2:
107C B0DB                 1997             MOV AL, 11011011b
107E E9A800               1998             JMP endfunc
                          1999             
1081                      2000             three:
1081 3C03                 2001             CMP AL,3
1083 7511                 2002             JNE four
1085 833EAD0001           2003             CMP DS:DECIMAL_FLAG, 1
108A 7405                 2004             JE decimal3
108C B04F                 2005             MOV AL, 01001111b
108E E99800               2006             JMP endfunc
1091                      2007     decimal3:
1091 B0CF                 2008             MOV AL, 11001111b
1093 E99300               2009             JMP endfunc
                          2010             
1096                      2011             four:
1096 3C04                 2012             CMP AL,4
1098 7511                 2013             JNE five
109A 833EAD0001           2014             CMP DS:DECIMAL_FLAG, 1
109F 7405                 2015             JE decimal4
10A1 B066                 2016             MOV AL, 01100110b
10A3 E98300               2017             JMP endfunc
10A6                      2018     decimal4:
10A6 B0E6                 2019             MOV AL, 11100110b
10A8 EB7F90               2020             JMP endfunc
                          2021             
10AB                      2022             five:
10AB 3C05                 2023             CMP AL,5
10AD 7511                 2024             JNE six
10AF 833EAD0001           2025             CMP DS:DECIMAL_FLAG, 1
10B4 7405                 2026             JE decimal5
10B6 B06D                 2027             MOV AL, 01101101b
10B8 EB6F90               2028             JMP endfunc
10BB                      2029     decimal5:
10BB B0ED                 2030             MOV AL, 11101101b
10BD EB6A90               2031             JMP endfunc
                          2032             
10C0                      2033             six:
10C0 3C06                 2034             CMP AL,6
10C2 7511                 2035             JNE seven
10C4 833EAD0001           2036             CMP DS:DECIMAL_FLAG, 1
10C9 7405                 2037             JE decimal6
10CB B07D                 2038             MOV AL, 01111101b
10CD EB5A90               2039             JMP endfunc
10D0                      2040     decimal6:
10D0 B0FD                 2041             MOV AL, 11111101b
10D2 EB5590               2042             JMP endfunc
                          2043             
10D5                      2044             seven:
10D5 3C07                 2045             CMP AL,7
10D7 7511                 2046             JNE eight
10D9 833EAD0001           2047             CMP DS:DECIMAL_FLAG, 1
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:37:07  12/08/;3  PAGE   39


LOC  OBJ                  LINE     SOURCE

10DE 7405                 2048             JE decimal7
10E0 B007                 2049             MOV AL, 00000111b
10E2 EB4590               2050             JMP endfunc
10E5                      2051     decimal7:
10E5 B087                 2052             MOV AL, 10000111b
10E7 EB4090               2053             JMP endfunc
                          2054             
10EA                      2055             eight:
10EA 3C08                 2056             CMP AL,8
10EC 7511                 2057             JNE nine
10EE 833EAD0001           2058             CMP DS:DECIMAL_FLAG, 1
10F3 7405                 2059             JE decimal8
10F5 B07F                 2060             MOV AL, 01111111b
10F7 EB3090               2061             JMP endfunc
10FA                      2062     decimal8:
10FA B0FF                 2063             MOV AL, 11111111b
10FC EB2B90               2064             JMP endfunc
                          2065             
10FF                      2066             nine:
10FF 3C09                 2067             CMP AL,9
1101 7511                 2068             JNE hifn
1103 833EAD0001           2069             CMP DS:DECIMAL_FLAG, 1
1108 7405                 2070             JE decimal9
110A B06F                 2071             MOV AL, 01101111b
110C EB1B90               2072             JMP endfunc
110F                      2073     decimal9:
110F B0EF                 2074             MOV AL, 11101111b
1111 EB1690               2075             JMP endfunc
                          2076             
1114                      2077             hifn:
1114 3C2D                 2078             CMP AL,'-'
1116 7511                 2079             JNE endfunc
1118 833EAD0001           2080             CMP DS:DECIMAL_FLAG, 1
111D 7405                 2081             JE decimal10
111F B040                 2082             MOV AL, 01000000b
1121 EB0690               2083             JMP endfunc
1124                      2084     decimal10:
1124 B0C0                 2085             MOV AL, 11000000b
1126 EB0190               2086             JMP endfunc
                          2087             
1129                      2088             endfunc:
1129 5A                   2089             POP DX
112A 59                   2090             POP CX
112B 5B                   2091             POP BX
                          2092     
112C CB                   2093     RET
                          2094     BCD_TO_7SEG ENDP
                          2095     
----                      2096     CODE_SEG        ENDS
                          2097     END

ASSEMBLY COMPLETE, NO ERRORS FOUND
