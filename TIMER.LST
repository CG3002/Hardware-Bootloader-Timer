8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    16:33:28  10/13/;3  PAGE    1


DOS 5.0 (038-N) 8086/87/88/186 MACRO ASSEMBLER V3.1 ASSEMBLY OF MODULE TIMER
OBJECT MODULE PLACED IN TIMER.OBJ
ASSEMBLER INVOKED BY:  D:\ASM86.EXE TIMER.ASM


LOC  OBJ                  LINE     SOURCE

                             1 +1  $MOD186
                             2 +1  $EP
                             3     NAME TIMER
                             4     ; Main program for uPD70208 microcomputer system
                             5     ;
                             6     ; Author:       Dr Tay Teng Tiow
                             7     ; Address:      Department of Electrical Engineering 
                             8     ;               National University of Singapore
                             9     ;               10, Kent Ridge Crescent
                            10     ;               Singapore 0511. 
                            11     ; Date:         6th September 1991
                            12     ;
                            13     ; This file contains proprietory information and cannot be copied 
                            14     ; or distributed without prior permission from the author.
                            15     ; =========================================================================
                            16     
                            17     public  serial_rec_action, timer2_action
                            18     extrn   print_char:far, print_2hex:far, iodefine:far
                            19     extrn   set_timer2:far
                            20     
                            21     ;IO Setup for 80C188 
  FFA0                      22             UMCR    EQU    0FFA0H ; Upper Memory Control Register
  FFA2                      23             LMCR    EQU    0FFA2H ; Lower Memory control Register         
  FFA4                      24             PCSBA   EQU    0FFA4H ; Peripheral Chip Select Base Address
  FFA8                      25             MPCS    EQU    0FFA8H ; MMCS and PCS Alter Control Register
  0080                      26             A_8255  EQU    0080H
  0081                      27             B_8255  EQU    0081H
  0082                      28             C_8255  EQU    0082H
  0083                      29             CWR_8255  EQU    0083H
  FF38                      30             INT0CON  EQU   0FF38H
  FF22                      31             EOI EQU 0FF22H
  FF28                      32             IMASK EQU 0FF28H
                            33     
----                        34     STACK_SEG       SEGMENT
0000 (256                   35                     DB      256 DUP(?)
     ??
     )
0100                        36             TOS     LABEL   WORD
----                        37     STACK_SEG       ENDS
                            38     
                            39     
----                        40     DATA_SEG        SEGMENT
0000 0A                     41             TIMER0_MESS     DB      10,13,'TIMER2 INTERRUPT    '
0001 0D
0002 54494D45523220
     494E5445525255
     505420202020
0016 2F                     42             T_COUNT         DB      2FH
0017 2F                     43             T_COUNT_SET     DB      2FH
0018 0A                     44             REC_MESS        DB      10,13,'Period of timer0 =     '
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    16:33:28  10/13/;3  PAGE    2


LOC  OBJ                  LINE     SOURCE

0019 0D
001A 506572696F6420
     6F662074696D65
     7230203D202020
     2020
0031 (32                    45             MESSAGE     DB  32 dup('h')
     68
     )
0051 20                     46             M_SIZE          DB  32
0052 (32                    47             INPUT       DB  32 dup('q')
     71
     )
0072 00                     48             INPUT_SIZE  DB  0
0073 00                     49             FLAG            DB  0
0074 ??                     50             CHAR            DB  ?
----                        51     DATA_SEG        ENDS
                            52     
                            53     
----                        54     CODE_SEG        SEGMENT
                            55     
                            56             PUBLIC          START
                            57     
                            58     ASSUME  CS:CODE_SEG, SS:STACK_SEG
                            59     
0000                        60     START:
                            61     ;initialize stack area
0000 B8----         R       62                     MOV     AX,STACK_SEG            
0003 8ED0                   63                     MOV     SS,AX
0005 368B260001             64                     MOV     SP,TOS
                            65     
                            66     ; Initialize the on-chip pheripherals
000A 9A0000----     E       67                     CALL    FAR PTR IODEFINE
                            68                     
000F 9A0000----     E       69     call set_timer2
0014 FB                     70                      STI
                            71     
                            72     ; ^^^^^^^^^^^^^^^^^  Start of User Main Routine  ^^^^^^^^^^^^^^^^^^
                            73        
                            74     ; Initialize MPCS to MAP peripheral to IO address
                            75             
0015 BAA8FF                 76             MOV DX, MPCS
0018 B88300                 77             MOV AX, 0083H
001B EF                     78             OUT DX, AX
                            79     
                            80     ; PCSBA initial, set the parallel port start from 00H
001C BAA4FF                 81             MOV DX, PCSBA
001F B80300                 82             MOV AX, 0003H ; Peripheral starting address 00H no READY, No Waits
0022 EF                     83             OUT DX, AX
                            84     
                            85     ; Initialize LMCS 
0023 BAA2FF                 86         MOV DX, LMCR
0026 B8C401                 87         MOV AX, 01C4H  ; Starting address 1FFFH, 8K, No waits, last shoud be 5H for 1 wai
                                   ts      
0029 EF                     88         OUT DX, AX
                            89     
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    16:33:28  10/13/;3  PAGE    3


LOC  OBJ                  LINE     SOURCE

002A B8----         R       90             MOV AX, DATA_SEG
002D 8ED8                   91             MOV DS, AX
                            92                              
002F BA8300                 93             MOV DX, CWR_8255
0032 B88000                 94             MOV AX, 0080h
0035 EF                     95             OUT DX, AX
                            96             
0036 BA8000                 97             MOV DX, A_8255
0039 B023                   98             MOV AL, 23h
003B F6D0                   99             NOT AL
003D EE                    100             OUT DX, AL
                           101     
                           102     ; LCD Initialization ;
                           103     
                           104     ;Function set 1;
                           105     ; 60 ms delay ;
003E B975AA                106             MOV CX, 0AA75h ; 43637 dec
0041                       107             loop60ms:       
0041 90                    108                     NOP        ; 3 clocks
0042 49                    109                     DEC CX     ; 3 clocks
0043 75FC                  110             JNZ loop60ms ; 16 clocks
                           111             
0045 33C0                  112             XOR AX, AX
0047 B020                  113             MOV AL, 00100000b
0049 BA8100                114             MOV DX, B_8255
004C EE                    115             OUT DX, AL
                           116             
004D 33C0                  117             XOR AX, AX
004F B03C                  118             MOV AL, 00111100b
0051 BA8200                119             MOV DX, C_8255
0054 EE                    120             OUT DX, AL
                           121             
0055 33C0                  122             XOR AX, AX
0057 B000                  123             MOV AL, 00000000b
0059 BA8100                124             MOV DX, B_8255
005C EE                    125             OUT DX, AL
                           126             
                           127     
                           128     ;Function set 2;
                           129     ; 5 ms delay;
005D B9350E                130             MOV CX, 0E35h ; 3637 dec
0060                       131             loop5ms:        
0060 90                    132                     NOP        ; 3 clocks
0061 49                    133                     DEC CX     ; 3 clocks
0062 75FC                  134             JNZ loop5ms ; 16 clocks
                           135             
0064 33C0                  136             XOR AX, AX
0066 B020                  137             MOV AL, 00100000b
0068 BA8100                138             MOV DX, B_8255
006B EE                    139             OUT DX, AL
                           140             
006C 33C0                  141             XOR AX, AX
006E B03C                  142             MOV AL, 00111100b
0070 BA8200                143             MOV DX, C_8255
0073 EE                    144             OUT DX, AL
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    16:33:28  10/13/;3  PAGE    4


LOC  OBJ                  LINE     SOURCE

                           145             
0074 33C0                  146             XOR AX, AX
0076 B000                  147             MOV AL, 00000000b
0078 BA8100                148             MOV DX, B_8255
007B EE                    149             OUT DX, AL
                           150             
                           151             
                           152     ;Function set 3;
                           153     ; 100 us delay;
007C B94900                154             MOV CX, 0049h ; 73 dec
007F                       155             loop4point100us:        
007F 90                    156                     NOP        ; 3 clocks
0080 49                    157                     DEC CX     ; 3 clocks
0081 75FC                  158             JNZ loop4point100us ; 16 clocks
                           159             
0083 33C0                  160             XOR AX, AX
0085 B020                  161             MOV AL, 00100000b
0087 BA8100                162             MOV DX, B_8255
008A EE                    163             OUT DX, AL
                           164             
008B 33C0                  165             XOR AX, AX
008D B03C                  166             MOV AL, 00111100b
008F BA8200                167             MOV DX, C_8255
0092 EE                    168             OUT DX, AL
                           169             
0093 33C0                  170             XOR AX, AX
0095 B000                  171             MOV AL, 00000000b
0097 BA8100                172             MOV DX, B_8255
009A EE                    173             OUT DX, AL
                           174                     
                           175             ; 40 us delay;
009B B91E00                176             MOV CX, 001Eh ; 30 dec
009E                       177             loop40us:       
009E 90                    178                     NOP        ; 3 clocks
009F 49                    179                     DEC CX     ; 3 clocks
00A0 75FC                  180             JNZ loop40us ; 16 clocks
                           181             
                           182             ;Display Clear;
                           183             
00A2 33C0                  184             XOR AX, AX
00A4 B020                  185             MOV AL, 00100000b
00A6 BA8100                186             MOV DX, B_8255
00A9 EE                    187             OUT DX, AL
                           188             
00AA 33C0                  189             XOR AX, AX
00AC B001                  190             MOV AL, 00000001b
00AE BA8200                191             MOV DX, C_8255
00B1 EE                    192             OUT DX, AL
                           193             
00B2 33C0                  194             XOR AX, AX
00B4 B000                  195             MOV AL, 00000000b
00B6 BA8100                196             MOV DX, B_8255
00B9 EE                    197             OUT DX, AL
                           198             
                           199             ; 1.6ms delay;
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    16:33:28  10/13/;3  PAGE    5


LOC  OBJ                  LINE     SOURCE

00BA B98C04                200             MOV CX, 048Ch ; 30 dec
00BD                       201             loop1point6ms:  
00BD 90                    202                     NOP        ; 3 clocks
00BE 49                    203                     DEC CX     ; 3 clocks
00BF 75FC                  204             JNZ loop1point6ms ; 16 clocks
                           205             
                           206             
                           207             ;Entry Mode Set;
                           208             
00C1 33C0                  209             XOR AX, AX
00C3 B020                  210             MOV AL, 00100000b
00C5 BA8100                211             MOV DX, B_8255
00C8 EE                    212             OUT DX, AL
                           213             
00C9 33C0                  214             XOR AX, AX
00CB B006                  215             MOV AL, 00000110b
00CD BA8200                216             MOV DX, C_8255
00D0 EE                    217             OUT DX, AL
                           218             
00D1 33C0                  219             XOR AX, AX
00D3 B000                  220             MOV AL, 00000000b
00D5 BA8100                221             MOV DX, B_8255
00D8 EE                    222             OUT DX, AL
                           223             
                           224             ; 40 us delay;
00D9 B91E00                225             MOV CX, 001Eh ; 30 dec
00DC                       226             loop40us2:      
00DC 90                    227                     NOP        ; 3 clocks
00DD 49                    228                     DEC CX     ; 3 clocks
00DE 75FC                  229             JNZ loop40us2 ; 16 clocks
                           230             
                           231             
                           232             ;Setting Address of DDRAM;
                           233             
00E0 33C0                  234             XOR AX, AX
00E2 B020                  235             MOV AL, 00100000b
00E4 BA8100                236             MOV DX, B_8255
00E7 EE                    237             OUT DX, AL
                           238             
00E8 33C0                  239             XOR AX, AX
00EA B080                  240             MOV AL, 10000000b
00EC BA8200                241             MOV DX, C_8255
00EF EE                    242             OUT DX, AL
                           243             
00F0 33C0                  244             XOR AX, AX
00F2 B000                  245             MOV AL, 00000000b
00F4 BA8100                246             MOV DX, B_8255
00F7 EE                    247             OUT DX, AL
                           248             
                           249             ; 40 us delay;
00F8 B91E00                250             MOV CX, 001Eh ; 30 dec
00FB                       251             loop40us3:      
00FB 90                    252                     NOP        ; 3 clocks
00FC 49                    253                     DEC CX     ; 3 clocks
00FD 75FC                  254             JNZ loop40us3 ; 16 clocks
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    16:33:28  10/13/;3  PAGE    6


LOC  OBJ                  LINE     SOURCE

                           255             
                           256             
                           257             ;Display On;
                           258             
00FF 33C0                  259             XOR AX, AX
0101 B020                  260             MOV AL, 00100000b
0103 BA8100                261             MOV DX, B_8255
0106 EE                    262             OUT DX, AL
                           263             
0107 33C0                  264             XOR AX, AX
0109 B00C                  265             MOV AL, 00001100b
010B BA8200                266             MOV DX, C_8255
010E EE                    267             OUT DX, AL
                           268             
010F 33C0                  269             XOR AX, AX
0111 B000                  270             MOV AL, 00000000b
0113 BA8100                271             MOV DX, B_8255
0116 EE                    272             OUT DX, AL
                           273             
                           274             ; 40 us delay;
0117 B91E00                275             MOV CX, 001Eh ; 30 dec
011A                       276             loop40us4:      
011A 90                    277                     NOP        ; 3 clocks
011B 49                    278                     DEC CX     ; 3 clocks
011C 75FC                  279             JNZ loop40us4 ; 16 clocks
                           280             
                           281             
                           282     
011E                       283     NEXT:
                           284             ; Begin 
                           285             
                           286             
                           287             ; XOR AX, AX
                           288             ; MOV AL, DS:M_SIZE1
                           289             ; MOV DS:M_SIZE, AL
                           290             
                           291             ; displayloop:
                           292             ; XOR BX, BX
                           293             ; MOV BL, DS:M_SIZE1
                           294             ; SUB BL, AL
                           295     
                           296             ; MOV DL, DS:MESSAGE_1[BX]
                           297             ; MOV DS:MESSAGE[BX], DL
                           298             
                           299             ; DEC AL
                           300             ; JNZ displayloop
                           301             
011E 9A2501----     R      302             CALL FAR PTR MESSAGE_LCD
                           303             
                           304             
0123 EBF9                  305     JMP NEXT
                           306     
0125                       307     MESSAGE_LCD     PROC FAR
0125 50                    308             PUSH AX
0126 53                    309             PUSH BX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    16:33:28  10/13/;3  PAGE    7


LOC  OBJ                  LINE     SOURCE

0127 51                    310             PUSH CX
0128 52                    311             PUSH DX
                           312     
                           313             ;Display Clear;
                           314             
0129 33C0                  315             XOR AX, AX
012B B020                  316             MOV AL, 00100000b
012D BA8100                317             MOV DX, B_8255
0130 EE                    318             OUT DX, AL
                           319             
0131 33C0                  320             XOR AX, AX
0133 B001                  321             MOV AL, 00000001b
0135 BA8200                322             MOV DX, C_8255
0138 EE                    323             OUT DX, AL
                           324             
0139 33C0                  325             XOR AX, AX
013B B000                  326             MOV AL, 00000000b
013D BA8100                327             MOV DX, B_8255
0140 EE                    328             OUT DX, AL
                           329             
                           330             ; 1.6ms delay;
0141 B98C04                331             MOV CX, 048Ch ; 30 dec
0144                       332             loop1point6ms2: 
0144 90                    333                     NOP        ; 3 clocks
0145 49                    334                     DEC CX     ; 3 clocks
0146 75FC                  335             JNZ loop1point6ms2 ; 16 clocks
                           336             
0148 33DB                  337             XOR BX, BX
014A 8A1E7200              338             MOV BL, DS:INPUT_SIZE
014E 80FB00                339             CMP BL, 0
0151 7503                  340             JNE display
0153 E9AD00                341             JMP overfunc
                           342             
0156                       343             display:
0156 33D2                  344             XOR DX, DX
0158 8A167200              345             MOV DL, DS:INPUT_SIZE
015C 2AD3                  346             SUB DL, BL
015E 80FA10                347             CMP DL, 10h
0161 7403                  348             JE address
0163 EB2090                349             JMP continue
                           350             
0166                       351             address:
                           352             ;Setting Addres of DDRAM;       
0166 33C0                  353             XOR AX, AX
0168 B020                  354             MOV AL, 00100000b
016A BA8100                355             MOV DX, B_8255
016D EE                    356             OUT DX, AL
                           357             
016E 33C0                  358             XOR AX, AX
0170 B0C0                  359             MOV AL, 11000000b
0172 BA8200                360             MOV DX, C_8255
0175 EE                    361             OUT DX, AL
                           362             
0176 33C0                  363             XOR AX, AX
0178 B000                  364             MOV AL, 00000000b
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    16:33:28  10/13/;3  PAGE    8


LOC  OBJ                  LINE     SOURCE

017A BA8100                365             MOV DX, B_8255
017D EE                    366             OUT DX, AL
                           367             
                           368             ; 40 us delay;
017E B91E00                369             MOV CX, 001Eh ; 30 dec
0181                       370             loop40us30:     
0181 90                    371                     NOP        ; 3 clocks
0182 49                    372                     DEC CX     ; 3 clocks
0183 75FC                  373             JNZ loop40us30 ; 16 clocks
                           374             
0185                       375             continue:
                           376             ;Letter Begin;
                           377             
                           378             ;Writing Data to DDRAM;
0185 33C0                  379             XOR AX, AX
0187 B0A0                  380             MOV AL, 10100000b
0189 BA8100                381             MOV DX, B_8255
018C EE                    382             OUT DX, AL
                           383             
018D 8BD3                  384             MOV DX, BX
018F 8A1E7200              385             MOV BL, DS:INPUT_SIZE
0193 2ADA                  386             SUB BL, DL
0195 33C0                  387             XOR AX, AX
0197 8A4752                388             MOV AL, DS:INPUT[BX]
019A 8BDA                  389             MOV BX, DX
019C BA8200                390             MOV DX, C_8255
019F EE                    391             OUT DX, AL
                           392             
01A0 33C0                  393             XOR AX, AX
01A2 B080                  394             MOV AL, 10000000b
01A4 BA8100                395             MOV DX, B_8255
01A7 EE                    396             OUT DX, AL
                           397             
                           398             ;Letter End;
                           399     
                           400     ; 40 us delay;
01A8 B91E00                401             MOV CX, 001Eh ; 30 dec
01AB                       402             loop40us5:      
01AB 90                    403                     NOP        ; 3 clocks
01AC 49                    404                     DEC CX     ; 3 clocks
01AD 75FC                  405             JNZ loop40us5 ; 16 clocks
                           406     
01AF 4B                    407             DEC BX
01B0 75A4                  408             JNZ display
                           409             
                           410             ; 40 us delay;
01B2 B9FFFF                411             MOV CX, 0FFFFh ; 30 dec
01B5                       412             looplong:       
01B5 90                    413                     NOP        ; 3 clocks
01B6 90                    414                     NOP        ; 3 clocks
01B7 90                    415                     NOP        ; 3 clocks
01B8 90                    416                     NOP        ; 3 clocks
01B9 90                    417                     NOP        ; 3 clocks
01BA 90                    418                     NOP        ; 3 clocks
01BB 90                    419                     NOP        ; 3 clocks
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    16:33:28  10/13/;3  PAGE    9


LOC  OBJ                  LINE     SOURCE

01BC 90                    420                     NOP        ; 3 clocks
01BD 90                    421                     NOP        ; 3 clocks
01BE 90                    422                     NOP        ; 3 clocks
01BF 90                    423                     NOP        ; 3 clocks
01C0 90                    424                     NOP        ; 3 clocks
01C1 90                    425                     NOP        ; 3 clocks
01C2 90                    426                     NOP        ; 3 clocks
01C3 90                    427                     NOP        ; 3 clocks
01C4 90                    428                     NOP        ; 3 clocks
01C5 90                    429                     NOP        ; 3 clocks
01C6 90                    430                     NOP        ; 3 clocks
01C7 90                    431                     NOP        ; 3 clocks
01C8 90                    432                     NOP        ; 3 clocks
01C9 90                    433                     NOP        ; 3 clocks
01CA 90                    434                     NOP        ; 3 clocks
01CB 90                    435                     NOP        ; 3 clocks
01CC 90                    436                     NOP        ; 3 clocks
01CD 90                    437                     NOP        ; 3 clocks
01CE 90                    438                     NOP        ; 3 clocks
01CF 90                    439                     NOP        ; 3 clocks
01D0 90                    440                     NOP        ; 3 clocks
01D1 90                    441                     NOP        ; 3 clocks
01D2 90                    442                     NOP        ; 3 clocks
01D3 90                    443                     NOP        ; 3 clocks
01D4 90                    444                     NOP        ; 3 clocks
01D5 90                    445                     NOP        ; 3 clocks
01D6 90                    446                     NOP        ; 3 clocks
01D7 90                    447                     NOP        ; 3 clocks
01D8 90                    448                     NOP        ; 3 clocks
01D9 90                    449                     NOP        ; 3 clocks
01DA 90                    450                     NOP        ; 3 clocks
01DB 90                    451                     NOP        ; 3 clocks
01DC 90                    452                     NOP        ; 3 clocks
01DD 90                    453                     NOP        ; 3 clocks
01DE 90                    454                     NOP        ; 3 clocks
01DF 90                    455                     NOP        ; 3 clocks
01E0 90                    456                     NOP        ; 3 clock
01E1 49                    457                     DEC CX     ; 3 clocks
01E2 75D1                  458             JNZ looplong ; 16 clocks
                           459             
                           460             ;Display Clear;
                           461             
01E4 33C0                  462             XOR AX, AX
01E6 B020                  463             MOV AL, 00100000b
01E8 BA8100                464             MOV DX, B_8255
01EB EE                    465             OUT DX, AL
                           466             
01EC 33C0                  467             XOR AX, AX
01EE B001                  468             MOV AL, 00000001b
01F0 BA8200                469             MOV DX, C_8255
01F3 EE                    470             OUT DX, AL
                           471             
01F4 33C0                  472             XOR AX, AX
01F6 B000                  473             MOV AL, 00000000b
01F8 BA8100                474             MOV DX, B_8255
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    16:33:28  10/13/;3  PAGE   10


LOC  OBJ                  LINE     SOURCE

01FB EE                    475             OUT DX, AL
                           476             
                           477             ; 1.6ms delay;
01FC B98C04                478             MOV CX, 048Ch ; 30 dec
01FF                       479             loop1point6ms3: 
01FF 90                    480                     NOP        ; 3 clocks
0200 49                    481                     DEC CX     ; 3 clocks
0201 75FC                  482             JNZ loop1point6ms3 ; 16 clocks
0203                       483     overfunc:
0203 5A                    484             POP DX
0204 59                    485             POP CX
0205 5B                    486             POP BX
0206 58                    487             POP AX
0207 CB                    488             RET
                           489     MESSAGE_LCD     ENDP
                           490     
0208                       491     CLEAR_LCD PROC FAR
0208 50                    492             PUSH AX
0209 53                    493             PUSH BX
020A 51                    494             PUSH CX
020B 52                    495             PUSH DX
                           496             ;Display Clear;
                           497             
020C 33C0                  498             XOR AX, AX
020E B020                  499             MOV AL, 00100000b
0210 BA8100                500             MOV DX, B_8255
0213 EE                    501             OUT DX, AL
                           502             
0214 33C0                  503             XOR AX, AX
0216 B001                  504             MOV AL, 00000001b
0218 BA8200                505             MOV DX, C_8255
021B EE                    506             OUT DX, AL
                           507             
021C 33C0                  508             XOR AX, AX
021E B000                  509             MOV AL, 00000000b
0220 BA8100                510             MOV DX, B_8255
0223 EE                    511             OUT DX, AL
                           512             
                           513             ; 1.6ms delay;
0224 B98C04                514             MOV CX, 048Ch ; 30 dec
0227                       515             loop1point6ms2_1:       
0227 90                    516                     NOP        ; 3 clocks
0228 49                    517                     DEC CX     ; 3 clocks
0229 75FC                  518             JNZ loop1point6ms2_1 ; 16 clocks
                           519             
                           520             ;Setting Address of DDRAM;
                           521             
022B 33C0                  522             XOR AX, AX
022D B020                  523             MOV AL, 00100000b
022F BA8100                524             MOV DX, B_8255
0232 EE                    525             OUT DX, AL
                           526             
0233 33C0                  527             XOR AX, AX
0235 B080                  528             MOV AL, 10000000b
0237 BA8200                529             MOV DX, C_8255
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    16:33:28  10/13/;3  PAGE   11


LOC  OBJ                  LINE     SOURCE

023A EE                    530             OUT DX, AL
                           531             
023B 33C0                  532             XOR AX, AX
023D B000                  533             MOV AL, 00000000b
023F BA8100                534             MOV DX, B_8255
0242 EE                    535             OUT DX, AL
                           536             
                           537             ; 40 us delay;
0243 B91E00                538             MOV CX, 001Eh ; 30 dec
0246                       539             loop40us3_1:    
0246 90                    540                     NOP        ; 3 clocks
0247 49                    541                     DEC CX     ; 3 clocks
0248 75FC                  542             JNZ loop40us3_1 ; 16 clocks
                           543             
024A B300                  544             MOV BL, 0
024C 881E7200              545             MOV DS:INPUT_SIZE, BL
                           546             
0250 5A                    547             POP DX
0251 59                    548             POP CX
0252 5B                    549             POP BX
0253 58                    550             POP AX
0254 CB                    551     RET
                           552     CLEAR_LCD ENDP
                           553     
                           554     ; ^^^^^^^^^^^^^^^ End of User main routine ^^^^^^^^^^^^^^^^^^^^^^^^^
0255                       555     SERIAL_REC_ACTION       PROC    FAR
0255 51                    556                     PUSH    CX
0256 53                    557                     PUSH    BX
0257 1E                    558                     PUSH    DS
                           559                     
0258 BB----         R      560                     MOV     BX,DATA_SEG             ;initialize data segment register
025B 8EDB                  561                     MOV     DS,BX
                           562                     
025D 3C7E                  563                     CMP AL, '~'
025F 7508                  564                     JNE resume
                           565                     
0261 9A0802----     R      566                     CALL FAR PTR CLEAR_LCD
0266 EB4490                567                     JMP S_RET
                           568                     
0269                       569                     resume:
0269 33DB                  570                     XOR BX, BX
026B 8A1E7200              571                     MOV BL, DS:INPUT_SIZE
026F 884752                572                     MOV DS:INPUT[BX], AL
0272 FEC3                  573                     INC BL
0274 881E7200              574                     MOV DS:INPUT_SIZE, BL
                           575                     
0278                       576                     continue3:
                           577                     
0278 3C3C                  578                     CMP     AL,'<'
027A 750B                  579                     JNE     S_FAST
                           580     
027C FE061700              581                     INC     DS:T_COUNT_SET
0280 FE061700              582                     INC     DS:T_COUNT_SET
                           583     
0284 EB0D90                584                     JMP     S_NEXT0
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    16:33:28  10/13/;3  PAGE   12


LOC  OBJ                  LINE     SOURCE

0287                       585     S_FAST:
0287 3C3E                  586                     CMP     AL,'>'
0289 7521                  587                     JNE     S_RET
                           588     
028B FE0E1700              589                     DEC     DS:T_COUNT_SET
028F FE0E1700              590                     DEC     DS:T_COUNT_SET
                           591     
0293                       592     S_NEXT0:
0293 B91600                593                     MOV     CX,22                   ;initialize counter for message
0296 BB0000                594                     MOV     BX,0
                           595     
0299 8A4718                596     S_NEXT1:        MOV     AL,DS:REC_MESS[BX]      ;print message
029C 9A0000----     E      597                     call    FAR ptr print_char
02A1 43                    598                     INC     BX
02A2 E2F5                  599                     LOOP    S_NEXT1
                           600     
02A4 A01700                601                     MOV     AL,DS:T_COUNT_SET       ;print current period of timer0
02A7 9A0000----     E      602                     CALL    FAR PTR PRINT_2HEX
02AC                       603     S_RET:
02AC 1F                    604                     POP     DS
02AD 5B                    605                     POP     BX
02AE 59                    606                     POP     CX
02AF CB                    607                     RET
                           608     SERIAL_REC_ACTION       ENDP
                           609     
                           610     
                           611     
02B0                       612     TIMER2_ACTION   PROC    FAR
02B0 50                    613                     PUSH    AX
02B1 1E                    614                     PUSH    DS
02B2 53                    615                     PUSH    BX
02B3 51                    616                     PUSH    CX
                           617     
02B4 B8----         R      618                     MOV     AX,DATA_SEG
02B7 8ED8                  619                     MOV     DS,AX
                           620             
02B9 FE0E1600              621                     DEC     DS:T_COUNT
02BD 7516                  622                     JNZ     T_NEXT1
02BF A01700                623                     MOV     AL,DS:T_COUNT_SET
02C2 A21600                624                     MOV     DS:T_COUNT,AL
                           625     
02C5 B91400                626                     MOV     CX,20
02C8 BB0000                627                     MOV     BX,0H
02CB                       628     T_NEXT0:
02CB 8A07                  629                     MOV     AL,DS:TIMER0_MESS[BX]
02CD 43                    630                     INC     BX
02CE 9A0000----     E      631                     CALL    FAR PTR PRINT_CHAR
02D3 E2F6                  632                     LOOP    T_NEXT0
                           633     
02D5                       634     T_NEXT1:        
02D5 59                    635                     POP     CX
02D6 5B                    636                     POP     BX
02D7 1F                    637                     POP     DS
02D8 58                    638                     POP     AX
02D9 CB                    639                     RET
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    16:33:28  10/13/;3  PAGE   13


LOC  OBJ                  LINE     SOURCE

                           640     TIMER2_ACTION   ENDP
                           641     
                           642     
----                       643     CODE_SEG        ENDS
                           644     END

ASSEMBLY COMPLETE, NO ERRORS FOUND
