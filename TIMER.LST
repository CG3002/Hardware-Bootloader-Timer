8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:51:02  12/08/;3  PAGE    1


DOS 5.0 (038-N) 8086/87/88/186 MACRO ASSEMBLER V3.1 ASSEMBLY OF MODULE TIMER
OBJECT MODULE PLACED IN TIMER.OBJ
ASSEMBLER INVOKED BY:  D:\ASM86.EXE TIMER.ASM


LOC  OBJ                  LINE     SOURCE

                             1 +1  $MOD186
                             2 +1  $EP
                             3     NAME TIMER
                             4     ; Main program for uPD70208 microcomputer system
                             5     ;
                             6     ; Author:       Dr Tay Teng Tiow
                             7     ; Address:      Department of Electrical Engineering 
                             8     ;               National University of Singapore
                             9     ;               10, Kent Ridge Crescent
                            10     ;               Singapore 0511. 
                            11     ; Date:         6th September 1991
                            12     ;
                            13     ; This file contains proprietory information and cannot be copied 
                            14     ; or distributed without prior permission from the author.
                            15     ; =========================================================================
                            16     
                            17     public  serial_rec_action, timer2_action
                            18     extrn   print_char:far, print_2hex:far, iodefine:far
                            19     extrn   set_timer2:far
                            20     
                            21     ;IO Setup for 80C188 
  FFA0                      22             UMCR    EQU    0FFA0H ; Upper Memory Control Register
  FFA2                      23             LMCR    EQU    0FFA2H ; Lower Memory control Register         
  FFA4                      24             PCSBA   EQU    0FFA4H ; Peripheral Chip Select Base Address
  FFA8                      25             MPCS    EQU    0FFA8H ; MMCS and PCS Alter Control Register
  0080                      26             A_8255  EQU    0080H
  0081                      27             B_8255  EQU    0081H
  0082                      28             C_8255  EQU    0082H
  0083                      29             CWR_8255  EQU    0083H
  FF38                      30             INT0CON  EQU   0FF38H
  FF22                      31             EOI EQU 0FF22H
  FF28                      32             IMASK EQU 0FF28H
  FFA6                      33             MMCS    EQU    0FFA6H 
  4000                      34             DAC EQU 4000H
                            35     
                            36     
----                        37     STACK_SEG       SEGMENT
0000 (512                   38                     DB      512 DUP(?)
     ??
     )
0200                        39             TOS     LABEL   WORD
----                        40     STACK_SEG       ENDS
                            41     
                            42     
----                        43     DATA_SEG        SEGMENT
0000 0A                     44             TIMER0_MESS             DB      10,13,'TIMER2 INTERRUPT    '
0001 0D
0002 54494D45523220
     494E5445525255
     505420202020
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:51:02  12/08/;3  PAGE    2


LOC  OBJ                  LINE     SOURCE

0016 18                     45             T_COUNT                 DB      24
0017 18                     46             T_COUNT_SET             DB      24
0018 0A                     47             REC_MESS                DB      10,13,'Period of timer0 =     '
0019 0D
001A 506572696F6420
     6F662074696D65
     7230203D202020
     2020
0031 (32                    48             MESSAGE         DB  32 dup('h')
     68
     )
0051 00                     49             KEYPAD_INPUT    DB  0,0,0,0,0,0,0,0
0052 00
0053 00
0054 00
0055 00
0056 00
0057 00
0058 00
0059 2D                     50             BCD_MESSAGE     DB  '-','-','-','-','-','-'
005A 2D
005B 2D
005C 2D
005D 2D
005E 2D
005F FE                     51             ENABLE_BYTE     DB  11111110b
0060 00                     52             BCD_INDEX       DB  0
0061 0000                   53             KEYPAD_INDEX    DW      0
0063 20                     54             M_SIZE                  DB  32
0064 0040                   55             DAC_BASE        DW  4000H
0066 (15                    56             DAC_ADDR        DB  15 dup(0) 
     00
     )
0075 00                     57             DAC_LEN         DB  0
0076 0000                   58             SI_PTR          DW  0
0078 ??                     59             CHAR                    DB  ?
0079 ??                     60             REG_AL                  DB  ?
007A ??                     61             REG_BH                  DB  ?
007B ??                     62             REG_CL                  DB  ?
007C 00                     63             FLAG            DB  0
007D 00                     64             LONG_PRESS_FLAG DB      0
007E 7231                   65             MY_ID                   DB      'r1'
0080 00                     66             ID_FLAG_@               DB      0
0081 00                     67             ID_FLAG_r               DB      0
0082 4072312F               68             REPLY_MESSAGE   DB      '@r1/'
0086 40302F                 69             FAIL_MESSAGE    DB '@0/'
0089 04                     70             REPLY_COUNT             DB      4
008A 03                     71             FAIL_COUNT              DB      3
008B 00                     72             REPLY_FLAG              DB      0
008C 00                     73             SEND_FLAG       DB  0
008D (20                    74             SEND_BUFFER     DB  20 dup(0)
     00
     )
00A1 0000                   75             SEND_BUFFER_LEN DW      0
00A3 0000                   76             MAX_INPUT_SIZE  DW      0
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:51:02  12/08/;3  PAGE    3


LOC  OBJ                  LINE     SOURCE

00A5 0000                   77             QTY_FLAG                DW      0
00A7 0000                   78             RECEIVE_FLAG    DW      0
00A9 0000                   79             DAC_FLAG                DW      0
00AB 0000                   80             PRICE_FLAG      DW      0
00AD 0100                   81             DECIMAL_FLAG    DW      1
00AF 0000                   82             SCROLL_LEN      DW      0
00B1 0000                   83             DAC_DISABLE     DW  0
00B3 0300                   84             DECIMAL_INDEX   DW  3
00B5 0100                   85             LANG_FLAG       DW  1
00B7 0000                   86             PRICE                   DW      0
00B9 0000                   87             QTY                             DW      0
00BB 0000                   88             TOTAL_PRICE_U   DW      0
00BD 0000                   89             TOTAL_PRICE_L   DW      0
00BF 0000                   90             TOTAL_PRICE_DEC DW      0
00C1 (8                     91             TEMP_BCD_ARR    DB  8 dup(0)
     00
     )
00C9 0000                   92             THOUSAND_FLAG   DW  0
00CB 0000                   93             CENT_FLAG               DW      0
00CD 0000                   94             DOLLAR_FLAG             DW      0
00CF 0000                   95             CASH_FLAG               DW      0
00D1 (8                     96             CASH_AMT        DB  8 dup(0)
     00
     )
00D9 (8                     97             TEMP_CASH_ARR   DW  8 dup(0)
     0000
     )
00E9 0000                   98             CASH_OK_FLAG    DW  0
00EB 0000                   99             BORROW_POSITION DW  0
00ED 0100                  100             CANCEL_FLAG             DW  1
00EF 0000                  101             TRANSACTION_OVER DW 0
00F1 0100                  102             DATA_ENTER              DW  1
00F3 (8                    103             TROLLEY_ARRAY   DB  8 dup(0)
     00
     )
00FB 0000                  104             TROLLEY_INDEX   DW  0
00FD 0000                  105             TROLLEY_FLAG    DW  0
00FF 0000                  106             TROLLEY_ID              DW  0
0101 0000                  107             TROLLEY_DISABLED DW 0
0103 0000                  108             TEN_THOUSAND_FLAG DW 0
0105 0000                  109             ZERO_TELL               DW  0
0107 0000                  110             ZERO_ALLOW              DW  0
----                       111     DATA_SEG        ENDS
                           112     
                           113     
----                       114     CODE_SEG        SEGMENT
                           115     
                           116             PUBLIC          START
                           117     
                           118     ASSUME  CS:CODE_SEG, SS:STACK_SEG
                           119     
0000                       120     START:
                           121     ;initialize stack area
0000 B8----         R      122                     MOV     AX,STACK_SEG            
0003 8ED0                  123                     MOV     SS,AX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:51:02  12/08/;3  PAGE    4


LOC  OBJ                  LINE     SOURCE

0005 368B260002            124                     MOV     SP,TOS
                           125                     
                           126     ; Initialize the on-chip pheripherals
000A 9A0000----     E      127                     CALL    FAR PTR IODEFINE
                           128                     
000F 9A0000----     E      129     call set_timer2
0014 FB                    130                    STI
                           131     
                           132     ; ^^^^^^^^^^^^^^^^^  Start of User Main Routine  ^^^^^^^^^^^^^^^^^^
                           133     
                           134     ;Initialize MMCS
                           135             
0015 BAA6FF                136             MOV DX, MMCS
0018 B80340                137             MOV AX, 4003H
001B EF                    138             OUT DX, AX
                           139     
                           140     ; Initialize MPCS to MAP peripheral to IO address
                           141             
001C BAA8FF                142             MOV DX, MPCS
001F B88320                143             MOV AX, 2083H
0022 EF                    144             OUT DX, AX
                           145        
                           146     ; PCSBA initial, set the parallel port start from 00H
0023 BAA4FF                147             MOV DX, PCSBA
0026 B80300                148             MOV AX, 0003H ; Peripheral starting address 00H no READY, No Waits
0029 EF                    149             OUT DX, AX
                           150     
                           151     ; Initialize LMCS 
002A BAA2FF                152         MOV DX, LMCR
002D B8C401                153         MOV AX, 01C4H  ; Starting address 1FFFH, 8K, No waits, last shoud be 5H for 1 wai
                                   ts      
0030 EF                    154         OUT DX, AX
                           155             
0031 B8----         R      156             MOV AX, DATA_SEG
0034 8ED8                  157             MOV DS, AX
                           158                              
0036 BA8300                159             MOV DX, CWR_8255
0039 B88200                160             MOV AX, 0082h
003C EF                    161             OUT DX, AX
                           162             
003D                       163     NEXT:
003D 9A4400----     R      164             CALL FAR PTR KEYPAD_LOOP
                           165             
0042 EBF9                  166     JMP NEXT
                           167     
0044                       168     KEYPAD_LOOP PROC FAR
0044 50                    169     PUSH AX
0045 53                    170     PUSH BX
0046 51                    171     PUSH CX
0047 52                    172     PUSH DX
                           173             
0048 9AD606----     R      174                             CALL FAR PTR DEBOUNCE           
                           175                             
004D C606790003            176     WAIT_1:         MOV DS:REG_AL, 03H
0052 BB0000                177                         MOV BX, 0000H
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:51:02  12/08/;3  PAGE    5


LOC  OBJ                  LINE     SOURCE

0055 BA8200                178                         MOV DX,C_8255
0058 8AC3                  179                         MOV AL,BL
005A EE                    180                         OUT DX,AL
                           181                        
005B BA8100                182                         MOV DX,B_8255
005E EC                    183                         IN AL,DX
005F 8AD8                  184                         MOV BL,AL  
0061 80E3FC                185                         AND BL,0FCH
0064 80FBFC                186                         CMP BL,0FCH
                           187                      
0067 744F                  188                     JE LONG_PRESS
                           189                             
0069 B3FE                  190                         MOV BL, 0FEH
006B C6067A0004            191                         MOV DS:REG_BH, 04H
                           192                        
0070                       193     NXTROW: 
0070 C0C307                194                     ROL BL,07H
0073 8AEB                  195                             MOV CH,BL
0075 BA8200                196                             MOV DX,C_8255
0078 8AC3                  197                             MOV AL,BL
007A EE                    198                             OUT DX,AL
                           199                             
007B BA8100                200                             MOV DX,B_8255
007E EC                    201                             IN AL,DX
007F 8AD8                  202                             MOV BL,AL
0081 80E3FC                203                             AND BL,0FCH
0084 C6067B0006            204                             MOV DS:REG_CL,06H
0089 C0DB02                205                             RCR BL,02H
008C D0DB                  206     NXTCOL:         RCR BL,01H
008E 7330                  207                             JNC CODEKY
0090 FE0E7900              208                             DEC DS:REG_AL
0094 FE0E7B00              209                             DEC DS:REG_CL
0098 803E7B0003            210                             CMP DS:REG_CL,03H
009D 7413                  211                             JE KEYPAD4
                           212                             
009F 803E7B0000            213                             CMP DS:REG_CL, 0H
00A4 740F                  214                             JE SUBTRACT3
00A6 EBE4                  215                             JMP NXTCOL
                           216                             
00A8 8ADD                  217                             MOV BL,CH
00AA FE0E7A00              218                             DEC DS:REG_BH
00AE 75C0                  219                             JNZ NXTROW
00B0 EB9B                  220                             JMP WAIT_1
                           221                             
00B2 E97F00                222     KEYPAD4:    JMP KEYPAD3
00B5 E97F00                223     SUBTRACT3:  JMP SUBTRACT2
                           224                             
00B8                       225     LONG_PRESS:
00B8 C6067D0000            226                             MOV DS:LONG_PRESS_FLAG, 0
00BD EB7290                227                             JMP RETURN2
00C0                       228     CODEKY:
00C0 803E79000B            229                         CMP DS:REG_AL, 11
00C5 7505                  230                             JNE bcd_upd
00C7 C606790000            231                             MOV DS:REG_AL, 0
                           232                             
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:51:02  12/08/;3  PAGE    6


LOC  OBJ                  LINE     SOURCE

00CC                       233     bcd_upd:
00CC 803E7D0000            234                             CMP DS:LONG_PRESS_FLAG, 0
00D1 755E                  235                             JNE RETURN2
                           236                             
00D3 803E790018            237                             CMP DS:REG_AL, 24
00D8 7560                  238                             JNE TROLLEY
00DA 833EEF0000            239                             CMP DS:TRANSACTION_OVER, 0
00DF 7459                  240                             JE TROLLEY
00E1 BB0000                241                             MOV BX, 0
00E4 C6878D003E            242                             MOV DS:SEND_BUFFER[BX], '>'
                           243                             
00E9 B90800                244                             MOV CX, 8
00EC                       245                             SEND_CASH_PRINT:
00EC 53                    246                                     PUSH BX
00ED BB0800                247                                     MOV BX, 8
00F0 2BD9                  248                                     SUB BX, CX
00F2 8A87D100              249                                     MOV AL, DS:CASH_AMT[BX]
00F6 5B                    250                                     POP BX
                           251                                     
00F7 43                    252                                     INC BX
00F8 0430                  253                                     ADD AL, 30H
00FA 88878D00              254                                     MOV DS:SEND_BUFFER[BX], AL
00FE E2EC                  255                             LOOP SEND_CASH_PRINT
                           256                             
0100 43                    257                             INC BX
0101 C6878D0029            258                             MOV DS:SEND_BUFFER[BX], ')'
                           259                             
0106 B90800                260                             MOV CX, 8
0109                       261                             SEND_CHANGE_PRINT:
0109 53                    262                                     PUSH BX
010A BB0800                263                                     MOV BX, 8
010D 2BD9                  264                                     SUB BX, CX
010F 8A87C100              265                                     MOV AL, DS:TEMP_BCD_ARR[BX]
0113 5B                    266                                     POP BX
                           267                                     
0114 43                    268                                     INC BX
0115 0430                  269                                     ADD AL, 30H
0117 88878D00              270                                     MOV DS:SEND_BUFFER[BX], AL
011B E2EC                  271                             LOOP SEND_CHANGE_PRINT
                           272                             
011D 43                    273                             INC BX
011E C6878D002F            274                             MOV DS:SEND_BUFFER[BX], '/'
0123 C706A1001300          275                             MOV DS:SEND_BUFFER_LEN, 19
0129 C6068C0001            276                             MOV DS:SEND_FLAG, 1
012E E96002                277                             JMP UPDATE_7SEG2
                           278                             
0131 E97703                279     RETURN2:    JMP RETURN
                           280                             
0134 E95603                281     KEYPAD3:        JMP KEYPAD_2
                           282                             
0137 E96303                283     SUBTRACT2:   JMP SUBTRACT
                           284     
013A                       285     TROLLEY:
013A 803E790011            286                             CMP DS:REG_AL, 17
013F 754C                  287                             JNE ENTER_CASH
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:51:02  12/08/;3  PAGE    7


LOC  OBJ                  LINE     SOURCE

                           288                             
0141 833E010101            289                             CMP DS:TROLLEY_DISABLED, 1
0146 7442                  290                             JE SKIP_ENTER_DATA1
                           291                             
0148 833ECF0001            292                             CMP DS:CASH_FLAG, 1
014D 743B                  293                             JE SKIP_ENTER_DATA1
014F 9A2506----     R      294                             CALL FAR PTR BCD_CLEAR
                           295                             
0154 833EEF0000            296                             CMP DS:TRANSACTION_OVER, 0
0159 7405                  297                             JE NO_RESET_NEEDED1
                           298                             
015B 9AE304----     R      299                             CALL FAR PTR CLEAR_TEMP_BCD
                           300                             
0160                       301             NO_RESET_NEEDED1:
0160 C706F1000100          302                             MOV DS:DATA_ENTER, 1
0166 C706B3000600          303                             MOV DS:DECIMAL_INDEX, 6
016C C706A3000600          304                             MOV DS:MAX_INPUT_SIZE, 6
0172 C706FF000100          305                             MOV DS:TROLLEY_ID, 1
0178 C706B5000000          306                             MOV DS:LANG_FLAG, 0
017E C706CF000000          307                             MOV DS:CASH_FLAG, 0
0184 C706EF000000          308                             MOV DS:TRANSACTION_OVER, 0
018A                       309             SKIP_ENTER_DATA1:
018A E90402                310                             JMP UPDATE_7SEG2
                           311                             
                           312                             
018D                       313     ENTER_CASH:     
018D 803E790014            314                             CMP DS:REG_AL, 20
0192 7521                  315                             JNE SEND_CASH
0194 833ECF0000            316                             CMP DS:CASH_FLAG, 0
0199 7417                  317                             JE SKIP_CASH
019B C706F1000100          318                             MOV DS:DATA_ENTER, 1
01A1 9A2506----     R      319                             CALL FAR PTR BCD_CLEAR
01A6 C706A3000600          320                             MOV DS:MAX_INPUT_SIZE, 6
01AC C706B3000600          321                             MOV DS:DECIMAL_INDEX, 6
01B2                       322                     SKIP_CASH:
01B2 E9DC01                323                             JMP UPDATE_7SEG2
                           324                             
01B5                       325     SEND_CASH:
01B5 803E790017            326                             CMP DS:REG_AL, 23
01BA 7529                  327                             JNE CLEAR_BUTTON
01BC 833ECF0000            328                             CMP DS:CASH_FLAG, 0
01C1 741F                  329                             JE SKIP_SEND_CASH
01C3 833E610000            330                             CMP DS:KEYPAD_INDEX, 0
01C8 7418                  331                             JE SKIP_SEND_CASH
01CA 833EB30003            332                             CMP DS:DECIMAL_INDEX, 3
01CF 7411                  333                             JE SKIP_SEND_CASH
01D1 C706F1000000          334                             MOV DS:DATA_ENTER, 0
01D7 C706A3000800          335                             MOV DS:MAX_INPUT_SIZE, 8
01DD 9AFB06----     R      336                             CALL FAR PTR TAKE_CASH
01E2                       337                     SKIP_SEND_CASH:
01E2 E9AC01                338                             JMP UPDATE_7SEG2
                           339                             
01E5                       340     CLEAR_BUTTON:
01E5 803E79000A            341                             CMP DS:REG_AL, 10
01EA 7508                  342                             JNE BACKSPACE
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:51:02  12/08/;3  PAGE    8


LOC  OBJ                  LINE     SOURCE

01EC 9A2506----     R      343                             CALL FAR PTR BCD_CLEAR
01F1 E99D01                344                             JMP UPDATE_7SEG2
                           345                             
01F4 803E79000C            346     BACKSPACE:      CMP DS:REG_AL, 12
01F9 7508                  347                             JNE ENTER_DATA
01FB 9AB605----     R      348                             CALL FAR PTR BCD_BACKSPACE
0200 E98E01                349                             JMP UPDATE_7SEG2
                           350     
0203 803E79000D            351     ENTER_DATA:     CMP DS:REG_AL, 13
0208 753F                  352                             JNE END_TRANS
020A 833ECF0001            353                             CMP DS:CASH_FLAG, 1
020F 7435                  354                             JE SKIP_ENTER_DATA
0211 9A2506----     R      355                             CALL FAR PTR BCD_CLEAR
                           356                             
0216 833EEF0000            357                             CMP DS:TRANSACTION_OVER, 0
021B 7405                  358                             JE NO_RESET_NEEDED
                           359                             
021D 9AE304----     R      360                             CALL FAR PTR CLEAR_TEMP_BCD
                           361                             
0222                       362             NO_RESET_NEEDED:
0222 C706F1000100          363                             MOV DS:DATA_ENTER, 1
0228 C706B3000600          364                             MOV DS:DECIMAL_INDEX, 6
022E C706A3000800          365                             MOV DS:MAX_INPUT_SIZE, 8
0234 C706B5000000          366                             MOV DS:LANG_FLAG, 0
023A C706CF000000          367                             MOV DS:CASH_FLAG, 0
0240 C706EF000000          368                             MOV DS:TRANSACTION_OVER, 0
0246                       369             SKIP_ENTER_DATA:
0246 E94801                370                             JMP UPDATE_7SEG2
                           371                             
0249 803E790010            372     END_TRANS:      CMP DS:REG_AL, 16
024E 7553                  373                             JNE CANCEL_TRANS
0250 833EFF0001            374                             CMP DS:TROLLEY_ID, 1
0255 7449                  375                             JE END_TRANS_CONT
0257 833ECF0001            376                             CMP DS:CASH_FLAG, 1
025C 7442                  377                             JE END_TRANS_CONT
025E 833EEF0000            378                             CMP DS:TRANSACTION_OVER, 0
0263 7403                  379                             JE TRANSACTION_NOT_OVER
0265 E92901                380                             JMP UPDATE_7SEG2
0268                       381     TRANSACTION_NOT_OVER:
0268 BB0000                382                             MOV BX, 0
026B C6878D0024            383                             MOV DS:SEND_BUFFER[BX], '$'
0270 43                    384                             INC BX
0271 C6878D002F            385                             MOV DS:SEND_BUFFER[BX], '/'
0276 C706A1000200          386                             MOV DS:SEND_BUFFER_LEN, 2
027C C6068C0001            387                             MOV DS:SEND_FLAG, 1
0281 C706BF000000          388                             MOV DS:TOTAL_PRICE_DEC, 0
0287 C706BD000000          389                             MOV DS:TOTAL_PRICE_L, 0
028D C706BB000000          390                             MOV DS:TOTAL_PRICE_U, 0
0293 833EED0001            391                             CMP DS:CANCEL_FLAG, 1
0298 7406                  392                             JE END_TRANS_CONT
029A C706CF000100          393                             MOV DS:CASH_FLAG, 1
02A0                       394                     END_TRANS_CONT:
02A0 E9EE00                395                             JMP UPDATE_7SEG2
                           396                             
02A3                       397     CANCEL_TRANS:   
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:51:02  12/08/;3  PAGE    9


LOC  OBJ                  LINE     SOURCE

02A3 803E79000F            398                             CMP DS:REG_AL, 15
02A8 755A                  399                             JNE SCROLL_LEFT
02AA 833ECF0001            400                             CMP DS:CASH_FLAG, 1
02AF 7503                  401                             JNE CONT_CANCEL
02B1 E9DD00                402                             JMP UPDATE_7SEG2
02B4                       403                     CONT_CANCEL:
02B4 BB0000                404                             MOV BX, 0
02B7 C6878D003F            405                             MOV DS:SEND_BUFFER[BX], '?'
02BC 43                    406                             INC BX
02BD C6878D002F            407                             MOV DS:SEND_BUFFER[BX], '/'
02C2 C706A1000200          408                             MOV DS:SEND_BUFFER_LEN, 2
02C8 C6068C0001            409                             MOV DS:SEND_FLAG, 1
02CD C706BF000000          410                             MOV DS:TOTAL_PRICE_DEC, 0
02D3 C706BD000000          411                             MOV DS:TOTAL_PRICE_L, 0
02D9 C706BB000000          412                             MOV DS:TOTAL_PRICE_U, 0
02DF C706B3000300          413                             MOV DS:DECIMAL_INDEX, 3
02E5 9A2506----     R      414                             CALL FAR PTR BCD_CLEAR
02EA C706A3000000          415                             MOV DS:MAX_INPUT_SIZE, 0
                           416                             
02F0 9AE304----     R      417                             CALL FAR PTR CLEAR_TEMP_BCD
                           418                             
02F5 C706ED000100          419                             MOV DS:CANCEL_FLAG, 1
02FB C70601010000          420                             MOV DS:TROLLEY_DISABLED, 0
0301 E98D00                421                             JMP UPDATE_7SEG2
                           422                             
0304                       423     SCROLL_LEFT:
0304 803E790015            424                             CMP DS:REG_AL, 21
0309 753D                  425                             JNE SCROLL_RIGHT
030B 833E610006            426                             CMP DS:KEYPAD_INDEX, 6
0310 7E7F                  427                             JLE UPDATE_7SEG2
0312 833EAF0000            428                             CMP DS:SCROLL_LEN, 0
0317 7478                  429                             JE UPDATE_7SEG2
0319 FF0EAF00              430                             DEC DS:SCROLL_LEN
031D FF0EB300              431                             DEC DS:DECIMAL_INDEX
0321 FF0E6100              432                             DEC DS:KEYPAD_INDEX
0325 8B1E6100              433                             MOV BX, DS:KEYPAD_INDEX
0329 8A4751                434                             MOV AL, DS:KEYPAD_INPUT[BX]
032C A27900                435                             MOV DS:REG_AL, AL
032F C706B1000100          436                             MOV DS:DAC_DISABLE, 1
0335 9A5006----     R      437                             CALL FAR PTR BCD_UPDATE
033A C706B1000000          438                             MOV DS:DAC_DISABLE, 0
0340 C606790015            439                             MOV DS:REG_AL, 21
0345 EB4A90                440                             JMP UPDATE_7SEG2
                           441     
0348                       442     SCROLL_RIGHT:
0348 803E790013            443                             CMP DS:REG_AL, 19
034D 7545                  444                             JNE LANG_TOGGLE
034F 833E610006            445                             CMP DS:KEYPAD_INDEX, 6
0354 7E3B                  446                             JLE UPDATE_7SEG2
0356 A16100                447                             MOV AX, DS:KEYPAD_INDEX
0359 2D0600                448                             SUB AX, 6
035C 3906AF00              449                             CMP DS:SCROLL_LEN, AX
0360 742F                  450                             JE UPDATE_7SEG2
0362 FF06AF00              451                             INC DS:SCROLL_LEN
0366 FF06B300              452                             INC DS:DECIMAL_INDEX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:51:02  12/08/;3  PAGE   10


LOC  OBJ                  LINE     SOURCE

036A FF0E6100              453                             DEC DS:KEYPAD_INDEX
036E 8B1E6100              454                             MOV BX, DS:KEYPAD_INDEX
0372 8A4751                455                             MOV AL, DS:KEYPAD_INPUT[BX]
0375 A27900                456                             MOV DS:REG_AL, AL
0378 C706B1000100          457                             MOV DS:DAC_DISABLE, 1
037E 9A5006----     R      458                             CALL FAR PTR BCD_UPDATE
0383 C706B1000000          459                             MOV DS:DAC_DISABLE, 0
0389 C606790013            460                             MOV DS:REG_AL, 19
038E EB0190                461                             JMP UPDATE_7SEG2
                           462                             
0391 E9DE00                463     UPDATE_7SEG2: JMP UPDATE_7SEG
                           464     
0394                       465     LANG_TOGGLE:
0394 803E790012            466                             CMP DS:REG_AL, 18
0399 7537                  467                             JNE QTY_PROMPT
039B 833EB50001            468                             CMP DS:LANG_FLAG, 1
03A0 75EF                  469                             JNE UPDATE_7SEG2
03A2 A16400                470                             MOV AX, DS:DAC_BASE
03A5 3D0040                471                             CMP AX, 4000H
03A8 7406                  472                             JE MANDRIN
03AA B80040                473                             MOV AX, 4000H
03AD EB0490                474                             JMP SEND_TOGGLE
03B0                       475             MANDRIN:
03B0 B80066                476                             MOV AX, 6600H
03B3                       477             SEND_TOGGLE:
03B3 A36400                478                             MOV DS:DAC_BASE, AX
03B6 BB0000                479                             MOV BX, 0
03B9 C6878D0021            480                             MOV DS:SEND_BUFFER[BX], '!'
03BE 43                    481                             INC BX
03BF C6878D002F            482                             MOV DS:SEND_BUFFER[BX], '/'
03C4 C706A1000200          483                             MOV DS:SEND_BUFFER_LEN, 2
03CA C6068C0001            484                             MOV DS:SEND_FLAG, 1
03CF E9A000                485                             JMP UPDATE_7SEG
03D2                       486     QTY_PROMPT:
03D2 803E790016            487                             CMP DS:REG_AL, 22
03D7 7527                  488                             JNE QUANTITY
03D9 833ECF0001            489                             CMP DS:CASH_FLAG, 1
03DE 7420                  490                             JE QUANTITY
03E0 833E610008            491                             CMP DS:KEYPAD_INDEX, 8
03E5 7519                  492                             JNE  QUANTITY
                           493                             ; CMP DS:MAX_INPUT_SIZE, 8
                           494                             ; JNE QUANTITY
03E7 9A6F05----     R      495                             CALL FAR PTR UPDATE_SEND_BUFFER
03EC 9A2506----     R      496                             CALL FAR PTR BCD_CLEAR
03F1 C706A3000200          497                             MOV DS:MAX_INPUT_SIZE, 2
03F7 C706A5000100          498                             MOV DS:QTY_FLAG, 1
03FD EB7390                499                             JMP UPDATE_7SEG
                           500                     
0400                       501     QUANTITY:
0400 833E610000            502                             CMP DS:KEYPAD_INDEX, 0
0405 746B                  503                             JE  UPDATE_7SEG
                           504                             
0407 803E79000E            505                             CMP DS:REG_AL, 14
040C 7564                  506                             JNE UPDATE_7SEG
                           507                             
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:51:02  12/08/;3  PAGE   11


LOC  OBJ                  LINE     SOURCE

040E 833EFF0001            508                             CMP DS:TROLLEY_ID, 1
0413 752C                  509                             JNE NORMAL_UPDATE
                           510                             
0415 833E610006            511                             CMP DS:KEYPAD_INDEX, 6
041A 7525                  512                             JNE NORMAL_UPDATE
                           513                             
041C 9AB004----     R      514                             CALL FAR PTR UPDATE_TROLLEY_ID
                           515                             
0421 C706FF000000          516                             MOV DS:TROLLEY_ID, 0
0427 C6068C0001            517                             MOV DS:SEND_FLAG, 1
042C C706F1000000          518                             MOV DS:DATA_ENTER, 0
0432 C706ED000000          519                             MOV DS:CANCEL_FLAG, 0
0438 C706CF000100          520                             MOV DS:CASH_FLAG, 1
                           521                             
043E EB3290                522                             JMP UPDATE_7SEG
                           523                             
0441                       524                     NORMAL_UPDATE:  
0441 833EA50001            525                             CMP DS:QTY_FLAG, 1
0446 752A                  526                             JNE UPDATE_7SEG
                           527                             
0448 C706F1000000          528                             MOV DS:DATA_ENTER, 0
                           529                             
044E C706ED000000          530                             MOV DS:CANCEL_FLAG, 0
                           531                     
0454 9A1E05----     R      532                             CALL FAR PTR UPDATE_THE_QUANTITY
                           533                             
0459 C70601010100          534                             MOV DS:TROLLEY_DISABLED, 1
045F C6068C0001            535                             MOV DS:SEND_FLAG, 1
                           536                             
0464 C706A5000000          537                             MOV DS:QTY_FLAG, 0
046A 9A2506----     R      538                             CALL FAR PTR BCD_CLEAR
046F EB0190                539                             JMP UPDATE_7SEG
                           540                             
                           541     
0472                       542     UPDATE_7SEG:
0472 803E790009            543                             CMP DS:REG_AL, 9
0477 7F0C                  544                             JG SET_PRESS_FLAG
                           545                             
0479 833EF10001            546                             CMP DS:DATA_ENTER, 1
047E 7505                  547                             JNE SET_PRESS_FLAG
                           548                             
0480 9A5006----     R      549                             CALL FAR PTR BCD_UPDATE
                           550                             
0485                       551     SET_PRESS_FLAG:
0485 C6067D0001            552                             MOV DS:LONG_PRESS_FLAG, 1
048A EB1F90                553                             JMP RETURN
                           554             
048D                       555     KEYPAD_2: 
048D 800679000F            556                 ADD DS:REG_AL,0FH
0492 E9F7FB                557                             JMP NXTCOL
0495 C606790000            558     ZERO_PRINT: MOV DS:REG_AL,00H
049A E9EFFB                559                             JMP NXTCOL
049D 802E790006            560     SUBTRACT:   SUB DS:REG_AL,06H
04A2 8ADD                  561                             MOV BL,CH
04A4 FE0E7A00              562                             DEC DS:REG_BH
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:51:02  12/08/;3  PAGE   12


LOC  OBJ                  LINE     SOURCE

04A8 E9C5FB                563                             JMP NXTROW
                           564             
                           565             
04AB                       566     RETURN:
04AB 5A                    567                             POP DX
04AC 59                    568                             POP CX
04AD 5B                    569                             POP BX
04AE 58                    570                             POP AX
04AF CB                    571                             RET
                           572     
                           573     KEYPAD_LOOP ENDP
                           574     
04B0                       575     UPDATE_TROLLEY_ID PROC FAR
04B0 50                    576     PUSH AX
04B1 53                    577     PUSH BX
04B2 51                    578     PUSH CX
04B3 52                    579     PUSH DX
04B4 BB0000                580             MOV BX, 0
04B7 C6878D005E            581             MOV DS:SEND_BUFFER[BX], '^'
04BC B90600                582             MOV CX, 6
04BF                       583             UPDATE_TROLLEY_BUFFER:
04BF BB0600                584                     MOV BX, 6
04C2 2BD9                  585                     SUB BX, CX
                           586                     
04C4 8A4751                587                     MOV AL, DS:KEYPAD_INPUT[BX]
                           588                     
04C7 43                    589                     INC BX
04C8 0430                  590                     ADD AL, 30H
04CA 88878D00              591                     MOV DS:SEND_BUFFER[BX], AL
04CE E2EF                  592             LOOP UPDATE_TROLLEY_BUFFER
                           593             
04D0 BB0700                594             MOV BX, 7
04D3 C6878D002F            595             MOV DS:SEND_BUFFER[BX], '/'
                           596             
04D8 C706A1000800          597             MOV DS:SEND_BUFFER_LEN, 8
                           598     
04DE 5A                    599     POP DX
04DF 59                    600     POP CX
04E0 5B                    601     POP BX
04E1 58                    602     POP AX
04E2 CB                    603     RET
                           604     UPDATE_TROLLEY_ID ENDP
                           605     
04E3                       606     CLEAR_TEMP_BCD PROC FAR
04E3 50                    607     PUSH AX
04E4 53                    608     PUSH BX
04E5 51                    609     PUSH CX
04E6 52                    610     PUSH DX
                           611     
04E7 BB0000                612             MOV BX, 0
04EA C687C1002D            613             MOV DS:TEMP_BCD_ARR[BX], '-'
04EF 43                    614             INC BX
04F0 C687C1002D            615             MOV DS:TEMP_BCD_ARR[BX], '-'
04F5 43                    616             INC BX
04F6 C687C1002D            617             MOV DS:TEMP_BCD_ARR[BX], '-'
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:51:02  12/08/;3  PAGE   13


LOC  OBJ                  LINE     SOURCE

04FB 43                    618             INC BX
04FC C687C1002D            619             MOV DS:TEMP_BCD_ARR[BX], '-'
0501 43                    620             INC BX
0502 C687C1002D            621             MOV DS:TEMP_BCD_ARR[BX], '-'
0507 43                    622             INC BX
0508 C687C1002D            623             MOV DS:TEMP_BCD_ARR[BX], '-'
050D 43                    624             INC BX
050E C687C1002D            625             MOV DS:TEMP_BCD_ARR[BX], '-'
0513 43                    626             INC BX
0514 C687C1002D            627             MOV DS:TEMP_BCD_ARR[BX], '-'
                           628             
0519 5A                    629     POP DX
051A 59                    630     POP CX
051B 5B                    631     POP BX
051C 58                    632     POP AX
051D CB                    633     RET
                           634     CLEAR_TEMP_BCD ENDP
                           635     
                           636     
051E                       637     UPDATE_THE_QUANTITY PROC FAR
051E 50                    638     PUSH AX
051F 53                    639     PUSH BX
0520 51                    640     PUSH CX
0521 52                    641     PUSH DX
0522 8B0E6100              642             MOV CX, DS:KEYPAD_INDEX
0526 BB0000                643             MOV BX, 0
0529 BA0000                644             MOV DX, 0
052C                       645             UPD_QTY:
052C A1B900                646                     MOV AX, DS:QTY
052F 53                    647                     PUSH BX
0530 BB0A00                648                     MOV BX, 10
0533 F7E3                  649                     MUL BX
0535 5B                    650                     POP BX
0536 8A5751                651                     MOV DL, DS:KEYPAD_INPUT[BX]
0539 03C2                  652                     ADD AX, DX
053B A3B900                653                     MOV DS:QTY, AX
053E 43                    654                     INC BX
053F E2EB                  655             LOOP UPD_QTY
                           656             
0541 8B0E6100              657             MOV CX, DS:KEYPAD_INDEX
0545 8B1EA100              658             MOV BX, DS:SEND_BUFFER_LEN
                           659             
0549                       660             UPD_BUFFER:
0549 53                    661                     PUSH BX
054A 8B1E6100              662                     MOV BX, DS:KEYPAD_INDEX
054E 2BD9                  663                     SUB BX, CX
0550 8A4751                664                     MOV AL, DS:KEYPAD_INPUT[BX]
0553 5B                    665                     POP BX
0554 0430                  666                     ADD AL, 30H
0556 88878D00              667                     MOV DS:SEND_BUFFER[BX], AL
                           668                     
055A 43                    669                     INC BX
055B FF06A100              670                     INC DS:SEND_BUFFER_LEN
055F E2E8                  671             LOOP UPD_BUFFER
                           672             
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:51:02  12/08/;3  PAGE   14


LOC  OBJ                  LINE     SOURCE

0561 C6878D002F            673             MOV DS:SEND_BUFFER[BX], '/'
0566 FF06A100              674             INC DS:SEND_BUFFER_LEN
                           675                     
056A 5A                    676     POP DX
056B 59                    677     POP CX
056C 5B                    678     POP BX
056D 58                    679     POP AX
                           680     
056E CB                    681     RET
                           682     UPDATE_THE_QUANTITY ENDP
                           683     
056F                       684     UPDATE_SEND_BUFFER PROC FAR
056F 50                    685     PUSH AX
0570 53                    686     PUSH BX
0571 51                    687     PUSH CX
0572 52                    688     PUSH DX
                           689     
0573 8B0E6100              690             MOV CX, DS:KEYPAD_INDEX
0577 83F900                691             CMP CX, 0
057A 7435                  692             JE END_UPD_BUFFER
057C 83C102                693             ADD CX, 2
057F 890EA100              694             MOV DS:SEND_BUFFER_LEN, CX
0583 BB0000                695             MOV BX, 0
0586                       696             BUFFER_LOOP:
0586 83FB00                697                     CMP BX, 0
0589 7508                  698                     JNE ASTERISK
058B C6878D007E            699                     MOV DS:SEND_BUFFER[BX], '~'
0590 EB1C90                700                     JMP END_BUFFER
0593                       701             ASTERISK:
0593 A16100                702                     MOV AX, DS:KEYPAD_INDEX
0596 40                    703                     INC AX
0597 3BD8                  704                     CMP BX, AX
0599 7508                  705                     JNE CONT
059B C6878D002A            706                     MOV DS:SEND_BUFFER[BX], '*'
05A0 EB0C90                707                     JMP END_BUFFER
05A3                       708             CONT:
05A3 4B                    709                     DEC BX
05A4 8A4751                710                     MOV AL, DS:KEYPAD_INPUT[BX]
05A7 0430                  711                     ADD AL, 30H
05A9 43                    712                     INC BX
05AA 88878D00              713                     MOV DS:SEND_BUFFER[BX], AL
                           714                     
05AE                       715             END_BUFFER:
05AE 43                    716                     INC BX
05AF E2D5                  717             LOOP BUFFER_LOOP
05B1                       718     END_UPD_BUFFER:
05B1 5A                    719     POP DX
05B2 59                    720     POP CX
05B3 5B                    721     POP BX
05B4 58                    722     POP AX
05B5 CB                    723     RET
                           724     UPDATE_SEND_BUFFER ENDP
                           725     
05B6                       726     BCD_BACKSPACE PROC FAR
                           727     
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:51:02  12/08/;3  PAGE   15


LOC  OBJ                  LINE     SOURCE

05B6 50                    728     PUSH AX
05B7 53                    729     PUSH BX
05B8 51                    730     PUSH CX
05B9 52                    731     PUSH DX
                           732     
05BA 8A167900              733             MOV DL, DS:REG_AL
05BE 833E610000            734             CMP DS:KEYPAD_INDEX, 0
05C3 7457                  735             JE RETURN_BACK
                           736             
05C5 BB0600                737             MOV BX, 6
05C8                       738             BCD_CLEAR_LOOP:
05C8 4B                    739                     DEC BX
05C9 C647592D              740                     MOV DS:BCD_MESSAGE[BX], '-'
05CD 43                    741                     INC BX
05CE 4B                    742                     DEC BX
05CF 75F7                  743             JNZ BCD_CLEAR_LOOP
                           744             
05D1 833E610001            745             CMP DS:KEYPAD_INDEX, 1
05D6 7E2C                  746             JLE less_than_two
                           747             
05D8 FF0E6100              748             DEC DS:KEYPAD_INDEX
05DC FF0E6100              749             DEC DS:KEYPAD_INDEX
05E0 8B1E6100              750             MOV BX, DS:KEYPAD_INDEX
05E4 8A4751                751             MOV AL, DS:KEYPAD_INPUT[BX]
05E7 A27900                752             MOV DS:REG_AL, AL
05EA C706AF000000          753             MOV DS:SCROLL_LEN, 0
05F0 C706B1000100          754             MOV DS:DAC_DISABLE, 1
05F6 9A5006----     R      755             CALL FAR PTR BCD_UPDATE
05FB C706B1000000          756             MOV DS:DAC_DISABLE, 0
0601 EB1990                757             JMP RETURN_BACK
                           758             
0604                       759     less_than_two:
0604 FF0E6100              760             DEC DS:KEYPAD_INDEX
0608 C60679002D            761             MOV DS:REG_AL, '-'
060D C706AF000000          762             MOV DS:SCROLL_LEN, 0
0613 9A5006----     R      763             CALL FAR PTR BCD_UPDATE
0618 FF0E6100              764             DEC DS:KEYPAD_INDEX
                           765             
061C                       766     RETURN_BACK:
061C 88167900              767             MOV DS:REG_AL, DL
0620 5A                    768     POP DX
0621 59                    769     POP CX
0622 5B                    770     POP BX
0623 58                    771     POP AX
                           772     
0624 CB                    773     RET
                           774     BCD_BACKSPACE ENDP
                           775     
0625                       776     BCD_CLEAR PROC FAR
0625 50                    777     PUSH AX
0626 53                    778     PUSH BX
0627 51                    779     PUSH CX
0628 52                    780     PUSH DX
0629 BB0800                781             MOV BX, 8
062C                       782             CLEAR_LOOP:
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:51:02  12/08/;3  PAGE   16


LOC  OBJ                  LINE     SOURCE

062C C6475100              783             MOV DS:KEYPAD_INPUT[BX], 0
0630 4B                    784             DEC BX
0631 75F9                  785             JNZ CLEAR_LOOP
                           786             
0633 BB0600                787             MOV BX, 6
0636                       788             CLEAR_LOOP2:
0636 4B                    789                     DEC BX
0637 C647592D              790                     MOV DS:BCD_MESSAGE[BX], '-'
063B 43                    791                     INC BX
063C 4B                    792                     DEC BX
063D 75F7                  793             JNZ CLEAR_LOOP2
                           794     
063F C70661000000          795             MOV DS:KEYPAD_INDEX, 0
0645 C706AF000000          796             MOV DS:SCROLL_LEN, 0
064B 5A                    797     POP DX
064C 59                    798     POP CX
064D 5B                    799     POP BX
064E 58                    800     POP AX
064F CB                    801     RET
                           802     BCD_CLEAR ENDP
                           803     
0650                       804     BCD_UPDATE PROC FAR
0650 50                    805     PUSH AX
0651 53                    806     PUSH BX
0652 51                    807     PUSH CX
0653 52                    808     PUSH DX
0654 A1A300                809                     MOV AX, DS:MAX_INPUT_SIZE
0657 39066100              810                     CMP DS:KEYPAD_INDEX, AX
065B 7D5A                  811                     JGE BCD_RET
                           812                     
065D 8A0E7900              813                     MOV CL, DS:REG_AL
0661 80F909                814                     CMP CL, 9
0664 7F0C                  815                     JG SKIP_PAST
0666 833EB10001            816                     CMP DS:DAC_DISABLE, 1
066B 7405                  817                     JE SKIP_PAST
066D 9ABC06----     R      818                     CALL FAR PTR DAC_UPDATE
                           819     
0672                       820     SKIP_PAST:              
0672 8A0E7900              821                     MOV CL, DS:REG_AL
                           822     
0676 8B1E6100              823                     MOV BX, DS:KEYPAD_INDEX
                           824                             
067A 884F51                825                     MOV DS:KEYPAD_INPUT[BX], CL
                           826                             
067D FF066100              827                     INC DS:KEYPAD_INDEX
                           828                             
0681 8B1E6100              829                     MOV BX, DS:KEYPAD_INDEX
                           830                     
0685 A1AF00                831                     MOV AX, DS:SCROLL_LEN
0688 2BD8                  832                     SUB BX, AX
                           833                     
068A 8B166100              834                     MOV DX, DS:KEYPAD_INDEX
068E 83FA06                835                     CMP DX, 6
0691 7E03                  836                     JLE update_display
0693 BA0600                837                     MOV DX, 6
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:51:02  12/08/;3  PAGE   17


LOC  OBJ                  LINE     SOURCE

                           838                     
0696                       839             update_display:
                           840             
0696 B90500                841                     MOV CX, 5
0699 4B                    842                     DEC BX
069A 8A4751                843                     MOV AL, DS:KEYPAD_INPUT[BX]
069D 43                    844                     INC BX
                           845                             
069E 52                    846                     PUSH DX
069F 8B166100              847                     MOV DX, DS:KEYPAD_INDEX
06A3 2B16AF00              848                     SUB DX, DS:SCROLL_LEN
                           849                     
06A7 2BD3                  850                     SUB DX, BX
                           851                             
06A9 53                    852                     PUSH BX
                           853                             
06AA 2BCA                  854                     SUB CX, DX
06AC 8BD9                  855                     MOV BX, CX
06AE 884759                856                     MOV DS:BCD_MESSAGE[BX], AL
                           857                             
06B1 5B                    858                     POP BX
06B2 5A                    859                     POP DX
                           860             
06B3 4B                    861                     DEC BX
06B4 4A                    862                     DEC DX
06B5 75DF                  863             JNZ update_display
                           864     
06B7                       865             BCD_RET:
06B7 5A                    866                     POP DX
06B8 59                    867                     POP CX
06B9 5B                    868                     POP BX
06BA 58                    869                     POP AX
06BB CB                    870     RET
                           871     BCD_UPDATE ENDP
                           872     
06BC                       873     DAC_UPDATE PROC FAR
06BC 50                    874             PUSH AX
06BD 53                    875             PUSH BX
06BE 51                    876             PUSH CX
06BF 52                    877             PUSH DX
                           878             
06C0 BB0000                879             MOV BX, 0
06C3 8A1E7500              880             MOV BL, DS:DAC_LEN
06C7 A07900                881             MOV AL, DS:REG_AL
                           882             
06CA 884766                883             MOV DS:DAC_ADDR[BX], AL
                           884             
06CD FE067500              885             INC DS:DAC_LEN
                           886     
06D1 5A                    887             POP DX
06D2 59                    888             POP CX
06D3 5B                    889             POP BX
06D4 58                    890             POP AX
06D5 CB                    891     RET
                           892     DAC_UPDATE ENDP
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:51:02  12/08/;3  PAGE   18


LOC  OBJ                  LINE     SOURCE

                           893               
06D6                       894     DEBOUNCE PROC FAR
06D6 51                    895                       PUSH CX
                           896                       
06D7 B94C09                897                       MOV CX, 094CH
06DA 90                    898     BACK:     NOP
06DB E2FD                  899                       LOOP BACK
06DD 59                    900                       POP CX
06DE CB                    901                       RET
                           902     DEBOUNCE  ENDP
                           903     
06DF                       904     SEND_INPUT PROC FAR
06DF 50                    905     PUSH AX
06E0 53                    906     PUSH BX
06E1 51                    907     PUSH CX
06E2 52                    908     PUSH DX
06E3 BB0000                909             MOV BX, 0
06E6 8B0EA100              910             MOV CX, DS:SEND_BUFFER_LEN
                           911             
06EA                       912             S_BUFF:
06EA 8A878D00              913                     MOV AL, DS:SEND_BUFFER[BX]
06EE 9A0000----     E      914                     CALL FAR PTR PRINT_CHAR
06F3 43                    915                     INC BX
06F4 E2F4                  916             LOOP S_BUFF
                           917             
06F6                       918     SEND_INPUT_END:
06F6 5A                    919     POP DX
06F7 59                    920     POP CX
06F8 5B                    921     POP BX
06F9 58                    922     POP AX
06FA CB                    923     RET
                           924     SEND_INPUT ENDP
                           925     
06FB                       926     TAKE_CASH PROC FAR
06FB 50                    927     PUSH AX
06FC 53                    928     PUSH BX
06FD 51                    929     PUSH CX
06FE 52                    930     PUSH DX
                           931             
06FF B90000                932             MOV CX, 0
0702 B108                  933             MOV CL, 8
0704                       934             CLEAR_CASH_AMT:
0704 8BD9                  935                     MOV BX, CX
0706 4B                    936                     DEC BX
0707 C687D10000            937                     MOV DS:CASH_AMT[BX], 0
070C E2F6                  938             LOOP CLEAR_CASH_AMT
                           939             
070E 8B0E6100              940             MOV CX, DS:KEYPAD_INDEX
0712 BA0600                941             MOV DX, 6
                           942             
0715                       943             UPDATE_CASH_AMT:
0715 8BD9                  944                     MOV BX, CX
0717 4B                    945                     DEC BX
                           946                     
0718 33C0                  947                     XOR AX, AX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:51:02  12/08/;3  PAGE   19


LOC  OBJ                  LINE     SOURCE

071A 8A4751                948                     MOV AL, DS:KEYPAD_INPUT[BX]
                           949                     
071D 8BDA                  950                     MOV BX, DX
071F 4B                    951                     DEC BX
0720 8887D100              952                     MOV DS:CASH_AMT[BX], AL
                           953                     
0724 4A                    954                     DEC DX
0725 E2EE                  955             LOOP UPDATE_CASH_AMT
                           956             
0727 C706E9000100          957             MOV DS:CASH_OK_FLAG, 1
072D C706EB000700          958             MOV DS:BORROW_POSITION, 7
0733 B90800                959             MOV CX, 8
0736                       960             CHECK_CASH:
0736 BB0800                961                     MOV BX, 8
0739 2BD9                  962                     SUB BX, CX
073B B80000                963                     MOV AX, 0
073E 8A87C100              964                     MOV AL, DS:TEMP_BCD_ARR[BX]
0742 8A97D100              965                     MOV DL, DS:CASH_AMT[BX]
0746 3AD0                  966                     CMP DL, AL
0748 741A                  967                     JE NEXT_CASH_DIGIT
                           968                     
074A 3AD0                  969                     CMP DL, AL
074C 7C0D                  970                     JL CASH_NOT_OK
                           971                     
074E C706E9000100          972                     MOV DS:CASH_OK_FLAG, 1
0754 891EEB00              973                     MOV DS:BORROW_POSITION, BX
                           974                     
0758 EB0C90                975                     JMP CHEK_CASH_DONE
                           976                     
075B                       977                     CASH_NOT_OK:
075B C706E9000000          978                     MOV DS:CASH_OK_FLAG, 0
0761 EB0390                979                     JMP CHEK_CASH_DONE
                           980                     
0764                       981             NEXT_CASH_DIGIT:
0764 E2D0                  982             LOOP CHECK_CASH
                           983             
0766                       984     CHEK_CASH_DONE:
                           985             
0766 833EE90001            986             CMP DS:CASH_OK_FLAG, 1
076B 7464                  987             JE CONTINUE_CASH
076D B90800                988             MOV CX, 8
0770 C70661000000          989             MOV DS:KEYPAD_INDEX, 0
0776 C706B3000300          990             MOV DS:DECIMAL_INDEX, 3
077C                       991             RETAIN_BCD:
077C BB0800                992                     MOV BX, 8
077F 2BD9                  993                     SUB BX, CX
                           994                     
0781 8A87C100              995                     MOV AL, DS:TEMP_BCD_ARR[BX]
0785 A27900                996                     MOV DS:REG_AL, AL
                           997                     
0788 C706B1000100          998                     MOV DS:DAC_DISABLE, 1
078E 9A5006----     R      999                     CALL FAR PTR BCD_UPDATE
0793 C706B1000000         1000                     MOV DS:DAC_DISABLE, 0
0799 E2E1                 1001             LOOP RETAIN_BCD
079B 813E64000040         1002             CMP DS:DAC_BASE, 4000H
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:51:02  12/08/;3  PAGE   20


LOC  OBJ                  LINE     SOURCE

07A1 7517                 1003             JNE MANDARIN_CASH
                          1004             
07A3 C606790023           1005             MOV DS:REG_AL, 35
07A8 9ABC06----     R     1006             CALL FAR PTR DAC_UPDATE
07AD C606790024           1007             MOV DS:REG_AL, 36
07B2 9ABC06----     R     1008             CALL FAR PTR DAC_UPDATE
07B7 E9B200               1009             JMP CASH_OVER
                          1010             
07BA                      1011     MANDARIN_CASH:
07BA C606790013           1012             MOV DS:REG_AL, 19
07BF 9ABC06----     R     1013             CALL FAR PTR DAC_UPDATE
07C4 C606790014           1014             MOV DS:REG_AL, 20
07C9 9ABC06----     R     1015             CALL FAR PTR DAC_UPDATE
07CE E99B00               1016             JMP CASH_OVER
                          1017             
07D1                      1018     CONTINUE_CASH:
07D1 8B1EEB00             1019             MOV BX, DS:BORROW_POSITION
07D5 B90700               1020             MOV CX, 7
07D8 2BCB                 1021             SUB CX, BX
07DA 83F900               1022             CMP CX, 0
07DD 740C                 1023             JE BEGIN_SUB
                          1024             
07DF                      1025             ADJUST_PLACES:
07DF FE8FD100             1026                     DEC DS:CASH_AMT[BX]
07E3 43                   1027                     INC BX
07E4 8087D1000A           1028                     ADD DS:CASH_AMT[BX], 10
07E9 E2F4                 1029             LOOP ADJUST_PLACES
                          1030             
07EB                      1031     BEGIN_SUB:
07EB B90800               1032             MOV CX, 8
07EE                      1033             CALC_CHANGE:
07EE BB0800               1034                     MOV BX, 8
07F1 2BD9                 1035                     SUB BX, CX
07F3 B80000               1036                     MOV AX, 0
07F6 8A87D100             1037                     MOV AL, DS:CASH_AMT[BX]
07FA BA0000               1038                     MOV DX, 0
07FD 8A97C100             1039                     MOV DL, DS:TEMP_BCD_ARR[BX]
0801 2BC2                 1040                     SUB AX, DX
0803 8987D900             1041                     MOV DS:TEMP_CASH_ARR[BX], AX
0807 E2E5                 1042             LOOP CALC_CHANGE
                          1043             
0809 B90800               1044             MOV CX, 8
080C                      1045             FIX_DIGITS:
080C 8BD9                 1046             MOV BX, CX
080E 4B                   1047             DEC BX
                          1048             
080F 8B87D900             1049             MOV AX, DS:TEMP_CASH_ARR[BX]
0813 3C0A                 1050             CMP AL, 10
0815 7C0A                 1051             JL NEXT_DIGIT_TO_FIX
                          1052             
0817 83AFD9000A           1053             SUB DS:TEMP_CASH_ARR[BX], 10
                          1054             
081C 4B                   1055             DEC BX
081D FF87D900             1056             INC DS:TEMP_CASH_ARR[BX]
                          1057             
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:51:02  12/08/;3  PAGE   21


LOC  OBJ                  LINE     SOURCE

0821                      1058             NEXT_DIGIT_TO_FIX:
                          1059             
0821 E2E9                 1060             LOOP FIX_DIGITS
                          1061             
0823 B90800               1062             MOV CX, 8
0826 C70661000000         1063             MOV DS:KEYPAD_INDEX, 0
082C C706B3000300         1064             MOV DS:DECIMAL_INDEX, 3
0832                      1065             UPDATE_BCD_TO_CASH:
0832 BB0800               1066                     MOV BX, 8
0835 2BD9                 1067                     SUB BX, CX
0837 8B87D900             1068                     MOV AX, DS:TEMP_CASH_ARR[BX]
083B 8887C100             1069                     MOV DS:TEMP_BCD_ARR[BX], AL
083F A27900               1070                     MOV DS:REG_AL, AL
0842 C706B1000100         1071                     MOV DS:DAC_DISABLE, 1
0848 9A5006----     R     1072                     CALL FAR PTR BCD_UPDATE
084D C706B1000000         1073                     MOV DS:DAC_DISABLE, 0
0853 E2DD                 1074             LOOP UPDATE_BCD_TO_CASH
                          1075             
0855 9A7108----     R     1076             CALL FAR PTR CALC_DAC
                          1077             
085A C706CF000000         1078             MOV DS:CASH_FLAG, 0
0860 C706EF000100         1079             MOV DS:TRANSACTION_OVER, 1
0866 C70601010000         1080             MOV DS:TROLLEY_DISABLED, 0
                          1081             
086C                      1082     CASH_OVER:
086C 5A                   1083     POP DX
086D 59                   1084     POP CX
086E 5B                   1085     POP BX
086F 58                   1086     POP AX
                          1087     
0870 CB                   1088     RET
                          1089     TAKE_CASH ENDP
                          1090     
0871                      1091     CALC_DAC PROC FAR
0871 50                   1092     PUSH AX
0872 53                   1093     PUSH BX
0873 51                   1094     PUSH CX
0874 52                   1095     PUSH DX
0875 813E64000040         1096             CMP DS:DAC_BASE, 4000H
087B 7403                 1097             JE ENGLISH_DAC
087D E98E01               1098             JMP MANDARIN_DAC
                          1099             
0880                      1100     ENGLISH_DAC:
0880 C706CB000000         1101             MOV DS:CENT_FLAG, 0
0886 C706C9000000         1102             MOV DS:THOUSAND_FLAG, 0
088C C706CD000000         1103             MOV DS:DOLLAR_FLAG,     0
0892 BB0000               1104             MOV BX, 0
0895 8A87C100             1105             MOV AL, DS:TEMP_BCD_ARR[BX]
0899 A27900               1106             MOV DS:REG_AL, AL
089C 3C00                 1107             CMP AL, 0
089E 7415                 1108             JE NEXT_PLACE
08A0 C706CD000100         1109             MOV DS:DOLLAR_FLAG, 1
08A6 9ABC06----     R     1110             CALL FAR PTR DAC_UPDATE
08AB C60679001C           1111             MOV DS:REG_AL, 28
08B0 9ABC06----     R     1112             CALL FAR PTR DAC_UPDATE
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:51:02  12/08/;3  PAGE   22


LOC  OBJ                  LINE     SOURCE

                          1113             
08B5                      1114     NEXT_PLACE:     
08B5 43                   1115             INC BX
08B6 8A87C100             1116             MOV AL, DS:TEMP_BCD_ARR[BX]
08BA 3C01                 1117             CMP AL, 1
08BC 751E                 1118             JNE NOT_1
08BE C706CD000100         1119             MOV DS:DOLLAR_FLAG, 1
08C4 43                   1120             INC BX
08C5 8A87C100             1121             MOV AL, DS:TEMP_BCD_ARR[BX]
08C9 040A                 1122             ADD AL, 10
08CB A27900               1123             MOV DS:REG_AL, AL
08CE 9ABC06----     R     1124             CALL FAR PTR DAC_UPDATE
08D3 C706C9000100         1125             MOV DS:THOUSAND_FLAG, 1
08D9 EB3890               1126             JMP HUNDREDS_PLACE
08DC                      1127     NOT_1:
08DC 3C00                 1128             CMP AL, 0
08DE 7416                 1129             JE NEXT_PLACE_1
08E0 C706CD000100         1130             MOV DS:DOLLAR_FLAG, 1
08E6 C706C9000100         1131             MOV DS:THOUSAND_FLAG, 1
08EC 0412                 1132             ADD AL, 18
08EE A27900               1133             MOV DS:REG_AL, AL
08F1 9ABC06----     R     1134             CALL FAR PTR DAC_UPDATE
08F6                      1135     NEXT_PLACE_1:
08F6 43                   1136             INC BX
08F7 8A87C100             1137             MOV AL, DS:TEMP_BCD_ARR[BX]
08FB 3C00                 1138             CMP AL, 0
08FD 7414                 1139             JE HUNDREDS_PLACE
08FF C706CD000100         1140             MOV DS:DOLLAR_FLAG, 1
0905 C706C9000100         1141             MOV DS:THOUSAND_FLAG, 1
090B A27900               1142             MOV DS:REG_AL, AL
090E 9ABC06----     R     1143             CALL FAR PTR DAC_UPDATE
                          1144     
0913                      1145     HUNDREDS_PLACE:
0913 833EC90000           1146             CMP DS:THOUSAND_FLAG, 0
0918 7410                 1147             JE NEXT_PLACE_2
091A C60679001D           1148             MOV DS:REG_AL, 29
091F 9ABC06----     R     1149             CALL FAR PTR DAC_UPDATE
0924 C706C9000000         1150             MOV DS:THOUSAND_FLAG, 0
                          1151             
092A                      1152     NEXT_PLACE_2:
092A 43                   1153             INC BX
092B 8A87C100             1154             MOV AL, DS:TEMP_BCD_ARR[BX]
092F 3C00                 1155             CMP AL, 0
0931 7418                 1156             JE NEXT_PLACE_3
0933 C706CD000100         1157             MOV DS:DOLLAR_FLAG, 1
0939 A27900               1158             MOV DS:REG_AL, AL
093C 9ABC06----     R     1159             CALL FAR PTR DAC_UPDATE
0941 C60679001C           1160             MOV DS:REG_AL, 28
0946 9ABC06----     R     1161             CALL FAR PTR DAC_UPDATE
                          1162             
094B                      1163     NEXT_PLACE_3:   
094B 43                   1164             INC BX
094C 8A87C100             1165             MOV AL, DS:TEMP_BCD_ARR[BX]
0950 3C01                 1166             CMP AL, 1
0952 7518                 1167             JNE NOT_1_2
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:51:02  12/08/;3  PAGE   23


LOC  OBJ                  LINE     SOURCE

0954 C706CD000100         1168             MOV DS:DOLLAR_FLAG, 1
095A 43                   1169             INC BX
095B 8A87C100             1170             MOV AL, DS:TEMP_BCD_ARR[BX]
095F 040A                 1171             ADD AL, 10
0961 A27900               1172             MOV DS:REG_AL, AL
0964 9ABC06----     R     1173             CALL FAR PTR DAC_UPDATE
0969 EB2C90               1174             JMP DECIMAL_DAC
096C                      1175     NOT_1_2:
096C 3C00                 1176             CMP AL, 0
096E 7410                 1177             JE NEXT_PLACE_4
0970 C706CD000100         1178             MOV DS:DOLLAR_FLAG, 1
0976 0412                 1179             ADD AL, 18
0978 A27900               1180             MOV DS:REG_AL, AL
097B 9ABC06----     R     1181             CALL FAR PTR DAC_UPDATE
0980                      1182     NEXT_PLACE_4:
0980 43                   1183             INC BX
0981 8A87C100             1184             MOV AL, DS:TEMP_BCD_ARR[BX]
0985 3C00                 1185             CMP AL, 0
0987 740E                 1186             JE DECIMAL_DAC
0989 C706CD000100         1187             MOV DS:DOLLAR_FLAG, 1
098F A27900               1188             MOV DS:REG_AL, AL
0992 9ABC06----     R     1189             CALL FAR PTR DAC_UPDATE
                          1190             
0997                      1191     DECIMAL_DAC:
0997 833ECD0000           1192             CMP DS:DOLLAR_FLAG, 0
099C 740A                 1193             JE DECIMAL_DAC_CONT
099E C60679001E           1194             MOV DS:REG_AL, 30
09A3 9ABC06----     R     1195             CALL FAR PTR DAC_UPDATE
                          1196             
09A8                      1197     DECIMAL_DAC_CONT:
09A8 43                   1198             INC BX
09A9 8A87C100             1199             MOV AL, DS:TEMP_BCD_ARR[BX]
09AD 3C01                 1200             CMP AL, 1
09AF 7518                 1201             JNE NOT_1_3
09B1 43                   1202             INC BX
09B2 C706CB000100         1203             MOV DS:CENT_FLAG, 1
09B8 8A87C100             1204             MOV AL, DS:TEMP_BCD_ARR[BX]
09BC 040A                 1205             ADD AL, 10
09BE A27900               1206             MOV DS:REG_AL, AL
09C1 9ABC06----     R     1207             CALL FAR PTR DAC_UPDATE
09C6 EB2C90               1208             JMP ENGLISH_END
                          1209             
09C9                      1210     NOT_1_3:
09C9 3C00                 1211             CMP AL, 0
09CB 7410                 1212             JE NEXT_PLACE_5
09CD C706CB000100         1213             MOV DS:CENT_FLAG, 1
09D3 0412                 1214             ADD AL, 18
09D5 A27900               1215             MOV DS:REG_AL, AL
09D8 9ABC06----     R     1216             CALL FAR PTR DAC_UPDATE
                          1217             
09DD                      1218     NEXT_PLACE_5:
09DD 43                   1219             INC BX
09DE 8A87C100             1220             MOV AL, DS:TEMP_BCD_ARR[BX]
09E2 3C00                 1221             CMP AL, 0
09E4 740E                 1222             JE ENGLISH_END
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:51:02  12/08/;3  PAGE   24


LOC  OBJ                  LINE     SOURCE

09E6 C706CB000100         1223             MOV DS:CENT_FLAG, 1
09EC A27900               1224             MOV DS:REG_AL, AL
09EF 9ABC06----     R     1225             CALL FAR PTR DAC_UPDATE
                          1226             
09F4                      1227     ENGLISH_END:
09F4 833ECB0000           1228             CMP DS:CENT_FLAG, 0
09F9 7410                 1229             JE ENGLISH_END2
09FB C60679001F           1230             MOV DS:REG_AL, 31
0A00 9ABC06----     R     1231             CALL FAR PTR DAC_UPDATE
0A05 C706CB000000         1232             MOV DS:CENT_FLAG, 0
0A0B                      1233     ENGLISH_END2:
0A0B E90D02               1234             JMP CONT_BCD_UPD_1
                          1235             
0A0E                      1236     MANDARIN_DAC:
0A0E C706CB000000         1237             MOV DS:CENT_FLAG, 0
0A14 C706C9000000         1238             MOV DS:THOUSAND_FLAG, 0
0A1A C70603010000         1239             MOV DS:TEN_THOUSAND_FLAG, 0
0A20 C70607010000         1240             MOV DS:ZERO_ALLOW, 0
0A26 C70605010000         1241             MOV DS:ZERO_TELL, 0
0A2C C706CD000000         1242             MOV DS:DOLLAR_FLAG,     0
0A32 BB0000               1243             MOV BX, 0
0A35 8A87C100             1244             MOV AL, DS:TEMP_BCD_ARR[BX]
0A39 3C00                 1245             CMP AL, 0
0A3B 742A                 1246             JE NEXT_PLACE_6
0A3D C70607010100         1247             MOV DS:ZERO_ALLOW, 1
0A43 C706CD000100         1248             MOV DS:DOLLAR_FLAG, 1
0A49 C70603010100         1249             MOV DS:TEN_THOUSAND_FLAG, 1
0A4F C706C9000000         1250             MOV DS:THOUSAND_FLAG, 0
0A55 A27900               1251             MOV DS:REG_AL, AL
0A58 9ABC06----     R     1252             CALL FAR PTR DAC_UPDATE
0A5D C60679000A           1253             MOV DS:REG_AL, 10
0A62 9ABC06----     R     1254             CALL FAR PTR DAC_UPDATE
                          1255             
0A67                      1256     NEXT_PLACE_6:
0A67 43                   1257             INC BX
0A68 8A87C100             1258             MOV AL, DS:TEMP_BCD_ARR[BX]
0A6C 3C00                 1259             CMP AL, 0
0A6E 7420                 1260             JE NEXT_PLACE_7
0A70 C70607010100         1261             MOV DS:ZERO_ALLOW, 1
0A76 C706CD000100         1262             MOV DS:DOLLAR_FLAG, 1
0A7C C70603010100         1263             MOV DS:TEN_THOUSAND_FLAG, 1
0A82 C706C9000000         1264             MOV DS:THOUSAND_FLAG, 0
0A88 A27900               1265             MOV DS:REG_AL, AL
0A8B 9ABC06----     R     1266             CALL FAR PTR DAC_UPDATE
                          1267             
0A90                      1268     NEXT_PLACE_7:
0A90 833E030101           1269             CMP DS:TEN_THOUSAND_FLAG, 1
0A95 750A                 1270             JNE NO_TEN_THOUSAND
0A97 C60679000D           1271             MOV DS:REG_AL, 13
0A9C 9ABC06----     R     1272             CALL FAR PTR DAC_UPDATE
0AA1                      1273     NO_TEN_THOUSAND:
0AA1 43                   1274             INC BX
0AA2 8A87C100             1275             MOV AL, DS:TEMP_BCD_ARR[BX]
0AA6 3C00                 1276             CMP AL, 0
0AA8 7510                 1277             JNE CONTINUE_MAND
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:51:02  12/08/;3  PAGE   25


LOC  OBJ                  LINE     SOURCE

0AAA 833E070100           1278             CMP DS:ZERO_ALLOW, 0
0AAF 7406                 1279             JE NO_ZERO_ALLOWED
0AB1 C70605010100         1280             MOV DS:ZERO_TELL, 1
0AB7                      1281     NO_ZERO_ALLOWED:
0AB7 EB1B90               1282             JMP NEXT_PLACE_8
0ABA                      1283     CONTINUE_MAND:  
0ABA C706CD000100         1284             MOV DS:DOLLAR_FLAG, 1
0AC0 C706C9000100         1285             MOV DS:THOUSAND_FLAG, 1
0AC6 C70607010100         1286             MOV DS:ZERO_ALLOW, 1
0ACC A27900               1287             MOV DS:REG_AL, AL
0ACF 9ABC06----     R     1288             CALL FAR PTR DAC_UPDATE
                          1289     
0AD4                      1290     NEXT_PLACE_8:
0AD4 833EC90000           1291             CMP DS:THOUSAND_FLAG, 0
0AD9 7410                 1292             JE IGNORE_THOUSAND
0ADB C60679000C           1293             MOV DS:REG_AL, 12
0AE0 9ABC06----     R     1294             CALL FAR PTR DAC_UPDATE
0AE5 C706C9000000         1295             MOV DS:THOUSAND_FLAG, 0
                          1296             
0AEB                      1297     IGNORE_THOUSAND:
0AEB 43                   1298             INC BX
0AEC 8A87C100             1299             MOV AL, DS:TEMP_BCD_ARR[BX]
0AF0 3C00                 1300             CMP AL, 0
0AF2 7510                 1301             JNE CONTINUE_MAND1
0AF4 833E070100           1302             CMP DS:ZERO_ALLOW, 0
0AF9 7406                 1303             JE NO_ZERO_ALLOWED2
0AFB C70605010100         1304             MOV DS:ZERO_TELL, 1
0B01                      1305     NO_ZERO_ALLOWED2:
0B01 EB3690               1306             JMP NEXT_PLACE_9
0B04                      1307     CONTINUE_MAND1:
0B04 C70607010100         1308             MOV DS:ZERO_ALLOW, 1
0B0A 833E050100           1309             CMP DS:ZERO_TELL, 0
0B0F 7410                 1310             JE DONT_ZERO
0B11 C606790000           1311             MOV DS:REG_AL, 0
0B16 9ABC06----     R     1312             CALL FAR PTR DAC_UPDATE
0B1B C70605010000         1313             MOV DS:ZERO_TELL, 0
0B21                      1314     DONT_ZERO:
0B21 C706CD000100         1315             MOV DS:DOLLAR_FLAG, 1
0B27 A27900               1316             MOV DS:REG_AL, AL
0B2A 9ABC06----     R     1317             CALL FAR PTR DAC_UPDATE
0B2F C60679000B           1318             MOV DS:REG_AL, 11
0B34 9ABC06----     R     1319             CALL FAR PTR DAC_UPDATE
                          1320             
0B39                      1321     NEXT_PLACE_9:
0B39 43                   1322             INC BX
0B3A 8A87C100             1323             MOV AL, DS:TEMP_BCD_ARR[BX]
0B3E 3C00                 1324             CMP AL, 0
0B40 7510                 1325             JNE CONTINUE_MAND2
0B42 833E070100           1326             CMP DS:ZERO_ALLOW, 0
0B47 7406                 1327             JE NO_ZERO_ALLOWED3
0B49 C70605010100         1328             MOV DS:ZERO_TELL, 1
0B4F                      1329     NO_ZERO_ALLOWED3:
0B4F EB3690               1330             JMP NEXT_PLACE_10
0B52                      1331     CONTINUE_MAND2:
0B52 C70607010100         1332             MOV DS:ZERO_ALLOW, 1
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:51:02  12/08/;3  PAGE   26


LOC  OBJ                  LINE     SOURCE

0B58 833E050100           1333             CMP DS:ZERO_TELL, 0
0B5D 7410                 1334             JE DONT_ZERO1
0B5F C606790000           1335             MOV DS:REG_AL, 0
0B64 9ABC06----     R     1336             CALL FAR PTR DAC_UPDATE
0B69 C70605010000         1337             MOV DS:ZERO_TELL, 0
0B6F                      1338     DONT_ZERO1:
0B6F C706CD000100         1339             MOV DS:DOLLAR_FLAG, 1
0B75 A27900               1340             MOV DS:REG_AL, AL
0B78 9ABC06----     R     1341             CALL FAR PTR DAC_UPDATE
0B7D C60679000A           1342             MOV DS:REG_AL, 10
0B82 9ABC06----     R     1343             CALL FAR PTR DAC_UPDATE
                          1344             
0B87                      1345     NEXT_PLACE_10:
0B87 43                   1346             INC BX
0B88 8A87C100             1347             MOV AL, DS:TEMP_BCD_ARR[BX]
0B8C 3C00                 1348             CMP AL, 0
0B8E 742B                 1349             JE MANDARIN_DEC
0B90 C70607010100         1350             MOV DS:ZERO_ALLOW, 1
0B96 833E050100           1351             CMP DS:ZERO_TELL, 0
0B9B 7410                 1352             JE DONT_ZERO2
0B9D C606790000           1353             MOV DS:REG_AL, 0
0BA2 9ABC06----     R     1354             CALL FAR PTR DAC_UPDATE
0BA7 C70605010000         1355             MOV DS:ZERO_TELL, 0
0BAD                      1356     DONT_ZERO2:
0BAD C706CD000100         1357             MOV DS:DOLLAR_FLAG, 1
0BB3 A27900               1358             MOV DS:REG_AL, AL
0BB6 9ABC06----     R     1359             CALL FAR PTR DAC_UPDATE
                          1360             
0BBB                      1361     MANDARIN_DEC:
0BBB 833ECD0000           1362             CMP DS:DOLLAR_FLAG, 0
0BC0 740A                 1363             JE MANDARIN_DAC_CONT
0BC2 C60679000E           1364             MOV DS:REG_AL, 14
0BC7 9ABC06----     R     1365             CALL FAR PTR DAC_UPDATE
0BCC                      1366     MANDARIN_DAC_CONT:
0BCC 43                   1367             INC BX
0BCD 8A87C100             1368             MOV AL, DS:TEMP_BCD_ARR[BX]
0BD1 3C00                 1369             CMP AL, 0
0BD3 7418                 1370             JE NEXT_PLACE_11
0BD5 C706CB000100         1371             MOV DS:CENT_FLAG, 1
0BDB A27900               1372             MOV DS:REG_AL, AL
0BDE 9ABC06----     R     1373             CALL FAR PTR DAC_UPDATE
0BE3 C60679000A           1374             MOV DS:REG_AL, 10
0BE8 9ABC06----     R     1375             CALL FAR PTR DAC_UPDATE
                          1376             
0BED                      1377     NEXT_PLACE_11:
                          1378     
0BED 43                   1379             INC BX
0BEE 8A87C100             1380             MOV AL, DS:TEMP_BCD_ARR[BX]
0BF2 3C00                 1381             CMP AL, 0
0BF4 740E                 1382             JE CONT_BCD_UPD
0BF6 C706CB000100         1383             MOV DS:CENT_FLAG, 1
0BFC A27900               1384             MOV DS:REG_AL, AL
0BFF 9ABC06----     R     1385             CALL FAR PTR DAC_UPDATE
                          1386             
0C04                      1387     CONT_BCD_UPD:
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:51:02  12/08/;3  PAGE   27


LOC  OBJ                  LINE     SOURCE

0C04 833ECB0000           1388             CMP DS:CENT_FLAG, 0
0C09 7410                 1389             JE CONT_BCD_UPD_1
0C0B C60679000F           1390             MOV DS:REG_AL, 15
0C10 9ABC06----     R     1391             CALL FAR PTR DAC_UPDATE
0C15 C706CB000000         1392             MOV DS:CENT_FLAG, 0
                          1393     
0C1B                      1394     CONT_BCD_UPD_1:
                          1395             
0C1B 5A                   1396     POP DX
0C1C 59                   1397     POP CX
0C1D 5B                   1398     POP BX
0C1E 58                   1399     POP AX
0C1F CB                   1400     RET
                          1401     CALC_DAC ENDP
                          1402     
0C20                      1403     CALC_UPD_PRICE PROC FAR
0C20 50                   1404     PUSH AX
0C21 53                   1405     PUSH BX
0C22 51                   1406     PUSH CX
0C23 52                   1407     PUSH DX
0C24 833EB90000           1408             CMP DS:QTY, 0
0C29 7503                 1409             JNE CHECK_PRICE_ZERO
0C2B E92B01               1410             JMP CALC_END
0C2E                      1411     CHECK_PRICE_ZERO:
0C2E 833EB70000           1412             CMP DS:PRICE, 0
0C33 7503                 1413             JNE START_CALC
0C35 E92101               1414             JMP CALC_END
0C38                      1415     START_CALC:
0C38 BA0000               1416             MOV DX, 0
0C3B A1B700               1417             MOV AX, DS:PRICE
0C3E 8B1EB900             1418             MOV BX, DS:QTY
0C42 F7E3                 1419             MUL BX
                          1420             
0C44 BB6400               1421             MOV BX, 100
0C47 F7F3                 1422             DIV BX
0C49 A3B700               1423             MOV DS:PRICE, AX
0C4C A1BF00               1424             MOV AX, DS:TOTAL_PRICE_DEC
0C4F 03C2                 1425             ADD AX, DX
0C51 3D6400               1426             CMP AX, 100
0C54 7C07                 1427             JL NON_DECIMAL
0C56 FF06BD00             1428             INC DS:TOTAL_PRICE_L
0C5A 2D6400               1429             SUB AX, 100
                          1430             
0C5D                      1431     NON_DECIMAL:    
0C5D A3BF00               1432             MOV DS:TOTAL_PRICE_DEC, AX
0C60 A1BD00               1433             MOV AX, DS:TOTAL_PRICE_L
0C63 8B1EB700             1434             MOV BX, DS:PRICE
0C67 03C3                 1435             ADD AX, BX
0C69 7304                 1436             JNC update_normal
0C6B FF06BB00             1437             INC DS:TOTAL_PRICE_U
                          1438             
0C6F                      1439     update_normal:
0C6F A3BD00               1440             MOV DS:TOTAL_PRICE_L, AX
                          1441             
0C72 BA0000               1442             MOV DX, 0
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:51:02  12/08/;3  PAGE   28


LOC  OBJ                  LINE     SOURCE

                          1443             ;CMP DS:TOTAL_PRICE_DEC, 9
                          1444             ;JG DECIMAL_CONT
                          1445             ;MOV CX, 10
                          1446             ;MOV AX, DS:TOTAL_PRICE_DEC
                          1447             ;MUL CX
                          1448             ;MOV DS:TOTAL_PRICE_DEC, AX
                          1449     ;DECIMAL_CONT:
0C75 A1BF00               1450             MOV AX, DS:TOTAL_PRICE_DEC
0C78 B90A00               1451             MOV CX, 10
0C7B F7F1                 1452             DIV CX
                          1453             
0C7D BB0700               1454             MOV BX, 7
0C80 8897C100             1455             MOV DS:TEMP_BCD_ARR[BX], DL
0C84 4B                   1456             DEC BX
0C85 8887C100             1457             MOV DS:TEMP_BCD_ARR[BX], AL
                          1458             
0C89 BB0600               1459             MOV BX, 6
0C8C A1BD00               1460             MOV AX, DS:TOTAL_PRICE_L
                          1461             
0C8F                      1462             TEMP_UPD_LOOP:
0C8F BA0000               1463                     MOV DX, 0
0C92 B90A00               1464                     MOV CX, 10
0C95 F7F1                 1465                     DIV CX
                          1466                     
0C97 4B                   1467                     DEC BX
0C98 8897C100             1468                     MOV DS:TEMP_BCD_ARR[BX], DL
0C9C 43                   1469                     INC BX
                          1470                     
0C9D 4B                   1471                     DEC BX
                          1472                     
0C9E 75EF                 1473             JNZ TEMP_UPD_LOOP
                          1474             
0CA0 8B0EBB00             1475             MOV CX, DS:TOTAL_PRICE_U
0CA4 83F900               1476             CMP CX, 0
0CA7 7478                 1477             JE upd_dac_part
0CA9                      1478             ADD_EXTRA_PART:
0CA9 BB0500               1479                     MOV BX, 5
0CAC 8A87C100             1480                     MOV AL, DS:TEMP_BCD_ARR[BX]
0CB0 0406                 1481                     ADD AL, 6
0CB2 3C09                 1482                     CMP AL, 9
0CB4 7E08                 1483                     JLE CONT_DIGIT_1
0CB6 2C0A                 1484                     SUB AL, 10
0CB8 4B                   1485                     DEC BX
0CB9 FE87C100             1486                     INC DS:TEMP_BCD_ARR[BX]
0CBD 43                   1487                     INC BX
0CBE                      1488             CONT_DIGIT_1:
0CBE 8887C100             1489                     MOV DS:TEMP_BCD_ARR[BX], AL
0CC2 4B                   1490                     DEC BX
                          1491                     
0CC3 8A87C100             1492                     MOV AL, DS:TEMP_BCD_ARR[BX]
0CC7 0403                 1493                     ADD AL, 3
0CC9 3C09                 1494                     CMP AL, 9
0CCB 7E08                 1495                     JLE CONT_DIGIT_2
0CCD 2C0A                 1496                     SUB AL, 10
0CCF 4B                   1497                     DEC BX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:51:02  12/08/;3  PAGE   29


LOC  OBJ                  LINE     SOURCE

0CD0 FE87C100             1498                     INC DS:TEMP_BCD_ARR[BX]
0CD4 43                   1499                     INC BX
0CD5                      1500             CONT_DIGIT_2:
0CD5 8887C100             1501                     MOV DS:TEMP_BCD_ARR[BX], AL
0CD9 4B                   1502                     DEC BX
                          1503                     
0CDA 8A87C100             1504                     MOV AL, DS:TEMP_BCD_ARR[BX]
0CDE 0405                 1505                     ADD AL, 5
0CE0 3C09                 1506                     CMP AL, 9
0CE2 7E08                 1507                     JLE CONT_DIGIT_3
0CE4 2C0A                 1508                     SUB AL, 10
0CE6 4B                   1509                     DEC BX
0CE7 FE87C100             1510                     INC DS:TEMP_BCD_ARR[BX]
0CEB 43                   1511                     INC BX
0CEC                      1512             CONT_DIGIT_3:
0CEC 8887C100             1513                     MOV DS:TEMP_BCD_ARR[BX], AL
0CF0 4B                   1514                     DEC BX
                          1515                     
                          1516                     
0CF1 8A87C100             1517                     MOV AL, DS:TEMP_BCD_ARR[BX]
0CF5 0405                 1518                     ADD AL, 5
0CF7 3C09                 1519                     CMP AL, 9
0CF9 7E08                 1520                     JLE CONT_DIGIT_4
0CFB 2C0A                 1521                     SUB AL, 10
0CFD 4B                   1522                     DEC BX
0CFE FE87C100             1523                     INC DS:TEMP_BCD_ARR[BX]
0D02 43                   1524                     INC BX
0D03                      1525             CONT_DIGIT_4:
0D03 8887C100             1526                     MOV DS:TEMP_BCD_ARR[BX], AL
0D07 4B                   1527                     DEC BX
                          1528                     
0D08 8A87C100             1529                     MOV AL, DS:TEMP_BCD_ARR[BX]
0D0C 0406                 1530                     ADD AL, 6
0D0E 3C09                 1531                     CMP AL, 9
0D10 7E08                 1532                     JLE CONT_DIGIT_5
0D12 2C0A                 1533                     SUB AL, 10
0D14 4B                   1534                     DEC BX
0D15 FE87C100             1535                     INC DS:TEMP_BCD_ARR[BX]
0D19 43                   1536                     INC BX
0D1A                      1537             CONT_DIGIT_5:
0D1A 8887C100             1538                     MOV DS:TEMP_BCD_ARR[BX], AL
0D1E 4B                   1539                     DEC BX
                          1540                     
0D1F E288                 1541             LOOP ADD_EXTRA_PART
                          1542             
0D21                      1543     upd_dac_part:
0D21 9A7108----     R     1544             CALL FAR PTR CALC_DAC
                          1545     
0D26 9A2506----     R     1546             CALL FAR PTR BCD_CLEAR
0D2B C70661000000         1547             MOV DS:KEYPAD_INDEX, 0
0D31 C706B3000300         1548             MOV DS:DECIMAL_INDEX, 3
0D37 B90800               1549             MOV CX, 8
0D3A                      1550             UPD_BCD:
0D3A BB0800               1551                     MOV BX, 8
0D3D 2BD9                 1552                     SUB BX, CX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:51:02  12/08/;3  PAGE   30


LOC  OBJ                  LINE     SOURCE

0D3F 8A87C100             1553                     MOV AL, DS:TEMP_BCD_ARR[BX]
0D43 A27900               1554                     MOV DS:REG_AL, AL
0D46 C706B1000100         1555                     MOV DS:DAC_DISABLE, 1
0D4C 9A5006----     R     1556                     CALL FAR PTR BCD_UPDATE
0D51 C706B1000000         1557                     MOV DS:DAC_DISABLE, 0
0D57 E2E1                 1558             LOOP UPD_BCD
                          1559             
0D59                      1560     CALC_END:
0D59 833EB70000           1561             CMP DS:PRICE, 0
0D5E 7403                 1562             JE RETAIN_BCD_VALUE
0D60 EB2F90               1563             JMP END_CALC_BCD_DAC
                          1564             
0D63                      1565     RETAIN_BCD_VALUE:       
0D63 C70661000000         1566             MOV DS:KEYPAD_INDEX, 0
0D69 C706B3000300         1567             MOV DS:DECIMAL_INDEX, 3
0D6F B90800               1568             MOV CX, 8
0D72                      1569             UPD_BCD1:
0D72 BB0800               1570                     MOV BX, 8
0D75 2BD9                 1571                     SUB BX, CX
0D77 8A87C100             1572                     MOV AL, DS:TEMP_BCD_ARR[BX]
0D7B A27900               1573                     MOV DS:REG_AL, AL
0D7E C706B1000100         1574                     MOV DS:DAC_DISABLE, 1
0D84 9A5006----     R     1575                     CALL FAR PTR BCD_UPDATE
0D89 C706B1000000         1576                     MOV DS:DAC_DISABLE, 0
0D8F E2E1                 1577             LOOP UPD_BCD1
                          1578     
0D91                      1579     END_CALC_BCD_DAC:
0D91 C706B7000000         1580             MOV DS:PRICE, 0
0D97 C706B9000000         1581             MOV DS:QTY, 0
0D9D 5A                   1582     POP DX
0D9E 59                   1583     POP CX
0D9F 5B                   1584     POP BX
0DA0 58                   1585     POP AX
0DA1 CB                   1586     RET
                          1587     CALC_UPD_PRICE ENDP
                          1588     
0DA2                      1589     UPDATE_TROLLEY PROC FAR
0DA2 50                   1590     PUSH AX
0DA3 53                   1591     PUSH BX
0DA4 51                   1592     PUSH CX
0DA5 52                   1593     PUSH DX
0DA6 B90800               1594             MOV CX, 8
0DA9                      1595             CLEAR_TEMP_BCD_TROLLEY:
0DA9 8BD9                 1596                     MOV BX, CX
0DAB 4B                   1597                     DEC BX
0DAC C687C10000           1598                     MOV DS:TEMP_BCD_ARR[BX], 0
0DB1 E2F6                 1599             LOOP CLEAR_TEMP_BCD_TROLLEY
                          1600             
0DB3 8B0EFB00             1601             MOV CX, DS:TROLLEY_INDEX
0DB7 BA0800               1602             MOV DX, 8
                          1603             
0DBA                      1604             UPD_TROLLEY_PRICE:
0DBA 8BD9                 1605                     MOV BX, CX
0DBC 4B                   1606                     DEC BX
                          1607                     
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:51:02  12/08/;3  PAGE   31


LOC  OBJ                  LINE     SOURCE

0DBD 8A87F300             1608                     MOV AL, DS:TROLLEY_ARRAY[BX]
                          1609                     
0DC1 8BDA                 1610                     MOV BX, DX
0DC3 4B                   1611                     DEC BX
                          1612                     
0DC4 8887C100             1613                     MOV DS:TEMP_BCD_ARR[BX], AL
                          1614                     
0DC8 4A                   1615                     DEC DX
0DC9 E2EF                 1616             LOOP UPD_TROLLEY_PRICE
                          1617             
0DCB B90800               1618             MOV CX, 8
0DCE C70661000000         1619             MOV DS:KEYPAD_INDEX, 0
0DD4                      1620             UPDATE_TROLLEY_PRICE_DISPLAY:
0DD4 BB0800               1621                     MOV BX, 8
0DD7 2BD9                 1622                     SUB BX, CX
0DD9 8A87C100             1623                     MOV AL, DS:TEMP_BCD_ARR[BX]
0DDD A27900               1624                     MOV DS:REG_AL, AL
0DE0 C706B1000100         1625                     MOV DS:DAC_DISABLE, 1
0DE6 9A5006----     R     1626                     CALL FAR PTR BCD_UPDATE
0DEB C706B1000000         1627                     MOV DS:DAC_DISABLE, 0
0DF1 E2E1                 1628             LOOP UPDATE_TROLLEY_PRICE_DISPLAY
                          1629             
0DF3 9A7108----     R     1630             CALL FAR PTR CALC_DAC
                          1631     
0DF8 5A                   1632     POP DX
0DF9 59                   1633     POP CX
0DFA 5B                   1634     POP BX
0DFB 5A                   1635     POP DX
0DFC CB                   1636     RET
                          1637     UPDATE_TROLLEY ENDP
                          1638     ; ^^^^^^^^^^^^^^^ End of User main routine ^^^^^^^^^^^^^^^^^^^^^^^^^
0DFD                      1639     SERIAL_REC_ACTION       PROC    FAR
0DFD 51                   1640                     PUSH    CX
0DFE 53                   1641                     PUSH    BX
0DFF 1E                   1642                     PUSH    DS
                          1643                     
0E00 BB----         R     1644                     MOV     BX,DATA_SEG             ;initialize data segment register
0E03 8EDB                 1645                     MOV     DS,BX
                          1646                     
0E05 803E8B0001           1647                     CMP DS:REPLY_FLAG, 1
0E0A 7557                 1648                     JNE next_id1
                          1649                     
0E0C 803E8C0001           1650                     CMP DS:SEND_FLAG, 1
0E11 7453                 1651                     JE send_input_across1
                          1652                     
0E13 833EA70001           1653                     CMP DS:RECEIVE_FLAG, 1
0E18 754F                 1654                     JNE terminate_session3
                          1655                     
0E1A 3C2F                 1656                     CMP AL, '/'
0E1C 752C                 1657                     JNE CHECK_SEND
0E1E C706AB000000         1658                     MOV DS:PRICE_FLAG, 0
0E24 C706A7000000         1659                     MOV DS:RECEIVE_FLAG, 0
0E2A C706B5000100         1660                     MOV DS:LANG_FLAG, 1
0E30 833EFD0000           1661                     CMP DS:TROLLEY_FLAG, 0
0E35 7405                 1662                     JE TROLLEY_UPD_SKIP
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:51:02  12/08/;3  PAGE   32


LOC  OBJ                  LINE     SOURCE

0E37 9AA20D----     R     1663                     CALL FAR PTR UPDATE_TROLLEY
0E3C                      1664             TROLLEY_UPD_SKIP:
0E3C C706FD000000         1665                     MOV DS:TROLLEY_FLAG, 0
0E42 9A200C----     R     1666                     CALL FAR PTR CALC_UPD_PRICE
0E47 EB2090               1667                     JMP terminate_session3
                          1668             
0E4A                      1669             CHECK_SEND:
0E4A 3C26                 1670                     CMP AL, '&'
0E4C 751E                 1671                     JNE TROLLEY_PRICE
0E4E C706AB000100         1672                     MOV DS:PRICE_FLAG, 1
0E54 C70661000000         1673                     MOV DS:KEYPAD_INDEX, 0
0E5A C706A3000800         1674                     MOV DS:MAX_INPUT_SIZE, 8
0E60 E9E300               1675                     JMP id_skip2
                          1676             
                          1677             
0E63                      1678             next_id1:
0E63 E9E300               1679                     JMP next_id
                          1680                     
0E66                      1681             send_input_across1:
0E66 E9C100               1682                     JMP send_input_across
                          1683             
0E69                      1684             terminate_session3:
0E69 E9D700               1685                     JMP terminate_session2
                          1686             
                          1687                     
0E6C                      1688             TROLLEY_PRICE:
0E6C 3C2B                 1689                     CMP AL, '+'
0E6E 7515                 1690                     JNE receive_price
0E70 C706A3000800         1691                     MOV DS:MAX_INPUT_SIZE, 8
0E76 C706FD000100         1692                     MOV DS:TROLLEY_FLAG, 1
0E7C C706FB000000         1693                     MOV DS:TROLLEY_INDEX, 0
0E82 E9C100               1694                     JMP id_skip2
                          1695                     
0E85                      1696             receive_price:
0E85 3C23                 1697                     CMP AL, '#'
0E87 7543                 1698                     JNE check_price
0E89 C706A9000100         1699                     MOV DS:DAC_FLAG, 1
0E8F C706AB000000         1700                     MOV DS:PRICE_FLAG, 0
0E95 C706B7000000         1701                     MOV DS:PRICE, 0
0E9B 833EFD0000           1702                     CMP DS:TROLLEY_FLAG, 0
0EA0 7421                 1703                     JE TROLLEY_UPD_SKIP2
0EA2 9AA20D----     R     1704                     CALL FAR PTR UPDATE_TROLLEY
                          1705                     ;CLEAN STATE
0EA7 C706B3000300         1706                     MOV DS:DECIMAL_INDEX, 3
0EAD 9A2506----     R     1707                     CALL FAR PTR BCD_CLEAR
0EB2 C706A3000000         1708                     MOV DS:MAX_INPUT_SIZE, 0
0EB8 9AE304----     R     1709                     CALL FAR PTR CLEAR_TEMP_BCD
                          1710                     
0EBD C706CF000000         1711                     MOV DS:CASH_FLAG, 0
                          1712                     
0EC3                      1713             TROLLEY_UPD_SKIP2:
0EC3 C706FD000000         1714                     MOV DS:TROLLEY_FLAG, 0
                          1715                     
0EC9 EB7B90               1716                     JMP id_skip2
                          1717             
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:51:02  12/08/;3  PAGE   33


LOC  OBJ                  LINE     SOURCE

0ECC                      1718             check_price:    
                          1719             
0ECC 833EAB0001           1720                     CMP DS:PRICE_FLAG, 1
0ED1 7440                 1721                     JE update_price_value
                          1722                     
0ED3 833EFD0001           1723                     CMP DS:TROLLEY_FLAG, 1
0ED8 7428                 1724                     JE update_trolley_arr
                          1725                     
0EDA 833EA90001           1726                     CMP DS:DAC_FLAG, 1
0EDF 7403                 1727                     JE dac_change
0EE1 EB6390               1728                     JMP id_skip2
                          1729     
0EE4                      1730             dac_change:
0EE4 8A1E7900             1731                     MOV BL, DS:REG_AL
0EE8 2C30                 1732                     SUB AL, 30H
0EEA A27900               1733                     MOV DS:REG_AL, AL
0EED 9ABC06----     R     1734                     CALL FAR PTR DAC_UPDATE
0EF2 881E7900             1735                     MOV DS:REG_AL, BL
0EF6 C706A9000000         1736                     MOV DS:DAC_FLAG, 0
0EFC EB4890               1737                     JMP id_skip2
                          1738             
                          1739     
0EFF EB4590               1740             id_skip3: JMP id_skip2
                          1741             
0F02                      1742             update_trolley_arr:
0F02 8B1EFB00             1743                     MOV BX, DS:TROLLEY_INDEX
0F06 2C30                 1744                     SUB AL, 30H
0F08 8887F300             1745                     MOV DS:TROLLEY_ARRAY[BX], AL
0F0C FF06FB00             1746                     INC DS:TROLLEY_INDEX
0F10 EB3490               1747                     JMP id_skip2
                          1748                     
0F13                      1749             update_price_value:
0F13 2C30                 1750                     SUB AL, 30H
0F15 B90000               1751                     MOV CX, 0
0F18 8AC8                 1752                     MOV CL, AL
0F1A A1B700               1753                     MOV AX, DS:PRICE
0F1D BB0A00               1754                     MOV BX, 10
0F20 F7E3                 1755                     MUL BX
                          1756                     
0F22 03C1                 1757                     ADD AX, CX
0F24 A3B700               1758                     MOV DS:PRICE, AX
0F27 EB1D90               1759                     JMP id_skip2
                          1760                     
0F2A                      1761             send_input_across:
0F2A 9ADF06----     R     1762                     CALL FAR PTR SEND_INPUT
                          1763                     
0F2F C706A1000000         1764                     MOV DS:SEND_BUFFER_LEN, 0
                          1765                     
0F35 C6068C0000           1766                     MOV DS:SEND_FLAG, 0
                          1767                     
0F3A C706A7000100         1768                     MOV DS:RECEIVE_FLAG, 1
                          1769                     
0F40 EB0490               1770                     JMP id_skip2
                          1771                     
0F43 EB3E90               1772                     terminate_session2: JMP terminate_session
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:51:02  12/08/;3  PAGE   34


LOC  OBJ                  LINE     SOURCE

0F46 EB6790               1773                     id_skip2: JMP id_skip
                          1774                     
0F49                      1775             next_id:
                          1776                     
0F49 803E810001           1777                     CMP DS:ID_FLAG_r, 1
0F4E 7513                 1778                     JNE id_flag_label
0F50 38067F00             1779                     CMP DS:MY_ID[1], AL
0F54 7559                 1780                     JNE id_skip
                          1781                     ;start writing to pc
0F56 C6068B0001           1782                     MOV DS:REPLY_FLAG, 1
0F5B C606810000           1783                     MOV DS:ID_FLAG_r, 0
0F60 EB4D90               1784                     JMP id_skip
                          1785             
0F63                      1786             id_flag_label:
                          1787             
0F63 803E800001           1788                     CMP DS:ID_FLAG_@, 1
0F68 7539                 1789                     JNE protocol_rec
0F6A 3C72                 1790                     CMP AL,'r'
0F6C 750D                 1791                     JNE id_not_r
0F6E C606810001           1792                     MOV DS:ID_FLAG_r,1
0F73 C606800000           1793                     MOV DS:ID_FLAG_@, 0
0F78 EB3590               1794                     JMP S_RET
0F7B                      1795             id_not_r:
0F7B C606800000           1796                     MOV DS:ID_FLAG_@, 0
0F80 EB2D90               1797                     JMP id_skip
                          1798             
0F83                      1799             terminate_session:
0F83 C606810000           1800                     MOV DS:ID_FLAG_r, 0
0F88 33DB                 1801                     XOR BX,BX
0F8A                      1802             start_send1:
0F8A 50                   1803                     PUSH AX
0F8B 33C0                 1804                     XOR AX,AX
0F8D 8A878600             1805                     MOV AL, DS:FAIL_MESSAGE[BX]
0F91 9A0000----     E     1806                     CALL FAR PTR PRINT_CHAR
0F96 58                   1807                     POP AX
0F97 C6068B0000           1808                     MOV DS:REPLY_FLAG, 0
0F9C 43                   1809                     INC BX
0F9D 3A1E8A00             1810                     CMP BL, DS:FAIL_COUNT
0FA1 75E7                 1811                     JNE start_send1
                          1812                     
0FA3                      1813             protocol_rec:
0FA3 3C40                 1814                     CMP AL,'@'
0FA5 7508                 1815                     JNE id_skip
0FA7 C606800001           1816                     MOV DS:ID_FLAG_@,1
0FAC EB0190               1817                     JMP S_RET
                          1818                     
0FAF                      1819             id_skip:
                          1820                     ; JMP S_RET
                          1821             
                          1822                     ; CMP   AL,'<'
                          1823                     ; JNE   S_FAST
                          1824     
                          1825                     ; INC   DS:T_COUNT_SET
                          1826                     ; INC   DS:T_COUNT_SET
                          1827     
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:51:02  12/08/;3  PAGE   35


LOC  OBJ                  LINE     SOURCE

                          1828                     ; JMP   S_NEXT0
                          1829     ; S_FAST:
                          1830                     ; CMP   AL,'>'
                          1831                     ; JNE   S_RET
                          1832     
                          1833                     ; DEC   DS:T_COUNT_SET
                          1834                     ; DEC   DS:T_COUNT_SET
                          1835     
                          1836     ; S_NEXT0:
                          1837                     ; MOV   CX,22                   ;initialize counter for message
                          1838                     ; MOV   BX,0
                          1839     
                          1840     ; S_NEXT1:      MOV     AL,DS:REC_MESS[BX]      ;print message
                          1841                     ; call  FAR ptr print_char
                          1842                     ; INC   BX
                          1843                     ; LOOP  S_NEXT1
                          1844     
                          1845                     ; MOV   AL,DS:T_COUNT_SET       ;print current period of timer0
                          1846                     ; CALL  FAR PTR PRINT_2HEX
0FAF                      1847     S_RET:
0FAF 1F                   1848                     POP     DS
0FB0 5B                   1849                     POP     BX
0FB1 59                   1850                     POP     CX
0FB2 CB                   1851                     RET
                          1852     SERIAL_REC_ACTION       ENDP
                          1853     
0FB3                      1854     TIMER2_ACTION   PROC    FAR
0FB3 50                   1855                     PUSH    AX
0FB4 1E                   1856                     PUSH    DS
0FB5 53                   1857                     PUSH    BX
0FB6 51                   1858                     PUSH    CX
0FB7 52                   1859                     PUSH    DX
                          1860                     
                          1861                     
0FB8 B8----         R     1862                     MOV     AX,DATA_SEG
0FBB 8ED8                 1863                     MOV     DS,AX
                          1864             
0FBD FE0E1600             1865                     DEC     DS:T_COUNT
0FC1 754A                 1866                     JNZ     T_NEXT1
0FC3 A01700               1867                     MOV     AL,DS:T_COUNT_SET
0FC6 A21600               1868                     MOV     DS:T_COUNT,AL
                          1869     
0FC9                      1870     T_NEXT0:
                          1871                     
0FC9 33DB                 1872                     XOR BX, BX
0FCB 8A1E6000             1873                     MOV BL, DS:BCD_INDEX
0FCF 8A4759               1874                     MOV AL, DS:BCD_MESSAGE[BX]
                          1875                     
0FD2 3B1EB300             1876                     CMP BX, DS:DECIMAL_INDEX
0FD6 7506                 1877                     JNE CALL_FUNC
0FD8 C706AD000100         1878                     MOV DS:DECIMAL_FLAG, 1
0FDE                      1879     CALL_FUNC:
0FDE 9A7E10----     R     1880                     CALL FAR PTR BCD_TO_7SEG
0FE3 C706AD000000         1881                     MOV DS:DECIMAL_FLAG, 0
                          1882     
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:51:02  12/08/;3  PAGE   36


LOC  OBJ                  LINE     SOURCE

0FE9 BA0002               1883                     MOV DX, 200H
0FEC EE                   1884                     OUT DX, AL
                          1885                     
0FED A05F00               1886                     MOV AL, DS:ENABLE_BYTE
0FF0 BA8001               1887                     MOV DX, 180H
0FF3 EE                   1888                     OUT DX, AL
                          1889                     
                          1890     
0FF4 FE066000             1891                     INC DS:BCD_INDEX
0FF8 D0065F00             1892                     ROL DS:ENABLE_BYTE, 1
0FFC 803E5F00BF           1893                     CMP DS:ENABLE_BYTE, 10111111b
1001 750A                 1894                     JNE T_NEXT1
1003 C6065F00FE           1895                     MOV DS:ENABLE_BYTE, 11111110b 
1008 C606600000           1896                     MOV DS:BCD_INDEX, 0
                          1897     
                          1898                     
100D                      1899     T_NEXT1:
100D 803E750000           1900                     CMP DS:DAC_LEN, 0
1012 743C                 1901                     JE ISR_END
                          1902                     
                          1903                     
1014 8B367600             1904                     MOV SI, DS:SI_PTR
                          1905                             
1018 BB0000               1906                     MOV BX, 0
101B 33C0                 1907                     XOR AX, AX
101D 8A4766               1908                     MOV AL, DS:DAC_ADDR[BX]
                          1909                     
1020 BB0001               1910                     MOV BX, 100H
1023 F7E3                 1911                     MUL BX
                          1912                     
1025 8B166400             1913                     MOV DX, DS:DAC_BASE
1029 03D0                 1914                     ADD DX, AX
                          1915                     
102B 1E                   1916                     PUSH DS
102C 8EDA                 1917                     MOV DS, DX
                          1918                     
102E 8B04                 1919                     MOV AX, [SI]
                          1920                     
1030 BA1001               1921                     MOV DX, 110H
1033 EE                   1922                     OUT DX, AL
                          1923                     
1034 1F                   1924                     POP DS
                          1925                     
1035 FF067600             1926                     INC DS:SI_PTR
1039 813E76000010         1927                     CMP DS:SI_PTR, 1000H
103F 750F                 1928                     JNE ISR_END
                          1929                     
1041 C70676000000         1930                     MOV DS:SI_PTR, 0
1047 FE0E7500             1931                     DEC DS:DAC_LEN
104B 9A5610----     R     1932                     CALL FAR PTR DAC_SHIFT
                          1933                     
1050                      1934     ISR_END:
                          1935                     
1050 5A                   1936                     POP DX
1051 59                   1937                     POP     CX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:51:02  12/08/;3  PAGE   37


LOC  OBJ                  LINE     SOURCE

1052 5B                   1938                     POP     BX
1053 1F                   1939                     POP     DS
1054 58                   1940                     POP AX
1055 CB                   1941                     RET
                          1942     TIMER2_ACTION   ENDP
                          1943     
                          1944     
1056                      1945     DAC_SHIFT PROC FAR
1056 50                   1946             PUSH AX
1057 53                   1947             PUSH BX
1058 51                   1948             PUSH CX
1059 52                   1949             PUSH DX
                          1950     
105A 33C9                 1951             XOR CX, CX
105C 8A0E7500             1952             MOV CL, DS:DAC_LEN
1060 80F900               1953             CMP CL, 0
1063 7414                 1954             JE END_SHIFT
                          1955     
1065                      1956             SHIFT_LOOP:
                          1957     
1065 33DB                 1958             XOR BX, BX
1067 8A1E7500             1959             MOV BL, DS:DAC_LEN
106B 2BD9                 1960             SUB BX, CX
106D 43                   1961             INC BX
                          1962             
106E 33D2                 1963             XOR DX, DX
1070 8A5766               1964             MOV DL, DS:DAC_ADDR[BX]
1073 4B                   1965             DEC BX
1074 885766               1966             MOV DS:DAC_ADDR[BX], DL
                          1967     
1077 E2EC                 1968             LOOP SHIFT_LOOP
                          1969             
1079                      1970             END_SHIFT:
1079 5A                   1971             POP DX
107A 59                   1972             POP CX
107B 5B                   1973             POP BX
107C 58                   1974             POP AX
107D CB                   1975             RET
                          1976     DAC_SHIFT ENDP
                          1977     
107E                      1978     BCD_TO_7SEG PROC FAR
                          1979     
107E 53                   1980             PUSH BX
107F 51                   1981             PUSH CX
1080 52                   1982             PUSH DX
                          1983             
1081 3C00                 1984             CMP AL, 0
1083 7511                 1985             JNE one
1085 833EAD0001           1986             CMP DS:DECIMAL_FLAG, 1
108A 7405                 1987             JE decimal0
108C B03F                 1988             MOV AL, 00111111b
108E E9D700               1989             JMP endfunc
1091                      1990     decimal0:
1091 B0BF                 1991             MOV AL, 10111111b
1093 E9D200               1992             JMP endfunc
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:51:02  12/08/;3  PAGE   38


LOC  OBJ                  LINE     SOURCE

                          1993             
1096                      1994             one:
1096 3C01                 1995             CMP AL, 1
1098 7511                 1996             JNE two
109A 833EAD0001           1997             CMP DS:DECIMAL_FLAG, 1
109F 7405                 1998             JE decimal1
10A1 B006                 1999             MOV AL, 00000110b
10A3 E9C200               2000             JMP endfunc
10A6                      2001     decimal1:
10A6 B086                 2002             MOV AL, 10000110b
10A8 E9BD00               2003             JMP endfunc
                          2004             
10AB                      2005             two:
10AB 3C02                 2006             CMP AL,2
10AD 7511                 2007             JNE three
10AF 833EAD0001           2008             CMP DS:DECIMAL_FLAG, 1
10B4 7405                 2009             JE decimal2
10B6 B05B                 2010             MOV AL, 01011011b
10B8 E9AD00               2011             JMP endfunc
10BB                      2012     decimal2:
10BB B0DB                 2013             MOV AL, 11011011b
10BD E9A800               2014             JMP endfunc
                          2015             
10C0                      2016             three:
10C0 3C03                 2017             CMP AL,3
10C2 7511                 2018             JNE four
10C4 833EAD0001           2019             CMP DS:DECIMAL_FLAG, 1
10C9 7405                 2020             JE decimal3
10CB B04F                 2021             MOV AL, 01001111b
10CD E99800               2022             JMP endfunc
10D0                      2023     decimal3:
10D0 B0CF                 2024             MOV AL, 11001111b
10D2 E99300               2025             JMP endfunc
                          2026             
10D5                      2027             four:
10D5 3C04                 2028             CMP AL,4
10D7 7511                 2029             JNE five
10D9 833EAD0001           2030             CMP DS:DECIMAL_FLAG, 1
10DE 7405                 2031             JE decimal4
10E0 B066                 2032             MOV AL, 01100110b
10E2 E98300               2033             JMP endfunc
10E5                      2034     decimal4:
10E5 B0E6                 2035             MOV AL, 11100110b
10E7 EB7F90               2036             JMP endfunc
                          2037             
10EA                      2038             five:
10EA 3C05                 2039             CMP AL,5
10EC 7511                 2040             JNE six
10EE 833EAD0001           2041             CMP DS:DECIMAL_FLAG, 1
10F3 7405                 2042             JE decimal5
10F5 B06D                 2043             MOV AL, 01101101b
10F7 EB6F90               2044             JMP endfunc
10FA                      2045     decimal5:
10FA B0ED                 2046             MOV AL, 11101101b
10FC EB6A90               2047             JMP endfunc
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:51:02  12/08/;3  PAGE   39


LOC  OBJ                  LINE     SOURCE

                          2048             
10FF                      2049             six:
10FF 3C06                 2050             CMP AL,6
1101 7511                 2051             JNE seven
1103 833EAD0001           2052             CMP DS:DECIMAL_FLAG, 1
1108 7405                 2053             JE decimal6
110A B07D                 2054             MOV AL, 01111101b
110C EB5A90               2055             JMP endfunc
110F                      2056     decimal6:
110F B0FD                 2057             MOV AL, 11111101b
1111 EB5590               2058             JMP endfunc
                          2059             
1114                      2060             seven:
1114 3C07                 2061             CMP AL,7
1116 7511                 2062             JNE eight
1118 833EAD0001           2063             CMP DS:DECIMAL_FLAG, 1
111D 7405                 2064             JE decimal7
111F B007                 2065             MOV AL, 00000111b
1121 EB4590               2066             JMP endfunc
1124                      2067     decimal7:
1124 B087                 2068             MOV AL, 10000111b
1126 EB4090               2069             JMP endfunc
                          2070             
1129                      2071             eight:
1129 3C08                 2072             CMP AL,8
112B 7511                 2073             JNE nine
112D 833EAD0001           2074             CMP DS:DECIMAL_FLAG, 1
1132 7405                 2075             JE decimal8
1134 B07F                 2076             MOV AL, 01111111b
1136 EB3090               2077             JMP endfunc
1139                      2078     decimal8:
1139 B0FF                 2079             MOV AL, 11111111b
113B EB2B90               2080             JMP endfunc
                          2081             
113E                      2082             nine:
113E 3C09                 2083             CMP AL,9
1140 7511                 2084             JNE hifn
1142 833EAD0001           2085             CMP DS:DECIMAL_FLAG, 1
1147 7405                 2086             JE decimal9
1149 B06F                 2087             MOV AL, 01101111b
114B EB1B90               2088             JMP endfunc
114E                      2089     decimal9:
114E B0EF                 2090             MOV AL, 11101111b
1150 EB1690               2091             JMP endfunc
                          2092             
1153                      2093             hifn:
1153 3C2D                 2094             CMP AL,'-'
1155 7511                 2095             JNE endfunc
1157 833EAD0001           2096             CMP DS:DECIMAL_FLAG, 1
115C 7405                 2097             JE decimal10
115E B040                 2098             MOV AL, 01000000b
1160 EB0690               2099             JMP endfunc
1163                      2100     decimal10:
1163 B0C0                 2101             MOV AL, 11000000b
1165 EB0190               2102             JMP endfunc
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:51:02  12/08/;3  PAGE   40


LOC  OBJ                  LINE     SOURCE

                          2103             
1168                      2104             endfunc:
1168 5A                   2105             POP DX
1169 59                   2106             POP CX
116A 5B                   2107             POP BX
                          2108     
116B CB                   2109     RET
                          2110     BCD_TO_7SEG ENDP
                          2111     
----                      2112     CODE_SEG        ENDS
                          2113     END

ASSEMBLY COMPLETE, NO ERRORS FOUND
