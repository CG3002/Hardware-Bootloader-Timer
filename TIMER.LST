8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    00:24:48  11/24/;3  PAGE    1


DOS 5.0 (038-N) 8086/87/88/186 MACRO ASSEMBLER V3.1 ASSEMBLY OF MODULE TIMER
OBJECT MODULE PLACED IN TIMER.OBJ
ASSEMBLER INVOKED BY:  D:\ASM86.EXE TIMER.ASM


LOC  OBJ                  LINE     SOURCE

                             1 +1  $MOD186
                             2 +1  $EP
                             3     NAME TIMER
                             4     ; Main program for uPD70208 microcomputer system
                             5     ;
                             6     ; Author:       Dr Tay Teng Tiow
                             7     ; Address:      Department of Electrical Engineering 
                             8     ;               National University of Singapore
                             9     ;               10, Kent Ridge Crescent
                            10     ;               Singapore 0511. 
                            11     ; Date:         6th September 1991
                            12     ;
                            13     ; This file contains proprietory information and cannot be copied 
                            14     ; or distributed without prior permission from the author.
                            15     ; =========================================================================
                            16     
                            17     public  serial_rec_action, timer2_action
                            18     extrn   print_char:far, print_2hex:far, iodefine:far
                            19     extrn   set_timer2:far
                            20     
                            21     ;IO Setup for 80C188 
  FFA0                      22             UMCR    EQU    0FFA0H ; Upper Memory Control Register
  FFA2                      23             LMCR    EQU    0FFA2H ; Lower Memory control Register         
  FFA4                      24             PCSBA   EQU    0FFA4H ; Peripheral Chip Select Base Address
  FFA8                      25             MPCS    EQU    0FFA8H ; MMCS and PCS Alter Control Register
  0080                      26             A_8255  EQU    0080H
  0081                      27             B_8255  EQU    0081H
  0082                      28             C_8255  EQU    0082H
  0083                      29             CWR_8255  EQU    0083H
  FF38                      30             INT0CON  EQU   0FF38H
  FF22                      31             EOI EQU 0FF22H
  FF28                      32             IMASK EQU 0FF28H
  FFA6                      33             MMCS    EQU    0FFA6H 
  4000                      34             DAC EQU 4000H
                            35     
                            36     
----                        37     STACK_SEG       SEGMENT
0000 (512                   38                     DB      512 DUP(?)
     ??
     )
0200                        39             TOS     LABEL   WORD
----                        40     STACK_SEG       ENDS
                            41     
                            42     
----                        43     DATA_SEG        SEGMENT
0000 0A                     44             TIMER0_MESS             DB      10,13,'TIMER2 INTERRUPT    '
0001 0D
0002 54494D45523220
     494E5445525255
     505420202020
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    00:24:48  11/24/;3  PAGE    2


LOC  OBJ                  LINE     SOURCE

0016 18                     45             T_COUNT                 DB      24
0017 18                     46             T_COUNT_SET             DB      24
0018 0A                     47             REC_MESS                DB      10,13,'Period of timer0 =     '
0019 0D
001A 506572696F6420
     6F662074696D65
     7230203D202020
     2020
0031 (32                    48             MESSAGE         DB  32 dup('h')
     68
     )
0051 00                     49             KEYPAD_INPUT    DB  0,0,0,0,0,0,0,0
0052 00
0053 00
0054 00
0055 00
0056 00
0057 00
0058 00
0059 2D                     50             BCD_MESSAGE     DB  '-','-','-','-','-','-'
005A 2D
005B 2D
005C 2D
005D 2D
005E 2D
005F FE                     51             ENABLE_BYTE     DB  11111110b
0060 00                     52             BCD_INDEX       DB  0
0061 0000                   53             KEYPAD_INDEX    DW      0
0063 20                     54             M_SIZE                  DB  32
0064 0040                   55             DAC_BASE        DW  4000H
0066 (15                    56             DAC_ADDR        DB  15 dup(0) 
     00
     )
0075 00                     57             DAC_LEN         DB  0
0076 0000                   58             SI_PTR          DW  0
0078 ??                     59             CHAR                    DB  ?
0079 ??                     60             REG_AL                  DB  ?
007A ??                     61             REG_BH                  DB  ?
007B ??                     62             REG_CL                  DB  ?
007C 00                     63             FLAG            DB  0
007D 00                     64             LONG_PRESS_FLAG DB      0
007E 7231                   65             MY_ID                   DB      'r1'
0080 00                     66             ID_FLAG_@               DB      0
0081 00                     67             ID_FLAG_r               DB      0
0082 4072312F               68             REPLY_MESSAGE   DB      '@r1/'
0086 40302F                 69             FAIL_MESSAGE    DB '@0/'
0089 04                     70             REPLY_COUNT             DB      4
008A 03                     71             FAIL_COUNT              DB      3
008B 00                     72             REPLY_FLAG              DB      0
008C 00                     73             SEND_FLAG       DB  0
008D (13                    74             SEND_BUFFER     DB  13 dup(0)
     00
     )
009A 0000                   75             SEND_BUFFER_LEN DW      0
009C 0000                   76             MAX_INPUT_SIZE  DW      0
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    00:24:48  11/24/;3  PAGE    3


LOC  OBJ                  LINE     SOURCE

009E 0000                   77             QTY_FLAG                DW      0
00A0 0000                   78             RECEIVE_FLAG    DW      0
00A2 0000                   79             DAC_FLAG                DW      0
00A4 0000                   80             PRICE_FLAG      DW      0
00A6 0100                   81             DECIMAL_FLAG    DW      1
00A8 0000                   82             SCROLL_LEN      DW      0
00AA 0000                   83             DAC_DISABLE     DW  0
00AC 0300                   84             DECIMAL_INDEX   DW  3
00AE 0100                   85             LANG_FLAG       DW  1
00B0 0000                   86             PRICE                   DW      0
00B2 0000                   87             QTY                             DW      0
00B4 0000                   88             TOTAL_PRICE_U   DW      0
00B6 0000                   89             TOTAL_PRICE_L   DW      0
00B8 0000                   90             TOTAL_PRICE_DEC DW      0
00BA (8                     91             TEMP_BCD_ARR    DB  8 dup(0)
     00
     )
00C2 0000                   92             THOUSAND_FLAG   DW  0
00C4 0000                   93             CENT_FLAG               DW      0
----                        94     DATA_SEG        ENDS
                            95     
                            96     
----                        97     CODE_SEG        SEGMENT
                            98     
                            99             PUBLIC          START
                           100     
                           101     ASSUME  CS:CODE_SEG, SS:STACK_SEG
                           102     
0000                       103     START:
                           104     ;initialize stack area
0000 B8----         R      105                     MOV     AX,STACK_SEG            
0003 8ED0                  106                     MOV     SS,AX
0005 368B260002            107                     MOV     SP,TOS
                           108                     
                           109     ; Initialize the on-chip pheripherals
000A 9A0000----     E      110                     CALL    FAR PTR IODEFINE
                           111                     
000F 9A0000----     E      112     call set_timer2
0014 FB                    113                    STI
                           114     
                           115     ; ^^^^^^^^^^^^^^^^^  Start of User Main Routine  ^^^^^^^^^^^^^^^^^^
                           116     
                           117     ;Initialize MMCS
                           118             
0015 BAA6FF                119             MOV DX, MMCS
0018 B80340                120             MOV AX, 4003H
001B EF                    121             OUT DX, AX
                           122     
                           123     ; Initialize MPCS to MAP peripheral to IO address
                           124             
001C BAA8FF                125             MOV DX, MPCS
001F B88320                126             MOV AX, 2083H
0022 EF                    127             OUT DX, AX
                           128        
                           129     ; PCSBA initial, set the parallel port start from 00H
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    00:24:48  11/24/;3  PAGE    4


LOC  OBJ                  LINE     SOURCE

0023 BAA4FF                130             MOV DX, PCSBA
0026 B80300                131             MOV AX, 0003H ; Peripheral starting address 00H no READY, No Waits
0029 EF                    132             OUT DX, AX
                           133     
                           134     ; Initialize LMCS 
002A BAA2FF                135         MOV DX, LMCR
002D B8C401                136         MOV AX, 01C4H  ; Starting address 1FFFH, 8K, No waits, last shoud be 5H for 1 wai
                                   ts      
0030 EF                    137         OUT DX, AX
                           138             
0031 B8----         R      139             MOV AX, DATA_SEG
0034 8ED8                  140             MOV DS, AX
                           141                              
0036 BA8300                142             MOV DX, CWR_8255
0039 B88200                143             MOV AX, 0082h
003C EF                    144             OUT DX, AX
                           145             
003D                       146     NEXT:
003D 9A4400----     R      147             CALL FAR PTR KEYPAD_LOOP
                           148             
0042 EBF9                  149     JMP NEXT
                           150     
0044                       151     KEYPAD_LOOP PROC FAR
0044 50                    152     PUSH AX
0045 53                    153     PUSH BX
0046 51                    154     PUSH CX
0047 52                    155     PUSH DX
                           156             
0048 9A4204----     R      157                             CALL FAR PTR DEBOUNCE           
                           158                             
004D C606790003            159     WAIT_1:         MOV DS:REG_AL, 03H
0052 BB0000                160                         MOV BX, 0000H
0055 BA8200                161                         MOV DX,C_8255
0058 8AC3                  162                         MOV AL,BL
005A EE                    163                         OUT DX,AL
                           164                        
005B BA8100                165                         MOV DX,B_8255
005E EC                    166                         IN AL,DX
005F 8AD8                  167                         MOV BL,AL  
0061 80E3FC                168                         AND BL,0FCH
0064 80FBFC                169                         CMP BL,0FCH
                           170                      
0067 7449                  171                     JE LONG_PRESS
                           172                             
0069 B3FE                  173                         MOV BL, 0FEH
006B C6067A0004            174                         MOV DS:REG_BH, 04H
                           175                        
0070                       176     NXTROW: 
0070 C0C307                177                     ROL BL,07H
0073 8AEB                  178                             MOV CH,BL
0075 BA8200                179                             MOV DX,C_8255
0078 8AC3                  180                             MOV AL,BL
007A EE                    181                             OUT DX,AL
                           182                             
007B BA8100                183                             MOV DX,B_8255
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    00:24:48  11/24/;3  PAGE    5


LOC  OBJ                  LINE     SOURCE

007E EC                    184                             IN AL,DX
007F 8AD8                  185                             MOV BL,AL
0081 80E3FC                186                             AND BL,0FCH
0084 C6067B0006            187                             MOV DS:REG_CL,06H
0089 C0DB02                188                             RCR BL,02H
008C D0DB                  189     NXTCOL:         RCR BL,01H
008E 732A                  190                             JNC CODEKY
0090 FE0E7900              191                             DEC DS:REG_AL
0094 FE0E7B00              192                             DEC DS:REG_CL
0098 803E7B0003            193                             CMP DS:REG_CL,03H
009D 7470                  194                             JE KEYPAD3
                           195                             
009F 803E7B0000            196                             CMP DS:REG_CL, 0H
00A4 7466                  197                             JE SUBTRACT2
00A6 EBE4                  198                             JMP NXTCOL
                           199                             
00A8 8ADD                  200                             MOV BL,CH
00AA FE0E7A00              201                             DEC DS:REG_BH
00AE 75C0                  202                             JNZ NXTROW
00B0 EB9B                  203                             JMP WAIT_1
                           204                             
00B2                       205     LONG_PRESS:
00B2 C6067D0000            206                             MOV DS:LONG_PRESS_FLAG, 0
00B7 EB5990                207                             JMP RETURN2
00BA                       208     CODEKY:
00BA 803E79000B            209                         CMP DS:REG_AL, 11
00BF 7505                  210                             JNE bcd_upd
00C1 C606790000            211                             MOV DS:REG_AL, 0
                           212                             
00C6                       213     bcd_upd:
00C6 803E7D0000            214                             CMP DS:LONG_PRESS_FLAG, 0
00CB 7545                  215                             JNE RETURN2
                           216                             
00CD 803E79000A            217                             CMP DS:REG_AL, 10
00D2 7508                  218                             JNE BACKSPACE
00D4 9A9103----     R      219                             CALL FAR PTR BCD_CLEAR
00D9 E9FB00                220                             JMP UPDATE_7SEG2
                           221                             
00DC 803E79000C            222     BACKSPACE:      CMP DS:REG_AL, 12
00E1 7508                  223                             JNE ENTER_DATA
00E3 9A2203----     R      224                             CALL FAR PTR BCD_BACKSPACE
00E8 E9EC00                225                             JMP UPDATE_7SEG2
                           226     
00EB 803E79000D            227     ENTER_DATA:     CMP DS:REG_AL, 13
00F0 7523                  228                             JNE END_TRANS
00F2 9A9103----     R      229                             CALL FAR PTR BCD_CLEAR
00F7 C706AC000600          230                             MOV DS:DECIMAL_INDEX, 6
00FD C7069C000800          231                             MOV DS:MAX_INPUT_SIZE, 8
0103 C706AE000000          232                             MOV DS:LANG_FLAG, 0
0109 E9CB00                233                             JMP UPDATE_7SEG2
                           234     
010C E96801                235     SUBTRACT2:   JMP SUBTRACT
                           236     
010F E95501                237     KEYPAD3:        JMP KEYPAD_2
                           238     
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    00:24:48  11/24/;3  PAGE    6


LOC  OBJ                  LINE     SOURCE

0112 E97001                239     RETURN2:    JMP RETURN
                           240                             
0115 803E790010            241     END_TRANS:      CMP DS:REG_AL, 16
011A 752E                  242                             JNE SCROLL_LEFT
011C BB0000                243                             MOV BX, 0
011F C6878D0024            244                             MOV DS:SEND_BUFFER[BX], '$'
0124 43                    245                             INC BX
0125 C6878D002F            246                             MOV DS:SEND_BUFFER[BX], '/'
012A C7069A000200          247                             MOV DS:SEND_BUFFER_LEN, 2
0130 C6068C0001            248                             MOV DS:SEND_FLAG, 1
0135 C706B8000000          249                             MOV DS:TOTAL_PRICE_DEC, 0
013B C706B6000000          250                             MOV DS:TOTAL_PRICE_L, 0
0141 C706B4000000          251                             MOV DS:TOTAL_PRICE_U, 0
0147 E98D00                252                             JMP UPDATE_7SEG2
                           253                             
                           254                             
014A                       255     SCROLL_LEFT:
014A 803E790015            256                             CMP DS:REG_AL, 21
014F 753D                  257                             JNE SCROLL_RIGHT
0151 833E610006            258                             CMP DS:KEYPAD_INDEX, 6
0156 7E7F                  259                             JLE UPDATE_7SEG2
0158 833EA80000            260                             CMP DS:SCROLL_LEN, 0
015D 7478                  261                             JE UPDATE_7SEG2
015F FF0EA800              262                             DEC DS:SCROLL_LEN
0163 FF0EAC00              263                             DEC DS:DECIMAL_INDEX
0167 FF0E6100              264                             DEC DS:KEYPAD_INDEX
016B 8B1E6100              265                             MOV BX, DS:KEYPAD_INDEX
016F 8A4751                266                             MOV AL, DS:KEYPAD_INPUT[BX]
0172 A27900                267                             MOV DS:REG_AL, AL
0175 C706AA000100          268                             MOV DS:DAC_DISABLE, 1
017B 9ABC03----     R      269                             CALL FAR PTR BCD_UPDATE
0180 C706AA000000          270                             MOV DS:DAC_DISABLE, 0
0186 C606790015            271                             MOV DS:REG_AL, 21
018B EB4A90                272                             JMP UPDATE_7SEG2
                           273     
                           274     
                           275     
018E                       276     SCROLL_RIGHT:
018E 803E790013            277                             CMP DS:REG_AL, 19
0193 7545                  278                             JNE LANG_TOGGLE
0195 833E610006            279                             CMP DS:KEYPAD_INDEX, 6
019A 7E3B                  280                             JLE UPDATE_7SEG2
019C A16100                281                             MOV AX, DS:KEYPAD_INDEX
019F 2D0600                282                             SUB AX, 6
01A2 3906A800              283                             CMP DS:SCROLL_LEN, AX
01A6 742F                  284                             JE UPDATE_7SEG2
01A8 FF06A800              285                             INC DS:SCROLL_LEN
01AC FF06AC00              286                             INC DS:DECIMAL_INDEX
01B0 FF0E6100              287                             DEC DS:KEYPAD_INDEX
01B4 8B1E6100              288                             MOV BX, DS:KEYPAD_INDEX
01B8 8A4751                289                             MOV AL, DS:KEYPAD_INPUT[BX]
01BB A27900                290                             MOV DS:REG_AL, AL
01BE C706AA000100          291                             MOV DS:DAC_DISABLE, 1
01C4 9ABC03----     R      292                             CALL FAR PTR BCD_UPDATE
01C9 C706AA000000          293                             MOV DS:DAC_DISABLE, 0
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    00:24:48  11/24/;3  PAGE    7


LOC  OBJ                  LINE     SOURCE

01CF C606790013            294                             MOV DS:REG_AL, 19
01D4 EB0190                295                             JMP UPDATE_7SEG2
                           296                             
01D7 EB7A90                297     UPDATE_7SEG2: JMP UPDATE_7SEG
                           298     
01DA                       299     LANG_TOGGLE:
01DA 803E790012            300                             CMP DS:REG_AL, 18
01DF 751E                  301                             JNE QTY_PROMPT
01E1 833EAE0001            302                             CMP DS:LANG_FLAG, 1
01E6 75EF                  303                             JNE UPDATE_7SEG2
01E8 A16400                304                             MOV AX, DS:DAC_BASE
01EB 3D0040                305                             CMP AX, 4000H
01EE 7406                  306                             JE MANDRIN
01F0 B80040                307                             MOV AX, 4000H
01F3 EB0490                308                             JMP SEND_TOGGLE
01F6                       309             MANDRIN:
01F6 B80063                310                             MOV AX, 6300H
01F9                       311             SEND_TOGGLE:
01F9 A36400                312                             MOV DS:DAC_BASE, AX
01FC EB5590                313                             JMP UPDATE_7SEG
01FF                       314     QTY_PROMPT:
01FF 803E790016            315                             CMP DS:REG_AL, 22
0204 7520                  316                             JNE QUANTITY
0206 833E610008            317                             CMP DS:KEYPAD_INDEX, 8
020B 7519                  318                             JNE  QUANTITY
                           319                             ; CMP DS:MAX_INPUT_SIZE, 8
                           320                             ; JNE QUANTITY
020D 9ADB02----     R      321                             CALL FAR PTR UPDATE_SEND_BUFFER
0212 9A9103----     R      322                             CALL FAR PTR BCD_CLEAR
0217 C7069C000200          323                             MOV DS:MAX_INPUT_SIZE, 2
021D C7069E000100          324                             MOV DS:QTY_FLAG, 1
0223 EB2E90                325                             JMP UPDATE_7SEG
                           326                     
0226                       327     QUANTITY:
0226 833E610000            328                             CMP DS:KEYPAD_INDEX, 0
022B 7426                  329                             JE  UPDATE_7SEG
                           330                             
022D 803E79000E            331                             CMP DS:REG_AL, 14
0232 751F                  332                             JNE UPDATE_7SEG
                           333                             
0234 833E9E0001            334                             CMP DS:QTY_FLAG, 1
0239 7518                  335                             JNE UPDATE_7SEG
                           336                             
023B 9A8A02----     R      337                             CALL FAR PTR UPDATE_THE_QUANTITY
                           338                                             
0240 C6068C0001            339                             MOV DS:SEND_FLAG, 1
                           340                             
0245 C7069E000000          341                             MOV DS:QTY_FLAG, 0
024B 9A9103----     R      342                             CALL FAR PTR BCD_CLEAR
0250 EB0190                343                             JMP UPDATE_7SEG
                           344                             
                           345     
0253                       346     UPDATE_7SEG:
0253 803E790009            347                             CMP DS:REG_AL, 9
0258 7F05                  348                             JG SET_PRESS_FLAG
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    00:24:48  11/24/;3  PAGE    8


LOC  OBJ                  LINE     SOURCE

                           349                             
025A 9ABC03----     R      350                             CALL FAR PTR BCD_UPDATE
                           351                             
025F                       352     SET_PRESS_FLAG:
025F C6067D0001            353                             MOV DS:LONG_PRESS_FLAG, 1
0264 EB1F90                354                             JMP RETURN
                           355             
0267                       356     KEYPAD_2: 
0267 800679000F            357                 ADD DS:REG_AL,0FH
026C E91DFE                358                             JMP NXTCOL
026F C606790000            359     ZERO_PRINT: MOV DS:REG_AL,00H
0274 E915FE                360                             JMP NXTCOL
0277 802E790006            361     SUBTRACT:   SUB DS:REG_AL,06H
027C 8ADD                  362                             MOV BL,CH
027E FE0E7A00              363                             DEC DS:REG_BH
0282 E9EBFD                364                             JMP NXTROW
                           365             
                           366             
0285                       367     RETURN:
0285 5A                    368                             POP DX
0286 59                    369                             POP CX
0287 5B                    370                             POP BX
0288 58                    371                             POP AX
0289 CB                    372                             RET
                           373     
                           374     KEYPAD_LOOP ENDP
                           375     
028A                       376     UPDATE_THE_QUANTITY PROC FAR
028A 50                    377     PUSH AX
028B 53                    378     PUSH BX
028C 51                    379     PUSH CX
028D 52                    380     PUSH DX
028E 8B0E6100              381             MOV CX, DS:KEYPAD_INDEX
0292 BB0000                382             MOV BX, 0
0295 BA0000                383             MOV DX, 0
0298                       384             UPD_QTY:
0298 A1B200                385                     MOV AX, DS:QTY
029B 53                    386                     PUSH BX
029C BB0A00                387                     MOV BX, 10
029F F7E3                  388                     MUL BX
02A1 5B                    389                     POP BX
02A2 8A5751                390                     MOV DL, DS:KEYPAD_INPUT[BX]
02A5 03C2                  391                     ADD AX, DX
02A7 A3B200                392                     MOV DS:QTY, AX
02AA 43                    393                     INC BX
02AB E2EB                  394             LOOP UPD_QTY
                           395             
02AD 8B0E6100              396             MOV CX, DS:KEYPAD_INDEX
02B1 8B1E9A00              397             MOV BX, DS:SEND_BUFFER_LEN
                           398             
02B5                       399             UPD_BUFFER:
02B5 53                    400                     PUSH BX
02B6 8B1E6100              401                     MOV BX, DS:KEYPAD_INDEX
02BA 2BD9                  402                     SUB BX, CX
02BC 8A4751                403                     MOV AL, DS:KEYPAD_INPUT[BX]
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    00:24:48  11/24/;3  PAGE    9


LOC  OBJ                  LINE     SOURCE

02BF 5B                    404                     POP BX
02C0 0430                  405                     ADD AL, 30H
02C2 88878D00              406                     MOV DS:SEND_BUFFER[BX], AL
                           407                     
02C6 43                    408                     INC BX
02C7 FF069A00              409                     INC DS:SEND_BUFFER_LEN
02CB E2E8                  410             LOOP UPD_BUFFER
                           411             
02CD C6878D002F            412             MOV DS:SEND_BUFFER[BX], '/'
02D2 FF069A00              413             INC DS:SEND_BUFFER_LEN
                           414                     
02D6 5A                    415     POP DX
02D7 59                    416     POP CX
02D8 5B                    417     POP BX
02D9 58                    418     POP AX
                           419     
02DA CB                    420     RET
                           421     UPDATE_THE_QUANTITY ENDP
                           422     
02DB                       423     UPDATE_SEND_BUFFER PROC FAR
02DB 50                    424     PUSH AX
02DC 53                    425     PUSH BX
02DD 51                    426     PUSH CX
02DE 52                    427     PUSH DX
                           428     
02DF 8B0E6100              429             MOV CX, DS:KEYPAD_INDEX
02E3 83F900                430             CMP CX, 0
02E6 7435                  431             JE END_UPD_BUFFER
02E8 83C102                432             ADD CX, 2
02EB 890E9A00              433             MOV DS:SEND_BUFFER_LEN, CX
02EF BB0000                434             MOV BX, 0
02F2                       435             BUFFER_LOOP:
02F2 83FB00                436                     CMP BX, 0
02F5 7508                  437                     JNE ASTERISK
02F7 C6878D007E            438                     MOV DS:SEND_BUFFER[BX], '~'
02FC EB1C90                439                     JMP END_BUFFER
02FF                       440             ASTERISK:
02FF A16100                441                     MOV AX, DS:KEYPAD_INDEX
0302 40                    442                     INC AX
0303 3BD8                  443                     CMP BX, AX
0305 7508                  444                     JNE CONT
0307 C6878D002A            445                     MOV DS:SEND_BUFFER[BX], '*'
030C EB0C90                446                     JMP END_BUFFER
030F                       447             CONT:
030F 4B                    448                     DEC BX
0310 8A4751                449                     MOV AL, DS:KEYPAD_INPUT[BX]
0313 0430                  450                     ADD AL, 30H
0315 43                    451                     INC BX
0316 88878D00              452                     MOV DS:SEND_BUFFER[BX], AL
                           453                     
031A                       454             END_BUFFER:
031A 43                    455                     INC BX
031B E2D5                  456             LOOP BUFFER_LOOP
031D                       457     END_UPD_BUFFER:
031D 5A                    458     POP DX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    00:24:48  11/24/;3  PAGE   10


LOC  OBJ                  LINE     SOURCE

031E 59                    459     POP CX
031F 5B                    460     POP BX
0320 58                    461     POP AX
0321 CB                    462     RET
                           463     UPDATE_SEND_BUFFER ENDP
                           464     
0322                       465     BCD_BACKSPACE PROC FAR
                           466     
0322 50                    467     PUSH AX
0323 53                    468     PUSH BX
0324 51                    469     PUSH CX
0325 52                    470     PUSH DX
                           471     
0326 8A167900              472             MOV DL, DS:REG_AL
032A 833E610000            473             CMP DS:KEYPAD_INDEX, 0
032F 7457                  474             JE RETURN_BACK
                           475             
0331 BB0600                476             MOV BX, 6
0334                       477             BCD_CLEAR_LOOP:
0334 4B                    478                     DEC BX
0335 C647592D              479                     MOV DS:BCD_MESSAGE[BX], '-'
0339 43                    480                     INC BX
033A 4B                    481                     DEC BX
033B 75F7                  482             JNZ BCD_CLEAR_LOOP
                           483             
033D 833E610001            484             CMP DS:KEYPAD_INDEX, 1
0342 7E2C                  485             JLE less_than_two
                           486             
0344 FF0E6100              487             DEC DS:KEYPAD_INDEX
0348 FF0E6100              488             DEC DS:KEYPAD_INDEX
034C 8B1E6100              489             MOV BX, DS:KEYPAD_INDEX
0350 8A4751                490             MOV AL, DS:KEYPAD_INPUT[BX]
0353 A27900                491             MOV DS:REG_AL, AL
0356 C706A8000000          492             MOV DS:SCROLL_LEN, 0
035C C706AA000100          493             MOV DS:DAC_DISABLE, 1
0362 9ABC03----     R      494             CALL FAR PTR BCD_UPDATE
0367 C706AA000000          495             MOV DS:DAC_DISABLE, 0
036D EB1990                496             JMP RETURN_BACK
                           497             
0370                       498     less_than_two:
0370 FF0E6100              499             DEC DS:KEYPAD_INDEX
0374 C60679002D            500             MOV DS:REG_AL, '-'
0379 C706A8000000          501             MOV DS:SCROLL_LEN, 0
037F 9ABC03----     R      502             CALL FAR PTR BCD_UPDATE
0384 FF0E6100              503             DEC DS:KEYPAD_INDEX
                           504             
0388                       505     RETURN_BACK:
0388 88167900              506             MOV DS:REG_AL, DL
038C 5A                    507     POP DX
038D 59                    508     POP CX
038E 5B                    509     POP BX
038F 58                    510     POP AX
                           511     
0390 CB                    512     RET
                           513     BCD_BACKSPACE ENDP
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    00:24:48  11/24/;3  PAGE   11


LOC  OBJ                  LINE     SOURCE

                           514     
0391                       515     BCD_CLEAR PROC FAR
0391 50                    516     PUSH AX
0392 53                    517     PUSH BX
0393 51                    518     PUSH CX
0394 52                    519     PUSH DX
0395 BB0800                520             MOV BX, 8
0398                       521             CLEAR_LOOP:
0398 C6475100              522             MOV DS:KEYPAD_INPUT[BX], 0
039C 4B                    523             DEC BX
039D 75F9                  524             JNZ CLEAR_LOOP
                           525             
039F BB0600                526             MOV BX, 6
03A2                       527             CLEAR_LOOP2:
03A2 4B                    528                     DEC BX
03A3 C647592D              529                     MOV DS:BCD_MESSAGE[BX], '-'
03A7 43                    530                     INC BX
03A8 4B                    531                     DEC BX
03A9 75F7                  532             JNZ CLEAR_LOOP2
                           533     
03AB C70661000000          534             MOV DS:KEYPAD_INDEX, 0
03B1 C706A8000000          535             MOV DS:SCROLL_LEN, 0
03B7 5A                    536     POP DX
03B8 59                    537     POP CX
03B9 5B                    538     POP BX
03BA 58                    539     POP AX
03BB CB                    540     RET
                           541     BCD_CLEAR ENDP
                           542     
03BC                       543     BCD_UPDATE PROC FAR
03BC 50                    544     PUSH AX
03BD 53                    545     PUSH BX
03BE 51                    546     PUSH CX
03BF 52                    547     PUSH DX
03C0 A19C00                548                     MOV AX, DS:MAX_INPUT_SIZE
03C3 39066100              549                     CMP DS:KEYPAD_INDEX, AX
03C7 7D5A                  550                     JGE BCD_RET
                           551                     
03C9 8A0E7900              552                     MOV CL, DS:REG_AL
03CD 80F909                553                     CMP CL, 9
03D0 7F0C                  554                     JG SKIP_PAST
03D2 833EAA0001            555                     CMP DS:DAC_DISABLE, 1
03D7 7405                  556                     JE SKIP_PAST
03D9 9A2804----     R      557                     CALL FAR PTR DAC_UPDATE
                           558     
03DE                       559     SKIP_PAST:              
03DE 8A0E7900              560                     MOV CL, DS:REG_AL
                           561     
03E2 8B1E6100              562                     MOV BX, DS:KEYPAD_INDEX
                           563                             
03E6 884F51                564                     MOV DS:KEYPAD_INPUT[BX], CL
                           565                             
03E9 FF066100              566                     INC DS:KEYPAD_INDEX
                           567                             
03ED 8B1E6100              568                     MOV BX, DS:KEYPAD_INDEX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    00:24:48  11/24/;3  PAGE   12


LOC  OBJ                  LINE     SOURCE

                           569                     
03F1 A1A800                570                     MOV AX, DS:SCROLL_LEN
03F4 2BD8                  571                     SUB BX, AX
                           572                     
03F6 8B166100              573                     MOV DX, DS:KEYPAD_INDEX
03FA 83FA06                574                     CMP DX, 6
03FD 7E03                  575                     JLE update_display
03FF BA0600                576                     MOV DX, 6
                           577                     
0402                       578             update_display:
                           579             
0402 B90500                580                     MOV CX, 5
0405 4B                    581                     DEC BX
0406 8A4751                582                     MOV AL, DS:KEYPAD_INPUT[BX]
0409 43                    583                     INC BX
                           584                             
040A 52                    585                     PUSH DX
040B 8B166100              586                     MOV DX, DS:KEYPAD_INDEX
040F 2B16A800              587                     SUB DX, DS:SCROLL_LEN
                           588                     
0413 2BD3                  589                     SUB DX, BX
                           590                             
0415 53                    591                     PUSH BX
                           592                             
0416 2BCA                  593                     SUB CX, DX
0418 8BD9                  594                     MOV BX, CX
041A 884759                595                     MOV DS:BCD_MESSAGE[BX], AL
                           596                             
041D 5B                    597                     POP BX
041E 5A                    598                     POP DX
                           599             
041F 4B                    600                     DEC BX
0420 4A                    601                     DEC DX
0421 75DF                  602             JNZ update_display
                           603     
0423                       604             BCD_RET:
0423 5A                    605                     POP DX
0424 59                    606                     POP CX
0425 5B                    607                     POP BX
0426 58                    608                     POP AX
0427 CB                    609     RET
                           610     BCD_UPDATE ENDP
                           611     
0428                       612     DAC_UPDATE PROC FAR
0428 50                    613             PUSH AX
0429 53                    614             PUSH BX
042A 51                    615             PUSH CX
042B 52                    616             PUSH DX
                           617             
042C BB0000                618             MOV BX, 0
042F 8A1E7500              619             MOV BL, DS:DAC_LEN
0433 A07900                620             MOV AL, DS:REG_AL
                           621             
0436 884766                622             MOV DS:DAC_ADDR[BX], AL
                           623             
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    00:24:48  11/24/;3  PAGE   13


LOC  OBJ                  LINE     SOURCE

0439 FE067500              624             INC DS:DAC_LEN
                           625     
043D 5A                    626             POP DX
043E 59                    627             POP CX
043F 5B                    628             POP BX
0440 58                    629             POP AX
0441 CB                    630     RET
                           631     DAC_UPDATE ENDP
                           632               
0442                       633     DEBOUNCE PROC FAR
0442 51                    634                       PUSH CX
                           635                       
0443 B94C09                636                       MOV CX, 094CH
0446 90                    637     BACK:     NOP
0447 E2FD                  638                       LOOP BACK
0449 59                    639                       POP CX
044A CB                    640                       RET
                           641     DEBOUNCE  ENDP
                           642     
044B                       643     SEND_INPUT PROC FAR
044B 50                    644     PUSH AX
044C 53                    645     PUSH BX
044D 51                    646     PUSH CX
044E 52                    647     PUSH DX
044F BB0000                648             MOV BX, 0
0452 8B0E9A00              649             MOV CX, DS:SEND_BUFFER_LEN
                           650             
0456                       651             S_BUFF:
0456 8A878D00              652                     MOV AL, DS:SEND_BUFFER[BX]
045A 9A0000----     E      653                     CALL FAR PTR PRINT_CHAR
045F 43                    654                     INC BX
0460 E2F4                  655             LOOP S_BUFF
                           656             
0462                       657     SEND_INPUT_END:
0462 5A                    658     POP DX
0463 59                    659     POP CX
0464 5B                    660     POP BX
0465 58                    661     POP AX
0466 CB                    662     RET
                           663     SEND_INPUT ENDP
                           664     
0467                       665     CALC_UPD_PRICE PROC FAR
0467 50                    666     PUSH AX
0468 53                    667     PUSH BX
0469 51                    668     PUSH CX
046A 52                    669     PUSH DX
046B 833EB20000            670             CMP DS:QTY, 0
0470 7503                  671             JNE START_CALC
0472 E9B403                672             JMP CALC_END
0475                       673     START_CALC:
0475 BA0000                674             MOV DX, 0
0478 A1B000                675             MOV AX, DS:PRICE
047B 8B1EB200              676             MOV BX, DS:QTY
047F F7E3                  677             MUL BX
                           678             
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    00:24:48  11/24/;3  PAGE   14


LOC  OBJ                  LINE     SOURCE

0481 BB6400                679             MOV BX, 100
0484 F7F3                  680             DIV BX
0486 A3B000                681             MOV DS:PRICE, AX
0489 A1B800                682             MOV AX, DS:TOTAL_PRICE_DEC
048C 03C2                  683             ADD AX, DX
048E 3D6400                684             CMP AX, 100
0491 7C07                  685             JL NON_DECIMAL
0493 FF06B600              686             INC DS:TOTAL_PRICE_L
0497 2D6400                687             SUB AX, 100
                           688             
049A                       689     NON_DECIMAL:    
049A A3B800                690             MOV DS:TOTAL_PRICE_DEC, AX
049D A1B600                691             MOV AX, DS:TOTAL_PRICE_L
04A0 8B1EB000              692             MOV BX, DS:PRICE
04A4 03C3                  693             ADD AX, BX
04A6 7304                  694             JNC update_normal
04A8 FF06B400              695             INC DS:TOTAL_PRICE_U
                           696             
04AC                       697     update_normal:
04AC A3B600                698             MOV DS:TOTAL_PRICE_L, AX
                           699             
04AF BA0000                700             MOV DX, 0
04B2 833EB80009            701             CMP DS:TOTAL_PRICE_DEC, 9
04B7 7F0B                  702             JG DECIMAL_CONT
04B9 B90A00                703             MOV CX, 10
04BC A1B800                704             MOV AX, DS:TOTAL_PRICE_DEC
04BF F7E1                  705             MUL CX
04C1 A3B800                706             MOV DS:TOTAL_PRICE_DEC, AX
04C4                       707     DECIMAL_CONT:
04C4 A1B800                708             MOV AX, DS:TOTAL_PRICE_DEC
04C7 B90A00                709             MOV CX, 10
04CA F7F1                  710             DIV CX
                           711             
04CC BB0700                712             MOV BX, 7
04CF 8897BA00              713             MOV DS:TEMP_BCD_ARR[BX], DL
04D3 4B                    714             DEC BX
04D4 8887BA00              715             MOV DS:TEMP_BCD_ARR[BX], AL
                           716             
04D8 BB0600                717             MOV BX, 6
04DB A1B600                718             MOV AX, DS:TOTAL_PRICE_L
                           719             
04DE                       720             TEMP_UPD_LOOP:
04DE BA0000                721                     MOV DX, 0
04E1 B90A00                722                     MOV CX, 10
04E4 F7F1                  723                     DIV CX
                           724                     
04E6 4B                    725                     DEC BX
04E7 8897BA00              726                     MOV DS:TEMP_BCD_ARR[BX], DL
04EB 43                    727                     INC BX
                           728                     
04EC 4B                    729                     DEC BX
                           730                     
04ED 75EF                  731             JNZ TEMP_UPD_LOOP
                           732             
04EF 8B0EB400              733             MOV CX, DS:TOTAL_PRICE_U
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    00:24:48  11/24/;3  PAGE   15


LOC  OBJ                  LINE     SOURCE

04F3 83F900                734             CMP CX, 0
04F6 7478                  735             JE upd_dac_part
04F8                       736             ADD_EXTRA_PART:
04F8 BB0500                737                     MOV BX, 5
04FB 8A87BA00              738                     MOV AL, DS:TEMP_BCD_ARR[BX]
04FF 0406                  739                     ADD AL, 6
0501 3C09                  740                     CMP AL, 9
0503 7E08                  741                     JLE CONT_DIGIT_1
0505 2C0A                  742                     SUB AL, 10
0507 4B                    743                     DEC BX
0508 FE87BA00              744                     INC DS:TEMP_BCD_ARR[BX]
050C 43                    745                     INC BX
050D                       746             CONT_DIGIT_1:
050D 8887BA00              747                     MOV DS:TEMP_BCD_ARR[BX], AL
0511 4B                    748                     DEC BX
                           749                     
0512 8A87BA00              750                     MOV AL, DS:TEMP_BCD_ARR[BX]
0516 0403                  751                     ADD AL, 3
0518 3C09                  752                     CMP AL, 9
051A 7E08                  753                     JLE CONT_DIGIT_2
051C 2C0A                  754                     SUB AL, 10
051E 4B                    755                     DEC BX
051F FE87BA00              756                     INC DS:TEMP_BCD_ARR[BX]
0523 43                    757                     INC BX
0524                       758             CONT_DIGIT_2:
0524 8887BA00              759                     MOV DS:TEMP_BCD_ARR[BX], AL
0528 4B                    760                     DEC BX
                           761                     
0529 8A87BA00              762                     MOV AL, DS:TEMP_BCD_ARR[BX]
052D 0405                  763                     ADD AL, 5
052F 3C09                  764                     CMP AL, 9
0531 7E08                  765                     JLE CONT_DIGIT_3
0533 2C0A                  766                     SUB AL, 10
0535 4B                    767                     DEC BX
0536 FE87BA00              768                     INC DS:TEMP_BCD_ARR[BX]
053A 43                    769                     INC BX
053B                       770             CONT_DIGIT_3:
053B 8887BA00              771                     MOV DS:TEMP_BCD_ARR[BX], AL
053F 4B                    772                     DEC BX
                           773                     
                           774                     
0540 8A87BA00              775                     MOV AL, DS:TEMP_BCD_ARR[BX]
0544 0405                  776                     ADD AL, 5
0546 3C09                  777                     CMP AL, 9
0548 7E08                  778                     JLE CONT_DIGIT_4
054A 2C0A                  779                     SUB AL, 10
054C 4B                    780                     DEC BX
054D FE87BA00              781                     INC DS:TEMP_BCD_ARR[BX]
0551 43                    782                     INC BX
0552                       783             CONT_DIGIT_4:
0552 8887BA00              784                     MOV DS:TEMP_BCD_ARR[BX], AL
0556 4B                    785                     DEC BX
                           786                     
0557 8A87BA00              787                     MOV AL, DS:TEMP_BCD_ARR[BX]
055B 0406                  788                     ADD AL, 6
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    00:24:48  11/24/;3  PAGE   16


LOC  OBJ                  LINE     SOURCE

055D 3C09                  789                     CMP AL, 9
055F 7E08                  790                     JLE CONT_DIGIT_5
0561 2C0A                  791                     SUB AL, 10
0563 4B                    792                     DEC BX
0564 FE87BA00              793                     INC DS:TEMP_BCD_ARR[BX]
0568 43                    794                     INC BX
0569                       795             CONT_DIGIT_5:
0569 8887BA00              796                     MOV DS:TEMP_BCD_ARR[BX], AL
056D 4B                    797                     DEC BX
                           798                     
056E E288                  799             LOOP ADD_EXTRA_PART
                           800             
0570                       801     upd_dac_part:
                           802     
0570 813E64000040          803             CMP DS:DAC_BASE, 4000H
0576 7403                  804             JE ENGLISH_DAC
0578 E95101                805             JMP MANDARIN_DAC
                           806             
057B                       807     ENGLISH_DAC:
057B C706C4000000          808             MOV DS:CENT_FLAG, 0
0581 C706C2000000          809             MOV DS:THOUSAND_FLAG, 0
0587 BB0000                810             MOV BX, 0
058A 8A87BA00              811             MOV AL, DS:TEMP_BCD_ARR[BX]
058E A27900                812             MOV DS:REG_AL, AL
0591 3C00                  813             CMP AL, 0
0593 740F                  814             JE NEXT_PLACE
0595 9A2804----     R      815             CALL FAR PTR DAC_UPDATE
059A C60679001C            816             MOV DS:REG_AL, 28
059F 9A2804----     R      817             CALL FAR PTR DAC_UPDATE
                           818             
05A4                       819     NEXT_PLACE:     
05A4 43                    820             INC BX
05A5 8A87BA00              821             MOV AL, DS:TEMP_BCD_ARR[BX]
05A9 3C01                  822             CMP AL, 1
05AB 7518                  823             JNE NOT_1
05AD 43                    824             INC BX
05AE 8A87BA00              825             MOV AL, DS:TEMP_BCD_ARR[BX]
05B2 040A                  826             ADD AL, 10
05B4 A27900                827             MOV DS:REG_AL, AL
05B7 9A2804----     R      828             CALL FAR PTR DAC_UPDATE
05BC C706C2000100          829             MOV DS:THOUSAND_FLAG, 1
05C2 EB2C90                830             JMP HUNDREDS_PLACE
05C5                       831     NOT_1:
05C5 3C00                  832             CMP AL, 0
05C7 7410                  833             JE NEXT_PLACE_1
05C9 C706C2000100          834             MOV DS:THOUSAND_FLAG, 1
05CF 0412                  835             ADD AL, 18
05D1 A27900                836             MOV DS:REG_AL, AL
05D4 9A2804----     R      837             CALL FAR PTR DAC_UPDATE
05D9                       838     NEXT_PLACE_1:
05D9 43                    839             INC BX
05DA 8A87BA00              840             MOV AL, DS:TEMP_BCD_ARR[BX]
05DE 3C00                  841             CMP AL, 0
05E0 740E                  842             JE HUNDREDS_PLACE
05E2 C706C2000100          843             MOV DS:THOUSAND_FLAG, 1
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    00:24:48  11/24/;3  PAGE   17


LOC  OBJ                  LINE     SOURCE

05E8 A27900                844             MOV DS:REG_AL, AL
05EB 9A2804----     R      845             CALL FAR PTR DAC_UPDATE
                           846     
05F0                       847     HUNDREDS_PLACE:
05F0 833EC20000            848             CMP DS:THOUSAND_FLAG, 0
05F5 7410                  849             JE NEXT_PLACE_2
05F7 C60679001D            850             MOV DS:REG_AL, 29
05FC 9A2804----     R      851             CALL FAR PTR DAC_UPDATE
0601 C706C2000000          852             MOV DS:THOUSAND_FLAG, 0
                           853             
0607                       854     NEXT_PLACE_2:
0607 43                    855             INC BX
0608 8A87BA00              856             MOV AL, DS:TEMP_BCD_ARR[BX]
060C 3C00                  857             CMP AL, 0
060E 7412                  858             JE NEXT_PLACE_3
0610 A27900                859             MOV DS:REG_AL, AL
0613 9A2804----     R      860             CALL FAR PTR DAC_UPDATE
0618 C60679001C            861             MOV DS:REG_AL, 28
061D 9A2804----     R      862             CALL FAR PTR DAC_UPDATE
                           863             
0622                       864     NEXT_PLACE_3:   
0622 43                    865             INC BX
0623 8A87BA00              866             MOV AL, DS:TEMP_BCD_ARR[BX]
0627 3C01                  867             CMP AL, 1
0629 7512                  868             JNE NOT_1_2
062B 43                    869             INC BX
062C 8A87BA00              870             MOV AL, DS:TEMP_BCD_ARR[BX]
0630 040A                  871             ADD AL, 10
0632 A27900                872             MOV DS:REG_AL, AL
0635 9A2804----     R      873             CALL FAR PTR DAC_UPDATE
063A EB2090                874             JMP DECIMAL_DAC
063D                       875     NOT_1_2:
063D 3C00                  876             CMP AL, 0
063F 740A                  877             JE NEXT_PLACE_4
0641 0412                  878             ADD AL, 18
0643 A27900                879             MOV DS:REG_AL, AL
0646 9A2804----     R      880             CALL FAR PTR DAC_UPDATE
064B                       881     NEXT_PLACE_4:
064B 43                    882             INC BX
064C 8A87BA00              883             MOV AL, DS:TEMP_BCD_ARR[BX]
0650 3C00                  884             CMP AL, 0
0652 7408                  885             JE DECIMAL_DAC
0654 A27900                886             MOV DS:REG_AL, AL
0657 9A2804----     R      887             CALL FAR PTR DAC_UPDATE
                           888             
065C                       889     DECIMAL_DAC:
065C C60679001E            890             MOV DS:REG_AL, 30
0661 9A2804----     R      891             CALL FAR PTR DAC_UPDATE
                           892             
0666 43                    893             INC BX
0667 8A87BA00              894             MOV AL, DS:TEMP_BCD_ARR[BX]
066B 3C01                  895             CMP AL, 1
066D 7518                  896             JNE NOT_1_3
066F 43                    897             INC BX
0670 C706C4000100          898             MOV DS:CENT_FLAG, 1
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    00:24:48  11/24/;3  PAGE   18


LOC  OBJ                  LINE     SOURCE

0676 8A87BA00              899             MOV AL, DS:TEMP_BCD_ARR[BX]
067A 040A                  900             ADD AL, 10
067C A27900                901             MOV DS:REG_AL, AL
067F 9A2804----     R      902             CALL FAR PTR DAC_UPDATE
0684 EB2C90                903             JMP ENGLISH_END
                           904             
0687                       905     NOT_1_3:
0687 3C00                  906             CMP AL, 0
0689 7410                  907             JE NEXT_PLACE_5
068B C706C4000100          908             MOV DS:CENT_FLAG, 1
0691 0412                  909             ADD AL, 18
0693 A27900                910             MOV DS:REG_AL, AL
0696 9A2804----     R      911             CALL FAR PTR DAC_UPDATE
                           912             
069B                       913     NEXT_PLACE_5:
069B 43                    914             INC BX
069C 8A87BA00              915             MOV AL, DS:TEMP_BCD_ARR[BX]
06A0 3C00                  916             CMP AL, 0
06A2 740E                  917             JE ENGLISH_END
06A4 C706C4000100          918             MOV DS:CENT_FLAG, 1
06AA A27900                919             MOV DS:REG_AL, AL
06AD 9A2804----     R      920             CALL FAR PTR DAC_UPDATE
                           921             
06B2                       922     ENGLISH_END:
06B2 833EC40000            923             CMP DS:CENT_FLAG, 0
06B7 7410                  924             JE ENGLISH_END2
06B9 C60679001F            925             MOV DS:REG_AL, 31
06BE 9A2804----     R      926             CALL FAR PTR DAC_UPDATE
06C3 C706C4000000          927             MOV DS:CENT_FLAG, 0
06C9                       928     ENGLISH_END2:
06C9 E91E01                929             JMP CONT_BCD_UPD_1
                           930             
06CC                       931     MANDARIN_DAC:
06CC C706C4000000          932             MOV DS:CENT_FLAG, 0
06D2 C706C2000000          933             MOV DS:THOUSAND_FLAG, 0
06D8 BB0000                934             MOV BX, 0
06DB 8A87BA00              935             MOV AL, DS:TEMP_BCD_ARR[BX]
06DF 3C00                  936             CMP AL, 0
06E1 7418                  937             JE NEXT_PLACE_6
06E3 C706C2000100          938             MOV DS:THOUSAND_FLAG, 1
06E9 A27900                939             MOV DS:REG_AL, AL
06EC 9A2804----     R      940             CALL FAR PTR DAC_UPDATE
06F1 C60679000B            941             MOV DS:REG_AL, 11
06F6 9A2804----     R      942             CALL FAR PTR DAC_UPDATE
                           943             
06FB                       944     NEXT_PLACE_6:
06FB 43                    945             INC BX
06FC 8A87BA00              946             MOV AL, DS:TEMP_BCD_ARR[BX]
0700 3C00                  947             CMP AL, 0
0702 7418                  948             JE NEXT_PLACE_7
0704 C706C2000100          949             MOV DS:THOUSAND_FLAG, 1
070A A27900                950             MOV DS:REG_AL, AL
070D 9A2804----     R      951             CALL FAR PTR DAC_UPDATE
0712 C60679000A            952             MOV DS:REG_AL, 10
0717 9A2804----     R      953             CALL FAR PTR DAC_UPDATE
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    00:24:48  11/24/;3  PAGE   19


LOC  OBJ                  LINE     SOURCE

                           954             
071C                       955     NEXT_PLACE_7:
071C 43                    956             INC BX
071D 8A87BA00              957             MOV AL, DS:TEMP_BCD_ARR[BX]
0721 3C00                  958             CMP AL, 0
0723 740E                  959             JE NEXT_PLACE_8
0725 C706C2000100          960             MOV DS:THOUSAND_FLAG, 1
072B A27900                961             MOV DS:REG_AL, AL
072E 9A2804----     R      962             CALL FAR PTR DAC_UPDATE
                           963     
0733                       964     NEXT_PLACE_8:
0733 833EC20000            965             CMP DS:THOUSAND_FLAG, 0
0738 7410                  966             JE IGNORE_THOUSAND
073A C60679000C            967             MOV DS:REG_AL, 12
073F 9A2804----     R      968             CALL FAR PTR DAC_UPDATE
0744 C706C2000000          969             MOV DS:THOUSAND_FLAG, 0
                           970             
074A                       971     IGNORE_THOUSAND:
074A 43                    972             INC BX
074B 8A87BA00              973             MOV AL, DS:TEMP_BCD_ARR[BX]
074F 3C00                  974             CMP AL, 0
0751 7412                  975             JE NEXT_PLACE_9
0753 A27900                976             MOV DS:REG_AL, AL
0756 9A2804----     R      977             CALL FAR PTR DAC_UPDATE
075B C60679000B            978             MOV DS:REG_AL, 11
0760 9A2804----     R      979             CALL FAR PTR DAC_UPDATE
                           980             
0765                       981     NEXT_PLACE_9:
0765 43                    982             INC BX
0766 8A87BA00              983             MOV AL, DS:TEMP_BCD_ARR[BX]
076A 3C00                  984             CMP AL, 0
076C 7412                  985             JE NEXT_PLACE_10
076E A27900                986             MOV DS:REG_AL, AL
0771 9A2804----     R      987             CALL FAR PTR DAC_UPDATE
0776 C60679000A            988             MOV DS:REG_AL, 10
077B 9A2804----     R      989             CALL FAR PTR DAC_UPDATE
                           990             
0780                       991     NEXT_PLACE_10:
0780 43                    992             INC BX
0781 8A87BA00              993             MOV AL, DS:TEMP_BCD_ARR[BX]
0785 3C00                  994             CMP AL, 0
0787 7408                  995             JE MANDARIN_DEC
0789 A27900                996             MOV DS:REG_AL, AL
078C 9A2804----     R      997             CALL FAR PTR DAC_UPDATE
                           998             
0791                       999     MANDARIN_DEC:
0791 C60679000D           1000             MOV DS:REG_AL, 13
0796 9A2804----     R     1001             CALL FAR PTR DAC_UPDATE
                          1002             
079B 43                   1003             INC BX
079C 8A87BA00             1004             MOV AL, DS:TEMP_BCD_ARR[BX]
07A0 3C00                 1005             CMP AL, 0
07A2 7418                 1006             JE NEXT_PLACE_11
07A4 C706C4000100         1007             MOV DS:CENT_FLAG, 1
07AA A27900               1008             MOV DS:REG_AL, AL
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    00:24:48  11/24/;3  PAGE   20


LOC  OBJ                  LINE     SOURCE

07AD 9A2804----     R     1009             CALL FAR PTR DAC_UPDATE
07B2 C60679000A           1010             MOV DS:REG_AL, 10
07B7 9A2804----     R     1011             CALL FAR PTR DAC_UPDATE
                          1012             
07BC                      1013     NEXT_PLACE_11:
                          1014     
07BC 43                   1015             INC BX
07BD 8A87BA00             1016             MOV AL, DS:TEMP_BCD_ARR[BX]
07C1 3C00                 1017             CMP AL, 0
07C3 740E                 1018             JE CONT_BCD_UPD
07C5 C706C4000100         1019             MOV DS:CENT_FLAG, 1
07CB A27900               1020             MOV DS:REG_AL, AL
07CE 9A2804----     R     1021             CALL FAR PTR DAC_UPDATE
                          1022             
07D3                      1023     CONT_BCD_UPD:
07D3 833EC40000           1024             CMP DS:CENT_FLAG, 0
07D8 7410                 1025             JE CONT_BCD_UPD_1
07DA C60679000E           1026             MOV DS:REG_AL, 14
07DF 9A2804----     R     1027             CALL FAR PTR DAC_UPDATE
07E4 C706C4000000         1028             MOV DS:CENT_FLAG, 0
07EA                      1029     CONT_BCD_UPD_1:
07EA 9A9103----     R     1030             CALL FAR PTR BCD_CLEAR
07EF C70661000000         1031             MOV DS:KEYPAD_INDEX, 0
07F5 C706AC000300         1032             MOV DS:DECIMAL_INDEX, 3
07FB B90800               1033             MOV CX, 8
07FE                      1034             UPD_BCD:
07FE BB0800               1035                     MOV BX, 8
0801 2BD9                 1036                     SUB BX, CX
0803 8A87BA00             1037                     MOV AL, DS:TEMP_BCD_ARR[BX]
0807 A27900               1038                     MOV DS:REG_AL, AL
080A C706AA000100         1039                     MOV DS:DAC_DISABLE, 1
0810 9ABC03----     R     1040                     CALL FAR PTR BCD_UPDATE
0815 C706AA000000         1041                     MOV DS:DAC_DISABLE, 0
081B E2E1                 1042             LOOP UPD_BCD
                          1043             
081D C706B0000000         1044             MOV DS:PRICE, 0
0823 C706B2000000         1045             MOV DS:QTY, 0
0829                      1046     CALC_END:
0829 5A                   1047     POP DX
082A 59                   1048     POP CX
082B 5B                   1049     POP BX
082C 58                   1050     POP AX
082D CB                   1051     RET
                          1052     CALC_UPD_PRICE ENDP
                          1053     ; ^^^^^^^^^^^^^^^ End of User main routine ^^^^^^^^^^^^^^^^^^^^^^^^^
082E                      1054     SERIAL_REC_ACTION       PROC    FAR
082E 51                   1055                     PUSH    CX
082F 53                   1056                     PUSH    BX
0830 1E                   1057                     PUSH    DS
                          1058                     
0831 BB----         R     1059                     MOV     BX,DATA_SEG             ;initialize data segment register
0834 8EDB                 1060                     MOV     DS,BX
                          1061                     
0836 803E8B0001           1062                     CMP DS:REPLY_FLAG, 1
083B 7569                 1063                     JNE next_id1
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    00:24:48  11/24/;3  PAGE   21


LOC  OBJ                  LINE     SOURCE

                          1064                     
083D 803E8C0001           1065                     CMP DS:SEND_FLAG, 1
0842 7465                 1066                     JE send_input_across1
                          1067                     
0844 833EA00001           1068                     CMP DS:RECEIVE_FLAG, 1
0849 7561                 1069                     JNE terminate_session3
                          1070                     
084B 3C2F                 1071                     CMP AL, '/'
084D 751A                 1072                     JNE CHECK_SEND
084F C706A4000000         1073                     MOV DS:PRICE_FLAG, 0
0855 C706A0000000         1074                     MOV DS:RECEIVE_FLAG, 0
085B C706AE000100         1075                     MOV DS:LANG_FLAG, 1
0861 9A6704----     R     1076                     CALL FAR PTR CALC_UPD_PRICE
0866 EB4490               1077                     JMP terminate_session3
                          1078             
0869                      1079             CHECK_SEND:
0869 3C26                 1080                     CMP AL, '&'
086B 7515                 1081                     JNE receive_price
086D C706A4000100         1082                     MOV DS:PRICE_FLAG, 1
0873 C70661000000         1083                     MOV DS:KEYPAD_INDEX, 0
0879 C7069C000800         1084                     MOV DS:MAX_INPUT_SIZE, 8
087F EB7F90               1085                     JMP id_skip2
                          1086                     
0882                      1087             receive_price:
0882 3C23                 1088                     CMP AL, '#'
0884 750F                 1089                     JNE check_price
0886 C706A2000100         1090                     MOV DS:DAC_FLAG, 1
088C C706A4000000         1091                     MOV DS:PRICE_FLAG, 0
0892 EB6C90               1092                     JMP id_skip2
                          1093             
0895                      1094             check_price:    
                          1095             
0895 833EA40001           1096                     CMP DS:PRICE_FLAG, 1
089A 7431                 1097                     JE update_price_value
                          1098                     
089C 833EA20001           1099                     CMP DS:DAC_FLAG, 1
08A1 740C                 1100                     JE dac_change
08A3 EB5B90               1101                     JMP id_skip2
                          1102     
08A6                      1103             next_id1:
08A6 EB5B90               1104                     JMP next_id
                          1105                     
08A9                      1106             send_input_across1:
08A9 EB3990               1107                     JMP send_input_across
                          1108             
08AC                      1109             terminate_session3:
08AC EB4F90               1110                     JMP terminate_session2
                          1111             
08AF                      1112             dac_change:
08AF 8A1E7900             1113                     MOV BL, DS:REG_AL
08B3 2C30                 1114                     SUB AL, 30H
08B5 A27900               1115                     MOV DS:REG_AL, AL
08B8 9A2804----     R     1116                     CALL FAR PTR DAC_UPDATE
08BD 881E7900             1117                     MOV DS:REG_AL, BL
08C1 C706A2000000         1118                     MOV DS:DAC_FLAG, 0
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    00:24:48  11/24/;3  PAGE   22


LOC  OBJ                  LINE     SOURCE

08C7 EB3790               1119                     JMP id_skip2
                          1120             
                          1121     
08CA EB3490               1122             id_skip3: JMP id_skip2
                          1123     
                          1124                     
08CD                      1125             update_price_value:
08CD 2C30                 1126                     SUB AL, 30H
08CF B90000               1127                     MOV CX, 0
08D2 8AC8                 1128                     MOV CL, AL
08D4 A1B000               1129                     MOV AX, DS:PRICE
08D7 BB0A00               1130                     MOV BX, 10
08DA F7E3                 1131                     MUL BX
                          1132                     
08DC 03C1                 1133                     ADD AX, CX
08DE A3B000               1134                     MOV DS:PRICE, AX
08E1 EB1D90               1135                     JMP id_skip2
                          1136                     
08E4                      1137             send_input_across:
08E4 9A4B04----     R     1138                     CALL FAR PTR SEND_INPUT
                          1139                     
08E9 C7069A000000         1140                     MOV DS:SEND_BUFFER_LEN, 0
                          1141                     
08EF C6068C0000           1142                     MOV DS:SEND_FLAG, 0
                          1143                     
08F4 C706A0000100         1144                     MOV DS:RECEIVE_FLAG, 1
                          1145                     
08FA EB0490               1146                     JMP id_skip2
                          1147                     
08FD EB3E90               1148                     terminate_session2: JMP terminate_session
0900 EB6790               1149                     id_skip2: JMP id_skip
                          1150                     
0903                      1151             next_id:
                          1152                     
0903 803E810001           1153                     CMP DS:ID_FLAG_r, 1
0908 7513                 1154                     JNE id_flag_label
090A 38067F00             1155                     CMP DS:MY_ID[1], AL
090E 7559                 1156                     JNE id_skip
                          1157                     ;start writing to pc
0910 C6068B0001           1158                     MOV DS:REPLY_FLAG, 1
0915 C606810000           1159                     MOV DS:ID_FLAG_r, 0
091A EB4D90               1160                     JMP id_skip
                          1161             
091D                      1162             id_flag_label:
                          1163             
091D 803E800001           1164                     CMP DS:ID_FLAG_@, 1
0922 7539                 1165                     JNE protocol_rec
0924 3C72                 1166                     CMP AL,'r'
0926 750D                 1167                     JNE id_not_r
0928 C606810001           1168                     MOV DS:ID_FLAG_r,1
092D C606800000           1169                     MOV DS:ID_FLAG_@, 0
0932 EB6C90               1170                     JMP S_RET
0935                      1171             id_not_r:
0935 C606800000           1172                     MOV DS:ID_FLAG_@, 0
093A EB2D90               1173                     JMP id_skip
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    00:24:48  11/24/;3  PAGE   23


LOC  OBJ                  LINE     SOURCE

                          1174             
093D                      1175             terminate_session:
093D C606810000           1176                     MOV DS:ID_FLAG_r, 0
0942 33DB                 1177                     XOR BX,BX
0944                      1178             start_send1:
0944 50                   1179                     PUSH AX
0945 33C0                 1180                     XOR AX,AX
0947 8A878600             1181                     MOV AL, DS:FAIL_MESSAGE[BX]
094B 9A0000----     E     1182                     CALL FAR PTR PRINT_CHAR
0950 58                   1183                     POP AX
0951 C6068B0000           1184                     MOV DS:REPLY_FLAG, 0
0956 43                   1185                     INC BX
0957 3A1E8A00             1186                     CMP BL, DS:FAIL_COUNT
095B 75E7                 1187                     JNE start_send1
                          1188                     
095D                      1189             protocol_rec:
095D 3C40                 1190                     CMP AL,'@'
095F 7508                 1191                     JNE id_skip
0961 C606800001           1192                     MOV DS:ID_FLAG_@,1
0966 EB3890               1193                     JMP S_RET
                          1194                     
0969                      1195             id_skip:
0969 EB3590               1196                     JMP S_RET
                          1197             
096C 3C3C                 1198                     CMP     AL,'<'
096E 750B                 1199                     JNE     S_FAST
                          1200     
0970 FE061700             1201                     INC     DS:T_COUNT_SET
0974 FE061700             1202                     INC     DS:T_COUNT_SET
                          1203     
0978 EB0D90               1204                     JMP     S_NEXT0
097B                      1205     S_FAST:
097B 3C3E                 1206                     CMP     AL,'>'
097D 7521                 1207                     JNE     S_RET
                          1208     
097F FE0E1700             1209                     DEC     DS:T_COUNT_SET
0983 FE0E1700             1210                     DEC     DS:T_COUNT_SET
                          1211     
0987                      1212     S_NEXT0:
0987 B91600               1213                     MOV     CX,22                   ;initialize counter for message
098A BB0000               1214                     MOV     BX,0
                          1215     
098D 8A4718               1216     S_NEXT1:        MOV     AL,DS:REC_MESS[BX]      ;print message
0990 9A0000----     E     1217                     call    FAR ptr print_char
0995 43                   1218                     INC     BX
0996 E2F5                 1219                     LOOP    S_NEXT1
                          1220     
0998 A01700               1221                     MOV     AL,DS:T_COUNT_SET       ;print current period of timer0
099B 9A0000----     E     1222                     CALL    FAR PTR PRINT_2HEX
09A0                      1223     S_RET:
09A0 1F                   1224                     POP     DS
09A1 5B                   1225                     POP     BX
09A2 59                   1226                     POP     CX
09A3 CB                   1227                     RET
                          1228     SERIAL_REC_ACTION       ENDP
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    00:24:48  11/24/;3  PAGE   24


LOC  OBJ                  LINE     SOURCE

                          1229     
09A4                      1230     TIMER2_ACTION   PROC    FAR
09A4 50                   1231                     PUSH    AX
09A5 1E                   1232                     PUSH    DS
09A6 53                   1233                     PUSH    BX
09A7 51                   1234                     PUSH    CX
09A8 52                   1235                     PUSH    DX
                          1236                     
                          1237                     
09A9 B8----         R     1238                     MOV     AX,DATA_SEG
09AC 8ED8                 1239                     MOV     DS,AX
                          1240             
09AE FE0E1600             1241                     DEC     DS:T_COUNT
09B2 754A                 1242                     JNZ     T_NEXT1
09B4 A01700               1243                     MOV     AL,DS:T_COUNT_SET
09B7 A21600               1244                     MOV     DS:T_COUNT,AL
                          1245     
09BA                      1246     T_NEXT0:
09BA A05F00               1247                     MOV AL, DS:ENABLE_BYTE
09BD BA8001               1248                     MOV DX, 180H
09C0 EE                   1249                     OUT DX, AL
                          1250                     
09C1 33DB                 1251                     XOR BX, BX
09C3 8A1E6000             1252                     MOV BL, DS:BCD_INDEX
09C7 8A4759               1253                     MOV AL, DS:BCD_MESSAGE[BX]
                          1254                     
09CA 3B1EAC00             1255                     CMP BX, DS:DECIMAL_INDEX
09CE 7506                 1256                     JNE CALL_FUNC
09D0 C706A6000100         1257                     MOV DS:DECIMAL_FLAG, 1
09D6                      1258     CALL_FUNC:
09D6 9A6F0A----     R     1259                     CALL FAR PTR BCD_TO_7SEG
09DB C706A6000000         1260                     MOV DS:DECIMAL_FLAG, 0
                          1261     
09E1 BA0002               1262                     MOV DX, 200H
09E4 EE                   1263                     OUT DX, AL
                          1264     
09E5 FE066000             1265                     INC DS:BCD_INDEX
09E9 D0065F00             1266                     ROL DS:ENABLE_BYTE, 1
09ED 803E5F00BF           1267                     CMP DS:ENABLE_BYTE, 10111111b
09F2 750A                 1268                     JNE T_NEXT1
09F4 C6065F00FE           1269                     MOV DS:ENABLE_BYTE, 11111110b 
09F9 C606600000           1270                     MOV DS:BCD_INDEX, 0
                          1271     
                          1272                     
09FE                      1273     T_NEXT1:
09FE 803E750000           1274                     CMP DS:DAC_LEN, 0
0A03 743C                 1275                     JE ISR_END
                          1276                     
                          1277                     
0A05 8B367600             1278                     MOV SI, DS:SI_PTR
                          1279                             
0A09 BB0000               1280                     MOV BX, 0
0A0C 33C0                 1281                     XOR AX, AX
0A0E 8A4766               1282                     MOV AL, DS:DAC_ADDR[BX]
                          1283                     
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    00:24:48  11/24/;3  PAGE   25


LOC  OBJ                  LINE     SOURCE

0A11 BB0001               1284                     MOV BX, 100H
0A14 F7E3                 1285                     MUL BX
                          1286                     
0A16 8B166400             1287                     MOV DX, DS:DAC_BASE
0A1A 03D0                 1288                     ADD DX, AX
                          1289                     
0A1C 1E                   1290                     PUSH DS
0A1D 8EDA                 1291                     MOV DS, DX
                          1292                     
0A1F 8B04                 1293                     MOV AX, [SI]
                          1294                     
0A21 BA1001               1295                     MOV DX, 110H
0A24 EE                   1296                     OUT DX, AL
                          1297                     
0A25 1F                   1298                     POP DS
                          1299                     
0A26 FF067600             1300                     INC DS:SI_PTR
0A2A 813E76000010         1301                     CMP DS:SI_PTR, 1000H
0A30 750F                 1302                     JNE ISR_END
                          1303                     
0A32 C70676000000         1304                     MOV DS:SI_PTR, 0
0A38 FE0E7500             1305                     DEC DS:DAC_LEN
0A3C 9A470A----     R     1306                     CALL FAR PTR DAC_SHIFT
                          1307                     
0A41                      1308     ISR_END:
                          1309                     
0A41 5A                   1310                     POP DX
0A42 59                   1311                     POP     CX
0A43 5B                   1312                     POP     BX
0A44 1F                   1313                     POP     DS
0A45 58                   1314                     POP AX
0A46 CB                   1315                     RET
                          1316     TIMER2_ACTION   ENDP
                          1317     
                          1318     
0A47                      1319     DAC_SHIFT PROC FAR
0A47 50                   1320             PUSH AX
0A48 53                   1321             PUSH BX
0A49 51                   1322             PUSH CX
0A4A 52                   1323             PUSH DX
                          1324     
0A4B 33C9                 1325             XOR CX, CX
0A4D 8A0E7500             1326             MOV CL, DS:DAC_LEN
0A51 80F900               1327             CMP CL, 0
0A54 7414                 1328             JE END_SHIFT
                          1329     
0A56                      1330             SHIFT_LOOP:
                          1331     
0A56 33DB                 1332             XOR BX, BX
0A58 8A1E7500             1333             MOV BL, DS:DAC_LEN
0A5C 2BD9                 1334             SUB BX, CX
0A5E 43                   1335             INC BX
                          1336             
0A5F 33D2                 1337             XOR DX, DX
0A61 8A5766               1338             MOV DL, DS:DAC_ADDR[BX]
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    00:24:48  11/24/;3  PAGE   26


LOC  OBJ                  LINE     SOURCE

0A64 4B                   1339             DEC BX
0A65 885766               1340             MOV DS:DAC_ADDR[BX], DL
                          1341     
0A68 E2EC                 1342             LOOP SHIFT_LOOP
                          1343             
0A6A                      1344             END_SHIFT:
0A6A 5A                   1345             POP DX
0A6B 59                   1346             POP CX
0A6C 5B                   1347             POP BX
0A6D 58                   1348             POP AX
0A6E CB                   1349             RET
                          1350     DAC_SHIFT ENDP
                          1351     
0A6F                      1352     BCD_TO_7SEG PROC FAR
                          1353     
0A6F 53                   1354             PUSH BX
0A70 51                   1355             PUSH CX
0A71 52                   1356             PUSH DX
                          1357             
0A72 3C00                 1358             CMP AL, 0
0A74 7511                 1359             JNE one
0A76 833EA60001           1360             CMP DS:DECIMAL_FLAG, 1
0A7B 7405                 1361             JE decimal0
0A7D B03F                 1362             MOV AL, 00111111b
0A7F E9D700               1363             JMP endfunc
0A82                      1364     decimal0:
0A82 B0BF                 1365             MOV AL, 10111111b
0A84 E9D200               1366             JMP endfunc
                          1367             
0A87                      1368             one:
0A87 3C01                 1369             CMP AL, 1
0A89 7511                 1370             JNE two
0A8B 833EA60001           1371             CMP DS:DECIMAL_FLAG, 1
0A90 7405                 1372             JE decimal1
0A92 B006                 1373             MOV AL, 00000110b
0A94 E9C200               1374             JMP endfunc
0A97                      1375     decimal1:
0A97 B086                 1376             MOV AL, 10000110b
0A99 E9BD00               1377             JMP endfunc
                          1378             
0A9C                      1379             two:
0A9C 3C02                 1380             CMP AL,2
0A9E 7511                 1381             JNE three
0AA0 833EA60001           1382             CMP DS:DECIMAL_FLAG, 1
0AA5 7405                 1383             JE decimal2
0AA7 B05B                 1384             MOV AL, 01011011b
0AA9 E9AD00               1385             JMP endfunc
0AAC                      1386     decimal2:
0AAC B0DB                 1387             MOV AL, 11011011b
0AAE E9A800               1388             JMP endfunc
                          1389             
0AB1                      1390             three:
0AB1 3C03                 1391             CMP AL,3
0AB3 7511                 1392             JNE four
0AB5 833EA60001           1393             CMP DS:DECIMAL_FLAG, 1
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    00:24:48  11/24/;3  PAGE   27


LOC  OBJ                  LINE     SOURCE

0ABA 7405                 1394             JE decimal3
0ABC B04F                 1395             MOV AL, 01001111b
0ABE E99800               1396             JMP endfunc
0AC1                      1397     decimal3:
0AC1 B0CF                 1398             MOV AL, 11001111b
0AC3 E99300               1399             JMP endfunc
                          1400             
0AC6                      1401             four:
0AC6 3C04                 1402             CMP AL,4
0AC8 7511                 1403             JNE five
0ACA 833EA60001           1404             CMP DS:DECIMAL_FLAG, 1
0ACF 7405                 1405             JE decimal4
0AD1 B066                 1406             MOV AL, 01100110b
0AD3 E98300               1407             JMP endfunc
0AD6                      1408     decimal4:
0AD6 B0E6                 1409             MOV AL, 11100110b
0AD8 EB7F90               1410             JMP endfunc
                          1411             
0ADB                      1412             five:
0ADB 3C05                 1413             CMP AL,5
0ADD 7511                 1414             JNE six
0ADF 833EA60001           1415             CMP DS:DECIMAL_FLAG, 1
0AE4 7405                 1416             JE decimal5
0AE6 B06D                 1417             MOV AL, 01101101b
0AE8 EB6F90               1418             JMP endfunc
0AEB                      1419     decimal5:
0AEB B0ED                 1420             MOV AL, 11101101b
0AED EB6A90               1421             JMP endfunc
                          1422             
0AF0                      1423             six:
0AF0 3C06                 1424             CMP AL,6
0AF2 7511                 1425             JNE seven
0AF4 833EA60001           1426             CMP DS:DECIMAL_FLAG, 1
0AF9 7405                 1427             JE decimal6
0AFB B07D                 1428             MOV AL, 01111101b
0AFD EB5A90               1429             JMP endfunc
0B00                      1430     decimal6:
0B00 B0FD                 1431             MOV AL, 11111101b
0B02 EB5590               1432             JMP endfunc
                          1433             
0B05                      1434             seven:
0B05 3C07                 1435             CMP AL,7
0B07 7511                 1436             JNE eight
0B09 833EA60001           1437             CMP DS:DECIMAL_FLAG, 1
0B0E 7405                 1438             JE decimal7
0B10 B007                 1439             MOV AL, 00000111b
0B12 EB4590               1440             JMP endfunc
0B15                      1441     decimal7:
0B15 B087                 1442             MOV AL, 10000111b
0B17 EB4090               1443             JMP endfunc
                          1444             
0B1A                      1445             eight:
0B1A 3C08                 1446             CMP AL,8
0B1C 7511                 1447             JNE nine
0B1E 833EA60001           1448             CMP DS:DECIMAL_FLAG, 1
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    00:24:48  11/24/;3  PAGE   28


LOC  OBJ                  LINE     SOURCE

0B23 7405                 1449             JE decimal8
0B25 B07F                 1450             MOV AL, 01111111b
0B27 EB3090               1451             JMP endfunc
0B2A                      1452     decimal8:
0B2A B0FF                 1453             MOV AL, 11111111b
0B2C EB2B90               1454             JMP endfunc
                          1455             
0B2F                      1456             nine:
0B2F 3C09                 1457             CMP AL,9
0B31 7511                 1458             JNE hifn
0B33 833EA60001           1459             CMP DS:DECIMAL_FLAG, 1
0B38 7405                 1460             JE decimal9
0B3A B06F                 1461             MOV AL, 01101111b
0B3C EB1B90               1462             JMP endfunc
0B3F                      1463     decimal9:
0B3F B0EF                 1464             MOV AL, 11101111b
0B41 EB1690               1465             JMP endfunc
                          1466             
0B44                      1467             hifn:
0B44 3C2D                 1468             CMP AL,'-'
0B46 7511                 1469             JNE endfunc
0B48 833EA60001           1470             CMP DS:DECIMAL_FLAG, 1
0B4D 7405                 1471             JE decimal10
0B4F B040                 1472             MOV AL, 01000000b
0B51 EB0690               1473             JMP endfunc
0B54                      1474     decimal10:
0B54 B0C0                 1475             MOV AL, 11000000b
0B56 EB0190               1476             JMP endfunc
                          1477             
0B59                      1478             endfunc:
0B59 5A                   1479             POP DX
0B5A 59                   1480             POP CX
0B5B 5B                   1481             POP BX
                          1482     
0B5C CB                   1483     RET
                          1484     BCD_TO_7SEG ENDP
                          1485     
----                      1486     CODE_SEG        ENDS
                          1487     END

ASSEMBLY COMPLETE, NO ERRORS FOUND
