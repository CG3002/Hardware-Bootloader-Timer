8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:16:20  12/07/;3  PAGE    1


DOS 5.0 (038-N) 8086/87/88/186 MACRO ASSEMBLER V3.1 ASSEMBLY OF MODULE TIMER
OBJECT MODULE PLACED IN TIMER.OBJ
ASSEMBLER INVOKED BY:  D:\ASM86.EXE TIMER.ASM


LOC  OBJ                  LINE     SOURCE

                             1 +1  $MOD186
                             2 +1  $EP
                             3     NAME TIMER
                             4     ; Main program for uPD70208 microcomputer system
                             5     ;
                             6     ; Author:       Dr Tay Teng Tiow
                             7     ; Address:      Department of Electrical Engineering 
                             8     ;               National University of Singapore
                             9     ;               10, Kent Ridge Crescent
                            10     ;               Singapore 0511. 
                            11     ; Date:         6th September 1991
                            12     ;
                            13     ; This file contains proprietory information and cannot be copied 
                            14     ; or distributed without prior permission from the author.
                            15     ; =========================================================================
                            16     
                            17     public  serial_rec_action, timer2_action
                            18     extrn   print_char:far, print_2hex:far, iodefine:far
                            19     extrn   set_timer2:far
                            20     
                            21     ;IO Setup for 80C188 
  FFA0                      22             UMCR    EQU    0FFA0H ; Upper Memory Control Register
  FFA2                      23             LMCR    EQU    0FFA2H ; Lower Memory control Register         
  FFA4                      24             PCSBA   EQU    0FFA4H ; Peripheral Chip Select Base Address
  FFA8                      25             MPCS    EQU    0FFA8H ; MMCS and PCS Alter Control Register
  0080                      26             A_8255  EQU    0080H
  0081                      27             B_8255  EQU    0081H
  0082                      28             C_8255  EQU    0082H
  0083                      29             CWR_8255  EQU    0083H
  FF38                      30             INT0CON  EQU   0FF38H
  FF22                      31             EOI EQU 0FF22H
  FF28                      32             IMASK EQU 0FF28H
  FFA6                      33             MMCS    EQU    0FFA6H 
  4000                      34             DAC EQU 4000H
                            35     
                            36     
----                        37     STACK_SEG       SEGMENT
0000 (512                   38                     DB      512 DUP(?)
     ??
     )
0200                        39             TOS     LABEL   WORD
----                        40     STACK_SEG       ENDS
                            41     
                            42     
----                        43     DATA_SEG        SEGMENT
0000 0A                     44             TIMER0_MESS             DB      10,13,'TIMER2 INTERRUPT    '
0001 0D
0002 54494D45523220
     494E5445525255
     505420202020
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:16:20  12/07/;3  PAGE    2


LOC  OBJ                  LINE     SOURCE

0016 18                     45             T_COUNT                 DB      24
0017 18                     46             T_COUNT_SET             DB      24
0018 0A                     47             REC_MESS                DB      10,13,'Period of timer0 =     '
0019 0D
001A 506572696F6420
     6F662074696D65
     7230203D202020
     2020
0031 (32                    48             MESSAGE         DB  32 dup('h')
     68
     )
0051 00                     49             KEYPAD_INPUT    DB  0,0,0,0,0,0,0,0
0052 00
0053 00
0054 00
0055 00
0056 00
0057 00
0058 00
0059 2D                     50             BCD_MESSAGE     DB  '-','-','-','-','-','-'
005A 2D
005B 2D
005C 2D
005D 2D
005E 2D
005F FE                     51             ENABLE_BYTE     DB  11111110b
0060 00                     52             BCD_INDEX       DB  0
0061 0000                   53             KEYPAD_INDEX    DW      0
0063 20                     54             M_SIZE                  DB  32
0064 0040                   55             DAC_BASE        DW  4000H
0066 (15                    56             DAC_ADDR        DB  15 dup(0) 
     00
     )
0075 00                     57             DAC_LEN         DB  0
0076 0000                   58             SI_PTR          DW  0
0078 ??                     59             CHAR                    DB  ?
0079 ??                     60             REG_AL                  DB  ?
007A ??                     61             REG_BH                  DB  ?
007B ??                     62             REG_CL                  DB  ?
007C 00                     63             FLAG            DB  0
007D 00                     64             LONG_PRESS_FLAG DB      0
007E 7231                   65             MY_ID                   DB      'r1'
0080 00                     66             ID_FLAG_@               DB      0
0081 00                     67             ID_FLAG_r               DB      0
0082 4072312F               68             REPLY_MESSAGE   DB      '@r1/'
0086 40302F                 69             FAIL_MESSAGE    DB '@0/'
0089 04                     70             REPLY_COUNT             DB      4
008A 03                     71             FAIL_COUNT              DB      3
008B 00                     72             REPLY_FLAG              DB      0
008C 00                     73             SEND_FLAG       DB  0
008D (13                    74             SEND_BUFFER     DB  13 dup(0)
     00
     )
009A 0000                   75             SEND_BUFFER_LEN DW      0
009C 0000                   76             MAX_INPUT_SIZE  DW      0
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:16:20  12/07/;3  PAGE    3


LOC  OBJ                  LINE     SOURCE

009E 0000                   77             QTY_FLAG                DW      0
00A0 0000                   78             RECEIVE_FLAG    DW      0
00A2 0000                   79             DAC_FLAG                DW      0
00A4 0000                   80             PRICE_FLAG      DW      0
00A6 0100                   81             DECIMAL_FLAG    DW      1
00A8 0000                   82             SCROLL_LEN      DW      0
00AA 0000                   83             DAC_DISABLE     DW  0
00AC 0300                   84             DECIMAL_INDEX   DW  3
00AE 0100                   85             LANG_FLAG       DW  1
00B0 0000                   86             PRICE                   DW      0
00B2 0000                   87             QTY                             DW      0
00B4 0000                   88             TOTAL_PRICE_U   DW      0
00B6 0000                   89             TOTAL_PRICE_L   DW      0
00B8 0000                   90             TOTAL_PRICE_DEC DW      0
00BA (8                     91             TEMP_BCD_ARR    DB  8 dup(0)
     00
     )
00C2 0000                   92             THOUSAND_FLAG   DW  0
00C4 0000                   93             CENT_FLAG               DW      0
00C6 0000                   94             DOLLAR_FLAG             DW      0
00C8 0000                   95             CASH_FLAG               DW      0
00CA (8                     96             CASH_AMT        DB  8 dup(0)
     00
     )
00D2 (8                     97             TEMP_CASH_ARR   DW  8 dup(0)
     0000
     )
00E2 0000                   98             CASH_OK_FLAG    DW  0
00E4 0000                   99             BORROW_POSITION DW  0
00E6 0100                  100             CANCEL_FLAG             DW  1
00E8 0000                  101             TRANSACTION_OVER DW 0
00EA 0100                  102             DATA_ENTER              DW  1
00EC (8                    103             TROLLEY_ARRAY   DB  8 dup(0)
     00
     )
00F4 0000                  104             TROLLEY_INDEX   DW  0
00F6 0000                  105             TROLLEY_FLAG    DW  0
00F8 0000                  106             TROLLEY_ID              DW  0
00FA 0000                  107             TROLLEY_DISABLED DW 0
----                       108     DATA_SEG        ENDS
                           109     
                           110     
----                       111     CODE_SEG        SEGMENT
                           112     
                           113             PUBLIC          START
                           114     
                           115     ASSUME  CS:CODE_SEG, SS:STACK_SEG
                           116     
0000                       117     START:
                           118     ;initialize stack area
0000 B8----         R      119                     MOV     AX,STACK_SEG            
0003 8ED0                  120                     MOV     SS,AX
0005 368B260002            121                     MOV     SP,TOS
                           122                     
                           123     ; Initialize the on-chip pheripherals
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:16:20  12/07/;3  PAGE    4


LOC  OBJ                  LINE     SOURCE

000A 9A0000----     E      124                     CALL    FAR PTR IODEFINE
                           125                     
000F 9A0000----     E      126     call set_timer2
0014 FB                    127                    STI
                           128     
                           129     ; ^^^^^^^^^^^^^^^^^  Start of User Main Routine  ^^^^^^^^^^^^^^^^^^
                           130     
                           131     ;Initialize MMCS
                           132             
0015 BAA6FF                133             MOV DX, MMCS
0018 B80340                134             MOV AX, 4003H
001B EF                    135             OUT DX, AX
                           136     
                           137     ; Initialize MPCS to MAP peripheral to IO address
                           138             
001C BAA8FF                139             MOV DX, MPCS
001F B88320                140             MOV AX, 2083H
0022 EF                    141             OUT DX, AX
                           142        
                           143     ; PCSBA initial, set the parallel port start from 00H
0023 BAA4FF                144             MOV DX, PCSBA
0026 B80300                145             MOV AX, 0003H ; Peripheral starting address 00H no READY, No Waits
0029 EF                    146             OUT DX, AX
                           147     
                           148     ; Initialize LMCS 
002A BAA2FF                149         MOV DX, LMCR
002D B8C401                150         MOV AX, 01C4H  ; Starting address 1FFFH, 8K, No waits, last shoud be 5H for 1 wai
                                   ts      
0030 EF                    151         OUT DX, AX
                           152             
0031 B8----         R      153             MOV AX, DATA_SEG
0034 8ED8                  154             MOV DS, AX
                           155                              
0036 BA8300                156             MOV DX, CWR_8255
0039 B88200                157             MOV AX, 0082h
003C EF                    158             OUT DX, AX
                           159             
003D                       160     NEXT:
003D 9A4400----     R      161             CALL FAR PTR KEYPAD_LOOP
                           162             
0042 EBF9                  163     JMP NEXT
                           164     
0044                       165     KEYPAD_LOOP PROC FAR
0044 50                    166     PUSH AX
0045 53                    167     PUSH BX
0046 51                    168     PUSH CX
0047 52                    169     PUSH DX
                           170             
0048 9A6506----     R      171                             CALL FAR PTR DEBOUNCE           
                           172                             
004D C606790003            173     WAIT_1:         MOV DS:REG_AL, 03H
0052 BB0000                174                         MOV BX, 0000H
0055 BA8200                175                         MOV DX,C_8255
0058 8AC3                  176                         MOV AL,BL
005A EE                    177                         OUT DX,AL
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:16:20  12/07/;3  PAGE    5


LOC  OBJ                  LINE     SOURCE

                           178                        
005B BA8100                179                         MOV DX,B_8255
005E EC                    180                         IN AL,DX
005F 8AD8                  181                         MOV BL,AL  
0061 80E3FC                182                         AND BL,0FCH
0064 80FBFC                183                         CMP BL,0FCH
                           184                      
0067 744F                  185                     JE LONG_PRESS
                           186                             
0069 B3FE                  187                         MOV BL, 0FEH
006B C6067A0004            188                         MOV DS:REG_BH, 04H
                           189                        
0070                       190     NXTROW: 
0070 C0C307                191                     ROL BL,07H
0073 8AEB                  192                             MOV CH,BL
0075 BA8200                193                             MOV DX,C_8255
0078 8AC3                  194                             MOV AL,BL
007A EE                    195                             OUT DX,AL
                           196                             
007B BA8100                197                             MOV DX,B_8255
007E EC                    198                             IN AL,DX
007F 8AD8                  199                             MOV BL,AL
0081 80E3FC                200                             AND BL,0FCH
0084 C6067B0006            201                             MOV DS:REG_CL,06H
0089 C0DB02                202                             RCR BL,02H
008C D0DB                  203     NXTCOL:         RCR BL,01H
008E 7330                  204                             JNC CODEKY
0090 FE0E7900              205                             DEC DS:REG_AL
0094 FE0E7B00              206                             DEC DS:REG_CL
0098 803E7B0003            207                             CMP DS:REG_CL,03H
009D 7413                  208                             JE KEYPAD4
                           209                             
009F 803E7B0000            210                             CMP DS:REG_CL, 0H
00A4 740F                  211                             JE SUBTRACT3
00A6 EBE4                  212                             JMP NXTCOL
                           213                             
00A8 8ADD                  214                             MOV BL,CH
00AA FE0E7A00              215                             DEC DS:REG_BH
00AE 75C0                  216                             JNZ NXTROW
00B0 EB9B                  217                             JMP WAIT_1
                           218                             
00B2 EB7290                219     KEYPAD4:    JMP KEYPAD3
00B5 EB7290                220     SUBTRACT3:  JMP SUBTRACT2
                           221                             
00B8                       222     LONG_PRESS:
00B8 C6067D0000            223                             MOV DS:LONG_PRESS_FLAG, 0
00BD EB6D90                224                             JMP RETURN2
00C0                       225     CODEKY:
00C0 803E79000B            226                         CMP DS:REG_AL, 11
00C5 7505                  227                             JNE bcd_upd
00C7 C606790000            228                             MOV DS:REG_AL, 0
                           229                             
00CC                       230     bcd_upd:
00CC 803E7D0000            231                             CMP DS:LONG_PRESS_FLAG, 0
00D1 7559                  232                             JNE RETURN2
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:16:20  12/07/;3  PAGE    6


LOC  OBJ                  LINE     SOURCE

                           233                             
00D3 803E790011            234                             CMP DS:REG_AL, 17
00D8 7555                  235                             JNE ENTER_CASH
                           236                             
00DA 833EFA0001            237                             CMP DS:TROLLEY_DISABLED, 1
00DF 7442                  238                             JE SKIP_ENTER_DATA1
                           239                             
00E1 833EC80001            240                             CMP DS:CASH_FLAG, 1
00E6 743B                  241                             JE SKIP_ENTER_DATA1
00E8 9AB405----     R      242                             CALL FAR PTR BCD_CLEAR
                           243                             
00ED 833EE80000            244                             CMP DS:TRANSACTION_OVER, 0
00F2 7405                  245                             JE NO_RESET_NEEDED1
                           246                             
00F4 9A7204----     R      247                             CALL FAR PTR CLEAR_TEMP_BCD
                           248                             
00F9                       249             NO_RESET_NEEDED1:
00F9 C706EA000100          250                             MOV DS:DATA_ENTER, 1
00FF C706AC000600          251                             MOV DS:DECIMAL_INDEX, 6
0105 C7069C000600          252                             MOV DS:MAX_INPUT_SIZE, 6
010B C706F8000100          253                             MOV DS:TROLLEY_ID, 1
0111 C706AE000000          254                             MOV DS:LANG_FLAG, 0
0117 C706C8000000          255                             MOV DS:CASH_FLAG, 0
011D C706E8000000          256                             MOV DS:TRANSACTION_OVER, 0
0123                       257             SKIP_ENTER_DATA1:
0123 E9FA01                258                             JMP UPDATE_7SEG2
                           259                             
0126 E9F302                260     KEYPAD3:        JMP KEYPAD_2
                           261                             
0129 E90003                262     SUBTRACT2:   JMP SUBTRACT
                           263     
012C E90B03                264     RETURN2:    JMP RETURN
                           265                             
                           266                             
012F                       267     ENTER_CASH:     
012F 803E790014            268                             CMP DS:REG_AL, 20
0134 7521                  269                             JNE SEND_CASH
0136 833EC80000            270                             CMP DS:CASH_FLAG, 0
013B 7417                  271                             JE SKIP_CASH
013D C706EA000100          272                             MOV DS:DATA_ENTER, 1
0143 9AB405----     R      273                             CALL FAR PTR BCD_CLEAR
0148 C7069C000800          274                             MOV DS:MAX_INPUT_SIZE, 8
014E C706AC000600          275                             MOV DS:DECIMAL_INDEX, 6
0154                       276                     SKIP_CASH:
0154 E9C901                277                             JMP UPDATE_7SEG2
                           278                             
0157                       279     SEND_CASH:
0157 803E790017            280                             CMP DS:REG_AL, 23
015C 751C                  281                             JNE CLEAR_BUTTON
015E 833EC80000            282                             CMP DS:CASH_FLAG, 0
0163 7412                  283                             JE SKIP_SEND_CASH
0165 833E610000            284                             CMP DS:KEYPAD_INDEX, 0
016A 740B                  285                             JE SKIP_SEND_CASH
016C C706EA000000          286                             MOV DS:DATA_ENTER, 0
0172 9A8A06----     R      287                             CALL FAR PTR TAKE_CASH
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:16:20  12/07/;3  PAGE    7


LOC  OBJ                  LINE     SOURCE

0177                       288                     SKIP_SEND_CASH:
0177 E9A601                289                             JMP UPDATE_7SEG2
                           290                             
017A                       291     CLEAR_BUTTON:
017A 803E79000A            292                             CMP DS:REG_AL, 10
017F 7508                  293                             JNE BACKSPACE
0181 9AB405----     R      294                             CALL FAR PTR BCD_CLEAR
0186 E99701                295                             JMP UPDATE_7SEG2
                           296                             
0189 803E79000C            297     BACKSPACE:      CMP DS:REG_AL, 12
018E 7508                  298                             JNE ENTER_DATA
0190 9A4505----     R      299                             CALL FAR PTR BCD_BACKSPACE
0195 E98801                300                             JMP UPDATE_7SEG2
                           301     
0198 803E79000D            302     ENTER_DATA:     CMP DS:REG_AL, 13
019D 753F                  303                             JNE END_TRANS
019F 833EC80001            304                             CMP DS:CASH_FLAG, 1
01A4 7435                  305                             JE SKIP_ENTER_DATA
01A6 9AB405----     R      306                             CALL FAR PTR BCD_CLEAR
                           307                             
01AB 833EE80000            308                             CMP DS:TRANSACTION_OVER, 0
01B0 7405                  309                             JE NO_RESET_NEEDED
                           310                             
01B2 9A7204----     R      311                             CALL FAR PTR CLEAR_TEMP_BCD
                           312                             
01B7                       313             NO_RESET_NEEDED:
01B7 C706EA000100          314                             MOV DS:DATA_ENTER, 1
01BD C706AC000600          315                             MOV DS:DECIMAL_INDEX, 6
01C3 C7069C000800          316                             MOV DS:MAX_INPUT_SIZE, 8
01C9 C706AE000000          317                             MOV DS:LANG_FLAG, 0
01CF C706C8000000          318                             MOV DS:CASH_FLAG, 0
01D5 C706E8000000          319                             MOV DS:TRANSACTION_OVER, 0
01DB                       320             SKIP_ENTER_DATA:
01DB E94201                321                             JMP UPDATE_7SEG2
                           322                             
01DE 803E790010            323     END_TRANS:      CMP DS:REG_AL, 16
01E3 7553                  324                             JNE CANCEL_TRANS
01E5 833EF80001            325                             CMP DS:TROLLEY_ID, 1
01EA 7449                  326                             JE END_TRANS_CONT
01EC 833EC80001            327                             CMP DS:CASH_FLAG, 1
01F1 7442                  328                             JE END_TRANS_CONT
01F3 833EE80000            329                             CMP DS:TRANSACTION_OVER, 0
01F8 7403                  330                             JE TRANSACTION_NOT_OVER
01FA E92301                331                             JMP UPDATE_7SEG2
01FD                       332     TRANSACTION_NOT_OVER:
01FD BB0000                333                             MOV BX, 0
0200 C6878D0024            334                             MOV DS:SEND_BUFFER[BX], '$'
0205 43                    335                             INC BX
0206 C6878D002F            336                             MOV DS:SEND_BUFFER[BX], '/'
020B C7069A000200          337                             MOV DS:SEND_BUFFER_LEN, 2
0211 C6068C0001            338                             MOV DS:SEND_FLAG, 1
0216 C706B8000000          339                             MOV DS:TOTAL_PRICE_DEC, 0
021C C706B6000000          340                             MOV DS:TOTAL_PRICE_L, 0
0222 C706B4000000          341                             MOV DS:TOTAL_PRICE_U, 0
0228 833EE60001            342                             CMP DS:CANCEL_FLAG, 1
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:16:20  12/07/;3  PAGE    8


LOC  OBJ                  LINE     SOURCE

022D 7406                  343                             JE END_TRANS_CONT
022F C706C8000100          344                             MOV DS:CASH_FLAG, 1
0235                       345                     END_TRANS_CONT:
0235 E9E800                346                             JMP UPDATE_7SEG2
                           347                             
0238                       348     CANCEL_TRANS:   
0238 803E79000F            349                             CMP DS:REG_AL, 15
023D 7554                  350                             JNE SCROLL_LEFT
023F 833EC80001            351                             CMP DS:CASH_FLAG, 1
0244 7503                  352                             JNE CONT_CANCEL
0246 E9D700                353                             JMP UPDATE_7SEG2
0249                       354                     CONT_CANCEL:
0249 BB0000                355                             MOV BX, 0
024C C6878D003F            356                             MOV DS:SEND_BUFFER[BX], '?'
0251 43                    357                             INC BX
0252 C6878D002F            358                             MOV DS:SEND_BUFFER[BX], '/'
0257 C7069A000200          359                             MOV DS:SEND_BUFFER_LEN, 2
025D C6068C0001            360                             MOV DS:SEND_FLAG, 1
0262 C706B8000000          361                             MOV DS:TOTAL_PRICE_DEC, 0
0268 C706B6000000          362                             MOV DS:TOTAL_PRICE_L, 0
026E C706B4000000          363                             MOV DS:TOTAL_PRICE_U, 0
0274 C706AC000300          364                             MOV DS:DECIMAL_INDEX, 3
027A 9AB405----     R      365                             CALL FAR PTR BCD_CLEAR
027F C7069C000000          366                             MOV DS:MAX_INPUT_SIZE, 0
                           367                             
0285 9A7204----     R      368                             CALL FAR PTR CLEAR_TEMP_BCD
                           369                             
028A C706E6000100          370                             MOV DS:CANCEL_FLAG, 1
0290 E98D00                371                             JMP UPDATE_7SEG2
                           372                             
0293                       373     SCROLL_LEFT:
0293 803E790015            374                             CMP DS:REG_AL, 21
0298 753D                  375                             JNE SCROLL_RIGHT
029A 833E610006            376                             CMP DS:KEYPAD_INDEX, 6
029F 7E7F                  377                             JLE UPDATE_7SEG2
02A1 833EA80000            378                             CMP DS:SCROLL_LEN, 0
02A6 7478                  379                             JE UPDATE_7SEG2
02A8 FF0EA800              380                             DEC DS:SCROLL_LEN
02AC FF0EAC00              381                             DEC DS:DECIMAL_INDEX
02B0 FF0E6100              382                             DEC DS:KEYPAD_INDEX
02B4 8B1E6100              383                             MOV BX, DS:KEYPAD_INDEX
02B8 8A4751                384                             MOV AL, DS:KEYPAD_INPUT[BX]
02BB A27900                385                             MOV DS:REG_AL, AL
02BE C706AA000100          386                             MOV DS:DAC_DISABLE, 1
02C4 9ADF05----     R      387                             CALL FAR PTR BCD_UPDATE
02C9 C706AA000000          388                             MOV DS:DAC_DISABLE, 0
02CF C606790015            389                             MOV DS:REG_AL, 21
02D4 EB4A90                390                             JMP UPDATE_7SEG2
                           391     
02D7                       392     SCROLL_RIGHT:
02D7 803E790013            393                             CMP DS:REG_AL, 19
02DC 7545                  394                             JNE LANG_TOGGLE
02DE 833E610006            395                             CMP DS:KEYPAD_INDEX, 6
02E3 7E3B                  396                             JLE UPDATE_7SEG2
02E5 A16100                397                             MOV AX, DS:KEYPAD_INDEX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:16:20  12/07/;3  PAGE    9


LOC  OBJ                  LINE     SOURCE

02E8 2D0600                398                             SUB AX, 6
02EB 3906A800              399                             CMP DS:SCROLL_LEN, AX
02EF 742F                  400                             JE UPDATE_7SEG2
02F1 FF06A800              401                             INC DS:SCROLL_LEN
02F5 FF06AC00              402                             INC DS:DECIMAL_INDEX
02F9 FF0E6100              403                             DEC DS:KEYPAD_INDEX
02FD 8B1E6100              404                             MOV BX, DS:KEYPAD_INDEX
0301 8A4751                405                             MOV AL, DS:KEYPAD_INPUT[BX]
0304 A27900                406                             MOV DS:REG_AL, AL
0307 C706AA000100          407                             MOV DS:DAC_DISABLE, 1
030D 9ADF05----     R      408                             CALL FAR PTR BCD_UPDATE
0312 C706AA000000          409                             MOV DS:DAC_DISABLE, 0
0318 C606790013            410                             MOV DS:REG_AL, 19
031D EB0190                411                             JMP UPDATE_7SEG2
                           412                             
0320 E9DE00                413     UPDATE_7SEG2: JMP UPDATE_7SEG
                           414     
0323                       415     LANG_TOGGLE:
0323 803E790012            416                             CMP DS:REG_AL, 18
0328 7537                  417                             JNE QTY_PROMPT
032A 833EAE0001            418                             CMP DS:LANG_FLAG, 1
032F 75EF                  419                             JNE UPDATE_7SEG2
0331 A16400                420                             MOV AX, DS:DAC_BASE
0334 3D0040                421                             CMP AX, 4000H
0337 7406                  422                             JE MANDRIN
0339 B80040                423                             MOV AX, 4000H
033C EB0490                424                             JMP SEND_TOGGLE
033F                       425             MANDRIN:
033F B80065                426                             MOV AX, 6500H
0342                       427             SEND_TOGGLE:
0342 A36400                428                             MOV DS:DAC_BASE, AX
0345 BB0000                429                             MOV BX, 0
0348 C6878D0021            430                             MOV DS:SEND_BUFFER[BX], '!'
034D 43                    431                             INC BX
034E C6878D002F            432                             MOV DS:SEND_BUFFER[BX], '/'
0353 C7069A000200          433                             MOV DS:SEND_BUFFER_LEN, 2
0359 C6068C0001            434                             MOV DS:SEND_FLAG, 1
035E E9A000                435                             JMP UPDATE_7SEG
0361                       436     QTY_PROMPT:
0361 803E790016            437                             CMP DS:REG_AL, 22
0366 7527                  438                             JNE QUANTITY
0368 833EC80001            439                             CMP DS:CASH_FLAG, 1
036D 7420                  440                             JE QUANTITY
036F 833E610008            441                             CMP DS:KEYPAD_INDEX, 8
0374 7519                  442                             JNE  QUANTITY
                           443                             ; CMP DS:MAX_INPUT_SIZE, 8
                           444                             ; JNE QUANTITY
0376 9AFE04----     R      445                             CALL FAR PTR UPDATE_SEND_BUFFER
037B 9AB405----     R      446                             CALL FAR PTR BCD_CLEAR
0380 C7069C000200          447                             MOV DS:MAX_INPUT_SIZE, 2
0386 C7069E000100          448                             MOV DS:QTY_FLAG, 1
038C EB7390                449                             JMP UPDATE_7SEG
                           450                     
038F                       451     QUANTITY:
038F 833E610000            452                             CMP DS:KEYPAD_INDEX, 0
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:16:20  12/07/;3  PAGE   10


LOC  OBJ                  LINE     SOURCE

0394 746B                  453                             JE  UPDATE_7SEG
                           454                             
0396 803E79000E            455                             CMP DS:REG_AL, 14
039B 7564                  456                             JNE UPDATE_7SEG
                           457                             
039D 833EF80001            458                             CMP DS:TROLLEY_ID, 1
03A2 752C                  459                             JNE NORMAL_UPDATE
                           460                             
03A4 833E610006            461                             CMP DS:KEYPAD_INDEX, 6
03A9 7525                  462                             JNE NORMAL_UPDATE
                           463                             
03AB 9A3F04----     R      464                             CALL FAR PTR UPDATE_TROLLEY_ID
                           465                             
03B0 C706F8000000          466                             MOV DS:TROLLEY_ID, 0
03B6 C6068C0001            467                             MOV DS:SEND_FLAG, 1
03BB C706EA000000          468                             MOV DS:DATA_ENTER, 0
03C1 C706E6000000          469                             MOV DS:CANCEL_FLAG, 0
03C7 C706C8000100          470                             MOV DS:CASH_FLAG, 1
                           471                             
03CD EB3290                472                             JMP UPDATE_7SEG
                           473                             
03D0                       474                     NORMAL_UPDATE:  
03D0 833E9E0001            475                             CMP DS:QTY_FLAG, 1
03D5 752A                  476                             JNE UPDATE_7SEG
                           477                             
03D7 C706EA000000          478                             MOV DS:DATA_ENTER, 0
                           479                             
03DD C706E6000000          480                             MOV DS:CANCEL_FLAG, 0
                           481                     
03E3 9AAD04----     R      482                             CALL FAR PTR UPDATE_THE_QUANTITY
                           483                             
03E8 C706FA000100          484                             MOV DS:TROLLEY_DISABLED, 1
03EE C6068C0001            485                             MOV DS:SEND_FLAG, 1
                           486                             
03F3 C7069E000000          487                             MOV DS:QTY_FLAG, 0
03F9 9AB405----     R      488                             CALL FAR PTR BCD_CLEAR
03FE EB0190                489                             JMP UPDATE_7SEG
                           490                             
                           491     
0401                       492     UPDATE_7SEG:
0401 803E790009            493                             CMP DS:REG_AL, 9
0406 7F0C                  494                             JG SET_PRESS_FLAG
                           495                             
0408 833EEA0001            496                             CMP DS:DATA_ENTER, 1
040D 7505                  497                             JNE SET_PRESS_FLAG
                           498                             
040F 9ADF05----     R      499                             CALL FAR PTR BCD_UPDATE
                           500                             
0414                       501     SET_PRESS_FLAG:
0414 C6067D0001            502                             MOV DS:LONG_PRESS_FLAG, 1
0419 EB1F90                503                             JMP RETURN
                           504             
041C                       505     KEYPAD_2: 
041C 800679000F            506                 ADD DS:REG_AL,0FH
0421 E968FC                507                             JMP NXTCOL
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:16:20  12/07/;3  PAGE   11


LOC  OBJ                  LINE     SOURCE

0424 C606790000            508     ZERO_PRINT: MOV DS:REG_AL,00H
0429 E960FC                509                             JMP NXTCOL
042C 802E790006            510     SUBTRACT:   SUB DS:REG_AL,06H
0431 8ADD                  511                             MOV BL,CH
0433 FE0E7A00              512                             DEC DS:REG_BH
0437 E936FC                513                             JMP NXTROW
                           514             
                           515             
043A                       516     RETURN:
043A 5A                    517                             POP DX
043B 59                    518                             POP CX
043C 5B                    519                             POP BX
043D 58                    520                             POP AX
043E CB                    521                             RET
                           522     
                           523     KEYPAD_LOOP ENDP
                           524     
043F                       525     UPDATE_TROLLEY_ID PROC FAR
043F 50                    526     PUSH AX
0440 53                    527     PUSH BX
0441 51                    528     PUSH CX
0442 52                    529     PUSH DX
0443 BB0000                530             MOV BX, 0
0446 C6878D005E            531             MOV DS:SEND_BUFFER[BX], '^'
044B B90600                532             MOV CX, 6
044E                       533             UPDATE_TROLLEY_BUFFER:
044E BB0600                534                     MOV BX, 6
0451 2BD9                  535                     SUB BX, CX
                           536                     
0453 8A4751                537                     MOV AL, DS:KEYPAD_INPUT[BX]
                           538                     
0456 43                    539                     INC BX
0457 0430                  540                     ADD AL, 30H
0459 88878D00              541                     MOV DS:SEND_BUFFER[BX], AL
045D E2EF                  542             LOOP UPDATE_TROLLEY_BUFFER
                           543             
045F BB0700                544             MOV BX, 7
0462 C6878D002F            545             MOV DS:SEND_BUFFER[BX], '/'
                           546             
0467 C7069A000800          547             MOV DS:SEND_BUFFER_LEN, 8
                           548     
046D 5A                    549     POP DX
046E 59                    550     POP CX
046F 5B                    551     POP BX
0470 58                    552     POP AX
0471 CB                    553     RET
                           554     UPDATE_TROLLEY_ID ENDP
                           555     
0472                       556     CLEAR_TEMP_BCD PROC FAR
0472 50                    557     PUSH AX
0473 53                    558     PUSH BX
0474 51                    559     PUSH CX
0475 52                    560     PUSH DX
                           561     
0476 BB0000                562             MOV BX, 0
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:16:20  12/07/;3  PAGE   12


LOC  OBJ                  LINE     SOURCE

0479 C687BA002D            563             MOV DS:TEMP_BCD_ARR[BX], '-'
047E 43                    564             INC BX
047F C687BA002D            565             MOV DS:TEMP_BCD_ARR[BX], '-'
0484 43                    566             INC BX
0485 C687BA002D            567             MOV DS:TEMP_BCD_ARR[BX], '-'
048A 43                    568             INC BX
048B C687BA002D            569             MOV DS:TEMP_BCD_ARR[BX], '-'
0490 43                    570             INC BX
0491 C687BA002D            571             MOV DS:TEMP_BCD_ARR[BX], '-'
0496 43                    572             INC BX
0497 C687BA002D            573             MOV DS:TEMP_BCD_ARR[BX], '-'
049C 43                    574             INC BX
049D C687BA002D            575             MOV DS:TEMP_BCD_ARR[BX], '-'
04A2 43                    576             INC BX
04A3 C687BA002D            577             MOV DS:TEMP_BCD_ARR[BX], '-'
                           578             
04A8 5A                    579     POP DX
04A9 59                    580     POP CX
04AA 5B                    581     POP BX
04AB 58                    582     POP AX
04AC CB                    583     RET
                           584     CLEAR_TEMP_BCD ENDP
                           585     
                           586     
04AD                       587     UPDATE_THE_QUANTITY PROC FAR
04AD 50                    588     PUSH AX
04AE 53                    589     PUSH BX
04AF 51                    590     PUSH CX
04B0 52                    591     PUSH DX
04B1 8B0E6100              592             MOV CX, DS:KEYPAD_INDEX
04B5 BB0000                593             MOV BX, 0
04B8 BA0000                594             MOV DX, 0
04BB                       595             UPD_QTY:
04BB A1B200                596                     MOV AX, DS:QTY
04BE 53                    597                     PUSH BX
04BF BB0A00                598                     MOV BX, 10
04C2 F7E3                  599                     MUL BX
04C4 5B                    600                     POP BX
04C5 8A5751                601                     MOV DL, DS:KEYPAD_INPUT[BX]
04C8 03C2                  602                     ADD AX, DX
04CA A3B200                603                     MOV DS:QTY, AX
04CD 43                    604                     INC BX
04CE E2EB                  605             LOOP UPD_QTY
                           606             
04D0 8B0E6100              607             MOV CX, DS:KEYPAD_INDEX
04D4 8B1E9A00              608             MOV BX, DS:SEND_BUFFER_LEN
                           609             
04D8                       610             UPD_BUFFER:
04D8 53                    611                     PUSH BX
04D9 8B1E6100              612                     MOV BX, DS:KEYPAD_INDEX
04DD 2BD9                  613                     SUB BX, CX
04DF 8A4751                614                     MOV AL, DS:KEYPAD_INPUT[BX]
04E2 5B                    615                     POP BX
04E3 0430                  616                     ADD AL, 30H
04E5 88878D00              617                     MOV DS:SEND_BUFFER[BX], AL
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:16:20  12/07/;3  PAGE   13


LOC  OBJ                  LINE     SOURCE

                           618                     
04E9 43                    619                     INC BX
04EA FF069A00              620                     INC DS:SEND_BUFFER_LEN
04EE E2E8                  621             LOOP UPD_BUFFER
                           622             
04F0 C6878D002F            623             MOV DS:SEND_BUFFER[BX], '/'
04F5 FF069A00              624             INC DS:SEND_BUFFER_LEN
                           625                     
04F9 5A                    626     POP DX
04FA 59                    627     POP CX
04FB 5B                    628     POP BX
04FC 58                    629     POP AX
                           630     
04FD CB                    631     RET
                           632     UPDATE_THE_QUANTITY ENDP
                           633     
04FE                       634     UPDATE_SEND_BUFFER PROC FAR
04FE 50                    635     PUSH AX
04FF 53                    636     PUSH BX
0500 51                    637     PUSH CX
0501 52                    638     PUSH DX
                           639     
0502 8B0E6100              640             MOV CX, DS:KEYPAD_INDEX
0506 83F900                641             CMP CX, 0
0509 7435                  642             JE END_UPD_BUFFER
050B 83C102                643             ADD CX, 2
050E 890E9A00              644             MOV DS:SEND_BUFFER_LEN, CX
0512 BB0000                645             MOV BX, 0
0515                       646             BUFFER_LOOP:
0515 83FB00                647                     CMP BX, 0
0518 7508                  648                     JNE ASTERISK
051A C6878D007E            649                     MOV DS:SEND_BUFFER[BX], '~'
051F EB1C90                650                     JMP END_BUFFER
0522                       651             ASTERISK:
0522 A16100                652                     MOV AX, DS:KEYPAD_INDEX
0525 40                    653                     INC AX
0526 3BD8                  654                     CMP BX, AX
0528 7508                  655                     JNE CONT
052A C6878D002A            656                     MOV DS:SEND_BUFFER[BX], '*'
052F EB0C90                657                     JMP END_BUFFER
0532                       658             CONT:
0532 4B                    659                     DEC BX
0533 8A4751                660                     MOV AL, DS:KEYPAD_INPUT[BX]
0536 0430                  661                     ADD AL, 30H
0538 43                    662                     INC BX
0539 88878D00              663                     MOV DS:SEND_BUFFER[BX], AL
                           664                     
053D                       665             END_BUFFER:
053D 43                    666                     INC BX
053E E2D5                  667             LOOP BUFFER_LOOP
0540                       668     END_UPD_BUFFER:
0540 5A                    669     POP DX
0541 59                    670     POP CX
0542 5B                    671     POP BX
0543 58                    672     POP AX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:16:20  12/07/;3  PAGE   14


LOC  OBJ                  LINE     SOURCE

0544 CB                    673     RET
                           674     UPDATE_SEND_BUFFER ENDP
                           675     
0545                       676     BCD_BACKSPACE PROC FAR
                           677     
0545 50                    678     PUSH AX
0546 53                    679     PUSH BX
0547 51                    680     PUSH CX
0548 52                    681     PUSH DX
                           682     
0549 8A167900              683             MOV DL, DS:REG_AL
054D 833E610000            684             CMP DS:KEYPAD_INDEX, 0
0552 7457                  685             JE RETURN_BACK
                           686             
0554 BB0600                687             MOV BX, 6
0557                       688             BCD_CLEAR_LOOP:
0557 4B                    689                     DEC BX
0558 C647592D              690                     MOV DS:BCD_MESSAGE[BX], '-'
055C 43                    691                     INC BX
055D 4B                    692                     DEC BX
055E 75F7                  693             JNZ BCD_CLEAR_LOOP
                           694             
0560 833E610001            695             CMP DS:KEYPAD_INDEX, 1
0565 7E2C                  696             JLE less_than_two
                           697             
0567 FF0E6100              698             DEC DS:KEYPAD_INDEX
056B FF0E6100              699             DEC DS:KEYPAD_INDEX
056F 8B1E6100              700             MOV BX, DS:KEYPAD_INDEX
0573 8A4751                701             MOV AL, DS:KEYPAD_INPUT[BX]
0576 A27900                702             MOV DS:REG_AL, AL
0579 C706A8000000          703             MOV DS:SCROLL_LEN, 0
057F C706AA000100          704             MOV DS:DAC_DISABLE, 1
0585 9ADF05----     R      705             CALL FAR PTR BCD_UPDATE
058A C706AA000000          706             MOV DS:DAC_DISABLE, 0
0590 EB1990                707             JMP RETURN_BACK
                           708             
0593                       709     less_than_two:
0593 FF0E6100              710             DEC DS:KEYPAD_INDEX
0597 C60679002D            711             MOV DS:REG_AL, '-'
059C C706A8000000          712             MOV DS:SCROLL_LEN, 0
05A2 9ADF05----     R      713             CALL FAR PTR BCD_UPDATE
05A7 FF0E6100              714             DEC DS:KEYPAD_INDEX
                           715             
05AB                       716     RETURN_BACK:
05AB 88167900              717             MOV DS:REG_AL, DL
05AF 5A                    718     POP DX
05B0 59                    719     POP CX
05B1 5B                    720     POP BX
05B2 58                    721     POP AX
                           722     
05B3 CB                    723     RET
                           724     BCD_BACKSPACE ENDP
                           725     
05B4                       726     BCD_CLEAR PROC FAR
05B4 50                    727     PUSH AX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:16:20  12/07/;3  PAGE   15


LOC  OBJ                  LINE     SOURCE

05B5 53                    728     PUSH BX
05B6 51                    729     PUSH CX
05B7 52                    730     PUSH DX
05B8 BB0800                731             MOV BX, 8
05BB                       732             CLEAR_LOOP:
05BB C6475100              733             MOV DS:KEYPAD_INPUT[BX], 0
05BF 4B                    734             DEC BX
05C0 75F9                  735             JNZ CLEAR_LOOP
                           736             
05C2 BB0600                737             MOV BX, 6
05C5                       738             CLEAR_LOOP2:
05C5 4B                    739                     DEC BX
05C6 C647592D              740                     MOV DS:BCD_MESSAGE[BX], '-'
05CA 43                    741                     INC BX
05CB 4B                    742                     DEC BX
05CC 75F7                  743             JNZ CLEAR_LOOP2
                           744     
05CE C70661000000          745             MOV DS:KEYPAD_INDEX, 0
05D4 C706A8000000          746             MOV DS:SCROLL_LEN, 0
05DA 5A                    747     POP DX
05DB 59                    748     POP CX
05DC 5B                    749     POP BX
05DD 58                    750     POP AX
05DE CB                    751     RET
                           752     BCD_CLEAR ENDP
                           753     
05DF                       754     BCD_UPDATE PROC FAR
05DF 50                    755     PUSH AX
05E0 53                    756     PUSH BX
05E1 51                    757     PUSH CX
05E2 52                    758     PUSH DX
05E3 A19C00                759                     MOV AX, DS:MAX_INPUT_SIZE
05E6 39066100              760                     CMP DS:KEYPAD_INDEX, AX
05EA 7D5A                  761                     JGE BCD_RET
                           762                     
05EC 8A0E7900              763                     MOV CL, DS:REG_AL
05F0 80F909                764                     CMP CL, 9
05F3 7F0C                  765                     JG SKIP_PAST
05F5 833EAA0001            766                     CMP DS:DAC_DISABLE, 1
05FA 7405                  767                     JE SKIP_PAST
05FC 9A4B06----     R      768                     CALL FAR PTR DAC_UPDATE
                           769     
0601                       770     SKIP_PAST:              
0601 8A0E7900              771                     MOV CL, DS:REG_AL
                           772     
0605 8B1E6100              773                     MOV BX, DS:KEYPAD_INDEX
                           774                             
0609 884F51                775                     MOV DS:KEYPAD_INPUT[BX], CL
                           776                             
060C FF066100              777                     INC DS:KEYPAD_INDEX
                           778                             
0610 8B1E6100              779                     MOV BX, DS:KEYPAD_INDEX
                           780                     
0614 A1A800                781                     MOV AX, DS:SCROLL_LEN
0617 2BD8                  782                     SUB BX, AX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:16:20  12/07/;3  PAGE   16


LOC  OBJ                  LINE     SOURCE

                           783                     
0619 8B166100              784                     MOV DX, DS:KEYPAD_INDEX
061D 83FA06                785                     CMP DX, 6
0620 7E03                  786                     JLE update_display
0622 BA0600                787                     MOV DX, 6
                           788                     
0625                       789             update_display:
                           790             
0625 B90500                791                     MOV CX, 5
0628 4B                    792                     DEC BX
0629 8A4751                793                     MOV AL, DS:KEYPAD_INPUT[BX]
062C 43                    794                     INC BX
                           795                             
062D 52                    796                     PUSH DX
062E 8B166100              797                     MOV DX, DS:KEYPAD_INDEX
0632 2B16A800              798                     SUB DX, DS:SCROLL_LEN
                           799                     
0636 2BD3                  800                     SUB DX, BX
                           801                             
0638 53                    802                     PUSH BX
                           803                             
0639 2BCA                  804                     SUB CX, DX
063B 8BD9                  805                     MOV BX, CX
063D 884759                806                     MOV DS:BCD_MESSAGE[BX], AL
                           807                             
0640 5B                    808                     POP BX
0641 5A                    809                     POP DX
                           810             
0642 4B                    811                     DEC BX
0643 4A                    812                     DEC DX
0644 75DF                  813             JNZ update_display
                           814     
0646                       815             BCD_RET:
0646 5A                    816                     POP DX
0647 59                    817                     POP CX
0648 5B                    818                     POP BX
0649 58                    819                     POP AX
064A CB                    820     RET
                           821     BCD_UPDATE ENDP
                           822     
064B                       823     DAC_UPDATE PROC FAR
064B 50                    824             PUSH AX
064C 53                    825             PUSH BX
064D 51                    826             PUSH CX
064E 52                    827             PUSH DX
                           828             
064F BB0000                829             MOV BX, 0
0652 8A1E7500              830             MOV BL, DS:DAC_LEN
0656 A07900                831             MOV AL, DS:REG_AL
                           832             
0659 884766                833             MOV DS:DAC_ADDR[BX], AL
                           834             
065C FE067500              835             INC DS:DAC_LEN
                           836     
0660 5A                    837             POP DX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:16:20  12/07/;3  PAGE   17


LOC  OBJ                  LINE     SOURCE

0661 59                    838             POP CX
0662 5B                    839             POP BX
0663 58                    840             POP AX
0664 CB                    841     RET
                           842     DAC_UPDATE ENDP
                           843               
0665                       844     DEBOUNCE PROC FAR
0665 51                    845                       PUSH CX
                           846                       
0666 B94C09                847                       MOV CX, 094CH
0669 90                    848     BACK:     NOP
066A E2FD                  849                       LOOP BACK
066C 59                    850                       POP CX
066D CB                    851                       RET
                           852     DEBOUNCE  ENDP
                           853     
066E                       854     SEND_INPUT PROC FAR
066E 50                    855     PUSH AX
066F 53                    856     PUSH BX
0670 51                    857     PUSH CX
0671 52                    858     PUSH DX
0672 BB0000                859             MOV BX, 0
0675 8B0E9A00              860             MOV CX, DS:SEND_BUFFER_LEN
                           861             
0679                       862             S_BUFF:
0679 8A878D00              863                     MOV AL, DS:SEND_BUFFER[BX]
067D 9A0000----     E      864                     CALL FAR PTR PRINT_CHAR
0682 43                    865                     INC BX
0683 E2F4                  866             LOOP S_BUFF
                           867             
0685                       868     SEND_INPUT_END:
0685 5A                    869     POP DX
0686 59                    870     POP CX
0687 5B                    871     POP BX
0688 58                    872     POP AX
0689 CB                    873     RET
                           874     SEND_INPUT ENDP
                           875     
068A                       876     TAKE_CASH PROC FAR
068A 50                    877     PUSH AX
068B 53                    878     PUSH BX
068C 51                    879     PUSH CX
068D 52                    880     PUSH DX
                           881             
068E B90000                882             MOV CX, 0
0691 B108                  883             MOV CL, 8
0693                       884             CLEAR_CASH_AMT:
0693 8BD9                  885                     MOV BX, CX
0695 4B                    886                     DEC BX
0696 C687CA0000            887                     MOV DS:CASH_AMT[BX], 0
069B E2F6                  888             LOOP CLEAR_CASH_AMT
                           889             
069D 8B0E6100              890             MOV CX, DS:KEYPAD_INDEX
06A1 BA0600                891             MOV DX, 6
                           892             
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:16:20  12/07/;3  PAGE   18


LOC  OBJ                  LINE     SOURCE

06A4                       893             UPDATE_CASH_AMT:
06A4 8BD9                  894                     MOV BX, CX
06A6 4B                    895                     DEC BX
                           896                     
06A7 33C0                  897                     XOR AX, AX
06A9 8A4751                898                     MOV AL, DS:KEYPAD_INPUT[BX]
                           899                     
06AC 8BDA                  900                     MOV BX, DX
06AE 4B                    901                     DEC BX
06AF 8887CA00              902                     MOV DS:CASH_AMT[BX], AL
                           903                     
06B3 4A                    904                     DEC DX
06B4 E2EE                  905             LOOP UPDATE_CASH_AMT
                           906             
06B6 C706E2000100          907             MOV DS:CASH_OK_FLAG, 1
06BC C706E4000700          908             MOV DS:BORROW_POSITION, 7
06C2 B90800                909             MOV CX, 8
06C5                       910             CHECK_CASH:
06C5 BB0800                911                     MOV BX, 8
06C8 2BD9                  912                     SUB BX, CX
06CA B80000                913                     MOV AX, 0
06CD 8A87BA00              914                     MOV AL, DS:TEMP_BCD_ARR[BX]
06D1 8A97CA00              915                     MOV DL, DS:CASH_AMT[BX]
06D5 3AD0                  916                     CMP DL, AL
06D7 741A                  917                     JE NEXT_CASH_DIGIT
                           918                     
06D9 3AD0                  919                     CMP DL, AL
06DB 7C0D                  920                     JL CASH_NOT_OK
                           921                     
06DD C706E2000100          922                     MOV DS:CASH_OK_FLAG, 1
06E3 891EE400              923                     MOV DS:BORROW_POSITION, BX
                           924                     
06E7 EB0C90                925                     JMP CHEK_CASH_DONE
                           926                     
06EA                       927                     CASH_NOT_OK:
06EA C706E2000000          928                     MOV DS:CASH_OK_FLAG, 0
06F0 EB0390                929                     JMP CHEK_CASH_DONE
                           930                     
06F3                       931             NEXT_CASH_DIGIT:
06F3 E2D0                  932             LOOP CHECK_CASH
                           933             
06F5                       934     CHEK_CASH_DONE:
                           935             
06F5 833EE20001            936             CMP DS:CASH_OK_FLAG, 1
06FA 7464                  937             JE CONTINUE_CASH
06FC B90800                938             MOV CX, 8
06FF C70661000000          939             MOV DS:KEYPAD_INDEX, 0
0705 C706AC000300          940             MOV DS:DECIMAL_INDEX, 3
070B                       941             RETAIN_BCD:
070B BB0800                942                     MOV BX, 8
070E 2BD9                  943                     SUB BX, CX
                           944                     
0710 8A87BA00              945                     MOV AL, DS:TEMP_BCD_ARR[BX]
0714 A27900                946                     MOV DS:REG_AL, AL
                           947                     
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:16:20  12/07/;3  PAGE   19


LOC  OBJ                  LINE     SOURCE

0717 C706AA000100          948                     MOV DS:DAC_DISABLE, 1
071D 9ADF05----     R      949                     CALL FAR PTR BCD_UPDATE
0722 C706AA000000          950                     MOV DS:DAC_DISABLE, 0
0728 E2E1                  951             LOOP RETAIN_BCD
072A 813E64000040          952             CMP DS:DAC_BASE, 4000H
0730 7517                  953             JNE MANDARIN_CASH
                           954             
0732 C606790023            955             MOV DS:REG_AL, 35
0737 9A4B06----     R      956             CALL FAR PTR DAC_UPDATE
073C C606790024            957             MOV DS:REG_AL, 36
0741 9A4B06----     R      958             CALL FAR PTR DAC_UPDATE
0746 E9B200                959             JMP CASH_OVER
                           960             
0749                       961     MANDARIN_CASH:
0749 C606790012            962             MOV DS:REG_AL, 18
074E 9A4B06----     R      963             CALL FAR PTR DAC_UPDATE
0753 C606790013            964             MOV DS:REG_AL, 19
0758 9A4B06----     R      965             CALL FAR PTR DAC_UPDATE
075D E99B00                966             JMP CASH_OVER
                           967             
0760                       968     CONTINUE_CASH:
0760 8B1EE400              969             MOV BX, DS:BORROW_POSITION
0764 B90700                970             MOV CX, 7
0767 2BCB                  971             SUB CX, BX
0769 83F900                972             CMP CX, 0
076C 740C                  973             JE BEGIN_SUB
                           974             
076E                       975             ADJUST_PLACES:
076E FE8FCA00              976                     DEC DS:CASH_AMT[BX]
0772 43                    977                     INC BX
0773 8087CA000A            978                     ADD DS:CASH_AMT[BX], 10
0778 E2F4                  979             LOOP ADJUST_PLACES
                           980             
077A                       981     BEGIN_SUB:
077A B90800                982             MOV CX, 8
077D                       983             CALC_CHANGE:
077D BB0800                984                     MOV BX, 8
0780 2BD9                  985                     SUB BX, CX
0782 B80000                986                     MOV AX, 0
0785 8A87CA00              987                     MOV AL, DS:CASH_AMT[BX]
0789 BA0000                988                     MOV DX, 0
078C 8A97BA00              989                     MOV DL, DS:TEMP_BCD_ARR[BX]
0790 2BC2                  990                     SUB AX, DX
0792 8987D200              991                     MOV DS:TEMP_CASH_ARR[BX], AX
0796 E2E5                  992             LOOP CALC_CHANGE
                           993             
0798 B90800                994             MOV CX, 8
079B                       995             FIX_DIGITS:
079B 8BD9                  996             MOV BX, CX
079D 4B                    997             DEC BX
                           998             
079E 8B87D200              999             MOV AX, DS:TEMP_CASH_ARR[BX]
07A2 3C0A                 1000             CMP AL, 10
07A4 7C0A                 1001             JL NEXT_DIGIT_TO_FIX
                          1002             
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:16:20  12/07/;3  PAGE   20


LOC  OBJ                  LINE     SOURCE

07A6 83AFD2000A           1003             SUB DS:TEMP_CASH_ARR[BX], 10
                          1004             
07AB 4B                   1005             DEC BX
07AC FF87D200             1006             INC DS:TEMP_CASH_ARR[BX]
                          1007             
07B0                      1008             NEXT_DIGIT_TO_FIX:
                          1009             
07B0 E2E9                 1010             LOOP FIX_DIGITS
                          1011             
07B2 B90800               1012             MOV CX, 8
07B5 C70661000000         1013             MOV DS:KEYPAD_INDEX, 0
07BB C706AC000300         1014             MOV DS:DECIMAL_INDEX, 3
07C1                      1015             UPDATE_BCD_TO_CASH:
07C1 BB0800               1016                     MOV BX, 8
07C4 2BD9                 1017                     SUB BX, CX
07C6 8B87D200             1018                     MOV AX, DS:TEMP_CASH_ARR[BX]
07CA 8887BA00             1019                     MOV DS:TEMP_BCD_ARR[BX], AL
07CE A27900               1020                     MOV DS:REG_AL, AL
07D1 C706AA000100         1021                     MOV DS:DAC_DISABLE, 1
07D7 9ADF05----     R     1022                     CALL FAR PTR BCD_UPDATE
07DC C706AA000000         1023                     MOV DS:DAC_DISABLE, 0
07E2 E2DD                 1024             LOOP UPDATE_BCD_TO_CASH
                          1025             
07E4 9A0008----     R     1026             CALL FAR PTR CALC_DAC
                          1027             
07E9 C706C8000000         1028             MOV DS:CASH_FLAG, 0
07EF C706E8000100         1029             MOV DS:TRANSACTION_OVER, 1
07F5 C706FA000000         1030             MOV DS:TROLLEY_DISABLED, 0
                          1031             
07FB                      1032     CASH_OVER:
07FB 5A                   1033     POP DX
07FC 59                   1034     POP CX
07FD 5B                   1035     POP BX
07FE 58                   1036     POP AX
                          1037     
07FF CB                   1038     RET
                          1039     TAKE_CASH ENDP
                          1040     
0800                      1041     CALC_DAC PROC FAR
0800 50                   1042     PUSH AX
0801 53                   1043     PUSH BX
0802 51                   1044     PUSH CX
0803 52                   1045     PUSH DX
0804 813E64000040         1046             CMP DS:DAC_BASE, 4000H
080A 7403                 1047             JE ENGLISH_DAC
080C E98E01               1048             JMP MANDARIN_DAC
                          1049             
080F                      1050     ENGLISH_DAC:
080F C706C4000000         1051             MOV DS:CENT_FLAG, 0
0815 C706C2000000         1052             MOV DS:THOUSAND_FLAG, 0
081B C706C6000000         1053             MOV DS:DOLLAR_FLAG,     0
0821 BB0000               1054             MOV BX, 0
0824 8A87BA00             1055             MOV AL, DS:TEMP_BCD_ARR[BX]
0828 A27900               1056             MOV DS:REG_AL, AL
082B 3C00                 1057             CMP AL, 0
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:16:20  12/07/;3  PAGE   21


LOC  OBJ                  LINE     SOURCE

082D 7415                 1058             JE NEXT_PLACE
082F C706C6000100         1059             MOV DS:DOLLAR_FLAG, 1
0835 9A4B06----     R     1060             CALL FAR PTR DAC_UPDATE
083A C60679001C           1061             MOV DS:REG_AL, 28
083F 9A4B06----     R     1062             CALL FAR PTR DAC_UPDATE
                          1063             
0844                      1064     NEXT_PLACE:     
0844 43                   1065             INC BX
0845 8A87BA00             1066             MOV AL, DS:TEMP_BCD_ARR[BX]
0849 3C01                 1067             CMP AL, 1
084B 751E                 1068             JNE NOT_1
084D C706C6000100         1069             MOV DS:DOLLAR_FLAG, 1
0853 43                   1070             INC BX
0854 8A87BA00             1071             MOV AL, DS:TEMP_BCD_ARR[BX]
0858 040A                 1072             ADD AL, 10
085A A27900               1073             MOV DS:REG_AL, AL
085D 9A4B06----     R     1074             CALL FAR PTR DAC_UPDATE
0862 C706C2000100         1075             MOV DS:THOUSAND_FLAG, 1
0868 EB3890               1076             JMP HUNDREDS_PLACE
086B                      1077     NOT_1:
086B 3C00                 1078             CMP AL, 0
086D 7416                 1079             JE NEXT_PLACE_1
086F C706C6000100         1080             MOV DS:DOLLAR_FLAG, 1
0875 C706C2000100         1081             MOV DS:THOUSAND_FLAG, 1
087B 0412                 1082             ADD AL, 18
087D A27900               1083             MOV DS:REG_AL, AL
0880 9A4B06----     R     1084             CALL FAR PTR DAC_UPDATE
0885                      1085     NEXT_PLACE_1:
0885 43                   1086             INC BX
0886 8A87BA00             1087             MOV AL, DS:TEMP_BCD_ARR[BX]
088A 3C00                 1088             CMP AL, 0
088C 7414                 1089             JE HUNDREDS_PLACE
088E C706C6000100         1090             MOV DS:DOLLAR_FLAG, 1
0894 C706C2000100         1091             MOV DS:THOUSAND_FLAG, 1
089A A27900               1092             MOV DS:REG_AL, AL
089D 9A4B06----     R     1093             CALL FAR PTR DAC_UPDATE
                          1094     
08A2                      1095     HUNDREDS_PLACE:
08A2 833EC20000           1096             CMP DS:THOUSAND_FLAG, 0
08A7 7410                 1097             JE NEXT_PLACE_2
08A9 C60679001D           1098             MOV DS:REG_AL, 29
08AE 9A4B06----     R     1099             CALL FAR PTR DAC_UPDATE
08B3 C706C2000000         1100             MOV DS:THOUSAND_FLAG, 0
                          1101             
08B9                      1102     NEXT_PLACE_2:
08B9 43                   1103             INC BX
08BA 8A87BA00             1104             MOV AL, DS:TEMP_BCD_ARR[BX]
08BE 3C00                 1105             CMP AL, 0
08C0 7418                 1106             JE NEXT_PLACE_3
08C2 C706C6000100         1107             MOV DS:DOLLAR_FLAG, 1
08C8 A27900               1108             MOV DS:REG_AL, AL
08CB 9A4B06----     R     1109             CALL FAR PTR DAC_UPDATE
08D0 C60679001C           1110             MOV DS:REG_AL, 28
08D5 9A4B06----     R     1111             CALL FAR PTR DAC_UPDATE
                          1112             
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:16:20  12/07/;3  PAGE   22


LOC  OBJ                  LINE     SOURCE

08DA                      1113     NEXT_PLACE_3:   
08DA 43                   1114             INC BX
08DB 8A87BA00             1115             MOV AL, DS:TEMP_BCD_ARR[BX]
08DF 3C01                 1116             CMP AL, 1
08E1 7518                 1117             JNE NOT_1_2
08E3 C706C6000100         1118             MOV DS:DOLLAR_FLAG, 1
08E9 43                   1119             INC BX
08EA 8A87BA00             1120             MOV AL, DS:TEMP_BCD_ARR[BX]
08EE 040A                 1121             ADD AL, 10
08F0 A27900               1122             MOV DS:REG_AL, AL
08F3 9A4B06----     R     1123             CALL FAR PTR DAC_UPDATE
08F8 EB2C90               1124             JMP DECIMAL_DAC
08FB                      1125     NOT_1_2:
08FB 3C00                 1126             CMP AL, 0
08FD 7410                 1127             JE NEXT_PLACE_4
08FF C706C6000100         1128             MOV DS:DOLLAR_FLAG, 1
0905 0412                 1129             ADD AL, 18
0907 A27900               1130             MOV DS:REG_AL, AL
090A 9A4B06----     R     1131             CALL FAR PTR DAC_UPDATE
090F                      1132     NEXT_PLACE_4:
090F 43                   1133             INC BX
0910 8A87BA00             1134             MOV AL, DS:TEMP_BCD_ARR[BX]
0914 3C00                 1135             CMP AL, 0
0916 740E                 1136             JE DECIMAL_DAC
0918 C706C6000100         1137             MOV DS:DOLLAR_FLAG, 1
091E A27900               1138             MOV DS:REG_AL, AL
0921 9A4B06----     R     1139             CALL FAR PTR DAC_UPDATE
                          1140             
0926                      1141     DECIMAL_DAC:
0926 833EC60000           1142             CMP DS:DOLLAR_FLAG, 0
092B 740A                 1143             JE DECIMAL_DAC_CONT
092D C60679001E           1144             MOV DS:REG_AL, 30
0932 9A4B06----     R     1145             CALL FAR PTR DAC_UPDATE
                          1146             
0937                      1147     DECIMAL_DAC_CONT:
0937 43                   1148             INC BX
0938 8A87BA00             1149             MOV AL, DS:TEMP_BCD_ARR[BX]
093C 3C01                 1150             CMP AL, 1
093E 7518                 1151             JNE NOT_1_3
0940 43                   1152             INC BX
0941 C706C4000100         1153             MOV DS:CENT_FLAG, 1
0947 8A87BA00             1154             MOV AL, DS:TEMP_BCD_ARR[BX]
094B 040A                 1155             ADD AL, 10
094D A27900               1156             MOV DS:REG_AL, AL
0950 9A4B06----     R     1157             CALL FAR PTR DAC_UPDATE
0955 EB2C90               1158             JMP ENGLISH_END
                          1159             
0958                      1160     NOT_1_3:
0958 3C00                 1161             CMP AL, 0
095A 7410                 1162             JE NEXT_PLACE_5
095C C706C4000100         1163             MOV DS:CENT_FLAG, 1
0962 0412                 1164             ADD AL, 18
0964 A27900               1165             MOV DS:REG_AL, AL
0967 9A4B06----     R     1166             CALL FAR PTR DAC_UPDATE
                          1167             
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:16:20  12/07/;3  PAGE   23


LOC  OBJ                  LINE     SOURCE

096C                      1168     NEXT_PLACE_5:
096C 43                   1169             INC BX
096D 8A87BA00             1170             MOV AL, DS:TEMP_BCD_ARR[BX]
0971 3C00                 1171             CMP AL, 0
0973 740E                 1172             JE ENGLISH_END
0975 C706C4000100         1173             MOV DS:CENT_FLAG, 1
097B A27900               1174             MOV DS:REG_AL, AL
097E 9A4B06----     R     1175             CALL FAR PTR DAC_UPDATE
                          1176             
0983                      1177     ENGLISH_END:
0983 833EC40000           1178             CMP DS:CENT_FLAG, 0
0988 7410                 1179             JE ENGLISH_END2
098A C60679001F           1180             MOV DS:REG_AL, 31
098F 9A4B06----     R     1181             CALL FAR PTR DAC_UPDATE
0994 C706C4000000         1182             MOV DS:CENT_FLAG, 0
099A                      1183     ENGLISH_END2:
099A E94F01               1184             JMP CONT_BCD_UPD_1
                          1185             
099D                      1186     MANDARIN_DAC:
099D C706C4000000         1187             MOV DS:CENT_FLAG, 0
09A3 C706C2000000         1188             MOV DS:THOUSAND_FLAG, 0
09A9 C706C6000000         1189             MOV DS:DOLLAR_FLAG,     0
09AF BB0000               1190             MOV BX, 0
09B2 8A87BA00             1191             MOV AL, DS:TEMP_BCD_ARR[BX]
09B6 3C00                 1192             CMP AL, 0
09B8 741E                 1193             JE NEXT_PLACE_6
09BA C706C6000100         1194             MOV DS:DOLLAR_FLAG, 1
09C0 C706C2000100         1195             MOV DS:THOUSAND_FLAG, 1
09C6 A27900               1196             MOV DS:REG_AL, AL
09C9 9A4B06----     R     1197             CALL FAR PTR DAC_UPDATE
09CE C60679000B           1198             MOV DS:REG_AL, 11
09D3 9A4B06----     R     1199             CALL FAR PTR DAC_UPDATE
                          1200             
09D8                      1201     NEXT_PLACE_6:
09D8 43                   1202             INC BX
09D9 8A87BA00             1203             MOV AL, DS:TEMP_BCD_ARR[BX]
09DD 3C00                 1204             CMP AL, 0
09DF 741E                 1205             JE NEXT_PLACE_7
09E1 C706C6000100         1206             MOV DS:DOLLAR_FLAG, 1
09E7 C706C2000100         1207             MOV DS:THOUSAND_FLAG, 1
09ED A27900               1208             MOV DS:REG_AL, AL
09F0 9A4B06----     R     1209             CALL FAR PTR DAC_UPDATE
09F5 C60679000A           1210             MOV DS:REG_AL, 10
09FA 9A4B06----     R     1211             CALL FAR PTR DAC_UPDATE
                          1212             
09FF                      1213     NEXT_PLACE_7:
09FF 43                   1214             INC BX
0A00 8A87BA00             1215             MOV AL, DS:TEMP_BCD_ARR[BX]
0A04 3C00                 1216             CMP AL, 0
0A06 7414                 1217             JE NEXT_PLACE_8
0A08 C706C6000100         1218             MOV DS:DOLLAR_FLAG, 1
0A0E C706C2000100         1219             MOV DS:THOUSAND_FLAG, 1
0A14 A27900               1220             MOV DS:REG_AL, AL
0A17 9A4B06----     R     1221             CALL FAR PTR DAC_UPDATE
                          1222     
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:16:20  12/07/;3  PAGE   24


LOC  OBJ                  LINE     SOURCE

0A1C                      1223     NEXT_PLACE_8:
0A1C 833EC20000           1224             CMP DS:THOUSAND_FLAG, 0
0A21 7410                 1225             JE IGNORE_THOUSAND
0A23 C60679000C           1226             MOV DS:REG_AL, 12
0A28 9A4B06----     R     1227             CALL FAR PTR DAC_UPDATE
0A2D C706C2000000         1228             MOV DS:THOUSAND_FLAG, 0
                          1229             
0A33                      1230     IGNORE_THOUSAND:
0A33 43                   1231             INC BX
0A34 8A87BA00             1232             MOV AL, DS:TEMP_BCD_ARR[BX]
0A38 3C00                 1233             CMP AL, 0
0A3A 7418                 1234             JE NEXT_PLACE_9
0A3C C706C6000100         1235             MOV DS:DOLLAR_FLAG, 1
0A42 A27900               1236             MOV DS:REG_AL, AL
0A45 9A4B06----     R     1237             CALL FAR PTR DAC_UPDATE
0A4A C60679000B           1238             MOV DS:REG_AL, 11
0A4F 9A4B06----     R     1239             CALL FAR PTR DAC_UPDATE
                          1240             
0A54                      1241     NEXT_PLACE_9:
0A54 43                   1242             INC BX
0A55 8A87BA00             1243             MOV AL, DS:TEMP_BCD_ARR[BX]
0A59 3C00                 1244             CMP AL, 0
0A5B 7418                 1245             JE NEXT_PLACE_10
0A5D C706C6000100         1246             MOV DS:DOLLAR_FLAG, 1
0A63 A27900               1247             MOV DS:REG_AL, AL
0A66 9A4B06----     R     1248             CALL FAR PTR DAC_UPDATE
0A6B C60679000A           1249             MOV DS:REG_AL, 10
0A70 9A4B06----     R     1250             CALL FAR PTR DAC_UPDATE
                          1251             
0A75                      1252     NEXT_PLACE_10:
0A75 43                   1253             INC BX
0A76 8A87BA00             1254             MOV AL, DS:TEMP_BCD_ARR[BX]
0A7A 3C00                 1255             CMP AL, 0
0A7C 740E                 1256             JE MANDARIN_DEC
0A7E C706C6000100         1257             MOV DS:DOLLAR_FLAG, 1
0A84 A27900               1258             MOV DS:REG_AL, AL
0A87 9A4B06----     R     1259             CALL FAR PTR DAC_UPDATE
                          1260             
0A8C                      1261     MANDARIN_DEC:
0A8C 833EC60000           1262             CMP DS:DOLLAR_FLAG, 0
0A91 740A                 1263             JE MANDARIN_DAC_CONT
0A93 C60679000D           1264             MOV DS:REG_AL, 13
0A98 9A4B06----     R     1265             CALL FAR PTR DAC_UPDATE
0A9D                      1266     MANDARIN_DAC_CONT:
0A9D 43                   1267             INC BX
0A9E 8A87BA00             1268             MOV AL, DS:TEMP_BCD_ARR[BX]
0AA2 3C00                 1269             CMP AL, 0
0AA4 7418                 1270             JE NEXT_PLACE_11
0AA6 C706C4000100         1271             MOV DS:CENT_FLAG, 1
0AAC A27900               1272             MOV DS:REG_AL, AL
0AAF 9A4B06----     R     1273             CALL FAR PTR DAC_UPDATE
0AB4 C60679000A           1274             MOV DS:REG_AL, 10
0AB9 9A4B06----     R     1275             CALL FAR PTR DAC_UPDATE
                          1276             
0ABE                      1277     NEXT_PLACE_11:
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:16:20  12/07/;3  PAGE   25


LOC  OBJ                  LINE     SOURCE

                          1278     
0ABE 43                   1279             INC BX
0ABF 8A87BA00             1280             MOV AL, DS:TEMP_BCD_ARR[BX]
0AC3 3C00                 1281             CMP AL, 0
0AC5 740E                 1282             JE CONT_BCD_UPD
0AC7 C706C4000100         1283             MOV DS:CENT_FLAG, 1
0ACD A27900               1284             MOV DS:REG_AL, AL
0AD0 9A4B06----     R     1285             CALL FAR PTR DAC_UPDATE
                          1286             
0AD5                      1287     CONT_BCD_UPD:
0AD5 833EC40000           1288             CMP DS:CENT_FLAG, 0
0ADA 7410                 1289             JE CONT_BCD_UPD_1
0ADC C60679000E           1290             MOV DS:REG_AL, 14
0AE1 9A4B06----     R     1291             CALL FAR PTR DAC_UPDATE
0AE6 C706C4000000         1292             MOV DS:CENT_FLAG, 0
                          1293     
0AEC                      1294     CONT_BCD_UPD_1:
                          1295             
0AEC 5A                   1296     POP DX
0AED 59                   1297     POP CX
0AEE 5B                   1298     POP BX
0AEF 58                   1299     POP AX
0AF0 CB                   1300     RET
                          1301     CALC_DAC ENDP
                          1302     
0AF1                      1303     CALC_UPD_PRICE PROC FAR
0AF1 50                   1304     PUSH AX
0AF2 53                   1305     PUSH BX
0AF3 51                   1306     PUSH CX
0AF4 52                   1307     PUSH DX
0AF5 833EB20000           1308             CMP DS:QTY, 0
0AFA 7503                 1309             JNE CHECK_PRICE_ZERO
0AFC E92B01               1310             JMP CALC_END
0AFF                      1311     CHECK_PRICE_ZERO:
0AFF 833EB00000           1312             CMP DS:PRICE, 0
0B04 7503                 1313             JNE START_CALC
0B06 E92101               1314             JMP CALC_END
0B09                      1315     START_CALC:
0B09 BA0000               1316             MOV DX, 0
0B0C A1B000               1317             MOV AX, DS:PRICE
0B0F 8B1EB200             1318             MOV BX, DS:QTY
0B13 F7E3                 1319             MUL BX
                          1320             
0B15 BB6400               1321             MOV BX, 100
0B18 F7F3                 1322             DIV BX
0B1A A3B000               1323             MOV DS:PRICE, AX
0B1D A1B800               1324             MOV AX, DS:TOTAL_PRICE_DEC
0B20 03C2                 1325             ADD AX, DX
0B22 3D6400               1326             CMP AX, 100
0B25 7C07                 1327             JL NON_DECIMAL
0B27 FF06B600             1328             INC DS:TOTAL_PRICE_L
0B2B 2D6400               1329             SUB AX, 100
                          1330             
0B2E                      1331     NON_DECIMAL:    
0B2E A3B800               1332             MOV DS:TOTAL_PRICE_DEC, AX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:16:20  12/07/;3  PAGE   26


LOC  OBJ                  LINE     SOURCE

0B31 A1B600               1333             MOV AX, DS:TOTAL_PRICE_L
0B34 8B1EB000             1334             MOV BX, DS:PRICE
0B38 03C3                 1335             ADD AX, BX
0B3A 7304                 1336             JNC update_normal
0B3C FF06B400             1337             INC DS:TOTAL_PRICE_U
                          1338             
0B40                      1339     update_normal:
0B40 A3B600               1340             MOV DS:TOTAL_PRICE_L, AX
                          1341             
0B43 BA0000               1342             MOV DX, 0
                          1343             ;CMP DS:TOTAL_PRICE_DEC, 9
                          1344             ;JG DECIMAL_CONT
                          1345             ;MOV CX, 10
                          1346             ;MOV AX, DS:TOTAL_PRICE_DEC
                          1347             ;MUL CX
                          1348             ;MOV DS:TOTAL_PRICE_DEC, AX
                          1349     ;DECIMAL_CONT:
0B46 A1B800               1350             MOV AX, DS:TOTAL_PRICE_DEC
0B49 B90A00               1351             MOV CX, 10
0B4C F7F1                 1352             DIV CX
                          1353             
0B4E BB0700               1354             MOV BX, 7
0B51 8897BA00             1355             MOV DS:TEMP_BCD_ARR[BX], DL
0B55 4B                   1356             DEC BX
0B56 8887BA00             1357             MOV DS:TEMP_BCD_ARR[BX], AL
                          1358             
0B5A BB0600               1359             MOV BX, 6
0B5D A1B600               1360             MOV AX, DS:TOTAL_PRICE_L
                          1361             
0B60                      1362             TEMP_UPD_LOOP:
0B60 BA0000               1363                     MOV DX, 0
0B63 B90A00               1364                     MOV CX, 10
0B66 F7F1                 1365                     DIV CX
                          1366                     
0B68 4B                   1367                     DEC BX
0B69 8897BA00             1368                     MOV DS:TEMP_BCD_ARR[BX], DL
0B6D 43                   1369                     INC BX
                          1370                     
0B6E 4B                   1371                     DEC BX
                          1372                     
0B6F 75EF                 1373             JNZ TEMP_UPD_LOOP
                          1374             
0B71 8B0EB400             1375             MOV CX, DS:TOTAL_PRICE_U
0B75 83F900               1376             CMP CX, 0
0B78 7478                 1377             JE upd_dac_part
0B7A                      1378             ADD_EXTRA_PART:
0B7A BB0500               1379                     MOV BX, 5
0B7D 8A87BA00             1380                     MOV AL, DS:TEMP_BCD_ARR[BX]
0B81 0406                 1381                     ADD AL, 6
0B83 3C09                 1382                     CMP AL, 9
0B85 7E08                 1383                     JLE CONT_DIGIT_1
0B87 2C0A                 1384                     SUB AL, 10
0B89 4B                   1385                     DEC BX
0B8A FE87BA00             1386                     INC DS:TEMP_BCD_ARR[BX]
0B8E 43                   1387                     INC BX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:16:20  12/07/;3  PAGE   27


LOC  OBJ                  LINE     SOURCE

0B8F                      1388             CONT_DIGIT_1:
0B8F 8887BA00             1389                     MOV DS:TEMP_BCD_ARR[BX], AL
0B93 4B                   1390                     DEC BX
                          1391                     
0B94 8A87BA00             1392                     MOV AL, DS:TEMP_BCD_ARR[BX]
0B98 0403                 1393                     ADD AL, 3
0B9A 3C09                 1394                     CMP AL, 9
0B9C 7E08                 1395                     JLE CONT_DIGIT_2
0B9E 2C0A                 1396                     SUB AL, 10
0BA0 4B                   1397                     DEC BX
0BA1 FE87BA00             1398                     INC DS:TEMP_BCD_ARR[BX]
0BA5 43                   1399                     INC BX
0BA6                      1400             CONT_DIGIT_2:
0BA6 8887BA00             1401                     MOV DS:TEMP_BCD_ARR[BX], AL
0BAA 4B                   1402                     DEC BX
                          1403                     
0BAB 8A87BA00             1404                     MOV AL, DS:TEMP_BCD_ARR[BX]
0BAF 0405                 1405                     ADD AL, 5
0BB1 3C09                 1406                     CMP AL, 9
0BB3 7E08                 1407                     JLE CONT_DIGIT_3
0BB5 2C0A                 1408                     SUB AL, 10
0BB7 4B                   1409                     DEC BX
0BB8 FE87BA00             1410                     INC DS:TEMP_BCD_ARR[BX]
0BBC 43                   1411                     INC BX
0BBD                      1412             CONT_DIGIT_3:
0BBD 8887BA00             1413                     MOV DS:TEMP_BCD_ARR[BX], AL
0BC1 4B                   1414                     DEC BX
                          1415                     
                          1416                     
0BC2 8A87BA00             1417                     MOV AL, DS:TEMP_BCD_ARR[BX]
0BC6 0405                 1418                     ADD AL, 5
0BC8 3C09                 1419                     CMP AL, 9
0BCA 7E08                 1420                     JLE CONT_DIGIT_4
0BCC 2C0A                 1421                     SUB AL, 10
0BCE 4B                   1422                     DEC BX
0BCF FE87BA00             1423                     INC DS:TEMP_BCD_ARR[BX]
0BD3 43                   1424                     INC BX
0BD4                      1425             CONT_DIGIT_4:
0BD4 8887BA00             1426                     MOV DS:TEMP_BCD_ARR[BX], AL
0BD8 4B                   1427                     DEC BX
                          1428                     
0BD9 8A87BA00             1429                     MOV AL, DS:TEMP_BCD_ARR[BX]
0BDD 0406                 1430                     ADD AL, 6
0BDF 3C09                 1431                     CMP AL, 9
0BE1 7E08                 1432                     JLE CONT_DIGIT_5
0BE3 2C0A                 1433                     SUB AL, 10
0BE5 4B                   1434                     DEC BX
0BE6 FE87BA00             1435                     INC DS:TEMP_BCD_ARR[BX]
0BEA 43                   1436                     INC BX
0BEB                      1437             CONT_DIGIT_5:
0BEB 8887BA00             1438                     MOV DS:TEMP_BCD_ARR[BX], AL
0BEF 4B                   1439                     DEC BX
                          1440                     
0BF0 E288                 1441             LOOP ADD_EXTRA_PART
                          1442             
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:16:20  12/07/;3  PAGE   28


LOC  OBJ                  LINE     SOURCE

0BF2                      1443     upd_dac_part:
0BF2 9A0008----     R     1444             CALL FAR PTR CALC_DAC
                          1445     
0BF7 9AB405----     R     1446             CALL FAR PTR BCD_CLEAR
0BFC C70661000000         1447             MOV DS:KEYPAD_INDEX, 0
0C02 C706AC000300         1448             MOV DS:DECIMAL_INDEX, 3
0C08 B90800               1449             MOV CX, 8
0C0B                      1450             UPD_BCD:
0C0B BB0800               1451                     MOV BX, 8
0C0E 2BD9                 1452                     SUB BX, CX
0C10 8A87BA00             1453                     MOV AL, DS:TEMP_BCD_ARR[BX]
0C14 A27900               1454                     MOV DS:REG_AL, AL
0C17 C706AA000100         1455                     MOV DS:DAC_DISABLE, 1
0C1D 9ADF05----     R     1456                     CALL FAR PTR BCD_UPDATE
0C22 C706AA000000         1457                     MOV DS:DAC_DISABLE, 0
0C28 E2E1                 1458             LOOP UPD_BCD
                          1459             
0C2A                      1460     CALC_END:
0C2A 833EB00000           1461             CMP DS:PRICE, 0
0C2F 7403                 1462             JE RETAIN_BCD_VALUE
0C31 EB2F90               1463             JMP END_CALC_BCD_DAC
                          1464             
0C34                      1465     RETAIN_BCD_VALUE:       
0C34 C70661000000         1466             MOV DS:KEYPAD_INDEX, 0
0C3A C706AC000300         1467             MOV DS:DECIMAL_INDEX, 3
0C40 B90800               1468             MOV CX, 8
0C43                      1469             UPD_BCD1:
0C43 BB0800               1470                     MOV BX, 8
0C46 2BD9                 1471                     SUB BX, CX
0C48 8A87BA00             1472                     MOV AL, DS:TEMP_BCD_ARR[BX]
0C4C A27900               1473                     MOV DS:REG_AL, AL
0C4F C706AA000100         1474                     MOV DS:DAC_DISABLE, 1
0C55 9ADF05----     R     1475                     CALL FAR PTR BCD_UPDATE
0C5A C706AA000000         1476                     MOV DS:DAC_DISABLE, 0
0C60 E2E1                 1477             LOOP UPD_BCD1
                          1478     
0C62                      1479     END_CALC_BCD_DAC:
0C62 C706B0000000         1480             MOV DS:PRICE, 0
0C68 C706B2000000         1481             MOV DS:QTY, 0
0C6E 5A                   1482     POP DX
0C6F 59                   1483     POP CX
0C70 5B                   1484     POP BX
0C71 58                   1485     POP AX
0C72 CB                   1486     RET
                          1487     CALC_UPD_PRICE ENDP
                          1488     
0C73                      1489     UPDATE_TROLLEY PROC FAR
0C73 50                   1490     PUSH AX
0C74 53                   1491     PUSH BX
0C75 51                   1492     PUSH CX
0C76 52                   1493     PUSH DX
0C77 B90800               1494             MOV CX, 8
0C7A                      1495             CLEAR_TEMP_BCD_TROLLEY:
0C7A 8BD9                 1496                     MOV BX, CX
0C7C 4B                   1497                     DEC BX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:16:20  12/07/;3  PAGE   29


LOC  OBJ                  LINE     SOURCE

0C7D C687BA0000           1498                     MOV DS:TEMP_BCD_ARR[BX], 0
0C82 E2F6                 1499             LOOP CLEAR_TEMP_BCD_TROLLEY
                          1500             
0C84 8B0EF400             1501             MOV CX, DS:TROLLEY_INDEX
0C88 BA0800               1502             MOV DX, 8
                          1503             
0C8B                      1504             UPD_TROLLEY_PRICE:
0C8B 8BD9                 1505                     MOV BX, CX
0C8D 4B                   1506                     DEC BX
                          1507                     
0C8E 8A87EC00             1508                     MOV AL, DS:TROLLEY_ARRAY[BX]
                          1509                     
0C92 8BDA                 1510                     MOV BX, DX
0C94 4B                   1511                     DEC BX
                          1512                     
0C95 8887BA00             1513                     MOV DS:TEMP_BCD_ARR[BX], AL
                          1514                     
0C99 4A                   1515                     DEC DX
0C9A E2EF                 1516             LOOP UPD_TROLLEY_PRICE
                          1517             
0C9C B90800               1518             MOV CX, 8
0C9F C70661000000         1519             MOV DS:KEYPAD_INDEX, 0
0CA5                      1520             UPDATE_TROLLEY_PRICE_DISPLAY:
0CA5 BB0800               1521                     MOV BX, 8
0CA8 2BD9                 1522                     SUB BX, CX
0CAA 8A87BA00             1523                     MOV AL, DS:TEMP_BCD_ARR[BX]
0CAE A27900               1524                     MOV DS:REG_AL, AL
0CB1 C706AA000100         1525                     MOV DS:DAC_DISABLE, 1
0CB7 9ADF05----     R     1526                     CALL FAR PTR BCD_UPDATE
0CBC C706AA000000         1527                     MOV DS:DAC_DISABLE, 0
0CC2 E2E1                 1528             LOOP UPDATE_TROLLEY_PRICE_DISPLAY
                          1529             
0CC4 9A0008----     R     1530             CALL FAR PTR CALC_DAC
                          1531     
0CC9 5A                   1532     POP DX
0CCA 59                   1533     POP CX
0CCB 5B                   1534     POP BX
0CCC 5A                   1535     POP DX
0CCD CB                   1536     RET
                          1537     UPDATE_TROLLEY ENDP
                          1538     ; ^^^^^^^^^^^^^^^ End of User main routine ^^^^^^^^^^^^^^^^^^^^^^^^^
0CCE                      1539     SERIAL_REC_ACTION       PROC    FAR
0CCE 51                   1540                     PUSH    CX
0CCF 53                   1541                     PUSH    BX
0CD0 1E                   1542                     PUSH    DS
                          1543                     
0CD1 BB----         R     1544                     MOV     BX,DATA_SEG             ;initialize data segment register
0CD4 8EDB                 1545                     MOV     DS,BX
                          1546                     
0CD6 803E8B0001           1547                     CMP DS:REPLY_FLAG, 1
0CDB 7557                 1548                     JNE next_id1
                          1549                     
0CDD 803E8C0001           1550                     CMP DS:SEND_FLAG, 1
0CE2 7453                 1551                     JE send_input_across1
                          1552                     
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:16:20  12/07/;3  PAGE   30


LOC  OBJ                  LINE     SOURCE

0CE4 833EA00001           1553                     CMP DS:RECEIVE_FLAG, 1
0CE9 754F                 1554                     JNE terminate_session3
                          1555                     
0CEB 3C2F                 1556                     CMP AL, '/'
0CED 752C                 1557                     JNE CHECK_SEND
0CEF C706A4000000         1558                     MOV DS:PRICE_FLAG, 0
0CF5 C706A0000000         1559                     MOV DS:RECEIVE_FLAG, 0
0CFB C706AE000100         1560                     MOV DS:LANG_FLAG, 1
0D01 833EF60000           1561                     CMP DS:TROLLEY_FLAG, 0
0D06 7405                 1562                     JE TROLLEY_UPD_SKIP
0D08 9A730C----     R     1563                     CALL FAR PTR UPDATE_TROLLEY
0D0D                      1564             TROLLEY_UPD_SKIP:
0D0D C706F6000000         1565                     MOV DS:TROLLEY_FLAG, 0
0D13 9AF10A----     R     1566                     CALL FAR PTR CALC_UPD_PRICE
0D18 EB2090               1567                     JMP terminate_session3
                          1568             
0D1B                      1569             CHECK_SEND:
0D1B 3C26                 1570                     CMP AL, '&'
0D1D 751E                 1571                     JNE TROLLEY_PRICE
0D1F C706A4000100         1572                     MOV DS:PRICE_FLAG, 1
0D25 C70661000000         1573                     MOV DS:KEYPAD_INDEX, 0
0D2B C7069C000800         1574                     MOV DS:MAX_INPUT_SIZE, 8
0D31 E9AF00               1575                     JMP id_skip2
                          1576             
                          1577             
0D34                      1578             next_id1:
0D34 E9AF00               1579                     JMP next_id
                          1580                     
0D37                      1581             send_input_across1:
0D37 E98D00               1582                     JMP send_input_across
                          1583             
0D3A                      1584             terminate_session3:
0D3A E9A300               1585                     JMP terminate_session2
                          1586             
                          1587                     
0D3D                      1588             TROLLEY_PRICE:
0D3D 3C2B                 1589                     CMP AL, '+'
0D3F 7515                 1590                     JNE receive_price
0D41 C7069C000800         1591                     MOV DS:MAX_INPUT_SIZE, 8
0D47 C706F6000100         1592                     MOV DS:TROLLEY_FLAG, 1
0D4D C706F4000000         1593                     MOV DS:TROLLEY_INDEX, 0
0D53 E98D00               1594                     JMP id_skip2
                          1595                     
0D56                      1596             receive_price:
0D56 3C23                 1597                     CMP AL, '#'
0D58 750F                 1598                     JNE check_price
0D5A C706A2000100         1599                     MOV DS:DAC_FLAG, 1
0D60 C706A4000000         1600                     MOV DS:PRICE_FLAG, 0
0D66 EB7B90               1601                     JMP id_skip2
                          1602             
0D69                      1603             check_price:    
                          1604             
0D69 833EA40001           1605                     CMP DS:PRICE_FLAG, 1
0D6E 7440                 1606                     JE update_price_value
                          1607                     
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:16:20  12/07/;3  PAGE   31


LOC  OBJ                  LINE     SOURCE

0D70 833EF60001           1608                     CMP DS:TROLLEY_FLAG, 1
0D75 7428                 1609                     JE update_trolley_arr
                          1610                     
0D77 833EA20001           1611                     CMP DS:DAC_FLAG, 1
0D7C 7403                 1612                     JE dac_change
0D7E EB6390               1613                     JMP id_skip2
                          1614     
0D81                      1615             dac_change:
0D81 8A1E7900             1616                     MOV BL, DS:REG_AL
0D85 2C30                 1617                     SUB AL, 30H
0D87 A27900               1618                     MOV DS:REG_AL, AL
0D8A 9A4B06----     R     1619                     CALL FAR PTR DAC_UPDATE
0D8F 881E7900             1620                     MOV DS:REG_AL, BL
0D93 C706A2000000         1621                     MOV DS:DAC_FLAG, 0
0D99 EB4890               1622                     JMP id_skip2
                          1623             
                          1624     
0D9C EB4590               1625             id_skip3: JMP id_skip2
                          1626             
0D9F                      1627             update_trolley_arr:
0D9F 8B1EF400             1628                     MOV BX, DS:TROLLEY_INDEX
0DA3 2C30                 1629                     SUB AL, 30H
0DA5 8887EC00             1630                     MOV DS:TROLLEY_ARRAY[BX], AL
0DA9 FF06F400             1631                     INC DS:TROLLEY_INDEX
0DAD EB3490               1632                     JMP id_skip2
                          1633                     
0DB0                      1634             update_price_value:
0DB0 2C30                 1635                     SUB AL, 30H
0DB2 B90000               1636                     MOV CX, 0
0DB5 8AC8                 1637                     MOV CL, AL
0DB7 A1B000               1638                     MOV AX, DS:PRICE
0DBA BB0A00               1639                     MOV BX, 10
0DBD F7E3                 1640                     MUL BX
                          1641                     
0DBF 03C1                 1642                     ADD AX, CX
0DC1 A3B000               1643                     MOV DS:PRICE, AX
0DC4 EB1D90               1644                     JMP id_skip2
                          1645                     
0DC7                      1646             send_input_across:
0DC7 9A6E06----     R     1647                     CALL FAR PTR SEND_INPUT
                          1648                     
0DCC C7069A000000         1649                     MOV DS:SEND_BUFFER_LEN, 0
                          1650                     
0DD2 C6068C0000           1651                     MOV DS:SEND_FLAG, 0
                          1652                     
0DD7 C706A0000100         1653                     MOV DS:RECEIVE_FLAG, 1
                          1654                     
0DDD EB0490               1655                     JMP id_skip2
                          1656                     
0DE0 EB3E90               1657                     terminate_session2: JMP terminate_session
0DE3 EB6790               1658                     id_skip2: JMP id_skip
                          1659                     
0DE6                      1660             next_id:
                          1661                     
0DE6 803E810001           1662                     CMP DS:ID_FLAG_r, 1
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:16:20  12/07/;3  PAGE   32


LOC  OBJ                  LINE     SOURCE

0DEB 7513                 1663                     JNE id_flag_label
0DED 38067F00             1664                     CMP DS:MY_ID[1], AL
0DF1 7559                 1665                     JNE id_skip
                          1666                     ;start writing to pc
0DF3 C6068B0001           1667                     MOV DS:REPLY_FLAG, 1
0DF8 C606810000           1668                     MOV DS:ID_FLAG_r, 0
0DFD EB4D90               1669                     JMP id_skip
                          1670             
0E00                      1671             id_flag_label:
                          1672             
0E00 803E800001           1673                     CMP DS:ID_FLAG_@, 1
0E05 7539                 1674                     JNE protocol_rec
0E07 3C72                 1675                     CMP AL,'r'
0E09 750D                 1676                     JNE id_not_r
0E0B C606810001           1677                     MOV DS:ID_FLAG_r,1
0E10 C606800000           1678                     MOV DS:ID_FLAG_@, 0
0E15 EB3590               1679                     JMP S_RET
0E18                      1680             id_not_r:
0E18 C606800000           1681                     MOV DS:ID_FLAG_@, 0
0E1D EB2D90               1682                     JMP id_skip
                          1683             
0E20                      1684             terminate_session:
0E20 C606810000           1685                     MOV DS:ID_FLAG_r, 0
0E25 33DB                 1686                     XOR BX,BX
0E27                      1687             start_send1:
0E27 50                   1688                     PUSH AX
0E28 33C0                 1689                     XOR AX,AX
0E2A 8A878600             1690                     MOV AL, DS:FAIL_MESSAGE[BX]
0E2E 9A0000----     E     1691                     CALL FAR PTR PRINT_CHAR
0E33 58                   1692                     POP AX
0E34 C6068B0000           1693                     MOV DS:REPLY_FLAG, 0
0E39 43                   1694                     INC BX
0E3A 3A1E8A00             1695                     CMP BL, DS:FAIL_COUNT
0E3E 75E7                 1696                     JNE start_send1
                          1697                     
0E40                      1698             protocol_rec:
0E40 3C40                 1699                     CMP AL,'@'
0E42 7508                 1700                     JNE id_skip
0E44 C606800001           1701                     MOV DS:ID_FLAG_@,1
0E49 EB0190               1702                     JMP S_RET
                          1703                     
0E4C                      1704             id_skip:
                          1705                     ; JMP S_RET
                          1706             
                          1707                     ; CMP   AL,'<'
                          1708                     ; JNE   S_FAST
                          1709     
                          1710                     ; INC   DS:T_COUNT_SET
                          1711                     ; INC   DS:T_COUNT_SET
                          1712     
                          1713                     ; JMP   S_NEXT0
                          1714     ; S_FAST:
                          1715                     ; CMP   AL,'>'
                          1716                     ; JNE   S_RET
                          1717     
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:16:20  12/07/;3  PAGE   33


LOC  OBJ                  LINE     SOURCE

                          1718                     ; DEC   DS:T_COUNT_SET
                          1719                     ; DEC   DS:T_COUNT_SET
                          1720     
                          1721     ; S_NEXT0:
                          1722                     ; MOV   CX,22                   ;initialize counter for message
                          1723                     ; MOV   BX,0
                          1724     
                          1725     ; S_NEXT1:      MOV     AL,DS:REC_MESS[BX]      ;print message
                          1726                     ; call  FAR ptr print_char
                          1727                     ; INC   BX
                          1728                     ; LOOP  S_NEXT1
                          1729     
                          1730                     ; MOV   AL,DS:T_COUNT_SET       ;print current period of timer0
                          1731                     ; CALL  FAR PTR PRINT_2HEX
0E4C                      1732     S_RET:
0E4C 1F                   1733                     POP     DS
0E4D 5B                   1734                     POP     BX
0E4E 59                   1735                     POP     CX
0E4F CB                   1736                     RET
                          1737     SERIAL_REC_ACTION       ENDP
                          1738     
0E50                      1739     TIMER2_ACTION   PROC    FAR
0E50 50                   1740                     PUSH    AX
0E51 1E                   1741                     PUSH    DS
0E52 53                   1742                     PUSH    BX
0E53 51                   1743                     PUSH    CX
0E54 52                   1744                     PUSH    DX
                          1745                     
                          1746                     
0E55 B8----         R     1747                     MOV     AX,DATA_SEG
0E58 8ED8                 1748                     MOV     DS,AX
                          1749             
0E5A FE0E1600             1750                     DEC     DS:T_COUNT
0E5E 754A                 1751                     JNZ     T_NEXT1
0E60 A01700               1752                     MOV     AL,DS:T_COUNT_SET
0E63 A21600               1753                     MOV     DS:T_COUNT,AL
                          1754     
0E66                      1755     T_NEXT0:
                          1756                     
0E66 33DB                 1757                     XOR BX, BX
0E68 8A1E6000             1758                     MOV BL, DS:BCD_INDEX
0E6C 8A4759               1759                     MOV AL, DS:BCD_MESSAGE[BX]
                          1760                     
0E6F 3B1EAC00             1761                     CMP BX, DS:DECIMAL_INDEX
0E73 7506                 1762                     JNE CALL_FUNC
0E75 C706A6000100         1763                     MOV DS:DECIMAL_FLAG, 1
0E7B                      1764     CALL_FUNC:
0E7B 9A1B0F----     R     1765                     CALL FAR PTR BCD_TO_7SEG
0E80 C706A6000000         1766                     MOV DS:DECIMAL_FLAG, 0
                          1767     
0E86 BA0002               1768                     MOV DX, 200H
0E89 EE                   1769                     OUT DX, AL
                          1770                     
0E8A A05F00               1771                     MOV AL, DS:ENABLE_BYTE
0E8D BA8001               1772                     MOV DX, 180H
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:16:20  12/07/;3  PAGE   34


LOC  OBJ                  LINE     SOURCE

0E90 EE                   1773                     OUT DX, AL
                          1774                     
                          1775     
0E91 FE066000             1776                     INC DS:BCD_INDEX
0E95 D0065F00             1777                     ROL DS:ENABLE_BYTE, 1
0E99 803E5F00BF           1778                     CMP DS:ENABLE_BYTE, 10111111b
0E9E 750A                 1779                     JNE T_NEXT1
0EA0 C6065F00FE           1780                     MOV DS:ENABLE_BYTE, 11111110b 
0EA5 C606600000           1781                     MOV DS:BCD_INDEX, 0
                          1782     
                          1783                     
0EAA                      1784     T_NEXT1:
0EAA 803E750000           1785                     CMP DS:DAC_LEN, 0
0EAF 743C                 1786                     JE ISR_END
                          1787                     
                          1788                     
0EB1 8B367600             1789                     MOV SI, DS:SI_PTR
                          1790                             
0EB5 BB0000               1791                     MOV BX, 0
0EB8 33C0                 1792                     XOR AX, AX
0EBA 8A4766               1793                     MOV AL, DS:DAC_ADDR[BX]
                          1794                     
0EBD BB0001               1795                     MOV BX, 100H
0EC0 F7E3                 1796                     MUL BX
                          1797                     
0EC2 8B166400             1798                     MOV DX, DS:DAC_BASE
0EC6 03D0                 1799                     ADD DX, AX
                          1800                     
0EC8 1E                   1801                     PUSH DS
0EC9 8EDA                 1802                     MOV DS, DX
                          1803                     
0ECB 8B04                 1804                     MOV AX, [SI]
                          1805                     
0ECD BA1001               1806                     MOV DX, 110H
0ED0 EE                   1807                     OUT DX, AL
                          1808                     
0ED1 1F                   1809                     POP DS
                          1810                     
0ED2 FF067600             1811                     INC DS:SI_PTR
0ED6 813E76000010         1812                     CMP DS:SI_PTR, 1000H
0EDC 750F                 1813                     JNE ISR_END
                          1814                     
0EDE C70676000000         1815                     MOV DS:SI_PTR, 0
0EE4 FE0E7500             1816                     DEC DS:DAC_LEN
0EE8 9AF30E----     R     1817                     CALL FAR PTR DAC_SHIFT
                          1818                     
0EED                      1819     ISR_END:
                          1820                     
0EED 5A                   1821                     POP DX
0EEE 59                   1822                     POP     CX
0EEF 5B                   1823                     POP     BX
0EF0 1F                   1824                     POP     DS
0EF1 58                   1825                     POP AX
0EF2 CB                   1826                     RET
                          1827     TIMER2_ACTION   ENDP
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:16:20  12/07/;3  PAGE   35


LOC  OBJ                  LINE     SOURCE

                          1828     
                          1829     
0EF3                      1830     DAC_SHIFT PROC FAR
0EF3 50                   1831             PUSH AX
0EF4 53                   1832             PUSH BX
0EF5 51                   1833             PUSH CX
0EF6 52                   1834             PUSH DX
                          1835     
0EF7 33C9                 1836             XOR CX, CX
0EF9 8A0E7500             1837             MOV CL, DS:DAC_LEN
0EFD 80F900               1838             CMP CL, 0
0F00 7414                 1839             JE END_SHIFT
                          1840     
0F02                      1841             SHIFT_LOOP:
                          1842     
0F02 33DB                 1843             XOR BX, BX
0F04 8A1E7500             1844             MOV BL, DS:DAC_LEN
0F08 2BD9                 1845             SUB BX, CX
0F0A 43                   1846             INC BX
                          1847             
0F0B 33D2                 1848             XOR DX, DX
0F0D 8A5766               1849             MOV DL, DS:DAC_ADDR[BX]
0F10 4B                   1850             DEC BX
0F11 885766               1851             MOV DS:DAC_ADDR[BX], DL
                          1852     
0F14 E2EC                 1853             LOOP SHIFT_LOOP
                          1854             
0F16                      1855             END_SHIFT:
0F16 5A                   1856             POP DX
0F17 59                   1857             POP CX
0F18 5B                   1858             POP BX
0F19 58                   1859             POP AX
0F1A CB                   1860             RET
                          1861     DAC_SHIFT ENDP
                          1862     
0F1B                      1863     BCD_TO_7SEG PROC FAR
                          1864     
0F1B 53                   1865             PUSH BX
0F1C 51                   1866             PUSH CX
0F1D 52                   1867             PUSH DX
                          1868             
0F1E 3C00                 1869             CMP AL, 0
0F20 7511                 1870             JNE one
0F22 833EA60001           1871             CMP DS:DECIMAL_FLAG, 1
0F27 7405                 1872             JE decimal0
0F29 B03F                 1873             MOV AL, 00111111b
0F2B E9D700               1874             JMP endfunc
0F2E                      1875     decimal0:
0F2E B0BF                 1876             MOV AL, 10111111b
0F30 E9D200               1877             JMP endfunc
                          1878             
0F33                      1879             one:
0F33 3C01                 1880             CMP AL, 1
0F35 7511                 1881             JNE two
0F37 833EA60001           1882             CMP DS:DECIMAL_FLAG, 1
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:16:20  12/07/;3  PAGE   36


LOC  OBJ                  LINE     SOURCE

0F3C 7405                 1883             JE decimal1
0F3E B006                 1884             MOV AL, 00000110b
0F40 E9C200               1885             JMP endfunc
0F43                      1886     decimal1:
0F43 B086                 1887             MOV AL, 10000110b
0F45 E9BD00               1888             JMP endfunc
                          1889             
0F48                      1890             two:
0F48 3C02                 1891             CMP AL,2
0F4A 7511                 1892             JNE three
0F4C 833EA60001           1893             CMP DS:DECIMAL_FLAG, 1
0F51 7405                 1894             JE decimal2
0F53 B05B                 1895             MOV AL, 01011011b
0F55 E9AD00               1896             JMP endfunc
0F58                      1897     decimal2:
0F58 B0DB                 1898             MOV AL, 11011011b
0F5A E9A800               1899             JMP endfunc
                          1900             
0F5D                      1901             three:
0F5D 3C03                 1902             CMP AL,3
0F5F 7511                 1903             JNE four
0F61 833EA60001           1904             CMP DS:DECIMAL_FLAG, 1
0F66 7405                 1905             JE decimal3
0F68 B04F                 1906             MOV AL, 01001111b
0F6A E99800               1907             JMP endfunc
0F6D                      1908     decimal3:
0F6D B0CF                 1909             MOV AL, 11001111b
0F6F E99300               1910             JMP endfunc
                          1911             
0F72                      1912             four:
0F72 3C04                 1913             CMP AL,4
0F74 7511                 1914             JNE five
0F76 833EA60001           1915             CMP DS:DECIMAL_FLAG, 1
0F7B 7405                 1916             JE decimal4
0F7D B066                 1917             MOV AL, 01100110b
0F7F E98300               1918             JMP endfunc
0F82                      1919     decimal4:
0F82 B0E6                 1920             MOV AL, 11100110b
0F84 EB7F90               1921             JMP endfunc
                          1922             
0F87                      1923             five:
0F87 3C05                 1924             CMP AL,5
0F89 7511                 1925             JNE six
0F8B 833EA60001           1926             CMP DS:DECIMAL_FLAG, 1
0F90 7405                 1927             JE decimal5
0F92 B06D                 1928             MOV AL, 01101101b
0F94 EB6F90               1929             JMP endfunc
0F97                      1930     decimal5:
0F97 B0ED                 1931             MOV AL, 11101101b
0F99 EB6A90               1932             JMP endfunc
                          1933             
0F9C                      1934             six:
0F9C 3C06                 1935             CMP AL,6
0F9E 7511                 1936             JNE seven
0FA0 833EA60001           1937             CMP DS:DECIMAL_FLAG, 1
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:16:20  12/07/;3  PAGE   37


LOC  OBJ                  LINE     SOURCE

0FA5 7405                 1938             JE decimal6
0FA7 B07D                 1939             MOV AL, 01111101b
0FA9 EB5A90               1940             JMP endfunc
0FAC                      1941     decimal6:
0FAC B0FD                 1942             MOV AL, 11111101b
0FAE EB5590               1943             JMP endfunc
                          1944             
0FB1                      1945             seven:
0FB1 3C07                 1946             CMP AL,7
0FB3 7511                 1947             JNE eight
0FB5 833EA60001           1948             CMP DS:DECIMAL_FLAG, 1
0FBA 7405                 1949             JE decimal7
0FBC B007                 1950             MOV AL, 00000111b
0FBE EB4590               1951             JMP endfunc
0FC1                      1952     decimal7:
0FC1 B087                 1953             MOV AL, 10000111b
0FC3 EB4090               1954             JMP endfunc
                          1955             
0FC6                      1956             eight:
0FC6 3C08                 1957             CMP AL,8
0FC8 7511                 1958             JNE nine
0FCA 833EA60001           1959             CMP DS:DECIMAL_FLAG, 1
0FCF 7405                 1960             JE decimal8
0FD1 B07F                 1961             MOV AL, 01111111b
0FD3 EB3090               1962             JMP endfunc
0FD6                      1963     decimal8:
0FD6 B0FF                 1964             MOV AL, 11111111b
0FD8 EB2B90               1965             JMP endfunc
                          1966             
0FDB                      1967             nine:
0FDB 3C09                 1968             CMP AL,9
0FDD 7511                 1969             JNE hifn
0FDF 833EA60001           1970             CMP DS:DECIMAL_FLAG, 1
0FE4 7405                 1971             JE decimal9
0FE6 B06F                 1972             MOV AL, 01101111b
0FE8 EB1B90               1973             JMP endfunc
0FEB                      1974     decimal9:
0FEB B0EF                 1975             MOV AL, 11101111b
0FED EB1690               1976             JMP endfunc
                          1977             
0FF0                      1978             hifn:
0FF0 3C2D                 1979             CMP AL,'-'
0FF2 7511                 1980             JNE endfunc
0FF4 833EA60001           1981             CMP DS:DECIMAL_FLAG, 1
0FF9 7405                 1982             JE decimal10
0FFB B040                 1983             MOV AL, 01000000b
0FFD EB0690               1984             JMP endfunc
1000                      1985     decimal10:
1000 B0C0                 1986             MOV AL, 11000000b
1002 EB0190               1987             JMP endfunc
                          1988             
1005                      1989             endfunc:
1005 5A                   1990             POP DX
1006 59                   1991             POP CX
1007 5B                   1992             POP BX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:16:20  12/07/;3  PAGE   38


LOC  OBJ                  LINE     SOURCE

                          1993     
1008 CB                   1994     RET
                          1995     BCD_TO_7SEG ENDP
                          1996     
----                      1997     CODE_SEG        ENDS
                          1998     END

ASSEMBLY COMPLETE, NO ERRORS FOUND
