8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    20:01:04  12/07/;3  PAGE    1


DOS 5.0 (038-N) 8086/87/88/186 MACRO ASSEMBLER V3.1 ASSEMBLY OF MODULE TIMER
OBJECT MODULE PLACED IN TIMER.OBJ
ASSEMBLER INVOKED BY:  D:\ASM86.EXE TIMER.ASM


LOC  OBJ                  LINE     SOURCE

                             1 +1  $MOD186
                             2 +1  $EP
                             3     NAME TIMER
                             4     ; Main program for uPD70208 microcomputer system
                             5     ;
                             6     ; Author:       Dr Tay Teng Tiow
                             7     ; Address:      Department of Electrical Engineering 
                             8     ;               National University of Singapore
                             9     ;               10, Kent Ridge Crescent
                            10     ;               Singapore 0511. 
                            11     ; Date:         6th September 1991
                            12     ;
                            13     ; This file contains proprietory information and cannot be copied 
                            14     ; or distributed without prior permission from the author.
                            15     ; =========================================================================
                            16     
                            17     public  serial_rec_action, timer2_action
                            18     extrn   print_char:far, print_2hex:far, iodefine:far
                            19     extrn   set_timer2:far
                            20     
                            21     ;IO Setup for 80C188 
  FFA0                      22             UMCR    EQU    0FFA0H ; Upper Memory Control Register
  FFA2                      23             LMCR    EQU    0FFA2H ; Lower Memory control Register         
  FFA4                      24             PCSBA   EQU    0FFA4H ; Peripheral Chip Select Base Address
  FFA8                      25             MPCS    EQU    0FFA8H ; MMCS and PCS Alter Control Register
  0080                      26             A_8255  EQU    0080H
  0081                      27             B_8255  EQU    0081H
  0082                      28             C_8255  EQU    0082H
  0083                      29             CWR_8255  EQU    0083H
  FF38                      30             INT0CON  EQU   0FF38H
  FF22                      31             EOI EQU 0FF22H
  FF28                      32             IMASK EQU 0FF28H
  FFA6                      33             MMCS    EQU    0FFA6H 
  4000                      34             DAC EQU 4000H
                            35     
                            36     
----                        37     STACK_SEG       SEGMENT
0000 (512                   38                     DB      512 DUP(?)
     ??
     )
0200                        39             TOS     LABEL   WORD
----                        40     STACK_SEG       ENDS
                            41     
                            42     
----                        43     DATA_SEG        SEGMENT
0000 0A                     44             TIMER0_MESS             DB      10,13,'TIMER2 INTERRUPT    '
0001 0D
0002 54494D45523220
     494E5445525255
     505420202020
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    20:01:04  12/07/;3  PAGE    2


LOC  OBJ                  LINE     SOURCE

0016 18                     45             T_COUNT                 DB      24
0017 18                     46             T_COUNT_SET             DB      24
0018 0A                     47             REC_MESS                DB      10,13,'Period of timer0 =     '
0019 0D
001A 506572696F6420
     6F662074696D65
     7230203D202020
     2020
0031 (32                    48             MESSAGE         DB  32 dup('h')
     68
     )
0051 00                     49             KEYPAD_INPUT    DB  0,0,0,0,0,0,0,0
0052 00
0053 00
0054 00
0055 00
0056 00
0057 00
0058 00
0059 2D                     50             BCD_MESSAGE     DB  '-','-','-','-','-','-'
005A 2D
005B 2D
005C 2D
005D 2D
005E 2D
005F FE                     51             ENABLE_BYTE     DB  11111110b
0060 00                     52             BCD_INDEX       DB  0
0061 0000                   53             KEYPAD_INDEX    DW      0
0063 20                     54             M_SIZE                  DB  32
0064 0040                   55             DAC_BASE        DW  4000H
0066 (15                    56             DAC_ADDR        DB  15 dup(0) 
     00
     )
0075 00                     57             DAC_LEN         DB  0
0076 0000                   58             SI_PTR          DW  0
0078 ??                     59             CHAR                    DB  ?
0079 ??                     60             REG_AL                  DB  ?
007A ??                     61             REG_BH                  DB  ?
007B ??                     62             REG_CL                  DB  ?
007C 00                     63             FLAG            DB  0
007D 00                     64             LONG_PRESS_FLAG DB      0
007E 7231                   65             MY_ID                   DB      'r1'
0080 00                     66             ID_FLAG_@               DB      0
0081 00                     67             ID_FLAG_r               DB      0
0082 4072312F               68             REPLY_MESSAGE   DB      '@r1/'
0086 40302F                 69             FAIL_MESSAGE    DB '@0/'
0089 04                     70             REPLY_COUNT             DB      4
008A 03                     71             FAIL_COUNT              DB      3
008B 00                     72             REPLY_FLAG              DB      0
008C 00                     73             SEND_FLAG       DB  0
008D (13                    74             SEND_BUFFER     DB  13 dup(0)
     00
     )
009A 0000                   75             SEND_BUFFER_LEN DW      0
009C 0000                   76             MAX_INPUT_SIZE  DW      0
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    20:01:04  12/07/;3  PAGE    3


LOC  OBJ                  LINE     SOURCE

009E 0000                   77             QTY_FLAG                DW      0
00A0 0000                   78             RECEIVE_FLAG    DW      0
00A2 0000                   79             DAC_FLAG                DW      0
00A4 0000                   80             PRICE_FLAG      DW      0
00A6 0100                   81             DECIMAL_FLAG    DW      1
00A8 0000                   82             SCROLL_LEN      DW      0
00AA 0000                   83             DAC_DISABLE     DW  0
00AC 0300                   84             DECIMAL_INDEX   DW  3
00AE 0100                   85             LANG_FLAG       DW  1
00B0 0000                   86             PRICE                   DW      0
00B2 0000                   87             QTY                             DW      0
00B4 0000                   88             TOTAL_PRICE_U   DW      0
00B6 0000                   89             TOTAL_PRICE_L   DW      0
00B8 0000                   90             TOTAL_PRICE_DEC DW      0
00BA (8                     91             TEMP_BCD_ARR    DB  8 dup(0)
     00
     )
00C2 0000                   92             THOUSAND_FLAG   DW  0
00C4 0000                   93             CENT_FLAG               DW      0
00C6 0000                   94             DOLLAR_FLAG             DW      0
00C8 0000                   95             CASH_FLAG               DW      0
00CA (8                     96             CASH_AMT        DB  8 dup(0)
     00
     )
00D2 (8                     97             TEMP_CASH_ARR   DW  8 dup(0)
     0000
     )
00E2 0000                   98             CASH_OK_FLAG    DW  0
00E4 0000                   99             BORROW_POSITION DW  0
00E6 0100                  100             CANCEL_FLAG             DW  1
00E8 0000                  101             TRANSACTION_OVER DW 0
00EA 0100                  102             DATA_ENTER              DW  1
00EC (8                    103             TROLLEY_ARRAY   DB  8 dup(0)
     00
     )
00F4 0000                  104             TROLLEY_INDEX   DW  0
00F6 0000                  105             TROLLEY_FLAG    DW  0
00F8 0000                  106             TROLLEY_ID              DW  0
00FA 0000                  107             TROLLEY_DISABLED DW 0
00FC 0000                  108             TEN_THOUSAND_FLAG DW 0
00FE 0000                  109             ZERO_TELL               DW  0
----                       110     DATA_SEG        ENDS
                           111     
                           112     
----                       113     CODE_SEG        SEGMENT
                           114     
                           115             PUBLIC          START
                           116     
                           117     ASSUME  CS:CODE_SEG, SS:STACK_SEG
                           118     
0000                       119     START:
                           120     ;initialize stack area
0000 B8----         R      121                     MOV     AX,STACK_SEG            
0003 8ED0                  122                     MOV     SS,AX
0005 368B260002            123                     MOV     SP,TOS
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    20:01:04  12/07/;3  PAGE    4


LOC  OBJ                  LINE     SOURCE

                           124                     
                           125     ; Initialize the on-chip pheripherals
000A 9A0000----     E      126                     CALL    FAR PTR IODEFINE
                           127                     
000F 9A0000----     E      128     call set_timer2
0014 FB                    129                    STI
                           130     
                           131     ; ^^^^^^^^^^^^^^^^^  Start of User Main Routine  ^^^^^^^^^^^^^^^^^^
                           132     
                           133     ;Initialize MMCS
                           134             
0015 BAA6FF                135             MOV DX, MMCS
0018 B80340                136             MOV AX, 4003H
001B EF                    137             OUT DX, AX
                           138     
                           139     ; Initialize MPCS to MAP peripheral to IO address
                           140             
001C BAA8FF                141             MOV DX, MPCS
001F B88320                142             MOV AX, 2083H
0022 EF                    143             OUT DX, AX
                           144        
                           145     ; PCSBA initial, set the parallel port start from 00H
0023 BAA4FF                146             MOV DX, PCSBA
0026 B80300                147             MOV AX, 0003H ; Peripheral starting address 00H no READY, No Waits
0029 EF                    148             OUT DX, AX
                           149     
                           150     ; Initialize LMCS 
002A BAA2FF                151         MOV DX, LMCR
002D B8C401                152         MOV AX, 01C4H  ; Starting address 1FFFH, 8K, No waits, last shoud be 5H for 1 wai
                                   ts      
0030 EF                    153         OUT DX, AX
                           154             
0031 B8----         R      155             MOV AX, DATA_SEG
0034 8ED8                  156             MOV DS, AX
                           157                              
0036 BA8300                158             MOV DX, CWR_8255
0039 B88200                159             MOV AX, 0082h
003C EF                    160             OUT DX, AX
                           161             
003D                       162     NEXT:
003D 9A4400----     R      163             CALL FAR PTR KEYPAD_LOOP
                           164             
0042 EBF9                  165     JMP NEXT
                           166     
0044                       167     KEYPAD_LOOP PROC FAR
0044 50                    168     PUSH AX
0045 53                    169     PUSH BX
0046 51                    170     PUSH CX
0047 52                    171     PUSH DX
                           172             
0048 9A7206----     R      173                             CALL FAR PTR DEBOUNCE           
                           174                             
004D C606790003            175     WAIT_1:         MOV DS:REG_AL, 03H
0052 BB0000                176                         MOV BX, 0000H
0055 BA8200                177                         MOV DX,C_8255
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    20:01:04  12/07/;3  PAGE    5


LOC  OBJ                  LINE     SOURCE

0058 8AC3                  178                         MOV AL,BL
005A EE                    179                         OUT DX,AL
                           180                        
005B BA8100                181                         MOV DX,B_8255
005E EC                    182                         IN AL,DX
005F 8AD8                  183                         MOV BL,AL  
0061 80E3FC                184                         AND BL,0FCH
0064 80FBFC                185                         CMP BL,0FCH
                           186                      
0067 744F                  187                     JE LONG_PRESS
                           188                             
0069 B3FE                  189                         MOV BL, 0FEH
006B C6067A0004            190                         MOV DS:REG_BH, 04H
                           191                        
0070                       192     NXTROW: 
0070 C0C307                193                     ROL BL,07H
0073 8AEB                  194                             MOV CH,BL
0075 BA8200                195                             MOV DX,C_8255
0078 8AC3                  196                             MOV AL,BL
007A EE                    197                             OUT DX,AL
                           198                             
007B BA8100                199                             MOV DX,B_8255
007E EC                    200                             IN AL,DX
007F 8AD8                  201                             MOV BL,AL
0081 80E3FC                202                             AND BL,0FCH
0084 C6067B0006            203                             MOV DS:REG_CL,06H
0089 C0DB02                204                             RCR BL,02H
008C D0DB                  205     NXTCOL:         RCR BL,01H
008E 7330                  206                             JNC CODEKY
0090 FE0E7900              207                             DEC DS:REG_AL
0094 FE0E7B00              208                             DEC DS:REG_CL
0098 803E7B0003            209                             CMP DS:REG_CL,03H
009D 7413                  210                             JE KEYPAD4
                           211                             
009F 803E7B0000            212                             CMP DS:REG_CL, 0H
00A4 740F                  213                             JE SUBTRACT3
00A6 EBE4                  214                             JMP NXTCOL
                           215                             
00A8 8ADD                  216                             MOV BL,CH
00AA FE0E7A00              217                             DEC DS:REG_BH
00AE 75C0                  218                             JNZ NXTROW
00B0 EB9B                  219                             JMP WAIT_1
                           220                             
00B2 EB7290                221     KEYPAD4:    JMP KEYPAD3
00B5 EB7290                222     SUBTRACT3:  JMP SUBTRACT2
                           223                             
00B8                       224     LONG_PRESS:
00B8 C6067D0000            225                             MOV DS:LONG_PRESS_FLAG, 0
00BD EB6D90                226                             JMP RETURN2
00C0                       227     CODEKY:
00C0 803E79000B            228                         CMP DS:REG_AL, 11
00C5 7505                  229                             JNE bcd_upd
00C7 C606790000            230                             MOV DS:REG_AL, 0
                           231                             
00CC                       232     bcd_upd:
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    20:01:04  12/07/;3  PAGE    6


LOC  OBJ                  LINE     SOURCE

00CC 803E7D0000            233                             CMP DS:LONG_PRESS_FLAG, 0
00D1 7559                  234                             JNE RETURN2
                           235                             
00D3 803E790011            236                             CMP DS:REG_AL, 17
00D8 7555                  237                             JNE ENTER_CASH
                           238                             
00DA 833EFA0001            239                             CMP DS:TROLLEY_DISABLED, 1
00DF 7442                  240                             JE SKIP_ENTER_DATA1
                           241                             
00E1 833EC80001            242                             CMP DS:CASH_FLAG, 1
00E6 743B                  243                             JE SKIP_ENTER_DATA1
00E8 9AC105----     R      244                             CALL FAR PTR BCD_CLEAR
                           245                             
00ED 833EE80000            246                             CMP DS:TRANSACTION_OVER, 0
00F2 7405                  247                             JE NO_RESET_NEEDED1
                           248                             
00F4 9A7F04----     R      249                             CALL FAR PTR CLEAR_TEMP_BCD
                           250                             
00F9                       251             NO_RESET_NEEDED1:
00F9 C706EA000100          252                             MOV DS:DATA_ENTER, 1
00FF C706AC000600          253                             MOV DS:DECIMAL_INDEX, 6
0105 C7069C000600          254                             MOV DS:MAX_INPUT_SIZE, 6
010B C706F8000100          255                             MOV DS:TROLLEY_ID, 1
0111 C706AE000000          256                             MOV DS:LANG_FLAG, 0
0117 C706C8000000          257                             MOV DS:CASH_FLAG, 0
011D C706E8000000          258                             MOV DS:TRANSACTION_OVER, 0
0123                       259             SKIP_ENTER_DATA1:
0123 E90702                260                             JMP UPDATE_7SEG2
                           261                             
0126 E90003                262     KEYPAD3:        JMP KEYPAD_2
                           263                             
0129 E90D03                264     SUBTRACT2:   JMP SUBTRACT
                           265     
012C E91803                266     RETURN2:    JMP RETURN
                           267                             
                           268                             
012F                       269     ENTER_CASH:     
012F 803E790014            270                             CMP DS:REG_AL, 20
0134 7521                  271                             JNE SEND_CASH
0136 833EC80000            272                             CMP DS:CASH_FLAG, 0
013B 7417                  273                             JE SKIP_CASH
013D C706EA000100          274                             MOV DS:DATA_ENTER, 1
0143 9AC105----     R      275                             CALL FAR PTR BCD_CLEAR
0148 C7069C000800          276                             MOV DS:MAX_INPUT_SIZE, 8
014E C706AC000600          277                             MOV DS:DECIMAL_INDEX, 6
0154                       278                     SKIP_CASH:
0154 E9D601                279                             JMP UPDATE_7SEG2
                           280                             
0157                       281     SEND_CASH:
0157 803E790017            282                             CMP DS:REG_AL, 23
015C 7523                  283                             JNE CLEAR_BUTTON
015E 833EC80000            284                             CMP DS:CASH_FLAG, 0
0163 7419                  285                             JE SKIP_SEND_CASH
0165 833E610000            286                             CMP DS:KEYPAD_INDEX, 0
016A 7412                  287                             JE SKIP_SEND_CASH
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    20:01:04  12/07/;3  PAGE    7


LOC  OBJ                  LINE     SOURCE

016C 833EAC0003            288                             CMP DS:DECIMAL_INDEX, 3
0171 740B                  289                             JE SKIP_SEND_CASH
0173 C706EA000000          290                             MOV DS:DATA_ENTER, 0
0179 9A9706----     R      291                             CALL FAR PTR TAKE_CASH
017E                       292                     SKIP_SEND_CASH:
017E E9AC01                293                             JMP UPDATE_7SEG2
                           294                             
0181                       295     CLEAR_BUTTON:
0181 803E79000A            296                             CMP DS:REG_AL, 10
0186 7508                  297                             JNE BACKSPACE
0188 9AC105----     R      298                             CALL FAR PTR BCD_CLEAR
018D E99D01                299                             JMP UPDATE_7SEG2
                           300                             
0190 803E79000C            301     BACKSPACE:      CMP DS:REG_AL, 12
0195 7508                  302                             JNE ENTER_DATA
0197 9A5205----     R      303                             CALL FAR PTR BCD_BACKSPACE
019C E98E01                304                             JMP UPDATE_7SEG2
                           305     
019F 803E79000D            306     ENTER_DATA:     CMP DS:REG_AL, 13
01A4 753F                  307                             JNE END_TRANS
01A6 833EC80001            308                             CMP DS:CASH_FLAG, 1
01AB 7435                  309                             JE SKIP_ENTER_DATA
01AD 9AC105----     R      310                             CALL FAR PTR BCD_CLEAR
                           311                             
01B2 833EE80000            312                             CMP DS:TRANSACTION_OVER, 0
01B7 7405                  313                             JE NO_RESET_NEEDED
                           314                             
01B9 9A7F04----     R      315                             CALL FAR PTR CLEAR_TEMP_BCD
                           316                             
01BE                       317             NO_RESET_NEEDED:
01BE C706EA000100          318                             MOV DS:DATA_ENTER, 1
01C4 C706AC000600          319                             MOV DS:DECIMAL_INDEX, 6
01CA C7069C000800          320                             MOV DS:MAX_INPUT_SIZE, 8
01D0 C706AE000000          321                             MOV DS:LANG_FLAG, 0
01D6 C706C8000000          322                             MOV DS:CASH_FLAG, 0
01DC C706E8000000          323                             MOV DS:TRANSACTION_OVER, 0
01E2                       324             SKIP_ENTER_DATA:
01E2 E94801                325                             JMP UPDATE_7SEG2
                           326                             
01E5 803E790010            327     END_TRANS:      CMP DS:REG_AL, 16
01EA 7553                  328                             JNE CANCEL_TRANS
01EC 833EF80001            329                             CMP DS:TROLLEY_ID, 1
01F1 7449                  330                             JE END_TRANS_CONT
01F3 833EC80001            331                             CMP DS:CASH_FLAG, 1
01F8 7442                  332                             JE END_TRANS_CONT
01FA 833EE80000            333                             CMP DS:TRANSACTION_OVER, 0
01FF 7403                  334                             JE TRANSACTION_NOT_OVER
0201 E92901                335                             JMP UPDATE_7SEG2
0204                       336     TRANSACTION_NOT_OVER:
0204 BB0000                337                             MOV BX, 0
0207 C6878D0024            338                             MOV DS:SEND_BUFFER[BX], '$'
020C 43                    339                             INC BX
020D C6878D002F            340                             MOV DS:SEND_BUFFER[BX], '/'
0212 C7069A000200          341                             MOV DS:SEND_BUFFER_LEN, 2
0218 C6068C0001            342                             MOV DS:SEND_FLAG, 1
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    20:01:04  12/07/;3  PAGE    8


LOC  OBJ                  LINE     SOURCE

021D C706B8000000          343                             MOV DS:TOTAL_PRICE_DEC, 0
0223 C706B6000000          344                             MOV DS:TOTAL_PRICE_L, 0
0229 C706B4000000          345                             MOV DS:TOTAL_PRICE_U, 0
022F 833EE60001            346                             CMP DS:CANCEL_FLAG, 1
0234 7406                  347                             JE END_TRANS_CONT
0236 C706C8000100          348                             MOV DS:CASH_FLAG, 1
023C                       349                     END_TRANS_CONT:
023C E9EE00                350                             JMP UPDATE_7SEG2
                           351                             
023F                       352     CANCEL_TRANS:   
023F 803E79000F            353                             CMP DS:REG_AL, 15
0244 755A                  354                             JNE SCROLL_LEFT
0246 833EC80001            355                             CMP DS:CASH_FLAG, 1
024B 7503                  356                             JNE CONT_CANCEL
024D E9DD00                357                             JMP UPDATE_7SEG2
0250                       358                     CONT_CANCEL:
0250 BB0000                359                             MOV BX, 0
0253 C6878D003F            360                             MOV DS:SEND_BUFFER[BX], '?'
0258 43                    361                             INC BX
0259 C6878D002F            362                             MOV DS:SEND_BUFFER[BX], '/'
025E C7069A000200          363                             MOV DS:SEND_BUFFER_LEN, 2
0264 C6068C0001            364                             MOV DS:SEND_FLAG, 1
0269 C706B8000000          365                             MOV DS:TOTAL_PRICE_DEC, 0
026F C706B6000000          366                             MOV DS:TOTAL_PRICE_L, 0
0275 C706B4000000          367                             MOV DS:TOTAL_PRICE_U, 0
027B C706AC000300          368                             MOV DS:DECIMAL_INDEX, 3
0281 9AC105----     R      369                             CALL FAR PTR BCD_CLEAR
0286 C7069C000000          370                             MOV DS:MAX_INPUT_SIZE, 0
                           371                             
028C 9A7F04----     R      372                             CALL FAR PTR CLEAR_TEMP_BCD
                           373                             
0291 C706E6000100          374                             MOV DS:CANCEL_FLAG, 1
0297 C706FA000000          375                             MOV DS:TROLLEY_DISABLED, 0
029D E98D00                376                             JMP UPDATE_7SEG2
                           377                             
02A0                       378     SCROLL_LEFT:
02A0 803E790015            379                             CMP DS:REG_AL, 21
02A5 753D                  380                             JNE SCROLL_RIGHT
02A7 833E610006            381                             CMP DS:KEYPAD_INDEX, 6
02AC 7E7F                  382                             JLE UPDATE_7SEG2
02AE 833EA80000            383                             CMP DS:SCROLL_LEN, 0
02B3 7478                  384                             JE UPDATE_7SEG2
02B5 FF0EA800              385                             DEC DS:SCROLL_LEN
02B9 FF0EAC00              386                             DEC DS:DECIMAL_INDEX
02BD FF0E6100              387                             DEC DS:KEYPAD_INDEX
02C1 8B1E6100              388                             MOV BX, DS:KEYPAD_INDEX
02C5 8A4751                389                             MOV AL, DS:KEYPAD_INPUT[BX]
02C8 A27900                390                             MOV DS:REG_AL, AL
02CB C706AA000100          391                             MOV DS:DAC_DISABLE, 1
02D1 9AEC05----     R      392                             CALL FAR PTR BCD_UPDATE
02D6 C706AA000000          393                             MOV DS:DAC_DISABLE, 0
02DC C606790015            394                             MOV DS:REG_AL, 21
02E1 EB4A90                395                             JMP UPDATE_7SEG2
                           396     
02E4                       397     SCROLL_RIGHT:
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    20:01:04  12/07/;3  PAGE    9


LOC  OBJ                  LINE     SOURCE

02E4 803E790013            398                             CMP DS:REG_AL, 19
02E9 7545                  399                             JNE LANG_TOGGLE
02EB 833E610006            400                             CMP DS:KEYPAD_INDEX, 6
02F0 7E3B                  401                             JLE UPDATE_7SEG2
02F2 A16100                402                             MOV AX, DS:KEYPAD_INDEX
02F5 2D0600                403                             SUB AX, 6
02F8 3906A800              404                             CMP DS:SCROLL_LEN, AX
02FC 742F                  405                             JE UPDATE_7SEG2
02FE FF06A800              406                             INC DS:SCROLL_LEN
0302 FF06AC00              407                             INC DS:DECIMAL_INDEX
0306 FF0E6100              408                             DEC DS:KEYPAD_INDEX
030A 8B1E6100              409                             MOV BX, DS:KEYPAD_INDEX
030E 8A4751                410                             MOV AL, DS:KEYPAD_INPUT[BX]
0311 A27900                411                             MOV DS:REG_AL, AL
0314 C706AA000100          412                             MOV DS:DAC_DISABLE, 1
031A 9AEC05----     R      413                             CALL FAR PTR BCD_UPDATE
031F C706AA000000          414                             MOV DS:DAC_DISABLE, 0
0325 C606790013            415                             MOV DS:REG_AL, 19
032A EB0190                416                             JMP UPDATE_7SEG2
                           417                             
032D E9DE00                418     UPDATE_7SEG2: JMP UPDATE_7SEG
                           419     
0330                       420     LANG_TOGGLE:
0330 803E790012            421                             CMP DS:REG_AL, 18
0335 7537                  422                             JNE QTY_PROMPT
0337 833EAE0001            423                             CMP DS:LANG_FLAG, 1
033C 75EF                  424                             JNE UPDATE_7SEG2
033E A16400                425                             MOV AX, DS:DAC_BASE
0341 3D0040                426                             CMP AX, 4000H
0344 7406                  427                             JE MANDRIN
0346 B80040                428                             MOV AX, 4000H
0349 EB0490                429                             JMP SEND_TOGGLE
034C                       430             MANDRIN:
034C B80066                431                             MOV AX, 6600H
034F                       432             SEND_TOGGLE:
034F A36400                433                             MOV DS:DAC_BASE, AX
0352 BB0000                434                             MOV BX, 0
0355 C6878D0021            435                             MOV DS:SEND_BUFFER[BX], '!'
035A 43                    436                             INC BX
035B C6878D002F            437                             MOV DS:SEND_BUFFER[BX], '/'
0360 C7069A000200          438                             MOV DS:SEND_BUFFER_LEN, 2
0366 C6068C0001            439                             MOV DS:SEND_FLAG, 1
036B E9A000                440                             JMP UPDATE_7SEG
036E                       441     QTY_PROMPT:
036E 803E790016            442                             CMP DS:REG_AL, 22
0373 7527                  443                             JNE QUANTITY
0375 833EC80001            444                             CMP DS:CASH_FLAG, 1
037A 7420                  445                             JE QUANTITY
037C 833E610008            446                             CMP DS:KEYPAD_INDEX, 8
0381 7519                  447                             JNE  QUANTITY
                           448                             ; CMP DS:MAX_INPUT_SIZE, 8
                           449                             ; JNE QUANTITY
0383 9A0B05----     R      450                             CALL FAR PTR UPDATE_SEND_BUFFER
0388 9AC105----     R      451                             CALL FAR PTR BCD_CLEAR
038D C7069C000200          452                             MOV DS:MAX_INPUT_SIZE, 2
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    20:01:04  12/07/;3  PAGE   10


LOC  OBJ                  LINE     SOURCE

0393 C7069E000100          453                             MOV DS:QTY_FLAG, 1
0399 EB7390                454                             JMP UPDATE_7SEG
                           455                     
039C                       456     QUANTITY:
039C 833E610000            457                             CMP DS:KEYPAD_INDEX, 0
03A1 746B                  458                             JE  UPDATE_7SEG
                           459                             
03A3 803E79000E            460                             CMP DS:REG_AL, 14
03A8 7564                  461                             JNE UPDATE_7SEG
                           462                             
03AA 833EF80001            463                             CMP DS:TROLLEY_ID, 1
03AF 752C                  464                             JNE NORMAL_UPDATE
                           465                             
03B1 833E610006            466                             CMP DS:KEYPAD_INDEX, 6
03B6 7525                  467                             JNE NORMAL_UPDATE
                           468                             
03B8 9A4C04----     R      469                             CALL FAR PTR UPDATE_TROLLEY_ID
                           470                             
03BD C706F8000000          471                             MOV DS:TROLLEY_ID, 0
03C3 C6068C0001            472                             MOV DS:SEND_FLAG, 1
03C8 C706EA000000          473                             MOV DS:DATA_ENTER, 0
03CE C706E6000000          474                             MOV DS:CANCEL_FLAG, 0
03D4 C706C8000100          475                             MOV DS:CASH_FLAG, 1
                           476                             
03DA EB3290                477                             JMP UPDATE_7SEG
                           478                             
03DD                       479                     NORMAL_UPDATE:  
03DD 833E9E0001            480                             CMP DS:QTY_FLAG, 1
03E2 752A                  481                             JNE UPDATE_7SEG
                           482                             
03E4 C706EA000000          483                             MOV DS:DATA_ENTER, 0
                           484                             
03EA C706E6000000          485                             MOV DS:CANCEL_FLAG, 0
                           486                     
03F0 9ABA04----     R      487                             CALL FAR PTR UPDATE_THE_QUANTITY
                           488                             
03F5 C706FA000100          489                             MOV DS:TROLLEY_DISABLED, 1
03FB C6068C0001            490                             MOV DS:SEND_FLAG, 1
                           491                             
0400 C7069E000000          492                             MOV DS:QTY_FLAG, 0
0406 9AC105----     R      493                             CALL FAR PTR BCD_CLEAR
040B EB0190                494                             JMP UPDATE_7SEG
                           495                             
                           496     
040E                       497     UPDATE_7SEG:
040E 803E790009            498                             CMP DS:REG_AL, 9
0413 7F0C                  499                             JG SET_PRESS_FLAG
                           500                             
0415 833EEA0001            501                             CMP DS:DATA_ENTER, 1
041A 7505                  502                             JNE SET_PRESS_FLAG
                           503                             
041C 9AEC05----     R      504                             CALL FAR PTR BCD_UPDATE
                           505                             
0421                       506     SET_PRESS_FLAG:
0421 C6067D0001            507                             MOV DS:LONG_PRESS_FLAG, 1
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    20:01:04  12/07/;3  PAGE   11


LOC  OBJ                  LINE     SOURCE

0426 EB1F90                508                             JMP RETURN
                           509             
0429                       510     KEYPAD_2: 
0429 800679000F            511                 ADD DS:REG_AL,0FH
042E E95BFC                512                             JMP NXTCOL
0431 C606790000            513     ZERO_PRINT: MOV DS:REG_AL,00H
0436 E953FC                514                             JMP NXTCOL
0439 802E790006            515     SUBTRACT:   SUB DS:REG_AL,06H
043E 8ADD                  516                             MOV BL,CH
0440 FE0E7A00              517                             DEC DS:REG_BH
0444 E929FC                518                             JMP NXTROW
                           519             
                           520             
0447                       521     RETURN:
0447 5A                    522                             POP DX
0448 59                    523                             POP CX
0449 5B                    524                             POP BX
044A 58                    525                             POP AX
044B CB                    526                             RET
                           527     
                           528     KEYPAD_LOOP ENDP
                           529     
044C                       530     UPDATE_TROLLEY_ID PROC FAR
044C 50                    531     PUSH AX
044D 53                    532     PUSH BX
044E 51                    533     PUSH CX
044F 52                    534     PUSH DX
0450 BB0000                535             MOV BX, 0
0453 C6878D005E            536             MOV DS:SEND_BUFFER[BX], '^'
0458 B90600                537             MOV CX, 6
045B                       538             UPDATE_TROLLEY_BUFFER:
045B BB0600                539                     MOV BX, 6
045E 2BD9                  540                     SUB BX, CX
                           541                     
0460 8A4751                542                     MOV AL, DS:KEYPAD_INPUT[BX]
                           543                     
0463 43                    544                     INC BX
0464 0430                  545                     ADD AL, 30H
0466 88878D00              546                     MOV DS:SEND_BUFFER[BX], AL
046A E2EF                  547             LOOP UPDATE_TROLLEY_BUFFER
                           548             
046C BB0700                549             MOV BX, 7
046F C6878D002F            550             MOV DS:SEND_BUFFER[BX], '/'
                           551             
0474 C7069A000800          552             MOV DS:SEND_BUFFER_LEN, 8
                           553     
047A 5A                    554     POP DX
047B 59                    555     POP CX
047C 5B                    556     POP BX
047D 58                    557     POP AX
047E CB                    558     RET
                           559     UPDATE_TROLLEY_ID ENDP
                           560     
047F                       561     CLEAR_TEMP_BCD PROC FAR
047F 50                    562     PUSH AX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    20:01:04  12/07/;3  PAGE   12


LOC  OBJ                  LINE     SOURCE

0480 53                    563     PUSH BX
0481 51                    564     PUSH CX
0482 52                    565     PUSH DX
                           566     
0483 BB0000                567             MOV BX, 0
0486 C687BA002D            568             MOV DS:TEMP_BCD_ARR[BX], '-'
048B 43                    569             INC BX
048C C687BA002D            570             MOV DS:TEMP_BCD_ARR[BX], '-'
0491 43                    571             INC BX
0492 C687BA002D            572             MOV DS:TEMP_BCD_ARR[BX], '-'
0497 43                    573             INC BX
0498 C687BA002D            574             MOV DS:TEMP_BCD_ARR[BX], '-'
049D 43                    575             INC BX
049E C687BA002D            576             MOV DS:TEMP_BCD_ARR[BX], '-'
04A3 43                    577             INC BX
04A4 C687BA002D            578             MOV DS:TEMP_BCD_ARR[BX], '-'
04A9 43                    579             INC BX
04AA C687BA002D            580             MOV DS:TEMP_BCD_ARR[BX], '-'
04AF 43                    581             INC BX
04B0 C687BA002D            582             MOV DS:TEMP_BCD_ARR[BX], '-'
                           583             
04B5 5A                    584     POP DX
04B6 59                    585     POP CX
04B7 5B                    586     POP BX
04B8 58                    587     POP AX
04B9 CB                    588     RET
                           589     CLEAR_TEMP_BCD ENDP
                           590     
                           591     
04BA                       592     UPDATE_THE_QUANTITY PROC FAR
04BA 50                    593     PUSH AX
04BB 53                    594     PUSH BX
04BC 51                    595     PUSH CX
04BD 52                    596     PUSH DX
04BE 8B0E6100              597             MOV CX, DS:KEYPAD_INDEX
04C2 BB0000                598             MOV BX, 0
04C5 BA0000                599             MOV DX, 0
04C8                       600             UPD_QTY:
04C8 A1B200                601                     MOV AX, DS:QTY
04CB 53                    602                     PUSH BX
04CC BB0A00                603                     MOV BX, 10
04CF F7E3                  604                     MUL BX
04D1 5B                    605                     POP BX
04D2 8A5751                606                     MOV DL, DS:KEYPAD_INPUT[BX]
04D5 03C2                  607                     ADD AX, DX
04D7 A3B200                608                     MOV DS:QTY, AX
04DA 43                    609                     INC BX
04DB E2EB                  610             LOOP UPD_QTY
                           611             
04DD 8B0E6100              612             MOV CX, DS:KEYPAD_INDEX
04E1 8B1E9A00              613             MOV BX, DS:SEND_BUFFER_LEN
                           614             
04E5                       615             UPD_BUFFER:
04E5 53                    616                     PUSH BX
04E6 8B1E6100              617                     MOV BX, DS:KEYPAD_INDEX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    20:01:04  12/07/;3  PAGE   13


LOC  OBJ                  LINE     SOURCE

04EA 2BD9                  618                     SUB BX, CX
04EC 8A4751                619                     MOV AL, DS:KEYPAD_INPUT[BX]
04EF 5B                    620                     POP BX
04F0 0430                  621                     ADD AL, 30H
04F2 88878D00              622                     MOV DS:SEND_BUFFER[BX], AL
                           623                     
04F6 43                    624                     INC BX
04F7 FF069A00              625                     INC DS:SEND_BUFFER_LEN
04FB E2E8                  626             LOOP UPD_BUFFER
                           627             
04FD C6878D002F            628             MOV DS:SEND_BUFFER[BX], '/'
0502 FF069A00              629             INC DS:SEND_BUFFER_LEN
                           630                     
0506 5A                    631     POP DX
0507 59                    632     POP CX
0508 5B                    633     POP BX
0509 58                    634     POP AX
                           635     
050A CB                    636     RET
                           637     UPDATE_THE_QUANTITY ENDP
                           638     
050B                       639     UPDATE_SEND_BUFFER PROC FAR
050B 50                    640     PUSH AX
050C 53                    641     PUSH BX
050D 51                    642     PUSH CX
050E 52                    643     PUSH DX
                           644     
050F 8B0E6100              645             MOV CX, DS:KEYPAD_INDEX
0513 83F900                646             CMP CX, 0
0516 7435                  647             JE END_UPD_BUFFER
0518 83C102                648             ADD CX, 2
051B 890E9A00              649             MOV DS:SEND_BUFFER_LEN, CX
051F BB0000                650             MOV BX, 0
0522                       651             BUFFER_LOOP:
0522 83FB00                652                     CMP BX, 0
0525 7508                  653                     JNE ASTERISK
0527 C6878D007E            654                     MOV DS:SEND_BUFFER[BX], '~'
052C EB1C90                655                     JMP END_BUFFER
052F                       656             ASTERISK:
052F A16100                657                     MOV AX, DS:KEYPAD_INDEX
0532 40                    658                     INC AX
0533 3BD8                  659                     CMP BX, AX
0535 7508                  660                     JNE CONT
0537 C6878D002A            661                     MOV DS:SEND_BUFFER[BX], '*'
053C EB0C90                662                     JMP END_BUFFER
053F                       663             CONT:
053F 4B                    664                     DEC BX
0540 8A4751                665                     MOV AL, DS:KEYPAD_INPUT[BX]
0543 0430                  666                     ADD AL, 30H
0545 43                    667                     INC BX
0546 88878D00              668                     MOV DS:SEND_BUFFER[BX], AL
                           669                     
054A                       670             END_BUFFER:
054A 43                    671                     INC BX
054B E2D5                  672             LOOP BUFFER_LOOP
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    20:01:04  12/07/;3  PAGE   14


LOC  OBJ                  LINE     SOURCE

054D                       673     END_UPD_BUFFER:
054D 5A                    674     POP DX
054E 59                    675     POP CX
054F 5B                    676     POP BX
0550 58                    677     POP AX
0551 CB                    678     RET
                           679     UPDATE_SEND_BUFFER ENDP
                           680     
0552                       681     BCD_BACKSPACE PROC FAR
                           682     
0552 50                    683     PUSH AX
0553 53                    684     PUSH BX
0554 51                    685     PUSH CX
0555 52                    686     PUSH DX
                           687     
0556 8A167900              688             MOV DL, DS:REG_AL
055A 833E610000            689             CMP DS:KEYPAD_INDEX, 0
055F 7457                  690             JE RETURN_BACK
                           691             
0561 BB0600                692             MOV BX, 6
0564                       693             BCD_CLEAR_LOOP:
0564 4B                    694                     DEC BX
0565 C647592D              695                     MOV DS:BCD_MESSAGE[BX], '-'
0569 43                    696                     INC BX
056A 4B                    697                     DEC BX
056B 75F7                  698             JNZ BCD_CLEAR_LOOP
                           699             
056D 833E610001            700             CMP DS:KEYPAD_INDEX, 1
0572 7E2C                  701             JLE less_than_two
                           702             
0574 FF0E6100              703             DEC DS:KEYPAD_INDEX
0578 FF0E6100              704             DEC DS:KEYPAD_INDEX
057C 8B1E6100              705             MOV BX, DS:KEYPAD_INDEX
0580 8A4751                706             MOV AL, DS:KEYPAD_INPUT[BX]
0583 A27900                707             MOV DS:REG_AL, AL
0586 C706A8000000          708             MOV DS:SCROLL_LEN, 0
058C C706AA000100          709             MOV DS:DAC_DISABLE, 1
0592 9AEC05----     R      710             CALL FAR PTR BCD_UPDATE
0597 C706AA000000          711             MOV DS:DAC_DISABLE, 0
059D EB1990                712             JMP RETURN_BACK
                           713             
05A0                       714     less_than_two:
05A0 FF0E6100              715             DEC DS:KEYPAD_INDEX
05A4 C60679002D            716             MOV DS:REG_AL, '-'
05A9 C706A8000000          717             MOV DS:SCROLL_LEN, 0
05AF 9AEC05----     R      718             CALL FAR PTR BCD_UPDATE
05B4 FF0E6100              719             DEC DS:KEYPAD_INDEX
                           720             
05B8                       721     RETURN_BACK:
05B8 88167900              722             MOV DS:REG_AL, DL
05BC 5A                    723     POP DX
05BD 59                    724     POP CX
05BE 5B                    725     POP BX
05BF 58                    726     POP AX
                           727     
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    20:01:04  12/07/;3  PAGE   15


LOC  OBJ                  LINE     SOURCE

05C0 CB                    728     RET
                           729     BCD_BACKSPACE ENDP
                           730     
05C1                       731     BCD_CLEAR PROC FAR
05C1 50                    732     PUSH AX
05C2 53                    733     PUSH BX
05C3 51                    734     PUSH CX
05C4 52                    735     PUSH DX
05C5 BB0800                736             MOV BX, 8
05C8                       737             CLEAR_LOOP:
05C8 C6475100              738             MOV DS:KEYPAD_INPUT[BX], 0
05CC 4B                    739             DEC BX
05CD 75F9                  740             JNZ CLEAR_LOOP
                           741             
05CF BB0600                742             MOV BX, 6
05D2                       743             CLEAR_LOOP2:
05D2 4B                    744                     DEC BX
05D3 C647592D              745                     MOV DS:BCD_MESSAGE[BX], '-'
05D7 43                    746                     INC BX
05D8 4B                    747                     DEC BX
05D9 75F7                  748             JNZ CLEAR_LOOP2
                           749     
05DB C70661000000          750             MOV DS:KEYPAD_INDEX, 0
05E1 C706A8000000          751             MOV DS:SCROLL_LEN, 0
05E7 5A                    752     POP DX
05E8 59                    753     POP CX
05E9 5B                    754     POP BX
05EA 58                    755     POP AX
05EB CB                    756     RET
                           757     BCD_CLEAR ENDP
                           758     
05EC                       759     BCD_UPDATE PROC FAR
05EC 50                    760     PUSH AX
05ED 53                    761     PUSH BX
05EE 51                    762     PUSH CX
05EF 52                    763     PUSH DX
05F0 A19C00                764                     MOV AX, DS:MAX_INPUT_SIZE
05F3 39066100              765                     CMP DS:KEYPAD_INDEX, AX
05F7 7D5A                  766                     JGE BCD_RET
                           767                     
05F9 8A0E7900              768                     MOV CL, DS:REG_AL
05FD 80F909                769                     CMP CL, 9
0600 7F0C                  770                     JG SKIP_PAST
0602 833EAA0001            771                     CMP DS:DAC_DISABLE, 1
0607 7405                  772                     JE SKIP_PAST
0609 9A5806----     R      773                     CALL FAR PTR DAC_UPDATE
                           774     
060E                       775     SKIP_PAST:              
060E 8A0E7900              776                     MOV CL, DS:REG_AL
                           777     
0612 8B1E6100              778                     MOV BX, DS:KEYPAD_INDEX
                           779                             
0616 884F51                780                     MOV DS:KEYPAD_INPUT[BX], CL
                           781                             
0619 FF066100              782                     INC DS:KEYPAD_INDEX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    20:01:04  12/07/;3  PAGE   16


LOC  OBJ                  LINE     SOURCE

                           783                             
061D 8B1E6100              784                     MOV BX, DS:KEYPAD_INDEX
                           785                     
0621 A1A800                786                     MOV AX, DS:SCROLL_LEN
0624 2BD8                  787                     SUB BX, AX
                           788                     
0626 8B166100              789                     MOV DX, DS:KEYPAD_INDEX
062A 83FA06                790                     CMP DX, 6
062D 7E03                  791                     JLE update_display
062F BA0600                792                     MOV DX, 6
                           793                     
0632                       794             update_display:
                           795             
0632 B90500                796                     MOV CX, 5
0635 4B                    797                     DEC BX
0636 8A4751                798                     MOV AL, DS:KEYPAD_INPUT[BX]
0639 43                    799                     INC BX
                           800                             
063A 52                    801                     PUSH DX
063B 8B166100              802                     MOV DX, DS:KEYPAD_INDEX
063F 2B16A800              803                     SUB DX, DS:SCROLL_LEN
                           804                     
0643 2BD3                  805                     SUB DX, BX
                           806                             
0645 53                    807                     PUSH BX
                           808                             
0646 2BCA                  809                     SUB CX, DX
0648 8BD9                  810                     MOV BX, CX
064A 884759                811                     MOV DS:BCD_MESSAGE[BX], AL
                           812                             
064D 5B                    813                     POP BX
064E 5A                    814                     POP DX
                           815             
064F 4B                    816                     DEC BX
0650 4A                    817                     DEC DX
0651 75DF                  818             JNZ update_display
                           819     
0653                       820             BCD_RET:
0653 5A                    821                     POP DX
0654 59                    822                     POP CX
0655 5B                    823                     POP BX
0656 58                    824                     POP AX
0657 CB                    825     RET
                           826     BCD_UPDATE ENDP
                           827     
0658                       828     DAC_UPDATE PROC FAR
0658 50                    829             PUSH AX
0659 53                    830             PUSH BX
065A 51                    831             PUSH CX
065B 52                    832             PUSH DX
                           833             
065C BB0000                834             MOV BX, 0
065F 8A1E7500              835             MOV BL, DS:DAC_LEN
0663 A07900                836             MOV AL, DS:REG_AL
                           837             
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    20:01:04  12/07/;3  PAGE   17


LOC  OBJ                  LINE     SOURCE

0666 884766                838             MOV DS:DAC_ADDR[BX], AL
                           839             
0669 FE067500              840             INC DS:DAC_LEN
                           841     
066D 5A                    842             POP DX
066E 59                    843             POP CX
066F 5B                    844             POP BX
0670 58                    845             POP AX
0671 CB                    846     RET
                           847     DAC_UPDATE ENDP
                           848               
0672                       849     DEBOUNCE PROC FAR
0672 51                    850                       PUSH CX
                           851                       
0673 B94C09                852                       MOV CX, 094CH
0676 90                    853     BACK:     NOP
0677 E2FD                  854                       LOOP BACK
0679 59                    855                       POP CX
067A CB                    856                       RET
                           857     DEBOUNCE  ENDP
                           858     
067B                       859     SEND_INPUT PROC FAR
067B 50                    860     PUSH AX
067C 53                    861     PUSH BX
067D 51                    862     PUSH CX
067E 52                    863     PUSH DX
067F BB0000                864             MOV BX, 0
0682 8B0E9A00              865             MOV CX, DS:SEND_BUFFER_LEN
                           866             
0686                       867             S_BUFF:
0686 8A878D00              868                     MOV AL, DS:SEND_BUFFER[BX]
068A 9A0000----     E      869                     CALL FAR PTR PRINT_CHAR
068F 43                    870                     INC BX
0690 E2F4                  871             LOOP S_BUFF
                           872             
0692                       873     SEND_INPUT_END:
0692 5A                    874     POP DX
0693 59                    875     POP CX
0694 5B                    876     POP BX
0695 58                    877     POP AX
0696 CB                    878     RET
                           879     SEND_INPUT ENDP
                           880     
0697                       881     TAKE_CASH PROC FAR
0697 50                    882     PUSH AX
0698 53                    883     PUSH BX
0699 51                    884     PUSH CX
069A 52                    885     PUSH DX
                           886             
069B B90000                887             MOV CX, 0
069E B108                  888             MOV CL, 8
06A0                       889             CLEAR_CASH_AMT:
06A0 8BD9                  890                     MOV BX, CX
06A2 4B                    891                     DEC BX
06A3 C687CA0000            892                     MOV DS:CASH_AMT[BX], 0
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    20:01:04  12/07/;3  PAGE   18


LOC  OBJ                  LINE     SOURCE

06A8 E2F6                  893             LOOP CLEAR_CASH_AMT
                           894             
06AA 8B0E6100              895             MOV CX, DS:KEYPAD_INDEX
06AE BA0600                896             MOV DX, 6
                           897             
06B1                       898             UPDATE_CASH_AMT:
06B1 8BD9                  899                     MOV BX, CX
06B3 4B                    900                     DEC BX
                           901                     
06B4 33C0                  902                     XOR AX, AX
06B6 8A4751                903                     MOV AL, DS:KEYPAD_INPUT[BX]
                           904                     
06B9 8BDA                  905                     MOV BX, DX
06BB 4B                    906                     DEC BX
06BC 8887CA00              907                     MOV DS:CASH_AMT[BX], AL
                           908                     
06C0 4A                    909                     DEC DX
06C1 E2EE                  910             LOOP UPDATE_CASH_AMT
                           911             
06C3 C706E2000100          912             MOV DS:CASH_OK_FLAG, 1
06C9 C706E4000700          913             MOV DS:BORROW_POSITION, 7
06CF B90800                914             MOV CX, 8
06D2                       915             CHECK_CASH:
06D2 BB0800                916                     MOV BX, 8
06D5 2BD9                  917                     SUB BX, CX
06D7 B80000                918                     MOV AX, 0
06DA 8A87BA00              919                     MOV AL, DS:TEMP_BCD_ARR[BX]
06DE 8A97CA00              920                     MOV DL, DS:CASH_AMT[BX]
06E2 3AD0                  921                     CMP DL, AL
06E4 741A                  922                     JE NEXT_CASH_DIGIT
                           923                     
06E6 3AD0                  924                     CMP DL, AL
06E8 7C0D                  925                     JL CASH_NOT_OK
                           926                     
06EA C706E2000100          927                     MOV DS:CASH_OK_FLAG, 1
06F0 891EE400              928                     MOV DS:BORROW_POSITION, BX
                           929                     
06F4 EB0C90                930                     JMP CHEK_CASH_DONE
                           931                     
06F7                       932                     CASH_NOT_OK:
06F7 C706E2000000          933                     MOV DS:CASH_OK_FLAG, 0
06FD EB0390                934                     JMP CHEK_CASH_DONE
                           935                     
0700                       936             NEXT_CASH_DIGIT:
0700 E2D0                  937             LOOP CHECK_CASH
                           938             
0702                       939     CHEK_CASH_DONE:
                           940             
0702 833EE20001            941             CMP DS:CASH_OK_FLAG, 1
0707 7464                  942             JE CONTINUE_CASH
0709 B90800                943             MOV CX, 8
070C C70661000000          944             MOV DS:KEYPAD_INDEX, 0
0712 C706AC000300          945             MOV DS:DECIMAL_INDEX, 3
0718                       946             RETAIN_BCD:
0718 BB0800                947                     MOV BX, 8
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    20:01:04  12/07/;3  PAGE   19


LOC  OBJ                  LINE     SOURCE

071B 2BD9                  948                     SUB BX, CX
                           949                     
071D 8A87BA00              950                     MOV AL, DS:TEMP_BCD_ARR[BX]
0721 A27900                951                     MOV DS:REG_AL, AL
                           952                     
0724 C706AA000100          953                     MOV DS:DAC_DISABLE, 1
072A 9AEC05----     R      954                     CALL FAR PTR BCD_UPDATE
072F C706AA000000          955                     MOV DS:DAC_DISABLE, 0
0735 E2E1                  956             LOOP RETAIN_BCD
0737 813E64000040          957             CMP DS:DAC_BASE, 4000H
073D 7517                  958             JNE MANDARIN_CASH
                           959             
073F C606790023            960             MOV DS:REG_AL, 35
0744 9A5806----     R      961             CALL FAR PTR DAC_UPDATE
0749 C606790024            962             MOV DS:REG_AL, 36
074E 9A5806----     R      963             CALL FAR PTR DAC_UPDATE
0753 E9B200                964             JMP CASH_OVER
                           965             
0756                       966     MANDARIN_CASH:
0756 C606790012            967             MOV DS:REG_AL, 18
075B 9A5806----     R      968             CALL FAR PTR DAC_UPDATE
0760 C606790013            969             MOV DS:REG_AL, 19
0765 9A5806----     R      970             CALL FAR PTR DAC_UPDATE
076A E99B00                971             JMP CASH_OVER
                           972             
076D                       973     CONTINUE_CASH:
076D 8B1EE400              974             MOV BX, DS:BORROW_POSITION
0771 B90700                975             MOV CX, 7
0774 2BCB                  976             SUB CX, BX
0776 83F900                977             CMP CX, 0
0779 740C                  978             JE BEGIN_SUB
                           979             
077B                       980             ADJUST_PLACES:
077B FE8FCA00              981                     DEC DS:CASH_AMT[BX]
077F 43                    982                     INC BX
0780 8087CA000A            983                     ADD DS:CASH_AMT[BX], 10
0785 E2F4                  984             LOOP ADJUST_PLACES
                           985             
0787                       986     BEGIN_SUB:
0787 B90800                987             MOV CX, 8
078A                       988             CALC_CHANGE:
078A BB0800                989                     MOV BX, 8
078D 2BD9                  990                     SUB BX, CX
078F B80000                991                     MOV AX, 0
0792 8A87CA00              992                     MOV AL, DS:CASH_AMT[BX]
0796 BA0000                993                     MOV DX, 0
0799 8A97BA00              994                     MOV DL, DS:TEMP_BCD_ARR[BX]
079D 2BC2                  995                     SUB AX, DX
079F 8987D200              996                     MOV DS:TEMP_CASH_ARR[BX], AX
07A3 E2E5                  997             LOOP CALC_CHANGE
                           998             
07A5 B90800                999             MOV CX, 8
07A8                      1000             FIX_DIGITS:
07A8 8BD9                 1001             MOV BX, CX
07AA 4B                   1002             DEC BX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    20:01:04  12/07/;3  PAGE   20


LOC  OBJ                  LINE     SOURCE

                          1003             
07AB 8B87D200             1004             MOV AX, DS:TEMP_CASH_ARR[BX]
07AF 3C0A                 1005             CMP AL, 10
07B1 7C0A                 1006             JL NEXT_DIGIT_TO_FIX
                          1007             
07B3 83AFD2000A           1008             SUB DS:TEMP_CASH_ARR[BX], 10
                          1009             
07B8 4B                   1010             DEC BX
07B9 FF87D200             1011             INC DS:TEMP_CASH_ARR[BX]
                          1012             
07BD                      1013             NEXT_DIGIT_TO_FIX:
                          1014             
07BD E2E9                 1015             LOOP FIX_DIGITS
                          1016             
07BF B90800               1017             MOV CX, 8
07C2 C70661000000         1018             MOV DS:KEYPAD_INDEX, 0
07C8 C706AC000300         1019             MOV DS:DECIMAL_INDEX, 3
07CE                      1020             UPDATE_BCD_TO_CASH:
07CE BB0800               1021                     MOV BX, 8
07D1 2BD9                 1022                     SUB BX, CX
07D3 8B87D200             1023                     MOV AX, DS:TEMP_CASH_ARR[BX]
07D7 8887BA00             1024                     MOV DS:TEMP_BCD_ARR[BX], AL
07DB A27900               1025                     MOV DS:REG_AL, AL
07DE C706AA000100         1026                     MOV DS:DAC_DISABLE, 1
07E4 9AEC05----     R     1027                     CALL FAR PTR BCD_UPDATE
07E9 C706AA000000         1028                     MOV DS:DAC_DISABLE, 0
07EF E2DD                 1029             LOOP UPDATE_BCD_TO_CASH
                          1030             
07F1 9A0D08----     R     1031             CALL FAR PTR CALC_DAC
                          1032             
07F6 C706C8000000         1033             MOV DS:CASH_FLAG, 0
07FC C706E8000100         1034             MOV DS:TRANSACTION_OVER, 1
0802 C706FA000000         1035             MOV DS:TROLLEY_DISABLED, 0
                          1036             
0808                      1037     CASH_OVER:
0808 5A                   1038     POP DX
0809 59                   1039     POP CX
080A 5B                   1040     POP BX
080B 58                   1041     POP AX
                          1042     
080C CB                   1043     RET
                          1044     TAKE_CASH ENDP
                          1045     
080D                      1046     CALC_DAC PROC FAR
080D 50                   1047     PUSH AX
080E 53                   1048     PUSH BX
080F 51                   1049     PUSH CX
0810 52                   1050     PUSH DX
0811 813E64000040         1051             CMP DS:DAC_BASE, 4000H
0817 7403                 1052             JE ENGLISH_DAC
0819 E98E01               1053             JMP MANDARIN_DAC
                          1054             
081C                      1055     ENGLISH_DAC:
081C C706C4000000         1056             MOV DS:CENT_FLAG, 0
0822 C706C2000000         1057             MOV DS:THOUSAND_FLAG, 0
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    20:01:04  12/07/;3  PAGE   21


LOC  OBJ                  LINE     SOURCE

0828 C706C6000000         1058             MOV DS:DOLLAR_FLAG,     0
082E BB0000               1059             MOV BX, 0
0831 8A87BA00             1060             MOV AL, DS:TEMP_BCD_ARR[BX]
0835 A27900               1061             MOV DS:REG_AL, AL
0838 3C00                 1062             CMP AL, 0
083A 7415                 1063             JE NEXT_PLACE
083C C706C6000100         1064             MOV DS:DOLLAR_FLAG, 1
0842 9A5806----     R     1065             CALL FAR PTR DAC_UPDATE
0847 C60679001C           1066             MOV DS:REG_AL, 28
084C 9A5806----     R     1067             CALL FAR PTR DAC_UPDATE
                          1068             
0851                      1069     NEXT_PLACE:     
0851 43                   1070             INC BX
0852 8A87BA00             1071             MOV AL, DS:TEMP_BCD_ARR[BX]
0856 3C01                 1072             CMP AL, 1
0858 751E                 1073             JNE NOT_1
085A C706C6000100         1074             MOV DS:DOLLAR_FLAG, 1
0860 43                   1075             INC BX
0861 8A87BA00             1076             MOV AL, DS:TEMP_BCD_ARR[BX]
0865 040A                 1077             ADD AL, 10
0867 A27900               1078             MOV DS:REG_AL, AL
086A 9A5806----     R     1079             CALL FAR PTR DAC_UPDATE
086F C706C2000100         1080             MOV DS:THOUSAND_FLAG, 1
0875 EB3890               1081             JMP HUNDREDS_PLACE
0878                      1082     NOT_1:
0878 3C00                 1083             CMP AL, 0
087A 7416                 1084             JE NEXT_PLACE_1
087C C706C6000100         1085             MOV DS:DOLLAR_FLAG, 1
0882 C706C2000100         1086             MOV DS:THOUSAND_FLAG, 1
0888 0412                 1087             ADD AL, 18
088A A27900               1088             MOV DS:REG_AL, AL
088D 9A5806----     R     1089             CALL FAR PTR DAC_UPDATE
0892                      1090     NEXT_PLACE_1:
0892 43                   1091             INC BX
0893 8A87BA00             1092             MOV AL, DS:TEMP_BCD_ARR[BX]
0897 3C00                 1093             CMP AL, 0
0899 7414                 1094             JE HUNDREDS_PLACE
089B C706C6000100         1095             MOV DS:DOLLAR_FLAG, 1
08A1 C706C2000100         1096             MOV DS:THOUSAND_FLAG, 1
08A7 A27900               1097             MOV DS:REG_AL, AL
08AA 9A5806----     R     1098             CALL FAR PTR DAC_UPDATE
                          1099     
08AF                      1100     HUNDREDS_PLACE:
08AF 833EC20000           1101             CMP DS:THOUSAND_FLAG, 0
08B4 7410                 1102             JE NEXT_PLACE_2
08B6 C60679001D           1103             MOV DS:REG_AL, 29
08BB 9A5806----     R     1104             CALL FAR PTR DAC_UPDATE
08C0 C706C2000000         1105             MOV DS:THOUSAND_FLAG, 0
                          1106             
08C6                      1107     NEXT_PLACE_2:
08C6 43                   1108             INC BX
08C7 8A87BA00             1109             MOV AL, DS:TEMP_BCD_ARR[BX]
08CB 3C00                 1110             CMP AL, 0
08CD 7418                 1111             JE NEXT_PLACE_3
08CF C706C6000100         1112             MOV DS:DOLLAR_FLAG, 1
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    20:01:04  12/07/;3  PAGE   22


LOC  OBJ                  LINE     SOURCE

08D5 A27900               1113             MOV DS:REG_AL, AL
08D8 9A5806----     R     1114             CALL FAR PTR DAC_UPDATE
08DD C60679001C           1115             MOV DS:REG_AL, 28
08E2 9A5806----     R     1116             CALL FAR PTR DAC_UPDATE
                          1117             
08E7                      1118     NEXT_PLACE_3:   
08E7 43                   1119             INC BX
08E8 8A87BA00             1120             MOV AL, DS:TEMP_BCD_ARR[BX]
08EC 3C01                 1121             CMP AL, 1
08EE 7518                 1122             JNE NOT_1_2
08F0 C706C6000100         1123             MOV DS:DOLLAR_FLAG, 1
08F6 43                   1124             INC BX
08F7 8A87BA00             1125             MOV AL, DS:TEMP_BCD_ARR[BX]
08FB 040A                 1126             ADD AL, 10
08FD A27900               1127             MOV DS:REG_AL, AL
0900 9A5806----     R     1128             CALL FAR PTR DAC_UPDATE
0905 EB2C90               1129             JMP DECIMAL_DAC
0908                      1130     NOT_1_2:
0908 3C00                 1131             CMP AL, 0
090A 7410                 1132             JE NEXT_PLACE_4
090C C706C6000100         1133             MOV DS:DOLLAR_FLAG, 1
0912 0412                 1134             ADD AL, 18
0914 A27900               1135             MOV DS:REG_AL, AL
0917 9A5806----     R     1136             CALL FAR PTR DAC_UPDATE
091C                      1137     NEXT_PLACE_4:
091C 43                   1138             INC BX
091D 8A87BA00             1139             MOV AL, DS:TEMP_BCD_ARR[BX]
0921 3C00                 1140             CMP AL, 0
0923 740E                 1141             JE DECIMAL_DAC
0925 C706C6000100         1142             MOV DS:DOLLAR_FLAG, 1
092B A27900               1143             MOV DS:REG_AL, AL
092E 9A5806----     R     1144             CALL FAR PTR DAC_UPDATE
                          1145             
0933                      1146     DECIMAL_DAC:
0933 833EC60000           1147             CMP DS:DOLLAR_FLAG, 0
0938 740A                 1148             JE DECIMAL_DAC_CONT
093A C60679001E           1149             MOV DS:REG_AL, 30
093F 9A5806----     R     1150             CALL FAR PTR DAC_UPDATE
                          1151             
0944                      1152     DECIMAL_DAC_CONT:
0944 43                   1153             INC BX
0945 8A87BA00             1154             MOV AL, DS:TEMP_BCD_ARR[BX]
0949 3C01                 1155             CMP AL, 1
094B 7518                 1156             JNE NOT_1_3
094D 43                   1157             INC BX
094E C706C4000100         1158             MOV DS:CENT_FLAG, 1
0954 8A87BA00             1159             MOV AL, DS:TEMP_BCD_ARR[BX]
0958 040A                 1160             ADD AL, 10
095A A27900               1161             MOV DS:REG_AL, AL
095D 9A5806----     R     1162             CALL FAR PTR DAC_UPDATE
0962 EB2C90               1163             JMP ENGLISH_END
                          1164             
0965                      1165     NOT_1_3:
0965 3C00                 1166             CMP AL, 0
0967 7410                 1167             JE NEXT_PLACE_5
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    20:01:04  12/07/;3  PAGE   23


LOC  OBJ                  LINE     SOURCE

0969 C706C4000100         1168             MOV DS:CENT_FLAG, 1
096F 0412                 1169             ADD AL, 18
0971 A27900               1170             MOV DS:REG_AL, AL
0974 9A5806----     R     1171             CALL FAR PTR DAC_UPDATE
                          1172             
0979                      1173     NEXT_PLACE_5:
0979 43                   1174             INC BX
097A 8A87BA00             1175             MOV AL, DS:TEMP_BCD_ARR[BX]
097E 3C00                 1176             CMP AL, 0
0980 740E                 1177             JE ENGLISH_END
0982 C706C4000100         1178             MOV DS:CENT_FLAG, 1
0988 A27900               1179             MOV DS:REG_AL, AL
098B 9A5806----     R     1180             CALL FAR PTR DAC_UPDATE
                          1181             
0990                      1182     ENGLISH_END:
0990 833EC40000           1183             CMP DS:CENT_FLAG, 0
0995 7410                 1184             JE ENGLISH_END2
0997 C60679001F           1185             MOV DS:REG_AL, 31
099C 9A5806----     R     1186             CALL FAR PTR DAC_UPDATE
09A1 C706C4000000         1187             MOV DS:CENT_FLAG, 0
09A7                      1188     ENGLISH_END2:
09A7 E9CE01               1189             JMP CONT_BCD_UPD_1
                          1190             
09AA                      1191     MANDARIN_DAC:
09AA C706C4000000         1192             MOV DS:CENT_FLAG, 0
09B0 C706C2000000         1193             MOV DS:THOUSAND_FLAG, 0
09B6 C706FC000000         1194             MOV DS:TEN_THOUSAND_FLAG, 0
09BC C706FE000000         1195             MOV DS:ZERO_TELL, 0
09C2 C706C6000000         1196             MOV DS:DOLLAR_FLAG,     0
09C8 BB0000               1197             MOV BX, 0
09CB 8A87BA00             1198             MOV AL, DS:TEMP_BCD_ARR[BX]
09CF 3C00                 1199             CMP AL, 0
09D1 7424                 1200             JE NEXT_PLACE_6
09D3 C706C6000100         1201             MOV DS:DOLLAR_FLAG, 1
09D9 C706FC000100         1202             MOV DS:TEN_THOUSAND_FLAG, 1
09DF C706C2000000         1203             MOV DS:THOUSAND_FLAG, 0
09E5 A27900               1204             MOV DS:REG_AL, AL
09E8 9A5806----     R     1205             CALL FAR PTR DAC_UPDATE
09ED C60679000A           1206             MOV DS:REG_AL, 10
09F2 9A5806----     R     1207             CALL FAR PTR DAC_UPDATE
                          1208             
09F7                      1209     NEXT_PLACE_6:
09F7 43                   1210             INC BX
09F8 8A87BA00             1211             MOV AL, DS:TEMP_BCD_ARR[BX]
09FC 3C00                 1212             CMP AL, 0
09FE 741A                 1213             JE NEXT_PLACE_7
0A00 C706C6000100         1214             MOV DS:DOLLAR_FLAG, 1
0A06 C706FC000100         1215             MOV DS:TEN_THOUSAND_FLAG, 1
0A0C C706C2000000         1216             MOV DS:THOUSAND_FLAG, 0
0A12 A27900               1217             MOV DS:REG_AL, AL
0A15 9A5806----     R     1218             CALL FAR PTR DAC_UPDATE
                          1219             
0A1A                      1220     NEXT_PLACE_7:
0A1A 833EFC0001           1221             CMP DS:TEN_THOUSAND_FLAG, 1
0A1F 750A                 1222             JNE NO_TEN_THOUSAND
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    20:01:04  12/07/;3  PAGE   24


LOC  OBJ                  LINE     SOURCE

0A21 C60679000D           1223             MOV DS:REG_AL, 13
0A26 9A5806----     R     1224             CALL FAR PTR DAC_UPDATE
0A2B                      1225     NO_TEN_THOUSAND:
0A2B 43                   1226             INC BX
0A2C 8A87BA00             1227             MOV AL, DS:TEMP_BCD_ARR[BX]
0A30 3C00                 1228             CMP AL, 0
0A32 7509                 1229             JNE CONTINUE_MAND
0A34 C706FE000100         1230             MOV DS:ZERO_TELL, 1
0A3A EB1590               1231             JMP NEXT_PLACE_8
0A3D                      1232     CONTINUE_MAND:  
0A3D C706C6000100         1233             MOV DS:DOLLAR_FLAG, 1
0A43 C706C2000100         1234             MOV DS:THOUSAND_FLAG, 1
                          1235     
0A49 A27900               1236             MOV DS:REG_AL, AL
0A4C 9A5806----     R     1237             CALL FAR PTR DAC_UPDATE
                          1238     
0A51                      1239     NEXT_PLACE_8:
0A51 833EC20000           1240             CMP DS:THOUSAND_FLAG, 0
0A56 7410                 1241             JE IGNORE_THOUSAND
0A58 C60679000C           1242             MOV DS:REG_AL, 12
0A5D 9A5806----     R     1243             CALL FAR PTR DAC_UPDATE
0A62 C706C2000000         1244             MOV DS:THOUSAND_FLAG, 0
                          1245             
0A68                      1246     IGNORE_THOUSAND:
0A68 43                   1247             INC BX
0A69 8A87BA00             1248             MOV AL, DS:TEMP_BCD_ARR[BX]
0A6D 3C00                 1249             CMP AL, 0
0A6F 7509                 1250             JNE CONTINUE_MAND1
0A71 C706FE000100         1251             MOV DS:ZERO_TELL, 1
0A77 EB3090               1252             JMP NEXT_PLACE_9
0A7A                      1253     CONTINUE_MAND1:
0A7A 833EFE0001           1254             CMP DS:ZERO_TELL, 1
0A7F 7510                 1255             JNE DONT_ZERO
0A81 C606790000           1256             MOV DS:REG_AL, 0
0A86 9A5806----     R     1257             CALL FAR PTR DAC_UPDATE
0A8B C706FE000000         1258             MOV DS:ZERO_TELL, 0
0A91                      1259     DONT_ZERO:
0A91 C706C6000100         1260             MOV DS:DOLLAR_FLAG, 1
0A97 A27900               1261             MOV DS:REG_AL, AL
0A9A 9A5806----     R     1262             CALL FAR PTR DAC_UPDATE
0A9F C60679000B           1263             MOV DS:REG_AL, 11
0AA4 9A5806----     R     1264             CALL FAR PTR DAC_UPDATE
                          1265             
0AA9                      1266     NEXT_PLACE_9:
0AA9 43                   1267             INC BX
0AAA 8A87BA00             1268             MOV AL, DS:TEMP_BCD_ARR[BX]
0AAE 3C00                 1269             CMP AL, 0
0AB0 7509                 1270             JNE CONTINUE_MAND2
0AB2 C706FE000100         1271             MOV DS:ZERO_TELL, 1
0AB8 EB3090               1272             JMP NEXT_PLACE_10
0ABB                      1273     CONTINUE_MAND2:
0ABB 833EFE0001           1274             CMP DS:ZERO_TELL, 1
0AC0 7510                 1275             JNE DONT_ZERO1
0AC2 C606790000           1276             MOV DS:REG_AL, 0
0AC7 9A5806----     R     1277             CALL FAR PTR DAC_UPDATE
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    20:01:04  12/07/;3  PAGE   25


LOC  OBJ                  LINE     SOURCE

0ACC C706FE000000         1278             MOV DS:ZERO_TELL, 0
0AD2                      1279     DONT_ZERO1:
0AD2 C706C6000100         1280             MOV DS:DOLLAR_FLAG, 1
0AD8 A27900               1281             MOV DS:REG_AL, AL
0ADB 9A5806----     R     1282             CALL FAR PTR DAC_UPDATE
0AE0 C60679000A           1283             MOV DS:REG_AL, 10
0AE5 9A5806----     R     1284             CALL FAR PTR DAC_UPDATE
                          1285             
0AEA                      1286     NEXT_PLACE_10:
0AEA 43                   1287             INC BX
0AEB 8A87BA00             1288             MOV AL, DS:TEMP_BCD_ARR[BX]
0AEF 3C00                 1289             CMP AL, 0
0AF1 7425                 1290             JE MANDARIN_DEC
0AF3 833EFE0001           1291             CMP DS:ZERO_TELL, 1
0AF8 7510                 1292             JNE DONT_ZERO2
0AFA C606790000           1293             MOV DS:REG_AL, 0
0AFF 9A5806----     R     1294             CALL FAR PTR DAC_UPDATE
0B04 C706FE000000         1295             MOV DS:ZERO_TELL, 0
0B0A                      1296     DONT_ZERO2:
0B0A C706C6000100         1297             MOV DS:DOLLAR_FLAG, 1
0B10 A27900               1298             MOV DS:REG_AL, AL
0B13 9A5806----     R     1299             CALL FAR PTR DAC_UPDATE
                          1300             
0B18                      1301     MANDARIN_DEC:
0B18 833EC60000           1302             CMP DS:DOLLAR_FLAG, 0
0B1D 740A                 1303             JE MANDARIN_DAC_CONT
0B1F C60679000E           1304             MOV DS:REG_AL, 14
0B24 9A5806----     R     1305             CALL FAR PTR DAC_UPDATE
0B29                      1306     MANDARIN_DAC_CONT:
0B29 43                   1307             INC BX
0B2A 8A87BA00             1308             MOV AL, DS:TEMP_BCD_ARR[BX]
0B2E 3C00                 1309             CMP AL, 0
0B30 7418                 1310             JE NEXT_PLACE_11
0B32 C706C4000100         1311             MOV DS:CENT_FLAG, 1
0B38 A27900               1312             MOV DS:REG_AL, AL
0B3B 9A5806----     R     1313             CALL FAR PTR DAC_UPDATE
0B40 C60679000A           1314             MOV DS:REG_AL, 10
0B45 9A5806----     R     1315             CALL FAR PTR DAC_UPDATE
                          1316             
0B4A                      1317     NEXT_PLACE_11:
                          1318     
0B4A 43                   1319             INC BX
0B4B 8A87BA00             1320             MOV AL, DS:TEMP_BCD_ARR[BX]
0B4F 3C00                 1321             CMP AL, 0
0B51 740E                 1322             JE CONT_BCD_UPD
0B53 C706C4000100         1323             MOV DS:CENT_FLAG, 1
0B59 A27900               1324             MOV DS:REG_AL, AL
0B5C 9A5806----     R     1325             CALL FAR PTR DAC_UPDATE
                          1326             
0B61                      1327     CONT_BCD_UPD:
0B61 833EC40000           1328             CMP DS:CENT_FLAG, 0
0B66 7410                 1329             JE CONT_BCD_UPD_1
0B68 C60679000F           1330             MOV DS:REG_AL, 15
0B6D 9A5806----     R     1331             CALL FAR PTR DAC_UPDATE
0B72 C706C4000000         1332             MOV DS:CENT_FLAG, 0
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    20:01:04  12/07/;3  PAGE   26


LOC  OBJ                  LINE     SOURCE

                          1333     
0B78                      1334     CONT_BCD_UPD_1:
                          1335             
0B78 5A                   1336     POP DX
0B79 59                   1337     POP CX
0B7A 5B                   1338     POP BX
0B7B 58                   1339     POP AX
0B7C CB                   1340     RET
                          1341     CALC_DAC ENDP
                          1342     
0B7D                      1343     CALC_UPD_PRICE PROC FAR
0B7D 50                   1344     PUSH AX
0B7E 53                   1345     PUSH BX
0B7F 51                   1346     PUSH CX
0B80 52                   1347     PUSH DX
0B81 833EB20000           1348             CMP DS:QTY, 0
0B86 7503                 1349             JNE CHECK_PRICE_ZERO
0B88 E92B01               1350             JMP CALC_END
0B8B                      1351     CHECK_PRICE_ZERO:
0B8B 833EB00000           1352             CMP DS:PRICE, 0
0B90 7503                 1353             JNE START_CALC
0B92 E92101               1354             JMP CALC_END
0B95                      1355     START_CALC:
0B95 BA0000               1356             MOV DX, 0
0B98 A1B000               1357             MOV AX, DS:PRICE
0B9B 8B1EB200             1358             MOV BX, DS:QTY
0B9F F7E3                 1359             MUL BX
                          1360             
0BA1 BB6400               1361             MOV BX, 100
0BA4 F7F3                 1362             DIV BX
0BA6 A3B000               1363             MOV DS:PRICE, AX
0BA9 A1B800               1364             MOV AX, DS:TOTAL_PRICE_DEC
0BAC 03C2                 1365             ADD AX, DX
0BAE 3D6400               1366             CMP AX, 100
0BB1 7C07                 1367             JL NON_DECIMAL
0BB3 FF06B600             1368             INC DS:TOTAL_PRICE_L
0BB7 2D6400               1369             SUB AX, 100
                          1370             
0BBA                      1371     NON_DECIMAL:    
0BBA A3B800               1372             MOV DS:TOTAL_PRICE_DEC, AX
0BBD A1B600               1373             MOV AX, DS:TOTAL_PRICE_L
0BC0 8B1EB000             1374             MOV BX, DS:PRICE
0BC4 03C3                 1375             ADD AX, BX
0BC6 7304                 1376             JNC update_normal
0BC8 FF06B400             1377             INC DS:TOTAL_PRICE_U
                          1378             
0BCC                      1379     update_normal:
0BCC A3B600               1380             MOV DS:TOTAL_PRICE_L, AX
                          1381             
0BCF BA0000               1382             MOV DX, 0
                          1383             ;CMP DS:TOTAL_PRICE_DEC, 9
                          1384             ;JG DECIMAL_CONT
                          1385             ;MOV CX, 10
                          1386             ;MOV AX, DS:TOTAL_PRICE_DEC
                          1387             ;MUL CX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    20:01:04  12/07/;3  PAGE   27


LOC  OBJ                  LINE     SOURCE

                          1388             ;MOV DS:TOTAL_PRICE_DEC, AX
                          1389     ;DECIMAL_CONT:
0BD2 A1B800               1390             MOV AX, DS:TOTAL_PRICE_DEC
0BD5 B90A00               1391             MOV CX, 10
0BD8 F7F1                 1392             DIV CX
                          1393             
0BDA BB0700               1394             MOV BX, 7
0BDD 8897BA00             1395             MOV DS:TEMP_BCD_ARR[BX], DL
0BE1 4B                   1396             DEC BX
0BE2 8887BA00             1397             MOV DS:TEMP_BCD_ARR[BX], AL
                          1398             
0BE6 BB0600               1399             MOV BX, 6
0BE9 A1B600               1400             MOV AX, DS:TOTAL_PRICE_L
                          1401             
0BEC                      1402             TEMP_UPD_LOOP:
0BEC BA0000               1403                     MOV DX, 0
0BEF B90A00               1404                     MOV CX, 10
0BF2 F7F1                 1405                     DIV CX
                          1406                     
0BF4 4B                   1407                     DEC BX
0BF5 8897BA00             1408                     MOV DS:TEMP_BCD_ARR[BX], DL
0BF9 43                   1409                     INC BX
                          1410                     
0BFA 4B                   1411                     DEC BX
                          1412                     
0BFB 75EF                 1413             JNZ TEMP_UPD_LOOP
                          1414             
0BFD 8B0EB400             1415             MOV CX, DS:TOTAL_PRICE_U
0C01 83F900               1416             CMP CX, 0
0C04 7478                 1417             JE upd_dac_part
0C06                      1418             ADD_EXTRA_PART:
0C06 BB0500               1419                     MOV BX, 5
0C09 8A87BA00             1420                     MOV AL, DS:TEMP_BCD_ARR[BX]
0C0D 0406                 1421                     ADD AL, 6
0C0F 3C09                 1422                     CMP AL, 9
0C11 7E08                 1423                     JLE CONT_DIGIT_1
0C13 2C0A                 1424                     SUB AL, 10
0C15 4B                   1425                     DEC BX
0C16 FE87BA00             1426                     INC DS:TEMP_BCD_ARR[BX]
0C1A 43                   1427                     INC BX
0C1B                      1428             CONT_DIGIT_1:
0C1B 8887BA00             1429                     MOV DS:TEMP_BCD_ARR[BX], AL
0C1F 4B                   1430                     DEC BX
                          1431                     
0C20 8A87BA00             1432                     MOV AL, DS:TEMP_BCD_ARR[BX]
0C24 0403                 1433                     ADD AL, 3
0C26 3C09                 1434                     CMP AL, 9
0C28 7E08                 1435                     JLE CONT_DIGIT_2
0C2A 2C0A                 1436                     SUB AL, 10
0C2C 4B                   1437                     DEC BX
0C2D FE87BA00             1438                     INC DS:TEMP_BCD_ARR[BX]
0C31 43                   1439                     INC BX
0C32                      1440             CONT_DIGIT_2:
0C32 8887BA00             1441                     MOV DS:TEMP_BCD_ARR[BX], AL
0C36 4B                   1442                     DEC BX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    20:01:04  12/07/;3  PAGE   28


LOC  OBJ                  LINE     SOURCE

                          1443                     
0C37 8A87BA00             1444                     MOV AL, DS:TEMP_BCD_ARR[BX]
0C3B 0405                 1445                     ADD AL, 5
0C3D 3C09                 1446                     CMP AL, 9
0C3F 7E08                 1447                     JLE CONT_DIGIT_3
0C41 2C0A                 1448                     SUB AL, 10
0C43 4B                   1449                     DEC BX
0C44 FE87BA00             1450                     INC DS:TEMP_BCD_ARR[BX]
0C48 43                   1451                     INC BX
0C49                      1452             CONT_DIGIT_3:
0C49 8887BA00             1453                     MOV DS:TEMP_BCD_ARR[BX], AL
0C4D 4B                   1454                     DEC BX
                          1455                     
                          1456                     
0C4E 8A87BA00             1457                     MOV AL, DS:TEMP_BCD_ARR[BX]
0C52 0405                 1458                     ADD AL, 5
0C54 3C09                 1459                     CMP AL, 9
0C56 7E08                 1460                     JLE CONT_DIGIT_4
0C58 2C0A                 1461                     SUB AL, 10
0C5A 4B                   1462                     DEC BX
0C5B FE87BA00             1463                     INC DS:TEMP_BCD_ARR[BX]
0C5F 43                   1464                     INC BX
0C60                      1465             CONT_DIGIT_4:
0C60 8887BA00             1466                     MOV DS:TEMP_BCD_ARR[BX], AL
0C64 4B                   1467                     DEC BX
                          1468                     
0C65 8A87BA00             1469                     MOV AL, DS:TEMP_BCD_ARR[BX]
0C69 0406                 1470                     ADD AL, 6
0C6B 3C09                 1471                     CMP AL, 9
0C6D 7E08                 1472                     JLE CONT_DIGIT_5
0C6F 2C0A                 1473                     SUB AL, 10
0C71 4B                   1474                     DEC BX
0C72 FE87BA00             1475                     INC DS:TEMP_BCD_ARR[BX]
0C76 43                   1476                     INC BX
0C77                      1477             CONT_DIGIT_5:
0C77 8887BA00             1478                     MOV DS:TEMP_BCD_ARR[BX], AL
0C7B 4B                   1479                     DEC BX
                          1480                     
0C7C E288                 1481             LOOP ADD_EXTRA_PART
                          1482             
0C7E                      1483     upd_dac_part:
0C7E 9A0D08----     R     1484             CALL FAR PTR CALC_DAC
                          1485     
0C83 9AC105----     R     1486             CALL FAR PTR BCD_CLEAR
0C88 C70661000000         1487             MOV DS:KEYPAD_INDEX, 0
0C8E C706AC000300         1488             MOV DS:DECIMAL_INDEX, 3
0C94 B90800               1489             MOV CX, 8
0C97                      1490             UPD_BCD:
0C97 BB0800               1491                     MOV BX, 8
0C9A 2BD9                 1492                     SUB BX, CX
0C9C 8A87BA00             1493                     MOV AL, DS:TEMP_BCD_ARR[BX]
0CA0 A27900               1494                     MOV DS:REG_AL, AL
0CA3 C706AA000100         1495                     MOV DS:DAC_DISABLE, 1
0CA9 9AEC05----     R     1496                     CALL FAR PTR BCD_UPDATE
0CAE C706AA000000         1497                     MOV DS:DAC_DISABLE, 0
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    20:01:04  12/07/;3  PAGE   29


LOC  OBJ                  LINE     SOURCE

0CB4 E2E1                 1498             LOOP UPD_BCD
                          1499             
0CB6                      1500     CALC_END:
0CB6 833EB00000           1501             CMP DS:PRICE, 0
0CBB 7403                 1502             JE RETAIN_BCD_VALUE
0CBD EB2F90               1503             JMP END_CALC_BCD_DAC
                          1504             
0CC0                      1505     RETAIN_BCD_VALUE:       
0CC0 C70661000000         1506             MOV DS:KEYPAD_INDEX, 0
0CC6 C706AC000300         1507             MOV DS:DECIMAL_INDEX, 3
0CCC B90800               1508             MOV CX, 8
0CCF                      1509             UPD_BCD1:
0CCF BB0800               1510                     MOV BX, 8
0CD2 2BD9                 1511                     SUB BX, CX
0CD4 8A87BA00             1512                     MOV AL, DS:TEMP_BCD_ARR[BX]
0CD8 A27900               1513                     MOV DS:REG_AL, AL
0CDB C706AA000100         1514                     MOV DS:DAC_DISABLE, 1
0CE1 9AEC05----     R     1515                     CALL FAR PTR BCD_UPDATE
0CE6 C706AA000000         1516                     MOV DS:DAC_DISABLE, 0
0CEC E2E1                 1517             LOOP UPD_BCD1
                          1518     
0CEE                      1519     END_CALC_BCD_DAC:
0CEE C706B0000000         1520             MOV DS:PRICE, 0
0CF4 C706B2000000         1521             MOV DS:QTY, 0
0CFA 5A                   1522     POP DX
0CFB 59                   1523     POP CX
0CFC 5B                   1524     POP BX
0CFD 58                   1525     POP AX
0CFE CB                   1526     RET
                          1527     CALC_UPD_PRICE ENDP
                          1528     
0CFF                      1529     UPDATE_TROLLEY PROC FAR
0CFF 50                   1530     PUSH AX
0D00 53                   1531     PUSH BX
0D01 51                   1532     PUSH CX
0D02 52                   1533     PUSH DX
0D03 B90800               1534             MOV CX, 8
0D06                      1535             CLEAR_TEMP_BCD_TROLLEY:
0D06 8BD9                 1536                     MOV BX, CX
0D08 4B                   1537                     DEC BX
0D09 C687BA0000           1538                     MOV DS:TEMP_BCD_ARR[BX], 0
0D0E E2F6                 1539             LOOP CLEAR_TEMP_BCD_TROLLEY
                          1540             
0D10 8B0EF400             1541             MOV CX, DS:TROLLEY_INDEX
0D14 BA0800               1542             MOV DX, 8
                          1543             
0D17                      1544             UPD_TROLLEY_PRICE:
0D17 8BD9                 1545                     MOV BX, CX
0D19 4B                   1546                     DEC BX
                          1547                     
0D1A 8A87EC00             1548                     MOV AL, DS:TROLLEY_ARRAY[BX]
                          1549                     
0D1E 8BDA                 1550                     MOV BX, DX
0D20 4B                   1551                     DEC BX
                          1552                     
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    20:01:04  12/07/;3  PAGE   30


LOC  OBJ                  LINE     SOURCE

0D21 8887BA00             1553                     MOV DS:TEMP_BCD_ARR[BX], AL
                          1554                     
0D25 4A                   1555                     DEC DX
0D26 E2EF                 1556             LOOP UPD_TROLLEY_PRICE
                          1557             
0D28 B90800               1558             MOV CX, 8
0D2B C70661000000         1559             MOV DS:KEYPAD_INDEX, 0
0D31                      1560             UPDATE_TROLLEY_PRICE_DISPLAY:
0D31 BB0800               1561                     MOV BX, 8
0D34 2BD9                 1562                     SUB BX, CX
0D36 8A87BA00             1563                     MOV AL, DS:TEMP_BCD_ARR[BX]
0D3A A27900               1564                     MOV DS:REG_AL, AL
0D3D C706AA000100         1565                     MOV DS:DAC_DISABLE, 1
0D43 9AEC05----     R     1566                     CALL FAR PTR BCD_UPDATE
0D48 C706AA000000         1567                     MOV DS:DAC_DISABLE, 0
0D4E E2E1                 1568             LOOP UPDATE_TROLLEY_PRICE_DISPLAY
                          1569             
0D50 9A0D08----     R     1570             CALL FAR PTR CALC_DAC
                          1571     
0D55 5A                   1572     POP DX
0D56 59                   1573     POP CX
0D57 5B                   1574     POP BX
0D58 5A                   1575     POP DX
0D59 CB                   1576     RET
                          1577     UPDATE_TROLLEY ENDP
                          1578     ; ^^^^^^^^^^^^^^^ End of User main routine ^^^^^^^^^^^^^^^^^^^^^^^^^
0D5A                      1579     SERIAL_REC_ACTION       PROC    FAR
0D5A 51                   1580                     PUSH    CX
0D5B 53                   1581                     PUSH    BX
0D5C 1E                   1582                     PUSH    DS
                          1583                     
0D5D BB----         R     1584                     MOV     BX,DATA_SEG             ;initialize data segment register
0D60 8EDB                 1585                     MOV     DS,BX
                          1586                     
0D62 803E8B0001           1587                     CMP DS:REPLY_FLAG, 1
0D67 7557                 1588                     JNE next_id1
                          1589                     
0D69 803E8C0001           1590                     CMP DS:SEND_FLAG, 1
0D6E 7453                 1591                     JE send_input_across1
                          1592                     
0D70 833EA00001           1593                     CMP DS:RECEIVE_FLAG, 1
0D75 754F                 1594                     JNE terminate_session3
                          1595                     
0D77 3C2F                 1596                     CMP AL, '/'
0D79 752C                 1597                     JNE CHECK_SEND
0D7B C706A4000000         1598                     MOV DS:PRICE_FLAG, 0
0D81 C706A0000000         1599                     MOV DS:RECEIVE_FLAG, 0
0D87 C706AE000100         1600                     MOV DS:LANG_FLAG, 1
0D8D 833EF60000           1601                     CMP DS:TROLLEY_FLAG, 0
0D92 7405                 1602                     JE TROLLEY_UPD_SKIP
0D94 9AFF0C----     R     1603                     CALL FAR PTR UPDATE_TROLLEY
0D99                      1604             TROLLEY_UPD_SKIP:
0D99 C706F6000000         1605                     MOV DS:TROLLEY_FLAG, 0
0D9F 9A7D0B----     R     1606                     CALL FAR PTR CALC_UPD_PRICE
0DA4 EB2090               1607                     JMP terminate_session3
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    20:01:04  12/07/;3  PAGE   31


LOC  OBJ                  LINE     SOURCE

                          1608             
0DA7                      1609             CHECK_SEND:
0DA7 3C26                 1610                     CMP AL, '&'
0DA9 751E                 1611                     JNE TROLLEY_PRICE
0DAB C706A4000100         1612                     MOV DS:PRICE_FLAG, 1
0DB1 C70661000000         1613                     MOV DS:KEYPAD_INDEX, 0
0DB7 C7069C000800         1614                     MOV DS:MAX_INPUT_SIZE, 8
0DBD E9E300               1615                     JMP id_skip2
                          1616             
                          1617             
0DC0                      1618             next_id1:
0DC0 E9E300               1619                     JMP next_id
                          1620                     
0DC3                      1621             send_input_across1:
0DC3 E9C100               1622                     JMP send_input_across
                          1623             
0DC6                      1624             terminate_session3:
0DC6 E9D700               1625                     JMP terminate_session2
                          1626             
                          1627                     
0DC9                      1628             TROLLEY_PRICE:
0DC9 3C2B                 1629                     CMP AL, '+'
0DCB 7515                 1630                     JNE receive_price
0DCD C7069C000800         1631                     MOV DS:MAX_INPUT_SIZE, 8
0DD3 C706F6000100         1632                     MOV DS:TROLLEY_FLAG, 1
0DD9 C706F4000000         1633                     MOV DS:TROLLEY_INDEX, 0
0DDF E9C100               1634                     JMP id_skip2
                          1635                     
0DE2                      1636             receive_price:
0DE2 3C23                 1637                     CMP AL, '#'
0DE4 7543                 1638                     JNE check_price
0DE6 C706A2000100         1639                     MOV DS:DAC_FLAG, 1
0DEC C706A4000000         1640                     MOV DS:PRICE_FLAG, 0
0DF2 C706B0000000         1641                     MOV DS:PRICE, 0
0DF8 833EF60000           1642                     CMP DS:TROLLEY_FLAG, 0
0DFD 7421                 1643                     JE TROLLEY_UPD_SKIP2
0DFF 9AFF0C----     R     1644                     CALL FAR PTR UPDATE_TROLLEY
                          1645                     ;CLEAN STATE
0E04 C706AC000300         1646                     MOV DS:DECIMAL_INDEX, 3
0E0A 9AC105----     R     1647                     CALL FAR PTR BCD_CLEAR
0E0F C7069C000000         1648                     MOV DS:MAX_INPUT_SIZE, 0
0E15 9A7F04----     R     1649                     CALL FAR PTR CLEAR_TEMP_BCD
                          1650                     
0E1A C706C8000000         1651                     MOV DS:CASH_FLAG, 0
                          1652                     
0E20                      1653             TROLLEY_UPD_SKIP2:
0E20 C706F6000000         1654                     MOV DS:TROLLEY_FLAG, 0
                          1655                     
0E26 EB7B90               1656                     JMP id_skip2
                          1657             
0E29                      1658             check_price:    
                          1659             
0E29 833EA40001           1660                     CMP DS:PRICE_FLAG, 1
0E2E 7440                 1661                     JE update_price_value
                          1662                     
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    20:01:04  12/07/;3  PAGE   32


LOC  OBJ                  LINE     SOURCE

0E30 833EF60001           1663                     CMP DS:TROLLEY_FLAG, 1
0E35 7428                 1664                     JE update_trolley_arr
                          1665                     
0E37 833EA20001           1666                     CMP DS:DAC_FLAG, 1
0E3C 7403                 1667                     JE dac_change
0E3E EB6390               1668                     JMP id_skip2
                          1669     
0E41                      1670             dac_change:
0E41 8A1E7900             1671                     MOV BL, DS:REG_AL
0E45 2C30                 1672                     SUB AL, 30H
0E47 A27900               1673                     MOV DS:REG_AL, AL
0E4A 9A5806----     R     1674                     CALL FAR PTR DAC_UPDATE
0E4F 881E7900             1675                     MOV DS:REG_AL, BL
0E53 C706A2000000         1676                     MOV DS:DAC_FLAG, 0
0E59 EB4890               1677                     JMP id_skip2
                          1678             
                          1679     
0E5C EB4590               1680             id_skip3: JMP id_skip2
                          1681             
0E5F                      1682             update_trolley_arr:
0E5F 8B1EF400             1683                     MOV BX, DS:TROLLEY_INDEX
0E63 2C30                 1684                     SUB AL, 30H
0E65 8887EC00             1685                     MOV DS:TROLLEY_ARRAY[BX], AL
0E69 FF06F400             1686                     INC DS:TROLLEY_INDEX
0E6D EB3490               1687                     JMP id_skip2
                          1688                     
0E70                      1689             update_price_value:
0E70 2C30                 1690                     SUB AL, 30H
0E72 B90000               1691                     MOV CX, 0
0E75 8AC8                 1692                     MOV CL, AL
0E77 A1B000               1693                     MOV AX, DS:PRICE
0E7A BB0A00               1694                     MOV BX, 10
0E7D F7E3                 1695                     MUL BX
                          1696                     
0E7F 03C1                 1697                     ADD AX, CX
0E81 A3B000               1698                     MOV DS:PRICE, AX
0E84 EB1D90               1699                     JMP id_skip2
                          1700                     
0E87                      1701             send_input_across:
0E87 9A7B06----     R     1702                     CALL FAR PTR SEND_INPUT
                          1703                     
0E8C C7069A000000         1704                     MOV DS:SEND_BUFFER_LEN, 0
                          1705                     
0E92 C6068C0000           1706                     MOV DS:SEND_FLAG, 0
                          1707                     
0E97 C706A0000100         1708                     MOV DS:RECEIVE_FLAG, 1
                          1709                     
0E9D EB0490               1710                     JMP id_skip2
                          1711                     
0EA0 EB3E90               1712                     terminate_session2: JMP terminate_session
0EA3 EB6790               1713                     id_skip2: JMP id_skip
                          1714                     
0EA6                      1715             next_id:
                          1716                     
0EA6 803E810001           1717                     CMP DS:ID_FLAG_r, 1
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    20:01:04  12/07/;3  PAGE   33


LOC  OBJ                  LINE     SOURCE

0EAB 7513                 1718                     JNE id_flag_label
0EAD 38067F00             1719                     CMP DS:MY_ID[1], AL
0EB1 7559                 1720                     JNE id_skip
                          1721                     ;start writing to pc
0EB3 C6068B0001           1722                     MOV DS:REPLY_FLAG, 1
0EB8 C606810000           1723                     MOV DS:ID_FLAG_r, 0
0EBD EB4D90               1724                     JMP id_skip
                          1725             
0EC0                      1726             id_flag_label:
                          1727             
0EC0 803E800001           1728                     CMP DS:ID_FLAG_@, 1
0EC5 7539                 1729                     JNE protocol_rec
0EC7 3C72                 1730                     CMP AL,'r'
0EC9 750D                 1731                     JNE id_not_r
0ECB C606810001           1732                     MOV DS:ID_FLAG_r,1
0ED0 C606800000           1733                     MOV DS:ID_FLAG_@, 0
0ED5 EB3590               1734                     JMP S_RET
0ED8                      1735             id_not_r:
0ED8 C606800000           1736                     MOV DS:ID_FLAG_@, 0
0EDD EB2D90               1737                     JMP id_skip
                          1738             
0EE0                      1739             terminate_session:
0EE0 C606810000           1740                     MOV DS:ID_FLAG_r, 0
0EE5 33DB                 1741                     XOR BX,BX
0EE7                      1742             start_send1:
0EE7 50                   1743                     PUSH AX
0EE8 33C0                 1744                     XOR AX,AX
0EEA 8A878600             1745                     MOV AL, DS:FAIL_MESSAGE[BX]
0EEE 9A0000----     E     1746                     CALL FAR PTR PRINT_CHAR
0EF3 58                   1747                     POP AX
0EF4 C6068B0000           1748                     MOV DS:REPLY_FLAG, 0
0EF9 43                   1749                     INC BX
0EFA 3A1E8A00             1750                     CMP BL, DS:FAIL_COUNT
0EFE 75E7                 1751                     JNE start_send1
                          1752                     
0F00                      1753             protocol_rec:
0F00 3C40                 1754                     CMP AL,'@'
0F02 7508                 1755                     JNE id_skip
0F04 C606800001           1756                     MOV DS:ID_FLAG_@,1
0F09 EB0190               1757                     JMP S_RET
                          1758                     
0F0C                      1759             id_skip:
                          1760                     ; JMP S_RET
                          1761             
                          1762                     ; CMP   AL,'<'
                          1763                     ; JNE   S_FAST
                          1764     
                          1765                     ; INC   DS:T_COUNT_SET
                          1766                     ; INC   DS:T_COUNT_SET
                          1767     
                          1768                     ; JMP   S_NEXT0
                          1769     ; S_FAST:
                          1770                     ; CMP   AL,'>'
                          1771                     ; JNE   S_RET
                          1772     
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    20:01:04  12/07/;3  PAGE   34


LOC  OBJ                  LINE     SOURCE

                          1773                     ; DEC   DS:T_COUNT_SET
                          1774                     ; DEC   DS:T_COUNT_SET
                          1775     
                          1776     ; S_NEXT0:
                          1777                     ; MOV   CX,22                   ;initialize counter for message
                          1778                     ; MOV   BX,0
                          1779     
                          1780     ; S_NEXT1:      MOV     AL,DS:REC_MESS[BX]      ;print message
                          1781                     ; call  FAR ptr print_char
                          1782                     ; INC   BX
                          1783                     ; LOOP  S_NEXT1
                          1784     
                          1785                     ; MOV   AL,DS:T_COUNT_SET       ;print current period of timer0
                          1786                     ; CALL  FAR PTR PRINT_2HEX
0F0C                      1787     S_RET:
0F0C 1F                   1788                     POP     DS
0F0D 5B                   1789                     POP     BX
0F0E 59                   1790                     POP     CX
0F0F CB                   1791                     RET
                          1792     SERIAL_REC_ACTION       ENDP
                          1793     
0F10                      1794     TIMER2_ACTION   PROC    FAR
0F10 50                   1795                     PUSH    AX
0F11 1E                   1796                     PUSH    DS
0F12 53                   1797                     PUSH    BX
0F13 51                   1798                     PUSH    CX
0F14 52                   1799                     PUSH    DX
                          1800                     
                          1801                     
0F15 B8----         R     1802                     MOV     AX,DATA_SEG
0F18 8ED8                 1803                     MOV     DS,AX
                          1804             
0F1A FE0E1600             1805                     DEC     DS:T_COUNT
0F1E 754A                 1806                     JNZ     T_NEXT1
0F20 A01700               1807                     MOV     AL,DS:T_COUNT_SET
0F23 A21600               1808                     MOV     DS:T_COUNT,AL
                          1809     
0F26                      1810     T_NEXT0:
                          1811                     
0F26 33DB                 1812                     XOR BX, BX
0F28 8A1E6000             1813                     MOV BL, DS:BCD_INDEX
0F2C 8A4759               1814                     MOV AL, DS:BCD_MESSAGE[BX]
                          1815                     
0F2F 3B1EAC00             1816                     CMP BX, DS:DECIMAL_INDEX
0F33 7506                 1817                     JNE CALL_FUNC
0F35 C706A6000100         1818                     MOV DS:DECIMAL_FLAG, 1
0F3B                      1819     CALL_FUNC:
0F3B 9ADB0F----     R     1820                     CALL FAR PTR BCD_TO_7SEG
0F40 C706A6000000         1821                     MOV DS:DECIMAL_FLAG, 0
                          1822     
0F46 BA0002               1823                     MOV DX, 200H
0F49 EE                   1824                     OUT DX, AL
                          1825                     
0F4A A05F00               1826                     MOV AL, DS:ENABLE_BYTE
0F4D BA8001               1827                     MOV DX, 180H
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    20:01:04  12/07/;3  PAGE   35


LOC  OBJ                  LINE     SOURCE

0F50 EE                   1828                     OUT DX, AL
                          1829                     
                          1830     
0F51 FE066000             1831                     INC DS:BCD_INDEX
0F55 D0065F00             1832                     ROL DS:ENABLE_BYTE, 1
0F59 803E5F00BF           1833                     CMP DS:ENABLE_BYTE, 10111111b
0F5E 750A                 1834                     JNE T_NEXT1
0F60 C6065F00FE           1835                     MOV DS:ENABLE_BYTE, 11111110b 
0F65 C606600000           1836                     MOV DS:BCD_INDEX, 0
                          1837     
                          1838                     
0F6A                      1839     T_NEXT1:
0F6A 803E750000           1840                     CMP DS:DAC_LEN, 0
0F6F 743C                 1841                     JE ISR_END
                          1842                     
                          1843                     
0F71 8B367600             1844                     MOV SI, DS:SI_PTR
                          1845                             
0F75 BB0000               1846                     MOV BX, 0
0F78 33C0                 1847                     XOR AX, AX
0F7A 8A4766               1848                     MOV AL, DS:DAC_ADDR[BX]
                          1849                     
0F7D BB0001               1850                     MOV BX, 100H
0F80 F7E3                 1851                     MUL BX
                          1852                     
0F82 8B166400             1853                     MOV DX, DS:DAC_BASE
0F86 03D0                 1854                     ADD DX, AX
                          1855                     
0F88 1E                   1856                     PUSH DS
0F89 8EDA                 1857                     MOV DS, DX
                          1858                     
0F8B 8B04                 1859                     MOV AX, [SI]
                          1860                     
0F8D BA1001               1861                     MOV DX, 110H
0F90 EE                   1862                     OUT DX, AL
                          1863                     
0F91 1F                   1864                     POP DS
                          1865                     
0F92 FF067600             1866                     INC DS:SI_PTR
0F96 813E76000010         1867                     CMP DS:SI_PTR, 1000H
0F9C 750F                 1868                     JNE ISR_END
                          1869                     
0F9E C70676000000         1870                     MOV DS:SI_PTR, 0
0FA4 FE0E7500             1871                     DEC DS:DAC_LEN
0FA8 9AB30F----     R     1872                     CALL FAR PTR DAC_SHIFT
                          1873                     
0FAD                      1874     ISR_END:
                          1875                     
0FAD 5A                   1876                     POP DX
0FAE 59                   1877                     POP     CX
0FAF 5B                   1878                     POP     BX
0FB0 1F                   1879                     POP     DS
0FB1 58                   1880                     POP AX
0FB2 CB                   1881                     RET
                          1882     TIMER2_ACTION   ENDP
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    20:01:04  12/07/;3  PAGE   36


LOC  OBJ                  LINE     SOURCE

                          1883     
                          1884     
0FB3                      1885     DAC_SHIFT PROC FAR
0FB3 50                   1886             PUSH AX
0FB4 53                   1887             PUSH BX
0FB5 51                   1888             PUSH CX
0FB6 52                   1889             PUSH DX
                          1890     
0FB7 33C9                 1891             XOR CX, CX
0FB9 8A0E7500             1892             MOV CL, DS:DAC_LEN
0FBD 80F900               1893             CMP CL, 0
0FC0 7414                 1894             JE END_SHIFT
                          1895     
0FC2                      1896             SHIFT_LOOP:
                          1897     
0FC2 33DB                 1898             XOR BX, BX
0FC4 8A1E7500             1899             MOV BL, DS:DAC_LEN
0FC8 2BD9                 1900             SUB BX, CX
0FCA 43                   1901             INC BX
                          1902             
0FCB 33D2                 1903             XOR DX, DX
0FCD 8A5766               1904             MOV DL, DS:DAC_ADDR[BX]
0FD0 4B                   1905             DEC BX
0FD1 885766               1906             MOV DS:DAC_ADDR[BX], DL
                          1907     
0FD4 E2EC                 1908             LOOP SHIFT_LOOP
                          1909             
0FD6                      1910             END_SHIFT:
0FD6 5A                   1911             POP DX
0FD7 59                   1912             POP CX
0FD8 5B                   1913             POP BX
0FD9 58                   1914             POP AX
0FDA CB                   1915             RET
                          1916     DAC_SHIFT ENDP
                          1917     
0FDB                      1918     BCD_TO_7SEG PROC FAR
                          1919     
0FDB 53                   1920             PUSH BX
0FDC 51                   1921             PUSH CX
0FDD 52                   1922             PUSH DX
                          1923             
0FDE 3C00                 1924             CMP AL, 0
0FE0 7511                 1925             JNE one
0FE2 833EA60001           1926             CMP DS:DECIMAL_FLAG, 1
0FE7 7405                 1927             JE decimal0
0FE9 B03F                 1928             MOV AL, 00111111b
0FEB E9D700               1929             JMP endfunc
0FEE                      1930     decimal0:
0FEE B0BF                 1931             MOV AL, 10111111b
0FF0 E9D200               1932             JMP endfunc
                          1933             
0FF3                      1934             one:
0FF3 3C01                 1935             CMP AL, 1
0FF5 7511                 1936             JNE two
0FF7 833EA60001           1937             CMP DS:DECIMAL_FLAG, 1
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    20:01:04  12/07/;3  PAGE   37


LOC  OBJ                  LINE     SOURCE

0FFC 7405                 1938             JE decimal1
0FFE B006                 1939             MOV AL, 00000110b
1000 E9C200               1940             JMP endfunc
1003                      1941     decimal1:
1003 B086                 1942             MOV AL, 10000110b
1005 E9BD00               1943             JMP endfunc
                          1944             
1008                      1945             two:
1008 3C02                 1946             CMP AL,2
100A 7511                 1947             JNE three
100C 833EA60001           1948             CMP DS:DECIMAL_FLAG, 1
1011 7405                 1949             JE decimal2
1013 B05B                 1950             MOV AL, 01011011b
1015 E9AD00               1951             JMP endfunc
1018                      1952     decimal2:
1018 B0DB                 1953             MOV AL, 11011011b
101A E9A800               1954             JMP endfunc
                          1955             
101D                      1956             three:
101D 3C03                 1957             CMP AL,3
101F 7511                 1958             JNE four
1021 833EA60001           1959             CMP DS:DECIMAL_FLAG, 1
1026 7405                 1960             JE decimal3
1028 B04F                 1961             MOV AL, 01001111b
102A E99800               1962             JMP endfunc
102D                      1963     decimal3:
102D B0CF                 1964             MOV AL, 11001111b
102F E99300               1965             JMP endfunc
                          1966             
1032                      1967             four:
1032 3C04                 1968             CMP AL,4
1034 7511                 1969             JNE five
1036 833EA60001           1970             CMP DS:DECIMAL_FLAG, 1
103B 7405                 1971             JE decimal4
103D B066                 1972             MOV AL, 01100110b
103F E98300               1973             JMP endfunc
1042                      1974     decimal4:
1042 B0E6                 1975             MOV AL, 11100110b
1044 EB7F90               1976             JMP endfunc
                          1977             
1047                      1978             five:
1047 3C05                 1979             CMP AL,5
1049 7511                 1980             JNE six
104B 833EA60001           1981             CMP DS:DECIMAL_FLAG, 1
1050 7405                 1982             JE decimal5
1052 B06D                 1983             MOV AL, 01101101b
1054 EB6F90               1984             JMP endfunc
1057                      1985     decimal5:
1057 B0ED                 1986             MOV AL, 11101101b
1059 EB6A90               1987             JMP endfunc
                          1988             
105C                      1989             six:
105C 3C06                 1990             CMP AL,6
105E 7511                 1991             JNE seven
1060 833EA60001           1992             CMP DS:DECIMAL_FLAG, 1
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    20:01:04  12/07/;3  PAGE   38


LOC  OBJ                  LINE     SOURCE

1065 7405                 1993             JE decimal6
1067 B07D                 1994             MOV AL, 01111101b
1069 EB5A90               1995             JMP endfunc
106C                      1996     decimal6:
106C B0FD                 1997             MOV AL, 11111101b
106E EB5590               1998             JMP endfunc
                          1999             
1071                      2000             seven:
1071 3C07                 2001             CMP AL,7
1073 7511                 2002             JNE eight
1075 833EA60001           2003             CMP DS:DECIMAL_FLAG, 1
107A 7405                 2004             JE decimal7
107C B007                 2005             MOV AL, 00000111b
107E EB4590               2006             JMP endfunc
1081                      2007     decimal7:
1081 B087                 2008             MOV AL, 10000111b
1083 EB4090               2009             JMP endfunc
                          2010             
1086                      2011             eight:
1086 3C08                 2012             CMP AL,8
1088 7511                 2013             JNE nine
108A 833EA60001           2014             CMP DS:DECIMAL_FLAG, 1
108F 7405                 2015             JE decimal8
1091 B07F                 2016             MOV AL, 01111111b
1093 EB3090               2017             JMP endfunc
1096                      2018     decimal8:
1096 B0FF                 2019             MOV AL, 11111111b
1098 EB2B90               2020             JMP endfunc
                          2021             
109B                      2022             nine:
109B 3C09                 2023             CMP AL,9
109D 7511                 2024             JNE hifn
109F 833EA60001           2025             CMP DS:DECIMAL_FLAG, 1
10A4 7405                 2026             JE decimal9
10A6 B06F                 2027             MOV AL, 01101111b
10A8 EB1B90               2028             JMP endfunc
10AB                      2029     decimal9:
10AB B0EF                 2030             MOV AL, 11101111b
10AD EB1690               2031             JMP endfunc
                          2032             
10B0                      2033             hifn:
10B0 3C2D                 2034             CMP AL,'-'
10B2 7511                 2035             JNE endfunc
10B4 833EA60001           2036             CMP DS:DECIMAL_FLAG, 1
10B9 7405                 2037             JE decimal10
10BB B040                 2038             MOV AL, 01000000b
10BD EB0690               2039             JMP endfunc
10C0                      2040     decimal10:
10C0 B0C0                 2041             MOV AL, 11000000b
10C2 EB0190               2042             JMP endfunc
                          2043             
10C5                      2044             endfunc:
10C5 5A                   2045             POP DX
10C6 59                   2046             POP CX
10C7 5B                   2047             POP BX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    20:01:04  12/07/;3  PAGE   39


LOC  OBJ                  LINE     SOURCE

                          2048     
10C8 CB                   2049     RET
                          2050     BCD_TO_7SEG ENDP
                          2051     
----                      2052     CODE_SEG        ENDS
                          2053     END

ASSEMBLY COMPLETE, NO ERRORS FOUND
