8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    14:30:34  12/05/;3  PAGE    1


DOS 5.0 (038-N) 8086/87/88/186 MACRO ASSEMBLER V3.1 ASSEMBLY OF MODULE TIMER
OBJECT MODULE PLACED IN TIMER.OBJ
ASSEMBLER INVOKED BY:  D:\ASM86.EXE TIMER.ASM


LOC  OBJ                  LINE     SOURCE

                             1 +1  $MOD186
                             2 +1  $EP
                             3     NAME TIMER
                             4     ; Main program for uPD70208 microcomputer system
                             5     ;
                             6     ; Author:       Dr Tay Teng Tiow
                             7     ; Address:      Department of Electrical Engineering 
                             8     ;               National University of Singapore
                             9     ;               10, Kent Ridge Crescent
                            10     ;               Singapore 0511. 
                            11     ; Date:         6th September 1991
                            12     ;
                            13     ; This file contains proprietory information and cannot be copied 
                            14     ; or distributed without prior permission from the author.
                            15     ; =========================================================================
                            16     
                            17     public  serial_rec_action, timer2_action
                            18     extrn   print_char:far, print_2hex:far, iodefine:far
                            19     extrn   set_timer2:far
                            20     
                            21     ;IO Setup for 80C188 
  FFA0                      22             UMCR    EQU    0FFA0H ; Upper Memory Control Register
  FFA2                      23             LMCR    EQU    0FFA2H ; Lower Memory control Register         
  FFA4                      24             PCSBA   EQU    0FFA4H ; Peripheral Chip Select Base Address
  FFA8                      25             MPCS    EQU    0FFA8H ; MMCS and PCS Alter Control Register
  0080                      26             A_8255  EQU    0080H
  0081                      27             B_8255  EQU    0081H
  0082                      28             C_8255  EQU    0082H
  0083                      29             CWR_8255  EQU    0083H
  FF38                      30             INT0CON  EQU   0FF38H
  FF22                      31             EOI EQU 0FF22H
  FF28                      32             IMASK EQU 0FF28H
  FFA6                      33             MMCS    EQU    0FFA6H 
  4000                      34             DAC EQU 4000H
                            35     
                            36     
----                        37     STACK_SEG       SEGMENT
0000 (512                   38                     DB      512 DUP(?)
     ??
     )
0200                        39             TOS     LABEL   WORD
----                        40     STACK_SEG       ENDS
                            41     
                            42     
----                        43     DATA_SEG        SEGMENT
0000 0A                     44             TIMER0_MESS             DB      10,13,'TIMER2 INTERRUPT    '
0001 0D
0002 54494D45523220
     494E5445525255
     505420202020
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    14:30:34  12/05/;3  PAGE    2


LOC  OBJ                  LINE     SOURCE

0016 18                     45             T_COUNT                 DB      24
0017 18                     46             T_COUNT_SET             DB      24
0018 0A                     47             REC_MESS                DB      10,13,'Period of timer0 =     '
0019 0D
001A 506572696F6420
     6F662074696D65
     7230203D202020
     2020
0031 (32                    48             MESSAGE         DB  32 dup('h')
     68
     )
0051 00                     49             KEYPAD_INPUT    DB  0,0,0,0,0,0,0,0
0052 00
0053 00
0054 00
0055 00
0056 00
0057 00
0058 00
0059 2D                     50             BCD_MESSAGE     DB  '-','-','-','-','-','-'
005A 2D
005B 2D
005C 2D
005D 2D
005E 2D
005F FE                     51             ENABLE_BYTE     DB  11111110b
0060 00                     52             BCD_INDEX       DB  0
0061 0000                   53             KEYPAD_INDEX    DW      0
0063 20                     54             M_SIZE                  DB  32
0064 0040                   55             DAC_BASE        DW  4000H
0066 (15                    56             DAC_ADDR        DB  15 dup(0) 
     00
     )
0075 00                     57             DAC_LEN         DB  0
0076 0000                   58             SI_PTR          DW  0
0078 ??                     59             CHAR                    DB  ?
0079 ??                     60             REG_AL                  DB  ?
007A ??                     61             REG_BH                  DB  ?
007B ??                     62             REG_CL                  DB  ?
007C 00                     63             FLAG            DB  0
007D 00                     64             LONG_PRESS_FLAG DB      0
007E 7231                   65             MY_ID                   DB      'r1'
0080 00                     66             ID_FLAG_@               DB      0
0081 00                     67             ID_FLAG_r               DB      0
0082 4072312F               68             REPLY_MESSAGE   DB      '@r1/'
0086 40302F                 69             FAIL_MESSAGE    DB '@0/'
0089 04                     70             REPLY_COUNT             DB      4
008A 03                     71             FAIL_COUNT              DB      3
008B 00                     72             REPLY_FLAG              DB      0
008C 00                     73             SEND_FLAG       DB  0
008D (13                    74             SEND_BUFFER     DB  13 dup(0)
     00
     )
009A 0000                   75             SEND_BUFFER_LEN DW      0
009C 0000                   76             MAX_INPUT_SIZE  DW      0
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    14:30:34  12/05/;3  PAGE    3


LOC  OBJ                  LINE     SOURCE

009E 0000                   77             QTY_FLAG                DW      0
00A0 0000                   78             RECEIVE_FLAG    DW      0
00A2 0000                   79             DAC_FLAG                DW      0
00A4 0000                   80             PRICE_FLAG      DW      0
00A6 0100                   81             DECIMAL_FLAG    DW      1
00A8 0000                   82             SCROLL_LEN      DW      0
00AA 0000                   83             DAC_DISABLE     DW  0
00AC 0300                   84             DECIMAL_INDEX   DW  3
00AE 0100                   85             LANG_FLAG       DW  1
00B0 0000                   86             PRICE                   DW      0
00B2 0000                   87             QTY                             DW      0
00B4 0000                   88             TOTAL_PRICE_U   DW      0
00B6 0000                   89             TOTAL_PRICE_L   DW      0
00B8 0000                   90             TOTAL_PRICE_DEC DW      0
00BA (8                     91             TEMP_BCD_ARR    DB  8 dup(0)
     00
     )
00C2 0000                   92             THOUSAND_FLAG   DW  0
00C4 0000                   93             CENT_FLAG               DW      0
00C6 0000                   94             CASH_FLAG               DW      0
00C8 (8                     95             CASH_AMT        DB  8 dup(0)
     00
     )
00D0 (8                     96             TEMP_CASH_ARR   DW  8 dup(0)
     0000
     )
00E0 0000                   97             CASH_OK_FLAG    DW  0
00E2 0000                   98             BORROW_POSITION    DW  0
----                        99     DATA_SEG        ENDS
                           100     
                           101     
----                       102     CODE_SEG        SEGMENT
                           103     
                           104             PUBLIC          START
                           105     
                           106     ASSUME  CS:CODE_SEG, SS:STACK_SEG
                           107     
0000                       108     START:
                           109     ;initialize stack area
0000 B8----         R      110                     MOV     AX,STACK_SEG            
0003 8ED0                  111                     MOV     SS,AX
0005 368B260002            112                     MOV     SP,TOS
                           113                     
                           114     ; Initialize the on-chip pheripherals
000A 9A0000----     E      115                     CALL    FAR PTR IODEFINE
                           116                     
000F 9A0000----     E      117     call set_timer2
0014 FB                    118                    STI
                           119     
                           120     ; ^^^^^^^^^^^^^^^^^  Start of User Main Routine  ^^^^^^^^^^^^^^^^^^
                           121     
                           122     ;Initialize MMCS
                           123             
0015 BAA6FF                124             MOV DX, MMCS
0018 B80340                125             MOV AX, 4003H
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    14:30:34  12/05/;3  PAGE    4


LOC  OBJ                  LINE     SOURCE

001B EF                    126             OUT DX, AX
                           127     
                           128     ; Initialize MPCS to MAP peripheral to IO address
                           129             
001C BAA8FF                130             MOV DX, MPCS
001F B88320                131             MOV AX, 2083H
0022 EF                    132             OUT DX, AX
                           133        
                           134     ; PCSBA initial, set the parallel port start from 00H
0023 BAA4FF                135             MOV DX, PCSBA
0026 B80300                136             MOV AX, 0003H ; Peripheral starting address 00H no READY, No Waits
0029 EF                    137             OUT DX, AX
                           138     
                           139     ; Initialize LMCS 
002A BAA2FF                140         MOV DX, LMCR
002D B8C401                141         MOV AX, 01C4H  ; Starting address 1FFFH, 8K, No waits, last shoud be 5H for 1 wai
                                   ts      
0030 EF                    142         OUT DX, AX
                           143             
0031 B8----         R      144             MOV AX, DATA_SEG
0034 8ED8                  145             MOV DS, AX
                           146                              
0036 BA8300                147             MOV DX, CWR_8255
0039 B88200                148             MOV AX, 0082h
003C EF                    149             OUT DX, AX
                           150             
003D                       151     NEXT:
003D 9A4400----     R      152             CALL FAR PTR KEYPAD_LOOP
                           153             
0042 EBF9                  154     JMP NEXT
                           155     
0044                       156     KEYPAD_LOOP PROC FAR
0044 50                    157     PUSH AX
0045 53                    158     PUSH BX
0046 51                    159     PUSH CX
0047 52                    160     PUSH DX
                           161             
0048 9AC204----     R      162                             CALL FAR PTR DEBOUNCE           
                           163                             
004D C606790003            164     WAIT_1:         MOV DS:REG_AL, 03H
0052 BB0000                165                         MOV BX, 0000H
0055 BA8200                166                         MOV DX,C_8255
0058 8AC3                  167                         MOV AL,BL
005A EE                    168                         OUT DX,AL
                           169                        
005B BA8100                170                         MOV DX,B_8255
005E EC                    171                         IN AL,DX
005F 8AD8                  172                         MOV BL,AL  
0061 80E3FC                173                         AND BL,0FCH
0064 80FBFC                174                         CMP BL,0FCH
                           175                      
0067 7449                  176                     JE LONG_PRESS
                           177                             
0069 B3FE                  178                         MOV BL, 0FEH
006B C6067A0004            179                         MOV DS:REG_BH, 04H
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    14:30:34  12/05/;3  PAGE    5


LOC  OBJ                  LINE     SOURCE

                           180                        
0070                       181     NXTROW: 
0070 C0C307                182                     ROL BL,07H
0073 8AEB                  183                             MOV CH,BL
0075 BA8200                184                             MOV DX,C_8255
0078 8AC3                  185                             MOV AL,BL
007A EE                    186                             OUT DX,AL
                           187                             
007B BA8100                188                             MOV DX,B_8255
007E EC                    189                             IN AL,DX
007F 8AD8                  190                             MOV BL,AL
0081 80E3FC                191                             AND BL,0FCH
0084 C6067B0006            192                             MOV DS:REG_CL,06H
0089 C0DB02                193                             RCR BL,02H
008C D0DB                  194     NXTCOL:         RCR BL,01H
008E 732A                  195                             JNC CODEKY
0090 FE0E7900              196                             DEC DS:REG_AL
0094 FE0E7B00              197                             DEC DS:REG_CL
0098 803E7B0003            198                             CMP DS:REG_CL,03H
009D 7453                  199                             JE KEYPAD3
                           200                             
009F 803E7B0000            201                             CMP DS:REG_CL, 0H
00A4 7449                  202                             JE SUBTRACT2
00A6 EBE4                  203                             JMP NXTCOL
                           204                             
00A8 8ADD                  205                             MOV BL,CH
00AA FE0E7A00              206                             DEC DS:REG_BH
00AE 75C0                  207                             JNZ NXTROW
00B0 EB9B                  208                             JMP WAIT_1
                           209                             
00B2                       210     LONG_PRESS:
00B2 C6067D0000            211                             MOV DS:LONG_PRESS_FLAG, 0
00B7 EB3C90                212                             JMP RETURN2
00BA                       213     CODEKY:
00BA 803E79000B            214                         CMP DS:REG_AL, 11
00BF 7505                  215                             JNE bcd_upd
00C1 C606790000            216                             MOV DS:REG_AL, 0
                           217                             
00C6                       218     bcd_upd:
00C6 803E7D0000            219                             CMP DS:LONG_PRESS_FLAG, 0
00CB 7528                  220                             JNE RETURN2
                           221                             
00CD 803E790014            222                             CMP DS:REG_AL, 20
00D2 7524                  223                             JNE SEND_CASH
00D4 833EC60000            224                             CMP DS:CASH_FLAG, 0
00D9 7411                  225                             JE SKIP_CASH
00DB 9A1104----     R      226                             CALL FAR PTR BCD_CLEAR
00E0 C7069C000800          227                             MOV DS:MAX_INPUT_SIZE, 8
00E6 C706AC000600          228                             MOV DS:DECIMAL_INDEX, 6
00EC                       229                     SKIP_CASH:
00EC E96801                230                             JMP UPDATE_7SEG2
                           231                             
00EF E90502                232     SUBTRACT2:   JMP SUBTRACT
                           233     
00F2 E9F201                234     KEYPAD3:        JMP KEYPAD_2
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    14:30:34  12/05/;3  PAGE    6


LOC  OBJ                  LINE     SOURCE

                           235     
00F5 E90D02                236     RETURN2:    JMP RETURN
                           237                             
00F8                       238     SEND_CASH:
00F8 803E790017            239                             CMP DS:REG_AL, 23
00FD 7516                  240                             JNE CLEAR_BUTTON
00FF 833EC60000            241                             CMP DS:CASH_FLAG, 0
0104 740C                  242                             JE SKIP_SEND_CASH
0106 833E610000            243                             CMP DS:KEYPAD_INDEX, 0
010B 7405                  244                             JE SKIP_SEND_CASH
010D 9AE704----     R      245                             CALL FAR PTR TAKE_CASH
0112                       246                     SKIP_SEND_CASH:
0112 E94201                247                             JMP UPDATE_7SEG2
                           248                             
0115                       249     CLEAR_BUTTON:
0115 803E79000A            250                             CMP DS:REG_AL, 10
011A 7508                  251                             JNE BACKSPACE
011C 9A1104----     R      252                             CALL FAR PTR BCD_CLEAR
0121 E93301                253                             JMP UPDATE_7SEG2
                           254                             
0124 803E79000C            255     BACKSPACE:      CMP DS:REG_AL, 12
0129 7508                  256                             JNE ENTER_DATA
012B 9AA203----     R      257                             CALL FAR PTR BCD_BACKSPACE
0130 E92401                258                             JMP UPDATE_7SEG2
                           259     
0133 803E79000D            260     ENTER_DATA:     CMP DS:REG_AL, 13
0138 7520                  261                             JNE END_TRANS
013A 9A1104----     R      262                             CALL FAR PTR BCD_CLEAR
013F C706AC000600          263                             MOV DS:DECIMAL_INDEX, 6
0145 C7069C000800          264                             MOV DS:MAX_INPUT_SIZE, 8
014B C706AE000000          265                             MOV DS:LANG_FLAG, 0
0151 C706C6000000          266                             MOV DS:CASH_FLAG, 0
0157 E9FD00                267                             JMP UPDATE_7SEG2
                           268                             
015A 803E790010            269     END_TRANS:      CMP DS:REG_AL, 16
015F 7534                  270                             JNE CANCEL_TRANS
0161 BB0000                271                             MOV BX, 0
0164 C6878D0024            272                             MOV DS:SEND_BUFFER[BX], '$'
0169 43                    273                             INC BX
016A C6878D002F            274                             MOV DS:SEND_BUFFER[BX], '/'
016F C7069A000200          275                             MOV DS:SEND_BUFFER_LEN, 2
0175 C6068C0001            276                             MOV DS:SEND_FLAG, 1
017A C706B8000000          277                             MOV DS:TOTAL_PRICE_DEC, 0
0180 C706B6000000          278                             MOV DS:TOTAL_PRICE_L, 0
0186 C706B4000000          279                             MOV DS:TOTAL_PRICE_U, 0
018C C706C6000100          280                             MOV DS:CASH_FLAG, 1
0192 E9C200                281                             JMP UPDATE_7SEG2
                           282                             
0195                       283     CANCEL_TRANS:   
0195 803E79000F            284                             CMP DS:REG_AL, 15
019A 752E                  285                             JNE SCROLL_LEFT
019C BB0000                286                             MOV BX, 0
019F C6878D003F            287                             MOV DS:SEND_BUFFER[BX], '?'
01A4 43                    288                             INC BX
01A5 C6878D002F            289                             MOV DS:SEND_BUFFER[BX], '/'
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    14:30:34  12/05/;3  PAGE    7


LOC  OBJ                  LINE     SOURCE

01AA C7069A000200          290                             MOV DS:SEND_BUFFER_LEN, 2
01B0 C6068C0001            291                             MOV DS:SEND_FLAG, 1
01B5 C706B8000000          292                             MOV DS:TOTAL_PRICE_DEC, 0
01BB C706B6000000          293                             MOV DS:TOTAL_PRICE_L, 0
01C1 C706B4000000          294                             MOV DS:TOTAL_PRICE_U, 0
01C7 E98D00                295                             JMP UPDATE_7SEG2
                           296                             
01CA                       297     SCROLL_LEFT:
01CA 803E790015            298                             CMP DS:REG_AL, 21
01CF 753D                  299                             JNE SCROLL_RIGHT
01D1 833E610006            300                             CMP DS:KEYPAD_INDEX, 6
01D6 7E7F                  301                             JLE UPDATE_7SEG2
01D8 833EA80000            302                             CMP DS:SCROLL_LEN, 0
01DD 7478                  303                             JE UPDATE_7SEG2
01DF FF0EA800              304                             DEC DS:SCROLL_LEN
01E3 FF0EAC00              305                             DEC DS:DECIMAL_INDEX
01E7 FF0E6100              306                             DEC DS:KEYPAD_INDEX
01EB 8B1E6100              307                             MOV BX, DS:KEYPAD_INDEX
01EF 8A4751                308                             MOV AL, DS:KEYPAD_INPUT[BX]
01F2 A27900                309                             MOV DS:REG_AL, AL
01F5 C706AA000100          310                             MOV DS:DAC_DISABLE, 1
01FB 9A3C04----     R      311                             CALL FAR PTR BCD_UPDATE
0200 C706AA000000          312                             MOV DS:DAC_DISABLE, 0
0206 C606790015            313                             MOV DS:REG_AL, 21
020B EB4A90                314                             JMP UPDATE_7SEG2
                           315     
020E                       316     SCROLL_RIGHT:
020E 803E790013            317                             CMP DS:REG_AL, 19
0213 7545                  318                             JNE LANG_TOGGLE
0215 833E610006            319                             CMP DS:KEYPAD_INDEX, 6
021A 7E3B                  320                             JLE UPDATE_7SEG2
021C A16100                321                             MOV AX, DS:KEYPAD_INDEX
021F 2D0600                322                             SUB AX, 6
0222 3906A800              323                             CMP DS:SCROLL_LEN, AX
0226 742F                  324                             JE UPDATE_7SEG2
0228 FF06A800              325                             INC DS:SCROLL_LEN
022C FF06AC00              326                             INC DS:DECIMAL_INDEX
0230 FF0E6100              327                             DEC DS:KEYPAD_INDEX
0234 8B1E6100              328                             MOV BX, DS:KEYPAD_INDEX
0238 8A4751                329                             MOV AL, DS:KEYPAD_INPUT[BX]
023B A27900                330                             MOV DS:REG_AL, AL
023E C706AA000100          331                             MOV DS:DAC_DISABLE, 1
0244 9A3C04----     R      332                             CALL FAR PTR BCD_UPDATE
0249 C706AA000000          333                             MOV DS:DAC_DISABLE, 0
024F C606790013            334                             MOV DS:REG_AL, 19
0254 EB0190                335                             JMP UPDATE_7SEG2
                           336                             
0257 EB7A90                337     UPDATE_7SEG2: JMP UPDATE_7SEG
                           338     
025A                       339     LANG_TOGGLE:
025A 803E790012            340                             CMP DS:REG_AL, 18
025F 751E                  341                             JNE QTY_PROMPT
0261 833EAE0001            342                             CMP DS:LANG_FLAG, 1
0266 75EF                  343                             JNE UPDATE_7SEG2
0268 A16400                344                             MOV AX, DS:DAC_BASE
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    14:30:34  12/05/;3  PAGE    8


LOC  OBJ                  LINE     SOURCE

026B 3D0040                345                             CMP AX, 4000H
026E 7406                  346                             JE MANDRIN
0270 B80040                347                             MOV AX, 4000H
0273 EB0490                348                             JMP SEND_TOGGLE
0276                       349             MANDRIN:
0276 B80065                350                             MOV AX, 6500H
0279                       351             SEND_TOGGLE:
0279 A36400                352                             MOV DS:DAC_BASE, AX
027C EB5590                353                             JMP UPDATE_7SEG
027F                       354     QTY_PROMPT:
027F 803E790016            355                             CMP DS:REG_AL, 22
0284 7520                  356                             JNE QUANTITY
0286 833E610008            357                             CMP DS:KEYPAD_INDEX, 8
028B 7519                  358                             JNE  QUANTITY
                           359                             ; CMP DS:MAX_INPUT_SIZE, 8
                           360                             ; JNE QUANTITY
028D 9A5B03----     R      361                             CALL FAR PTR UPDATE_SEND_BUFFER
0292 9A1104----     R      362                             CALL FAR PTR BCD_CLEAR
0297 C7069C000200          363                             MOV DS:MAX_INPUT_SIZE, 2
029D C7069E000100          364                             MOV DS:QTY_FLAG, 1
02A3 EB2E90                365                             JMP UPDATE_7SEG
                           366                     
02A6                       367     QUANTITY:
02A6 833E610000            368                             CMP DS:KEYPAD_INDEX, 0
02AB 7426                  369                             JE  UPDATE_7SEG
                           370                             
02AD 803E79000E            371                             CMP DS:REG_AL, 14
02B2 751F                  372                             JNE UPDATE_7SEG
                           373                             
02B4 833E9E0001            374                             CMP DS:QTY_FLAG, 1
02B9 7518                  375                             JNE UPDATE_7SEG
                           376                             
02BB 9A0A03----     R      377                             CALL FAR PTR UPDATE_THE_QUANTITY
                           378                                             
02C0 C6068C0001            379                             MOV DS:SEND_FLAG, 1
                           380                             
02C5 C7069E000000          381                             MOV DS:QTY_FLAG, 0
02CB 9A1104----     R      382                             CALL FAR PTR BCD_CLEAR
02D0 EB0190                383                             JMP UPDATE_7SEG
                           384                             
                           385     
02D3                       386     UPDATE_7SEG:
02D3 803E790009            387                             CMP DS:REG_AL, 9
02D8 7F05                  388                             JG SET_PRESS_FLAG
                           389                             
02DA 9A3C04----     R      390                             CALL FAR PTR BCD_UPDATE
                           391                             
02DF                       392     SET_PRESS_FLAG:
02DF C6067D0001            393                             MOV DS:LONG_PRESS_FLAG, 1
02E4 EB1F90                394                             JMP RETURN
                           395             
02E7                       396     KEYPAD_2: 
02E7 800679000F            397                 ADD DS:REG_AL,0FH
02EC E99DFD                398                             JMP NXTCOL
02EF C606790000            399     ZERO_PRINT: MOV DS:REG_AL,00H
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    14:30:34  12/05/;3  PAGE    9


LOC  OBJ                  LINE     SOURCE

02F4 E995FD                400                             JMP NXTCOL
02F7 802E790006            401     SUBTRACT:   SUB DS:REG_AL,06H
02FC 8ADD                  402                             MOV BL,CH
02FE FE0E7A00              403                             DEC DS:REG_BH
0302 E96BFD                404                             JMP NXTROW
                           405             
                           406             
0305                       407     RETURN:
0305 5A                    408                             POP DX
0306 59                    409                             POP CX
0307 5B                    410                             POP BX
0308 58                    411                             POP AX
0309 CB                    412                             RET
                           413     
                           414     KEYPAD_LOOP ENDP
                           415     
030A                       416     UPDATE_THE_QUANTITY PROC FAR
030A 50                    417     PUSH AX
030B 53                    418     PUSH BX
030C 51                    419     PUSH CX
030D 52                    420     PUSH DX
030E 8B0E6100              421             MOV CX, DS:KEYPAD_INDEX
0312 BB0000                422             MOV BX, 0
0315 BA0000                423             MOV DX, 0
0318                       424             UPD_QTY:
0318 A1B200                425                     MOV AX, DS:QTY
031B 53                    426                     PUSH BX
031C BB0A00                427                     MOV BX, 10
031F F7E3                  428                     MUL BX
0321 5B                    429                     POP BX
0322 8A5751                430                     MOV DL, DS:KEYPAD_INPUT[BX]
0325 03C2                  431                     ADD AX, DX
0327 A3B200                432                     MOV DS:QTY, AX
032A 43                    433                     INC BX
032B E2EB                  434             LOOP UPD_QTY
                           435             
032D 8B0E6100              436             MOV CX, DS:KEYPAD_INDEX
0331 8B1E9A00              437             MOV BX, DS:SEND_BUFFER_LEN
                           438             
0335                       439             UPD_BUFFER:
0335 53                    440                     PUSH BX
0336 8B1E6100              441                     MOV BX, DS:KEYPAD_INDEX
033A 2BD9                  442                     SUB BX, CX
033C 8A4751                443                     MOV AL, DS:KEYPAD_INPUT[BX]
033F 5B                    444                     POP BX
0340 0430                  445                     ADD AL, 30H
0342 88878D00              446                     MOV DS:SEND_BUFFER[BX], AL
                           447                     
0346 43                    448                     INC BX
0347 FF069A00              449                     INC DS:SEND_BUFFER_LEN
034B E2E8                  450             LOOP UPD_BUFFER
                           451             
034D C6878D002F            452             MOV DS:SEND_BUFFER[BX], '/'
0352 FF069A00              453             INC DS:SEND_BUFFER_LEN
                           454                     
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    14:30:34  12/05/;3  PAGE   10


LOC  OBJ                  LINE     SOURCE

0356 5A                    455     POP DX
0357 59                    456     POP CX
0358 5B                    457     POP BX
0359 58                    458     POP AX
                           459     
035A CB                    460     RET
                           461     UPDATE_THE_QUANTITY ENDP
                           462     
035B                       463     UPDATE_SEND_BUFFER PROC FAR
035B 50                    464     PUSH AX
035C 53                    465     PUSH BX
035D 51                    466     PUSH CX
035E 52                    467     PUSH DX
                           468     
035F 8B0E6100              469             MOV CX, DS:KEYPAD_INDEX
0363 83F900                470             CMP CX, 0
0366 7435                  471             JE END_UPD_BUFFER
0368 83C102                472             ADD CX, 2
036B 890E9A00              473             MOV DS:SEND_BUFFER_LEN, CX
036F BB0000                474             MOV BX, 0
0372                       475             BUFFER_LOOP:
0372 83FB00                476                     CMP BX, 0
0375 7508                  477                     JNE ASTERISK
0377 C6878D007E            478                     MOV DS:SEND_BUFFER[BX], '~'
037C EB1C90                479                     JMP END_BUFFER
037F                       480             ASTERISK:
037F A16100                481                     MOV AX, DS:KEYPAD_INDEX
0382 40                    482                     INC AX
0383 3BD8                  483                     CMP BX, AX
0385 7508                  484                     JNE CONT
0387 C6878D002A            485                     MOV DS:SEND_BUFFER[BX], '*'
038C EB0C90                486                     JMP END_BUFFER
038F                       487             CONT:
038F 4B                    488                     DEC BX
0390 8A4751                489                     MOV AL, DS:KEYPAD_INPUT[BX]
0393 0430                  490                     ADD AL, 30H
0395 43                    491                     INC BX
0396 88878D00              492                     MOV DS:SEND_BUFFER[BX], AL
                           493                     
039A                       494             END_BUFFER:
039A 43                    495                     INC BX
039B E2D5                  496             LOOP BUFFER_LOOP
039D                       497     END_UPD_BUFFER:
039D 5A                    498     POP DX
039E 59                    499     POP CX
039F 5B                    500     POP BX
03A0 58                    501     POP AX
03A1 CB                    502     RET
                           503     UPDATE_SEND_BUFFER ENDP
                           504     
03A2                       505     BCD_BACKSPACE PROC FAR
                           506     
03A2 50                    507     PUSH AX
03A3 53                    508     PUSH BX
03A4 51                    509     PUSH CX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    14:30:34  12/05/;3  PAGE   11


LOC  OBJ                  LINE     SOURCE

03A5 52                    510     PUSH DX
                           511     
03A6 8A167900              512             MOV DL, DS:REG_AL
03AA 833E610000            513             CMP DS:KEYPAD_INDEX, 0
03AF 7457                  514             JE RETURN_BACK
                           515             
03B1 BB0600                516             MOV BX, 6
03B4                       517             BCD_CLEAR_LOOP:
03B4 4B                    518                     DEC BX
03B5 C647592D              519                     MOV DS:BCD_MESSAGE[BX], '-'
03B9 43                    520                     INC BX
03BA 4B                    521                     DEC BX
03BB 75F7                  522             JNZ BCD_CLEAR_LOOP
                           523             
03BD 833E610001            524             CMP DS:KEYPAD_INDEX, 1
03C2 7E2C                  525             JLE less_than_two
                           526             
03C4 FF0E6100              527             DEC DS:KEYPAD_INDEX
03C8 FF0E6100              528             DEC DS:KEYPAD_INDEX
03CC 8B1E6100              529             MOV BX, DS:KEYPAD_INDEX
03D0 8A4751                530             MOV AL, DS:KEYPAD_INPUT[BX]
03D3 A27900                531             MOV DS:REG_AL, AL
03D6 C706A8000000          532             MOV DS:SCROLL_LEN, 0
03DC C706AA000100          533             MOV DS:DAC_DISABLE, 1
03E2 9A3C04----     R      534             CALL FAR PTR BCD_UPDATE
03E7 C706AA000000          535             MOV DS:DAC_DISABLE, 0
03ED EB1990                536             JMP RETURN_BACK
                           537             
03F0                       538     less_than_two:
03F0 FF0E6100              539             DEC DS:KEYPAD_INDEX
03F4 C60679002D            540             MOV DS:REG_AL, '-'
03F9 C706A8000000          541             MOV DS:SCROLL_LEN, 0
03FF 9A3C04----     R      542             CALL FAR PTR BCD_UPDATE
0404 FF0E6100              543             DEC DS:KEYPAD_INDEX
                           544             
0408                       545     RETURN_BACK:
0408 88167900              546             MOV DS:REG_AL, DL
040C 5A                    547     POP DX
040D 59                    548     POP CX
040E 5B                    549     POP BX
040F 58                    550     POP AX
                           551     
0410 CB                    552     RET
                           553     BCD_BACKSPACE ENDP
                           554     
0411                       555     BCD_CLEAR PROC FAR
0411 50                    556     PUSH AX
0412 53                    557     PUSH BX
0413 51                    558     PUSH CX
0414 52                    559     PUSH DX
0415 BB0800                560             MOV BX, 8
0418                       561             CLEAR_LOOP:
0418 C6475100              562             MOV DS:KEYPAD_INPUT[BX], 0
041C 4B                    563             DEC BX
041D 75F9                  564             JNZ CLEAR_LOOP
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    14:30:34  12/05/;3  PAGE   12


LOC  OBJ                  LINE     SOURCE

                           565             
041F BB0600                566             MOV BX, 6
0422                       567             CLEAR_LOOP2:
0422 4B                    568                     DEC BX
0423 C647592D              569                     MOV DS:BCD_MESSAGE[BX], '-'
0427 43                    570                     INC BX
0428 4B                    571                     DEC BX
0429 75F7                  572             JNZ CLEAR_LOOP2
                           573     
042B C70661000000          574             MOV DS:KEYPAD_INDEX, 0
0431 C706A8000000          575             MOV DS:SCROLL_LEN, 0
0437 5A                    576     POP DX
0438 59                    577     POP CX
0439 5B                    578     POP BX
043A 58                    579     POP AX
043B CB                    580     RET
                           581     BCD_CLEAR ENDP
                           582     
043C                       583     BCD_UPDATE PROC FAR
043C 50                    584     PUSH AX
043D 53                    585     PUSH BX
043E 51                    586     PUSH CX
043F 52                    587     PUSH DX
0440 A19C00                588                     MOV AX, DS:MAX_INPUT_SIZE
0443 39066100              589                     CMP DS:KEYPAD_INDEX, AX
0447 7D5A                  590                     JGE BCD_RET
                           591                     
0449 8A0E7900              592                     MOV CL, DS:REG_AL
044D 80F909                593                     CMP CL, 9
0450 7F0C                  594                     JG SKIP_PAST
0452 833EAA0001            595                     CMP DS:DAC_DISABLE, 1
0457 7405                  596                     JE SKIP_PAST
0459 9AA804----     R      597                     CALL FAR PTR DAC_UPDATE
                           598     
045E                       599     SKIP_PAST:              
045E 8A0E7900              600                     MOV CL, DS:REG_AL
                           601     
0462 8B1E6100              602                     MOV BX, DS:KEYPAD_INDEX
                           603                             
0466 884F51                604                     MOV DS:KEYPAD_INPUT[BX], CL
                           605                             
0469 FF066100              606                     INC DS:KEYPAD_INDEX
                           607                             
046D 8B1E6100              608                     MOV BX, DS:KEYPAD_INDEX
                           609                     
0471 A1A800                610                     MOV AX, DS:SCROLL_LEN
0474 2BD8                  611                     SUB BX, AX
                           612                     
0476 8B166100              613                     MOV DX, DS:KEYPAD_INDEX
047A 83FA06                614                     CMP DX, 6
047D 7E03                  615                     JLE update_display
047F BA0600                616                     MOV DX, 6
                           617                     
0482                       618             update_display:
                           619             
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    14:30:34  12/05/;3  PAGE   13


LOC  OBJ                  LINE     SOURCE

0482 B90500                620                     MOV CX, 5
0485 4B                    621                     DEC BX
0486 8A4751                622                     MOV AL, DS:KEYPAD_INPUT[BX]
0489 43                    623                     INC BX
                           624                             
048A 52                    625                     PUSH DX
048B 8B166100              626                     MOV DX, DS:KEYPAD_INDEX
048F 2B16A800              627                     SUB DX, DS:SCROLL_LEN
                           628                     
0493 2BD3                  629                     SUB DX, BX
                           630                             
0495 53                    631                     PUSH BX
                           632                             
0496 2BCA                  633                     SUB CX, DX
0498 8BD9                  634                     MOV BX, CX
049A 884759                635                     MOV DS:BCD_MESSAGE[BX], AL
                           636                             
049D 5B                    637                     POP BX
049E 5A                    638                     POP DX
                           639             
049F 4B                    640                     DEC BX
04A0 4A                    641                     DEC DX
04A1 75DF                  642             JNZ update_display
                           643     
04A3                       644             BCD_RET:
04A3 5A                    645                     POP DX
04A4 59                    646                     POP CX
04A5 5B                    647                     POP BX
04A6 58                    648                     POP AX
04A7 CB                    649     RET
                           650     BCD_UPDATE ENDP
                           651     
04A8                       652     DAC_UPDATE PROC FAR
04A8 50                    653             PUSH AX
04A9 53                    654             PUSH BX
04AA 51                    655             PUSH CX
04AB 52                    656             PUSH DX
                           657             
04AC BB0000                658             MOV BX, 0
04AF 8A1E7500              659             MOV BL, DS:DAC_LEN
04B3 A07900                660             MOV AL, DS:REG_AL
                           661             
04B6 884766                662             MOV DS:DAC_ADDR[BX], AL
                           663             
04B9 FE067500              664             INC DS:DAC_LEN
                           665     
04BD 5A                    666             POP DX
04BE 59                    667             POP CX
04BF 5B                    668             POP BX
04C0 58                    669             POP AX
04C1 CB                    670     RET
                           671     DAC_UPDATE ENDP
                           672               
04C2                       673     DEBOUNCE PROC FAR
04C2 51                    674                       PUSH CX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    14:30:34  12/05/;3  PAGE   14


LOC  OBJ                  LINE     SOURCE

                           675                       
04C3 B94C09                676                       MOV CX, 094CH
04C6 90                    677     BACK:     NOP
04C7 E2FD                  678                       LOOP BACK
04C9 59                    679                       POP CX
04CA CB                    680                       RET
                           681     DEBOUNCE  ENDP
                           682     
04CB                       683     SEND_INPUT PROC FAR
04CB 50                    684     PUSH AX
04CC 53                    685     PUSH BX
04CD 51                    686     PUSH CX
04CE 52                    687     PUSH DX
04CF BB0000                688             MOV BX, 0
04D2 8B0E9A00              689             MOV CX, DS:SEND_BUFFER_LEN
                           690             
04D6                       691             S_BUFF:
04D6 8A878D00              692                     MOV AL, DS:SEND_BUFFER[BX]
04DA 9A0000----     E      693                     CALL FAR PTR PRINT_CHAR
04DF 43                    694                     INC BX
04E0 E2F4                  695             LOOP S_BUFF
                           696             
04E2                       697     SEND_INPUT_END:
04E2 5A                    698     POP DX
04E3 59                    699     POP CX
04E4 5B                    700     POP BX
04E5 58                    701     POP AX
04E6 CB                    702     RET
                           703     SEND_INPUT ENDP
                           704     
04E7                       705     TAKE_CASH PROC FAR
04E7 50                    706     PUSH AX
04E8 53                    707     PUSH BX
04E9 51                    708     PUSH CX
04EA 52                    709     PUSH DX
                           710             
04EB B90000                711             MOV CX, 0
04EE B108                  712             MOV CL, 8
04F0                       713             CLEAR_CASH_AMT:
04F0 8BD9                  714                     MOV BX, CX
04F2 4B                    715                     DEC BX
04F3 C687C80000            716                     MOV DS:CASH_AMT[BX], 0
04F8 E2F6                  717             LOOP CLEAR_CASH_AMT
                           718             
04FA 8B0E6100              719             MOV CX, DS:KEYPAD_INDEX
04FE BA0600                720             MOV DX, 6
                           721             
0501                       722             UPDATE_CASH_AMT:
0501 8BD9                  723                     MOV BX, CX
0503 4B                    724                     DEC BX
                           725                     
0504 33C0                  726                     XOR AX, AX
0506 8A4751                727                     MOV AL, DS:KEYPAD_INPUT[BX]
                           728                     
0509 8BDA                  729                     MOV BX, DX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    14:30:34  12/05/;3  PAGE   15


LOC  OBJ                  LINE     SOURCE

050B 4B                    730                     DEC BX
050C 8887C800              731                     MOV DS:CASH_AMT[BX], AL
                           732                     
0510 4A                    733                     DEC DX
0511 E2EE                  734             LOOP UPDATE_CASH_AMT
                           735             
0513 C706E0000100          736             MOV DS:CASH_OK_FLAG, 1
0519 C706E2000700          737             MOV DS:BORROW_POSITION, 7
051F B90800                738             MOV CX, 8
0522                       739             CHECK_CASH:
0522 BB0800                740                     MOV BX, 8
0525 2BD9                  741                     SUB BX, CX
0527 B80000                742                     MOV AX, 0
052A 8A87BA00              743                     MOV AL, DS:TEMP_BCD_ARR[BX]
052E 8A97C800              744                     MOV DL, DS:CASH_AMT[BX]
0532 3AD0                  745                     CMP DL, AL
0534 741A                  746                     JE NEXT_CASH_DIGIT
                           747                     
0536 3AD0                  748                     CMP DL, AL
0538 7C0D                  749                     JL CASH_NOT_OK
                           750                     
053A C706E0000100          751                     MOV DS:CASH_OK_FLAG, 1
0540 891EE200              752                     MOV DS:BORROW_POSITION, BX
                           753                     
0544 EB0C90                754                     JMP CHEK_CASH_DONE
                           755                     
0547                       756                     CASH_NOT_OK:
0547 C706E0000000          757                     MOV DS:CASH_OK_FLAG, 0
054D EB0390                758                     JMP CHEK_CASH_DONE
                           759                     
0550                       760             NEXT_CASH_DIGIT:
0550 E2D0                  761             LOOP CHECK_CASH
                           762             
0552                       763     CHEK_CASH_DONE:
                           764             
0552 833EE00001            765             CMP DS:CASH_OK_FLAG, 1
0557 7464                  766             JE CONTINUE_CASH
0559 B90800                767             MOV CX, 8
055C C70661000000          768             MOV DS:KEYPAD_INDEX, 0
0562 C706AC000300          769             MOV DS:DECIMAL_INDEX, 3
0568                       770             RETAIN_BCD:
0568 BB0800                771                     MOV BX, 8
056B 2BD9                  772                     SUB BX, CX
                           773                     
056D 8A87BA00              774                     MOV AL, DS:TEMP_BCD_ARR[BX]
0571 A27900                775                     MOV DS:REG_AL, AL
                           776                     
0574 C706AA000100          777                     MOV DS:DAC_DISABLE, 1
057A 9A3C04----     R      778                     CALL FAR PTR BCD_UPDATE
057F C706AA000000          779                     MOV DS:DAC_DISABLE, 0
0585 E2E1                  780             LOOP RETAIN_BCD
0587 813E64000040          781             CMP DS:DAC_BASE, 4000H
058D 7517                  782             JNE MANDARIN_CASH
                           783             
058F C606790023            784             MOV DS:REG_AL, 35
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    14:30:34  12/05/;3  PAGE   16


LOC  OBJ                  LINE     SOURCE

0594 9AA804----     R      785             CALL FAR PTR DAC_UPDATE
0599 C606790024            786             MOV DS:REG_AL, 36
059E 9AA804----     R      787             CALL FAR PTR DAC_UPDATE
05A3 E9A600                788             JMP CASH_OVER
                           789             
05A6                       790     MANDARIN_CASH:
05A6 C606790012            791             MOV DS:REG_AL, 18
05AB 9AA804----     R      792             CALL FAR PTR DAC_UPDATE
05B0 C606790013            793             MOV DS:REG_AL, 19
05B5 9AA804----     R      794             CALL FAR PTR DAC_UPDATE
05BA E98F00                795             JMP CASH_OVER
                           796             
05BD                       797     CONTINUE_CASH:
05BD 8B1EE200              798             MOV BX, DS:BORROW_POSITION
05C1 B90700                799             MOV CX, 7
05C4 2BCB                  800             SUB CX, BX
05C6 83F900                801             CMP CX, 0
05C9 740C                  802             JE BEGIN_SUB
                           803             
05CB                       804             ADJUST_PLACES:
05CB FE8FC800              805                     DEC DS:CASH_AMT[BX]
05CF 43                    806                     INC BX
05D0 8087C8000A            807                     ADD DS:CASH_AMT[BX], 10
05D5 E2F4                  808             LOOP ADJUST_PLACES
                           809             
05D7                       810     BEGIN_SUB:
05D7 B90800                811             MOV CX, 8
05DA                       812             CALC_CHANGE:
05DA BB0800                813                     MOV BX, 8
05DD 2BD9                  814                     SUB BX, CX
05DF B80000                815                     MOV AX, 0
05E2 8A87C800              816                     MOV AL, DS:CASH_AMT[BX]
05E6 BA0000                817                     MOV DX, 0
05E9 8A97BA00              818                     MOV DL, DS:TEMP_BCD_ARR[BX]
05ED 2BC2                  819                     SUB AX, DX
05EF 8987D000              820                     MOV DS:TEMP_CASH_ARR[BX], AX
05F3 E2E5                  821             LOOP CALC_CHANGE
                           822             
05F5 B90800                823             MOV CX, 8
05F8                       824             FIX_DIGITS:
05F8 8BD9                  825             MOV BX, CX
05FA 4B                    826             DEC BX
                           827             
05FB 8B87D000              828             MOV AX, DS:TEMP_CASH_ARR[BX]
05FF 3C0A                  829             CMP AL, 10
0601 7C0A                  830             JL NEXT_DIGIT_TO_FIX
                           831             
0603 83AFD0000A            832             SUB DS:TEMP_CASH_ARR[BX], 10
                           833             
0608 4B                    834             DEC BX
0609 FF87D000              835             INC DS:TEMP_CASH_ARR[BX]
                           836             
060D                       837             NEXT_DIGIT_TO_FIX:
                           838             
060D E2E9                  839             LOOP FIX_DIGITS
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    14:30:34  12/05/;3  PAGE   17


LOC  OBJ                  LINE     SOURCE

                           840             
060F B90800                841             MOV CX, 8
0612 C70661000000          842             MOV DS:KEYPAD_INDEX, 0
0618 C706AC000300          843             MOV DS:DECIMAL_INDEX, 3
061E                       844             UPDATE_BCD_TO_CASH:
061E BB0800                845                     MOV BX, 8
0621 2BD9                  846                     SUB BX, CX
0623 8B87D000              847                     MOV AX, DS:TEMP_CASH_ARR[BX]
0627 8887BA00              848                     MOV DS:TEMP_BCD_ARR[BX], AL
062B A27900                849                     MOV DS:REG_AL, AL
062E C706AA000100          850                     MOV DS:DAC_DISABLE, 1
0634 9A3C04----     R      851                     CALL FAR PTR BCD_UPDATE
0639 C706AA000000          852                     MOV DS:DAC_DISABLE, 0
063F E2DD                  853             LOOP UPDATE_BCD_TO_CASH
                           854             
0641 9A5106----     R      855             CALL FAR PTR CALC_DAC
                           856             
0646 C706C6000000          857             MOV DS:CASH_FLAG, 0
                           858             
064C                       859     CASH_OVER:
064C 5A                    860     POP DX
064D 59                    861     POP CX
064E 5B                    862     POP BX
064F 58                    863     POP AX
                           864     
0650 CB                    865     RET
                           866     TAKE_CASH ENDP
                           867     
0651                       868     CALC_DAC PROC FAR
0651 50                    869     PUSH AX
0652 53                    870     PUSH BX
0653 51                    871     PUSH CX
0654 52                    872     PUSH DX
0655 813E64000040          873             CMP DS:DAC_BASE, 4000H
065B 7403                  874             JE ENGLISH_DAC
065D E95101                875             JMP MANDARIN_DAC
                           876             
0660                       877     ENGLISH_DAC:
0660 C706C4000000          878             MOV DS:CENT_FLAG, 0
0666 C706C2000000          879             MOV DS:THOUSAND_FLAG, 0
066C BB0000                880             MOV BX, 0
066F 8A87BA00              881             MOV AL, DS:TEMP_BCD_ARR[BX]
0673 A27900                882             MOV DS:REG_AL, AL
0676 3C00                  883             CMP AL, 0
0678 740F                  884             JE NEXT_PLACE
067A 9AA804----     R      885             CALL FAR PTR DAC_UPDATE
067F C60679001C            886             MOV DS:REG_AL, 28
0684 9AA804----     R      887             CALL FAR PTR DAC_UPDATE
                           888             
0689                       889     NEXT_PLACE:     
0689 43                    890             INC BX
068A 8A87BA00              891             MOV AL, DS:TEMP_BCD_ARR[BX]
068E 3C01                  892             CMP AL, 1
0690 7518                  893             JNE NOT_1
0692 43                    894             INC BX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    14:30:34  12/05/;3  PAGE   18


LOC  OBJ                  LINE     SOURCE

0693 8A87BA00              895             MOV AL, DS:TEMP_BCD_ARR[BX]
0697 040A                  896             ADD AL, 10
0699 A27900                897             MOV DS:REG_AL, AL
069C 9AA804----     R      898             CALL FAR PTR DAC_UPDATE
06A1 C706C2000100          899             MOV DS:THOUSAND_FLAG, 1
06A7 EB2C90                900             JMP HUNDREDS_PLACE
06AA                       901     NOT_1:
06AA 3C00                  902             CMP AL, 0
06AC 7410                  903             JE NEXT_PLACE_1
06AE C706C2000100          904             MOV DS:THOUSAND_FLAG, 1
06B4 0412                  905             ADD AL, 18
06B6 A27900                906             MOV DS:REG_AL, AL
06B9 9AA804----     R      907             CALL FAR PTR DAC_UPDATE
06BE                       908     NEXT_PLACE_1:
06BE 43                    909             INC BX
06BF 8A87BA00              910             MOV AL, DS:TEMP_BCD_ARR[BX]
06C3 3C00                  911             CMP AL, 0
06C5 740E                  912             JE HUNDREDS_PLACE
06C7 C706C2000100          913             MOV DS:THOUSAND_FLAG, 1
06CD A27900                914             MOV DS:REG_AL, AL
06D0 9AA804----     R      915             CALL FAR PTR DAC_UPDATE
                           916     
06D5                       917     HUNDREDS_PLACE:
06D5 833EC20000            918             CMP DS:THOUSAND_FLAG, 0
06DA 7410                  919             JE NEXT_PLACE_2
06DC C60679001D            920             MOV DS:REG_AL, 29
06E1 9AA804----     R      921             CALL FAR PTR DAC_UPDATE
06E6 C706C2000000          922             MOV DS:THOUSAND_FLAG, 0
                           923             
06EC                       924     NEXT_PLACE_2:
06EC 43                    925             INC BX
06ED 8A87BA00              926             MOV AL, DS:TEMP_BCD_ARR[BX]
06F1 3C00                  927             CMP AL, 0
06F3 7412                  928             JE NEXT_PLACE_3
06F5 A27900                929             MOV DS:REG_AL, AL
06F8 9AA804----     R      930             CALL FAR PTR DAC_UPDATE
06FD C60679001C            931             MOV DS:REG_AL, 28
0702 9AA804----     R      932             CALL FAR PTR DAC_UPDATE
                           933             
0707                       934     NEXT_PLACE_3:   
0707 43                    935             INC BX
0708 8A87BA00              936             MOV AL, DS:TEMP_BCD_ARR[BX]
070C 3C01                  937             CMP AL, 1
070E 7512                  938             JNE NOT_1_2
0710 43                    939             INC BX
0711 8A87BA00              940             MOV AL, DS:TEMP_BCD_ARR[BX]
0715 040A                  941             ADD AL, 10
0717 A27900                942             MOV DS:REG_AL, AL
071A 9AA804----     R      943             CALL FAR PTR DAC_UPDATE
071F EB2090                944             JMP DECIMAL_DAC
0722                       945     NOT_1_2:
0722 3C00                  946             CMP AL, 0
0724 740A                  947             JE NEXT_PLACE_4
0726 0412                  948             ADD AL, 18
0728 A27900                949             MOV DS:REG_AL, AL
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    14:30:34  12/05/;3  PAGE   19


LOC  OBJ                  LINE     SOURCE

072B 9AA804----     R      950             CALL FAR PTR DAC_UPDATE
0730                       951     NEXT_PLACE_4:
0730 43                    952             INC BX
0731 8A87BA00              953             MOV AL, DS:TEMP_BCD_ARR[BX]
0735 3C00                  954             CMP AL, 0
0737 7408                  955             JE DECIMAL_DAC
0739 A27900                956             MOV DS:REG_AL, AL
073C 9AA804----     R      957             CALL FAR PTR DAC_UPDATE
                           958             
0741                       959     DECIMAL_DAC:
0741 C60679001E            960             MOV DS:REG_AL, 30
0746 9AA804----     R      961             CALL FAR PTR DAC_UPDATE
                           962             
074B 43                    963             INC BX
074C 8A87BA00              964             MOV AL, DS:TEMP_BCD_ARR[BX]
0750 3C01                  965             CMP AL, 1
0752 7518                  966             JNE NOT_1_3
0754 43                    967             INC BX
0755 C706C4000100          968             MOV DS:CENT_FLAG, 1
075B 8A87BA00              969             MOV AL, DS:TEMP_BCD_ARR[BX]
075F 040A                  970             ADD AL, 10
0761 A27900                971             MOV DS:REG_AL, AL
0764 9AA804----     R      972             CALL FAR PTR DAC_UPDATE
0769 EB2C90                973             JMP ENGLISH_END
                           974             
076C                       975     NOT_1_3:
076C 3C00                  976             CMP AL, 0
076E 7410                  977             JE NEXT_PLACE_5
0770 C706C4000100          978             MOV DS:CENT_FLAG, 1
0776 0412                  979             ADD AL, 18
0778 A27900                980             MOV DS:REG_AL, AL
077B 9AA804----     R      981             CALL FAR PTR DAC_UPDATE
                           982             
0780                       983     NEXT_PLACE_5:
0780 43                    984             INC BX
0781 8A87BA00              985             MOV AL, DS:TEMP_BCD_ARR[BX]
0785 3C00                  986             CMP AL, 0
0787 740E                  987             JE ENGLISH_END
0789 C706C4000100          988             MOV DS:CENT_FLAG, 1
078F A27900                989             MOV DS:REG_AL, AL
0792 9AA804----     R      990             CALL FAR PTR DAC_UPDATE
                           991             
0797                       992     ENGLISH_END:
0797 833EC40000            993             CMP DS:CENT_FLAG, 0
079C 7410                  994             JE ENGLISH_END2
079E C60679001F            995             MOV DS:REG_AL, 31
07A3 9AA804----     R      996             CALL FAR PTR DAC_UPDATE
07A8 C706C4000000          997             MOV DS:CENT_FLAG, 0
07AE                       998     ENGLISH_END2:
07AE E91E01                999             JMP CONT_BCD_UPD_1
                          1000             
07B1                      1001     MANDARIN_DAC:
07B1 C706C4000000         1002             MOV DS:CENT_FLAG, 0
07B7 C706C2000000         1003             MOV DS:THOUSAND_FLAG, 0
07BD BB0000               1004             MOV BX, 0
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    14:30:34  12/05/;3  PAGE   20


LOC  OBJ                  LINE     SOURCE

07C0 8A87BA00             1005             MOV AL, DS:TEMP_BCD_ARR[BX]
07C4 3C00                 1006             CMP AL, 0
07C6 7418                 1007             JE NEXT_PLACE_6
07C8 C706C2000100         1008             MOV DS:THOUSAND_FLAG, 1
07CE A27900               1009             MOV DS:REG_AL, AL
07D1 9AA804----     R     1010             CALL FAR PTR DAC_UPDATE
07D6 C60679000B           1011             MOV DS:REG_AL, 11
07DB 9AA804----     R     1012             CALL FAR PTR DAC_UPDATE
                          1013             
07E0                      1014     NEXT_PLACE_6:
07E0 43                   1015             INC BX
07E1 8A87BA00             1016             MOV AL, DS:TEMP_BCD_ARR[BX]
07E5 3C00                 1017             CMP AL, 0
07E7 7418                 1018             JE NEXT_PLACE_7
07E9 C706C2000100         1019             MOV DS:THOUSAND_FLAG, 1
07EF A27900               1020             MOV DS:REG_AL, AL
07F2 9AA804----     R     1021             CALL FAR PTR DAC_UPDATE
07F7 C60679000A           1022             MOV DS:REG_AL, 10
07FC 9AA804----     R     1023             CALL FAR PTR DAC_UPDATE
                          1024             
0801                      1025     NEXT_PLACE_7:
0801 43                   1026             INC BX
0802 8A87BA00             1027             MOV AL, DS:TEMP_BCD_ARR[BX]
0806 3C00                 1028             CMP AL, 0
0808 740E                 1029             JE NEXT_PLACE_8
080A C706C2000100         1030             MOV DS:THOUSAND_FLAG, 1
0810 A27900               1031             MOV DS:REG_AL, AL
0813 9AA804----     R     1032             CALL FAR PTR DAC_UPDATE
                          1033     
0818                      1034     NEXT_PLACE_8:
0818 833EC20000           1035             CMP DS:THOUSAND_FLAG, 0
081D 7410                 1036             JE IGNORE_THOUSAND
081F C60679000C           1037             MOV DS:REG_AL, 12
0824 9AA804----     R     1038             CALL FAR PTR DAC_UPDATE
0829 C706C2000000         1039             MOV DS:THOUSAND_FLAG, 0
                          1040             
082F                      1041     IGNORE_THOUSAND:
082F 43                   1042             INC BX
0830 8A87BA00             1043             MOV AL, DS:TEMP_BCD_ARR[BX]
0834 3C00                 1044             CMP AL, 0
0836 7412                 1045             JE NEXT_PLACE_9
0838 A27900               1046             MOV DS:REG_AL, AL
083B 9AA804----     R     1047             CALL FAR PTR DAC_UPDATE
0840 C60679000B           1048             MOV DS:REG_AL, 11
0845 9AA804----     R     1049             CALL FAR PTR DAC_UPDATE
                          1050             
084A                      1051     NEXT_PLACE_9:
084A 43                   1052             INC BX
084B 8A87BA00             1053             MOV AL, DS:TEMP_BCD_ARR[BX]
084F 3C00                 1054             CMP AL, 0
0851 7412                 1055             JE NEXT_PLACE_10
0853 A27900               1056             MOV DS:REG_AL, AL
0856 9AA804----     R     1057             CALL FAR PTR DAC_UPDATE
085B C60679000A           1058             MOV DS:REG_AL, 10
0860 9AA804----     R     1059             CALL FAR PTR DAC_UPDATE
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    14:30:34  12/05/;3  PAGE   21


LOC  OBJ                  LINE     SOURCE

                          1060             
0865                      1061     NEXT_PLACE_10:
0865 43                   1062             INC BX
0866 8A87BA00             1063             MOV AL, DS:TEMP_BCD_ARR[BX]
086A 3C00                 1064             CMP AL, 0
086C 7408                 1065             JE MANDARIN_DEC
086E A27900               1066             MOV DS:REG_AL, AL
0871 9AA804----     R     1067             CALL FAR PTR DAC_UPDATE
                          1068             
0876                      1069     MANDARIN_DEC:
0876 C60679000D           1070             MOV DS:REG_AL, 13
087B 9AA804----     R     1071             CALL FAR PTR DAC_UPDATE
                          1072             
0880 43                   1073             INC BX
0881 8A87BA00             1074             MOV AL, DS:TEMP_BCD_ARR[BX]
0885 3C00                 1075             CMP AL, 0
0887 7418                 1076             JE NEXT_PLACE_11
0889 C706C4000100         1077             MOV DS:CENT_FLAG, 1
088F A27900               1078             MOV DS:REG_AL, AL
0892 9AA804----     R     1079             CALL FAR PTR DAC_UPDATE
0897 C60679000A           1080             MOV DS:REG_AL, 10
089C 9AA804----     R     1081             CALL FAR PTR DAC_UPDATE
                          1082             
08A1                      1083     NEXT_PLACE_11:
                          1084     
08A1 43                   1085             INC BX
08A2 8A87BA00             1086             MOV AL, DS:TEMP_BCD_ARR[BX]
08A6 3C00                 1087             CMP AL, 0
08A8 740E                 1088             JE CONT_BCD_UPD
08AA C706C4000100         1089             MOV DS:CENT_FLAG, 1
08B0 A27900               1090             MOV DS:REG_AL, AL
08B3 9AA804----     R     1091             CALL FAR PTR DAC_UPDATE
                          1092             
08B8                      1093     CONT_BCD_UPD:
08B8 833EC40000           1094             CMP DS:CENT_FLAG, 0
08BD 7410                 1095             JE CONT_BCD_UPD_1
08BF C60679000E           1096             MOV DS:REG_AL, 14
08C4 9AA804----     R     1097             CALL FAR PTR DAC_UPDATE
08C9 C706C4000000         1098             MOV DS:CENT_FLAG, 0
                          1099     
08CF                      1100     CONT_BCD_UPD_1:
                          1101             
08CF 5A                   1102     POP DX
08D0 59                   1103     POP CX
08D1 5B                   1104     POP BX
08D2 58                   1105     POP AX
08D3 CB                   1106     RET
                          1107     CALC_DAC ENDP
                          1108     
08D4                      1109     CALC_UPD_PRICE PROC FAR
08D4 50                   1110     PUSH AX
08D5 53                   1111     PUSH BX
08D6 51                   1112     PUSH CX
08D7 52                   1113     PUSH DX
08D8 833EB20000           1114             CMP DS:QTY, 0
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    14:30:34  12/05/;3  PAGE   22


LOC  OBJ                  LINE     SOURCE

08DD 7503                 1115             JNE START_CALC
08DF E93F01               1116             JMP CALC_END
08E2                      1117     START_CALC:
08E2 BA0000               1118             MOV DX, 0
08E5 A1B000               1119             MOV AX, DS:PRICE
08E8 8B1EB200             1120             MOV BX, DS:QTY
08EC F7E3                 1121             MUL BX
                          1122             
08EE BB6400               1123             MOV BX, 100
08F1 F7F3                 1124             DIV BX
08F3 A3B000               1125             MOV DS:PRICE, AX
08F6 A1B800               1126             MOV AX, DS:TOTAL_PRICE_DEC
08F9 03C2                 1127             ADD AX, DX
08FB 3D6400               1128             CMP AX, 100
08FE 7C07                 1129             JL NON_DECIMAL
0900 FF06B600             1130             INC DS:TOTAL_PRICE_L
0904 2D6400               1131             SUB AX, 100
                          1132             
0907                      1133     NON_DECIMAL:    
0907 A3B800               1134             MOV DS:TOTAL_PRICE_DEC, AX
090A A1B600               1135             MOV AX, DS:TOTAL_PRICE_L
090D 8B1EB000             1136             MOV BX, DS:PRICE
0911 03C3                 1137             ADD AX, BX
0913 7304                 1138             JNC update_normal
0915 FF06B400             1139             INC DS:TOTAL_PRICE_U
                          1140             
0919                      1141     update_normal:
0919 A3B600               1142             MOV DS:TOTAL_PRICE_L, AX
                          1143             
091C BA0000               1144             MOV DX, 0
091F 833EB80009           1145             CMP DS:TOTAL_PRICE_DEC, 9
0924 7F0B                 1146             JG DECIMAL_CONT
0926 B90A00               1147             MOV CX, 10
0929 A1B800               1148             MOV AX, DS:TOTAL_PRICE_DEC
092C F7E1                 1149             MUL CX
092E A3B800               1150             MOV DS:TOTAL_PRICE_DEC, AX
0931                      1151     DECIMAL_CONT:
0931 A1B800               1152             MOV AX, DS:TOTAL_PRICE_DEC
0934 B90A00               1153             MOV CX, 10
0937 F7F1                 1154             DIV CX
                          1155             
0939 BB0700               1156             MOV BX, 7
093C 8897BA00             1157             MOV DS:TEMP_BCD_ARR[BX], DL
0940 4B                   1158             DEC BX
0941 8887BA00             1159             MOV DS:TEMP_BCD_ARR[BX], AL
                          1160             
0945 BB0600               1161             MOV BX, 6
0948 A1B600               1162             MOV AX, DS:TOTAL_PRICE_L
                          1163             
094B                      1164             TEMP_UPD_LOOP:
094B BA0000               1165                     MOV DX, 0
094E B90A00               1166                     MOV CX, 10
0951 F7F1                 1167                     DIV CX
                          1168                     
0953 4B                   1169                     DEC BX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    14:30:34  12/05/;3  PAGE   23


LOC  OBJ                  LINE     SOURCE

0954 8897BA00             1170                     MOV DS:TEMP_BCD_ARR[BX], DL
0958 43                   1171                     INC BX
                          1172                     
0959 4B                   1173                     DEC BX
                          1174                     
095A 75EF                 1175             JNZ TEMP_UPD_LOOP
                          1176             
095C 8B0EB400             1177             MOV CX, DS:TOTAL_PRICE_U
0960 83F900               1178             CMP CX, 0
0963 7478                 1179             JE upd_dac_part
0965                      1180             ADD_EXTRA_PART:
0965 BB0500               1181                     MOV BX, 5
0968 8A87BA00             1182                     MOV AL, DS:TEMP_BCD_ARR[BX]
096C 0406                 1183                     ADD AL, 6
096E 3C09                 1184                     CMP AL, 9
0970 7E08                 1185                     JLE CONT_DIGIT_1
0972 2C0A                 1186                     SUB AL, 10
0974 4B                   1187                     DEC BX
0975 FE87BA00             1188                     INC DS:TEMP_BCD_ARR[BX]
0979 43                   1189                     INC BX
097A                      1190             CONT_DIGIT_1:
097A 8887BA00             1191                     MOV DS:TEMP_BCD_ARR[BX], AL
097E 4B                   1192                     DEC BX
                          1193                     
097F 8A87BA00             1194                     MOV AL, DS:TEMP_BCD_ARR[BX]
0983 0403                 1195                     ADD AL, 3
0985 3C09                 1196                     CMP AL, 9
0987 7E08                 1197                     JLE CONT_DIGIT_2
0989 2C0A                 1198                     SUB AL, 10
098B 4B                   1199                     DEC BX
098C FE87BA00             1200                     INC DS:TEMP_BCD_ARR[BX]
0990 43                   1201                     INC BX
0991                      1202             CONT_DIGIT_2:
0991 8887BA00             1203                     MOV DS:TEMP_BCD_ARR[BX], AL
0995 4B                   1204                     DEC BX
                          1205                     
0996 8A87BA00             1206                     MOV AL, DS:TEMP_BCD_ARR[BX]
099A 0405                 1207                     ADD AL, 5
099C 3C09                 1208                     CMP AL, 9
099E 7E08                 1209                     JLE CONT_DIGIT_3
09A0 2C0A                 1210                     SUB AL, 10
09A2 4B                   1211                     DEC BX
09A3 FE87BA00             1212                     INC DS:TEMP_BCD_ARR[BX]
09A7 43                   1213                     INC BX
09A8                      1214             CONT_DIGIT_3:
09A8 8887BA00             1215                     MOV DS:TEMP_BCD_ARR[BX], AL
09AC 4B                   1216                     DEC BX
                          1217                     
                          1218                     
09AD 8A87BA00             1219                     MOV AL, DS:TEMP_BCD_ARR[BX]
09B1 0405                 1220                     ADD AL, 5
09B3 3C09                 1221                     CMP AL, 9
09B5 7E08                 1222                     JLE CONT_DIGIT_4
09B7 2C0A                 1223                     SUB AL, 10
09B9 4B                   1224                     DEC BX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    14:30:34  12/05/;3  PAGE   24


LOC  OBJ                  LINE     SOURCE

09BA FE87BA00             1225                     INC DS:TEMP_BCD_ARR[BX]
09BE 43                   1226                     INC BX
09BF                      1227             CONT_DIGIT_4:
09BF 8887BA00             1228                     MOV DS:TEMP_BCD_ARR[BX], AL
09C3 4B                   1229                     DEC BX
                          1230                     
09C4 8A87BA00             1231                     MOV AL, DS:TEMP_BCD_ARR[BX]
09C8 0406                 1232                     ADD AL, 6
09CA 3C09                 1233                     CMP AL, 9
09CC 7E08                 1234                     JLE CONT_DIGIT_5
09CE 2C0A                 1235                     SUB AL, 10
09D0 4B                   1236                     DEC BX
09D1 FE87BA00             1237                     INC DS:TEMP_BCD_ARR[BX]
09D5 43                   1238                     INC BX
09D6                      1239             CONT_DIGIT_5:
09D6 8887BA00             1240                     MOV DS:TEMP_BCD_ARR[BX], AL
09DA 4B                   1241                     DEC BX
                          1242                     
09DB E288                 1243             LOOP ADD_EXTRA_PART
                          1244             
09DD                      1245     upd_dac_part:
09DD 9A5106----     R     1246             CALL FAR PTR CALC_DAC
                          1247     
09E2 9A1104----     R     1248             CALL FAR PTR BCD_CLEAR
09E7 C70661000000         1249             MOV DS:KEYPAD_INDEX, 0
09ED C706AC000300         1250             MOV DS:DECIMAL_INDEX, 3
09F3 B90800               1251             MOV CX, 8
09F6                      1252             UPD_BCD:
09F6 BB0800               1253                     MOV BX, 8
09F9 2BD9                 1254                     SUB BX, CX
09FB 8A87BA00             1255                     MOV AL, DS:TEMP_BCD_ARR[BX]
09FF A27900               1256                     MOV DS:REG_AL, AL
0A02 C706AA000100         1257                     MOV DS:DAC_DISABLE, 1
0A08 9A3C04----     R     1258                     CALL FAR PTR BCD_UPDATE
0A0D C706AA000000         1259                     MOV DS:DAC_DISABLE, 0
0A13 E2E1                 1260             LOOP UPD_BCD
                          1261             
0A15 C706B0000000         1262             MOV DS:PRICE, 0
0A1B C706B2000000         1263             MOV DS:QTY, 0
0A21                      1264     CALC_END:
0A21 5A                   1265     POP DX
0A22 59                   1266     POP CX
0A23 5B                   1267     POP BX
0A24 58                   1268     POP AX
0A25 CB                   1269     RET
                          1270     CALC_UPD_PRICE ENDP
                          1271     ; ^^^^^^^^^^^^^^^ End of User main routine ^^^^^^^^^^^^^^^^^^^^^^^^^
0A26                      1272     SERIAL_REC_ACTION       PROC    FAR
0A26 51                   1273                     PUSH    CX
0A27 53                   1274                     PUSH    BX
0A28 1E                   1275                     PUSH    DS
                          1276                     
0A29 BB----         R     1277                     MOV     BX,DATA_SEG             ;initialize data segment register
0A2C 8EDB                 1278                     MOV     DS,BX
                          1279                     
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    14:30:34  12/05/;3  PAGE   25


LOC  OBJ                  LINE     SOURCE

0A2E 803E8B0001           1280                     CMP DS:REPLY_FLAG, 1
0A33 7569                 1281                     JNE next_id1
                          1282                     
0A35 803E8C0001           1283                     CMP DS:SEND_FLAG, 1
0A3A 7465                 1284                     JE send_input_across1
                          1285                     
0A3C 833EA00001           1286                     CMP DS:RECEIVE_FLAG, 1
0A41 7561                 1287                     JNE terminate_session3
                          1288                     
0A43 3C2F                 1289                     CMP AL, '/'
0A45 751A                 1290                     JNE CHECK_SEND
0A47 C706A4000000         1291                     MOV DS:PRICE_FLAG, 0
0A4D C706A0000000         1292                     MOV DS:RECEIVE_FLAG, 0
0A53 C706AE000100         1293                     MOV DS:LANG_FLAG, 1
0A59 9AD408----     R     1294                     CALL FAR PTR CALC_UPD_PRICE
0A5E EB4490               1295                     JMP terminate_session3
                          1296             
0A61                      1297             CHECK_SEND:
0A61 3C26                 1298                     CMP AL, '&'
0A63 7515                 1299                     JNE receive_price
0A65 C706A4000100         1300                     MOV DS:PRICE_FLAG, 1
0A6B C70661000000         1301                     MOV DS:KEYPAD_INDEX, 0
0A71 C7069C000800         1302                     MOV DS:MAX_INPUT_SIZE, 8
0A77 EB7F90               1303                     JMP id_skip2
                          1304                     
0A7A                      1305             receive_price:
0A7A 3C23                 1306                     CMP AL, '#'
0A7C 750F                 1307                     JNE check_price
0A7E C706A2000100         1308                     MOV DS:DAC_FLAG, 1
0A84 C706A4000000         1309                     MOV DS:PRICE_FLAG, 0
0A8A EB6C90               1310                     JMP id_skip2
                          1311             
0A8D                      1312             check_price:    
                          1313             
0A8D 833EA40001           1314                     CMP DS:PRICE_FLAG, 1
0A92 7431                 1315                     JE update_price_value
                          1316                     
0A94 833EA20001           1317                     CMP DS:DAC_FLAG, 1
0A99 740C                 1318                     JE dac_change
0A9B EB5B90               1319                     JMP id_skip2
                          1320     
0A9E                      1321             next_id1:
0A9E EB5B90               1322                     JMP next_id
                          1323                     
0AA1                      1324             send_input_across1:
0AA1 EB3990               1325                     JMP send_input_across
                          1326             
0AA4                      1327             terminate_session3:
0AA4 EB4F90               1328                     JMP terminate_session2
                          1329             
0AA7                      1330             dac_change:
0AA7 8A1E7900             1331                     MOV BL, DS:REG_AL
0AAB 2C30                 1332                     SUB AL, 30H
0AAD A27900               1333                     MOV DS:REG_AL, AL
0AB0 9AA804----     R     1334                     CALL FAR PTR DAC_UPDATE
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    14:30:34  12/05/;3  PAGE   26


LOC  OBJ                  LINE     SOURCE

0AB5 881E7900             1335                     MOV DS:REG_AL, BL
0AB9 C706A2000000         1336                     MOV DS:DAC_FLAG, 0
0ABF EB3790               1337                     JMP id_skip2
                          1338             
                          1339     
0AC2 EB3490               1340             id_skip3: JMP id_skip2
                          1341     
                          1342                     
0AC5                      1343             update_price_value:
0AC5 2C30                 1344                     SUB AL, 30H
0AC7 B90000               1345                     MOV CX, 0
0ACA 8AC8                 1346                     MOV CL, AL
0ACC A1B000               1347                     MOV AX, DS:PRICE
0ACF BB0A00               1348                     MOV BX, 10
0AD2 F7E3                 1349                     MUL BX
                          1350                     
0AD4 03C1                 1351                     ADD AX, CX
0AD6 A3B000               1352                     MOV DS:PRICE, AX
0AD9 EB1D90               1353                     JMP id_skip2
                          1354                     
0ADC                      1355             send_input_across:
0ADC 9ACB04----     R     1356                     CALL FAR PTR SEND_INPUT
                          1357                     
0AE1 C7069A000000         1358                     MOV DS:SEND_BUFFER_LEN, 0
                          1359                     
0AE7 C6068C0000           1360                     MOV DS:SEND_FLAG, 0
                          1361                     
0AEC C706A0000100         1362                     MOV DS:RECEIVE_FLAG, 1
                          1363                     
0AF2 EB0490               1364                     JMP id_skip2
                          1365                     
0AF5 EB3E90               1366                     terminate_session2: JMP terminate_session
0AF8 EB6790               1367                     id_skip2: JMP id_skip
                          1368                     
0AFB                      1369             next_id:
                          1370                     
0AFB 803E810001           1371                     CMP DS:ID_FLAG_r, 1
0B00 7513                 1372                     JNE id_flag_label
0B02 38067F00             1373                     CMP DS:MY_ID[1], AL
0B06 7559                 1374                     JNE id_skip
                          1375                     ;start writing to pc
0B08 C6068B0001           1376                     MOV DS:REPLY_FLAG, 1
0B0D C606810000           1377                     MOV DS:ID_FLAG_r, 0
0B12 EB4D90               1378                     JMP id_skip
                          1379             
0B15                      1380             id_flag_label:
                          1381             
0B15 803E800001           1382                     CMP DS:ID_FLAG_@, 1
0B1A 7539                 1383                     JNE protocol_rec
0B1C 3C72                 1384                     CMP AL,'r'
0B1E 750D                 1385                     JNE id_not_r
0B20 C606810001           1386                     MOV DS:ID_FLAG_r,1
0B25 C606800000           1387                     MOV DS:ID_FLAG_@, 0
0B2A EB6C90               1388                     JMP S_RET
0B2D                      1389             id_not_r:
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    14:30:34  12/05/;3  PAGE   27


LOC  OBJ                  LINE     SOURCE

0B2D C606800000           1390                     MOV DS:ID_FLAG_@, 0
0B32 EB2D90               1391                     JMP id_skip
                          1392             
0B35                      1393             terminate_session:
0B35 C606810000           1394                     MOV DS:ID_FLAG_r, 0
0B3A 33DB                 1395                     XOR BX,BX
0B3C                      1396             start_send1:
0B3C 50                   1397                     PUSH AX
0B3D 33C0                 1398                     XOR AX,AX
0B3F 8A878600             1399                     MOV AL, DS:FAIL_MESSAGE[BX]
0B43 9A0000----     E     1400                     CALL FAR PTR PRINT_CHAR
0B48 58                   1401                     POP AX
0B49 C6068B0000           1402                     MOV DS:REPLY_FLAG, 0
0B4E 43                   1403                     INC BX
0B4F 3A1E8A00             1404                     CMP BL, DS:FAIL_COUNT
0B53 75E7                 1405                     JNE start_send1
                          1406                     
0B55                      1407             protocol_rec:
0B55 3C40                 1408                     CMP AL,'@'
0B57 7508                 1409                     JNE id_skip
0B59 C606800001           1410                     MOV DS:ID_FLAG_@,1
0B5E EB3890               1411                     JMP S_RET
                          1412                     
0B61                      1413             id_skip:
0B61 EB3590               1414                     JMP S_RET
                          1415             
0B64 3C3C                 1416                     CMP     AL,'<'
0B66 750B                 1417                     JNE     S_FAST
                          1418     
0B68 FE061700             1419                     INC     DS:T_COUNT_SET
0B6C FE061700             1420                     INC     DS:T_COUNT_SET
                          1421     
0B70 EB0D90               1422                     JMP     S_NEXT0
0B73                      1423     S_FAST:
0B73 3C3E                 1424                     CMP     AL,'>'
0B75 7521                 1425                     JNE     S_RET
                          1426     
0B77 FE0E1700             1427                     DEC     DS:T_COUNT_SET
0B7B FE0E1700             1428                     DEC     DS:T_COUNT_SET
                          1429     
0B7F                      1430     S_NEXT0:
0B7F B91600               1431                     MOV     CX,22                   ;initialize counter for message
0B82 BB0000               1432                     MOV     BX,0
                          1433     
0B85 8A4718               1434     S_NEXT1:        MOV     AL,DS:REC_MESS[BX]      ;print message
0B88 9A0000----     E     1435                     call    FAR ptr print_char
0B8D 43                   1436                     INC     BX
0B8E E2F5                 1437                     LOOP    S_NEXT1
                          1438     
0B90 A01700               1439                     MOV     AL,DS:T_COUNT_SET       ;print current period of timer0
0B93 9A0000----     E     1440                     CALL    FAR PTR PRINT_2HEX
0B98                      1441     S_RET:
0B98 1F                   1442                     POP     DS
0B99 5B                   1443                     POP     BX
0B9A 59                   1444                     POP     CX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    14:30:34  12/05/;3  PAGE   28


LOC  OBJ                  LINE     SOURCE

0B9B CB                   1445                     RET
                          1446     SERIAL_REC_ACTION       ENDP
                          1447     
0B9C                      1448     TIMER2_ACTION   PROC    FAR
0B9C 50                   1449                     PUSH    AX
0B9D 1E                   1450                     PUSH    DS
0B9E 53                   1451                     PUSH    BX
0B9F 51                   1452                     PUSH    CX
0BA0 52                   1453                     PUSH    DX
                          1454                     
                          1455                     
0BA1 B8----         R     1456                     MOV     AX,DATA_SEG
0BA4 8ED8                 1457                     MOV     DS,AX
                          1458             
0BA6 FE0E1600             1459                     DEC     DS:T_COUNT
0BAA 754A                 1460                     JNZ     T_NEXT1
0BAC A01700               1461                     MOV     AL,DS:T_COUNT_SET
0BAF A21600               1462                     MOV     DS:T_COUNT,AL
                          1463     
0BB2                      1464     T_NEXT0:
                          1465                     
0BB2 33DB                 1466                     XOR BX, BX
0BB4 8A1E6000             1467                     MOV BL, DS:BCD_INDEX
0BB8 8A4759               1468                     MOV AL, DS:BCD_MESSAGE[BX]
                          1469                     
0BBB 3B1EAC00             1470                     CMP BX, DS:DECIMAL_INDEX
0BBF 7506                 1471                     JNE CALL_FUNC
0BC1 C706A6000100         1472                     MOV DS:DECIMAL_FLAG, 1
0BC7                      1473     CALL_FUNC:
0BC7 9A670C----     R     1474                     CALL FAR PTR BCD_TO_7SEG
0BCC C706A6000000         1475                     MOV DS:DECIMAL_FLAG, 0
                          1476     
0BD2 BA0002               1477                     MOV DX, 200H
0BD5 EE                   1478                     OUT DX, AL
                          1479                     
0BD6 A05F00               1480                     MOV AL, DS:ENABLE_BYTE
0BD9 BA8001               1481                     MOV DX, 180H
0BDC EE                   1482                     OUT DX, AL
                          1483                     
                          1484     
0BDD FE066000             1485                     INC DS:BCD_INDEX
0BE1 D0065F00             1486                     ROL DS:ENABLE_BYTE, 1
0BE5 803E5F00BF           1487                     CMP DS:ENABLE_BYTE, 10111111b
0BEA 750A                 1488                     JNE T_NEXT1
0BEC C6065F00FE           1489                     MOV DS:ENABLE_BYTE, 11111110b 
0BF1 C606600000           1490                     MOV DS:BCD_INDEX, 0
                          1491     
                          1492                     
0BF6                      1493     T_NEXT1:
0BF6 803E750000           1494                     CMP DS:DAC_LEN, 0
0BFB 743C                 1495                     JE ISR_END
                          1496                     
                          1497                     
0BFD 8B367600             1498                     MOV SI, DS:SI_PTR
                          1499                             
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    14:30:34  12/05/;3  PAGE   29


LOC  OBJ                  LINE     SOURCE

0C01 BB0000               1500                     MOV BX, 0
0C04 33C0                 1501                     XOR AX, AX
0C06 8A4766               1502                     MOV AL, DS:DAC_ADDR[BX]
                          1503                     
0C09 BB0001               1504                     MOV BX, 100H
0C0C F7E3                 1505                     MUL BX
                          1506                     
0C0E 8B166400             1507                     MOV DX, DS:DAC_BASE
0C12 03D0                 1508                     ADD DX, AX
                          1509                     
0C14 1E                   1510                     PUSH DS
0C15 8EDA                 1511                     MOV DS, DX
                          1512                     
0C17 8B04                 1513                     MOV AX, [SI]
                          1514                     
0C19 BA1001               1515                     MOV DX, 110H
0C1C EE                   1516                     OUT DX, AL
                          1517                     
0C1D 1F                   1518                     POP DS
                          1519                     
0C1E FF067600             1520                     INC DS:SI_PTR
0C22 813E76000010         1521                     CMP DS:SI_PTR, 1000H
0C28 750F                 1522                     JNE ISR_END
                          1523                     
0C2A C70676000000         1524                     MOV DS:SI_PTR, 0
0C30 FE0E7500             1525                     DEC DS:DAC_LEN
0C34 9A3F0C----     R     1526                     CALL FAR PTR DAC_SHIFT
                          1527                     
0C39                      1528     ISR_END:
                          1529                     
0C39 5A                   1530                     POP DX
0C3A 59                   1531                     POP     CX
0C3B 5B                   1532                     POP     BX
0C3C 1F                   1533                     POP     DS
0C3D 58                   1534                     POP AX
0C3E CB                   1535                     RET
                          1536     TIMER2_ACTION   ENDP
                          1537     
                          1538     
0C3F                      1539     DAC_SHIFT PROC FAR
0C3F 50                   1540             PUSH AX
0C40 53                   1541             PUSH BX
0C41 51                   1542             PUSH CX
0C42 52                   1543             PUSH DX
                          1544     
0C43 33C9                 1545             XOR CX, CX
0C45 8A0E7500             1546             MOV CL, DS:DAC_LEN
0C49 80F900               1547             CMP CL, 0
0C4C 7414                 1548             JE END_SHIFT
                          1549     
0C4E                      1550             SHIFT_LOOP:
                          1551     
0C4E 33DB                 1552             XOR BX, BX
0C50 8A1E7500             1553             MOV BL, DS:DAC_LEN
0C54 2BD9                 1554             SUB BX, CX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    14:30:34  12/05/;3  PAGE   30


LOC  OBJ                  LINE     SOURCE

0C56 43                   1555             INC BX
                          1556             
0C57 33D2                 1557             XOR DX, DX
0C59 8A5766               1558             MOV DL, DS:DAC_ADDR[BX]
0C5C 4B                   1559             DEC BX
0C5D 885766               1560             MOV DS:DAC_ADDR[BX], DL
                          1561     
0C60 E2EC                 1562             LOOP SHIFT_LOOP
                          1563             
0C62                      1564             END_SHIFT:
0C62 5A                   1565             POP DX
0C63 59                   1566             POP CX
0C64 5B                   1567             POP BX
0C65 58                   1568             POP AX
0C66 CB                   1569             RET
                          1570     DAC_SHIFT ENDP
                          1571     
0C67                      1572     BCD_TO_7SEG PROC FAR
                          1573     
0C67 53                   1574             PUSH BX
0C68 51                   1575             PUSH CX
0C69 52                   1576             PUSH DX
                          1577             
0C6A 3C00                 1578             CMP AL, 0
0C6C 7511                 1579             JNE one
0C6E 833EA60001           1580             CMP DS:DECIMAL_FLAG, 1
0C73 7405                 1581             JE decimal0
0C75 B03F                 1582             MOV AL, 00111111b
0C77 E9D700               1583             JMP endfunc
0C7A                      1584     decimal0:
0C7A B0BF                 1585             MOV AL, 10111111b
0C7C E9D200               1586             JMP endfunc
                          1587             
0C7F                      1588             one:
0C7F 3C01                 1589             CMP AL, 1
0C81 7511                 1590             JNE two
0C83 833EA60001           1591             CMP DS:DECIMAL_FLAG, 1
0C88 7405                 1592             JE decimal1
0C8A B006                 1593             MOV AL, 00000110b
0C8C E9C200               1594             JMP endfunc
0C8F                      1595     decimal1:
0C8F B086                 1596             MOV AL, 10000110b
0C91 E9BD00               1597             JMP endfunc
                          1598             
0C94                      1599             two:
0C94 3C02                 1600             CMP AL,2
0C96 7511                 1601             JNE three
0C98 833EA60001           1602             CMP DS:DECIMAL_FLAG, 1
0C9D 7405                 1603             JE decimal2
0C9F B05B                 1604             MOV AL, 01011011b
0CA1 E9AD00               1605             JMP endfunc
0CA4                      1606     decimal2:
0CA4 B0DB                 1607             MOV AL, 11011011b
0CA6 E9A800               1608             JMP endfunc
                          1609             
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    14:30:34  12/05/;3  PAGE   31


LOC  OBJ                  LINE     SOURCE

0CA9                      1610             three:
0CA9 3C03                 1611             CMP AL,3
0CAB 7511                 1612             JNE four
0CAD 833EA60001           1613             CMP DS:DECIMAL_FLAG, 1
0CB2 7405                 1614             JE decimal3
0CB4 B04F                 1615             MOV AL, 01001111b
0CB6 E99800               1616             JMP endfunc
0CB9                      1617     decimal3:
0CB9 B0CF                 1618             MOV AL, 11001111b
0CBB E99300               1619             JMP endfunc
                          1620             
0CBE                      1621             four:
0CBE 3C04                 1622             CMP AL,4
0CC0 7511                 1623             JNE five
0CC2 833EA60001           1624             CMP DS:DECIMAL_FLAG, 1
0CC7 7405                 1625             JE decimal4
0CC9 B066                 1626             MOV AL, 01100110b
0CCB E98300               1627             JMP endfunc
0CCE                      1628     decimal4:
0CCE B0E6                 1629             MOV AL, 11100110b
0CD0 EB7F90               1630             JMP endfunc
                          1631             
0CD3                      1632             five:
0CD3 3C05                 1633             CMP AL,5
0CD5 7511                 1634             JNE six
0CD7 833EA60001           1635             CMP DS:DECIMAL_FLAG, 1
0CDC 7405                 1636             JE decimal5
0CDE B06D                 1637             MOV AL, 01101101b
0CE0 EB6F90               1638             JMP endfunc
0CE3                      1639     decimal5:
0CE3 B0ED                 1640             MOV AL, 11101101b
0CE5 EB6A90               1641             JMP endfunc
                          1642             
0CE8                      1643             six:
0CE8 3C06                 1644             CMP AL,6
0CEA 7511                 1645             JNE seven
0CEC 833EA60001           1646             CMP DS:DECIMAL_FLAG, 1
0CF1 7405                 1647             JE decimal6
0CF3 B07D                 1648             MOV AL, 01111101b
0CF5 EB5A90               1649             JMP endfunc
0CF8                      1650     decimal6:
0CF8 B0FD                 1651             MOV AL, 11111101b
0CFA EB5590               1652             JMP endfunc
                          1653             
0CFD                      1654             seven:
0CFD 3C07                 1655             CMP AL,7
0CFF 7511                 1656             JNE eight
0D01 833EA60001           1657             CMP DS:DECIMAL_FLAG, 1
0D06 7405                 1658             JE decimal7
0D08 B007                 1659             MOV AL, 00000111b
0D0A EB4590               1660             JMP endfunc
0D0D                      1661     decimal7:
0D0D B087                 1662             MOV AL, 10000111b
0D0F EB4090               1663             JMP endfunc
                          1664             
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    14:30:34  12/05/;3  PAGE   32


LOC  OBJ                  LINE     SOURCE

0D12                      1665             eight:
0D12 3C08                 1666             CMP AL,8
0D14 7511                 1667             JNE nine
0D16 833EA60001           1668             CMP DS:DECIMAL_FLAG, 1
0D1B 7405                 1669             JE decimal8
0D1D B07F                 1670             MOV AL, 01111111b
0D1F EB3090               1671             JMP endfunc
0D22                      1672     decimal8:
0D22 B0FF                 1673             MOV AL, 11111111b
0D24 EB2B90               1674             JMP endfunc
                          1675             
0D27                      1676             nine:
0D27 3C09                 1677             CMP AL,9
0D29 7511                 1678             JNE hifn
0D2B 833EA60001           1679             CMP DS:DECIMAL_FLAG, 1
0D30 7405                 1680             JE decimal9
0D32 B06F                 1681             MOV AL, 01101111b
0D34 EB1B90               1682             JMP endfunc
0D37                      1683     decimal9:
0D37 B0EF                 1684             MOV AL, 11101111b
0D39 EB1690               1685             JMP endfunc
                          1686             
0D3C                      1687             hifn:
0D3C 3C2D                 1688             CMP AL,'-'
0D3E 7511                 1689             JNE endfunc
0D40 833EA60001           1690             CMP DS:DECIMAL_FLAG, 1
0D45 7405                 1691             JE decimal10
0D47 B040                 1692             MOV AL, 01000000b
0D49 EB0690               1693             JMP endfunc
0D4C                      1694     decimal10:
0D4C B0C0                 1695             MOV AL, 11000000b
0D4E EB0190               1696             JMP endfunc
                          1697             
0D51                      1698             endfunc:
0D51 5A                   1699             POP DX
0D52 59                   1700             POP CX
0D53 5B                   1701             POP BX
                          1702     
0D54 CB                   1703     RET
                          1704     BCD_TO_7SEG ENDP
                          1705     
----                      1706     CODE_SEG        ENDS
                          1707     END

ASSEMBLY COMPLETE, NO ERRORS FOUND
