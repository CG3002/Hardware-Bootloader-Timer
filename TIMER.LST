8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:31:49  11/21/;3  PAGE    1


DOS 5.0 (038-N) 8086/87/88/186 MACRO ASSEMBLER V3.1 ASSEMBLY OF MODULE TIMER
OBJECT MODULE PLACED IN TIMER.OBJ
ASSEMBLER INVOKED BY:  D:\ASM86.EXE TIMER.ASM


LOC  OBJ                  LINE     SOURCE

                             1 +1  $MOD186
                             2 +1  $EP
                             3     NAME TIMER
                             4     ; Main program for uPD70208 microcomputer system
                             5     ;
                             6     ; Author:       Dr Tay Teng Tiow
                             7     ; Address:      Department of Electrical Engineering 
                             8     ;               National University of Singapore
                             9     ;               10, Kent Ridge Crescent
                            10     ;               Singapore 0511. 
                            11     ; Date:         6th September 1991
                            12     ;
                            13     ; This file contains proprietory information and cannot be copied 
                            14     ; or distributed without prior permission from the author.
                            15     ; =========================================================================
                            16     
                            17     public  serial_rec_action, timer2_action
                            18     extrn   print_char:far, print_2hex:far, iodefine:far
                            19     extrn   set_timer2:far
                            20     
                            21     ;IO Setup for 80C188 
  FFA0                      22             UMCR    EQU    0FFA0H ; Upper Memory Control Register
  FFA2                      23             LMCR    EQU    0FFA2H ; Lower Memory control Register         
  FFA4                      24             PCSBA   EQU    0FFA4H ; Peripheral Chip Select Base Address
  FFA8                      25             MPCS    EQU    0FFA8H ; MMCS and PCS Alter Control Register
  0080                      26             A_8255  EQU    0080H
  0081                      27             B_8255  EQU    0081H
  0082                      28             C_8255  EQU    0082H
  0083                      29             CWR_8255  EQU    0083H
  FF38                      30             INT0CON  EQU   0FF38H
  FF22                      31             EOI EQU 0FF22H
  FF28                      32             IMASK EQU 0FF28H
  FFA6                      33             MMCS    EQU    0FFA6H 
  4000                      34             DAC EQU 4000H
                            35     
                            36     
----                        37     STACK_SEG       SEGMENT
0000 (512                   38                     DB      512 DUP(?)
     ??
     )
0200                        39             TOS     LABEL   WORD
----                        40     STACK_SEG       ENDS
                            41     
                            42     
----                        43     DATA_SEG        SEGMENT
0000 0A                     44             TIMER0_MESS             DB      10,13,'TIMER2 INTERRUPT    '
0001 0D
0002 54494D45523220
     494E5445525255
     505420202020
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:31:49  11/21/;3  PAGE    2


LOC  OBJ                  LINE     SOURCE

0016 18                     45             T_COUNT                 DB      24
0017 18                     46             T_COUNT_SET             DB      24
0018 0A                     47             REC_MESS                DB      10,13,'Period of timer0 =     '
0019 0D
001A 506572696F6420
     6F662074696D65
     7230203D202020
     2020
0031 (32                    48             MESSAGE         DB  32 dup('h')
     68
     )
0051 00                     49             KEYPAD_INPUT    DB  0,0,0,0,0,0,0,0
0052 00
0053 00
0054 00
0055 00
0056 00
0057 00
0058 00
0059 2D                     50             BCD_MESSAGE     DB  '-','-','-','-','-','-'
005A 2D
005B 2D
005C 2D
005D 2D
005E 2D
005F FE                     51             ENABLE_BYTE     DB  11111110b
0060 00                     52             BCD_INDEX       DB  0
0061 0000                   53             KEYPAD_INDEX    DW      0
0063 20                     54             M_SIZE                  DB  32
0064 0040                   55             DAC_BASE        DW  4000H
0066 (15                    56             DAC_ADDR        DB  15 dup(0) 
     00
     )
0075 00                     57             DAC_LEN         DB  0
0076 0000                   58             SI_PTR          DW  0
0078 ??                     59             CHAR                    DB  ?
0079 ??                     60             REG_AL                  DB  ?
007A ??                     61             REG_BH                  DB  ?
007B ??                     62             REG_CL                  DB  ?
007C 00                     63             FLAG            DB  0
007D 00                     64             LONG_PRESS_FLAG DB      0
007E 7231                   65             MY_ID                   DB      'r1'
0080 00                     66             ID_FLAG_@               DB      0
0081 00                     67             ID_FLAG_r               DB      0
0082 4072312F               68             REPLY_MESSAGE   DB      '@r1/'
0086 40302F                 69             FAIL_MESSAGE    DB '@0/'
0089 04                     70             REPLY_COUNT             DB      4
008A 03                     71             FAIL_COUNT              DB      3
008B 00                     72             REPLY_FLAG              DB      0
008C 00                     73             SEND_FLAG       DB  0
008D (13                    74             SEND_BUFFER     DB  13 dup(0)
     00
     )
009A 0000                   75             SEND_BUFFER_LEN DW      0
009C 0000                   76             MAX_INPUT_SIZE  DW      0
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:31:49  11/21/;3  PAGE    3


LOC  OBJ                  LINE     SOURCE

009E 0000                   77             QTY_FLAG                DW      0
00A0 0000                   78             RECEIVE_FLAG    DW      0
00A2 0000                   79             DAC_FLAG                DW      0
00A4 0000                   80             PRICE_FLAG      DW      0
00A6 0100                   81             DECIMAL_FLAG    DW      1
00A8 0000                   82             SCROLL_LEN      DW      0
00AA 0000                   83             DAC_DISABLE     DW  0
00AC 0300                   84             DECIMAL_INDEX   DW  3
00AE 0100                   85             LANG_FLAG     DW  1
----                        86     DATA_SEG        ENDS
                            87     
                            88     
----                        89     CODE_SEG        SEGMENT
                            90     
                            91             PUBLIC          START
                            92     
                            93     ASSUME  CS:CODE_SEG, SS:STACK_SEG
                            94     
0000                        95     START:
                            96     ;initialize stack area
0000 B8----         R       97                     MOV     AX,STACK_SEG            
0003 8ED0                   98                     MOV     SS,AX
0005 368B260002             99                     MOV     SP,TOS
                           100                     
                           101     ; Initialize the on-chip pheripherals
000A 9A0000----     E      102                     CALL    FAR PTR IODEFINE
                           103                     
000F 9A0000----     E      104     call set_timer2
0014 FB                    105                    STI
                           106     
                           107     ; ^^^^^^^^^^^^^^^^^  Start of User Main Routine  ^^^^^^^^^^^^^^^^^^
                           108     
                           109     ;Initialize MMCS
                           110             
0015 BAA6FF                111             MOV DX, MMCS
0018 B80340                112             MOV AX, 4003H
001B EF                    113             OUT DX, AX
                           114     
                           115     ; Initialize MPCS to MAP peripheral to IO address
                           116             
001C BAA8FF                117             MOV DX, MPCS
001F B88320                118             MOV AX, 2083H
0022 EF                    119             OUT DX, AX
                           120        
                           121     ; PCSBA initial, set the parallel port start from 00H
0023 BAA4FF                122             MOV DX, PCSBA
0026 B80300                123             MOV AX, 0003H ; Peripheral starting address 00H no READY, No Waits
0029 EF                    124             OUT DX, AX
                           125     
                           126     ; Initialize LMCS 
002A BAA2FF                127         MOV DX, LMCR
002D B8C401                128         MOV AX, 01C4H  ; Starting address 1FFFH, 8K, No waits, last shoud be 5H for 1 wai
                                   ts      
0030 EF                    129         OUT DX, AX
                           130             
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:31:49  11/21/;3  PAGE    4


LOC  OBJ                  LINE     SOURCE

0031 B8----         R      131             MOV AX, DATA_SEG
0034 8ED8                  132             MOV DS, AX
                           133                              
0036 BA8300                134             MOV DX, CWR_8255
0039 B88200                135             MOV AX, 0082h
003C EF                    136             OUT DX, AX
                           137             
003D                       138     NEXT:
003D 9A4400----     R      139             CALL FAR PTR KEYPAD_LOOP
                           140             
0042 EBF9                  141     JMP NEXT
                           142     
0044                       143     KEYPAD_LOOP PROC FAR
0044 50                    144     PUSH AX
0045 53                    145     PUSH BX
0046 51                    146     PUSH CX
0047 52                    147     PUSH DX
                           148             
0048 9A3104----     R      149                             CALL FAR PTR DEBOUNCE           
                           150                             
004D C606790003            151     WAIT_1:         MOV DS:REG_AL, 03H
0052 BB0000                152                         MOV BX, 0000H
0055 BA8200                153                         MOV DX,C_8255
0058 8AC3                  154                         MOV AL,BL
005A EE                    155                         OUT DX,AL
                           156                        
005B BA8100                157                         MOV DX,B_8255
005E EC                    158                         IN AL,DX
005F 8AD8                  159                         MOV BL,AL  
0061 80E3FC                160                         AND BL,0FCH
0064 80FBFC                161                         CMP BL,0FCH
                           162                      
0067 7449                  163                     JE LONG_PRESS
                           164                             
0069 B3FE                  165                         MOV BL, 0FEH
006B C6067A0004            166                         MOV DS:REG_BH, 04H
                           167                        
0070                       168     NXTROW: 
0070 C0C307                169                     ROL BL,07H
0073 8AEB                  170                             MOV CH,BL
0075 BA8200                171                             MOV DX,C_8255
0078 8AC3                  172                             MOV AL,BL
007A EE                    173                             OUT DX,AL
                           174                             
007B BA8100                175                             MOV DX,B_8255
007E EC                    176                             IN AL,DX
007F 8AD8                  177                             MOV BL,AL
0081 80E3FC                178                             AND BL,0FCH
0084 C6067B0006            179                             MOV DS:REG_CL,06H
0089 C0DB02                180                             RCR BL,02H
008C D0DB                  181     NXTCOL:         RCR BL,01H
008E 732A                  182                             JNC CODEKY
0090 FE0E7900              183                             DEC DS:REG_AL
0094 FE0E7B00              184                             DEC DS:REG_CL
0098 803E7B0003            185                             CMP DS:REG_CL,03H
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:31:49  11/21/;3  PAGE    5


LOC  OBJ                  LINE     SOURCE

009D 7470                  186                             JE KEYPAD3
                           187                             
009F 803E7B0000            188                             CMP DS:REG_CL, 0H
00A4 7466                  189                             JE SUBTRACT2
00A6 EBE4                  190                             JMP NXTCOL
                           191                             
00A8 8ADD                  192                             MOV BL,CH
00AA FE0E7A00              193                             DEC DS:REG_BH
00AE 75C0                  194                             JNZ NXTROW
00B0 EB9B                  195                             JMP WAIT_1
                           196                             
00B2                       197     LONG_PRESS:
00B2 C6067D0000            198                             MOV DS:LONG_PRESS_FLAG, 0
00B7 EB5990                199                             JMP RETURN2
00BA                       200     CODEKY:
00BA 803E79000B            201                         CMP DS:REG_AL, 11
00BF 7505                  202                             JNE bcd_upd
00C1 C606790000            203                             MOV DS:REG_AL, 0
                           204                             
00C6                       205     bcd_upd:
00C6 803E7D0000            206                             CMP DS:LONG_PRESS_FLAG, 0
00CB 7545                  207                             JNE RETURN2
                           208                             
00CD 803E79000A            209                             CMP DS:REG_AL, 10
00D2 7508                  210                             JNE BACKSPACE
00D4 9A8003----     R      211                             CALL FAR PTR BCD_CLEAR
00D9 E9E900                212                             JMP UPDATE_7SEG2
                           213                             
00DC 803E79000C            214     BACKSPACE:      CMP DS:REG_AL, 12
00E1 7508                  215                             JNE ENTER_DATA
00E3 9A1103----     R      216                             CALL FAR PTR BCD_BACKSPACE
00E8 E9DA00                217                             JMP UPDATE_7SEG2
                           218     
00EB 803E79000D            219     ENTER_DATA:     CMP DS:REG_AL, 13
00F0 7523                  220                             JNE END_TRANS
00F2 9A8003----     R      221                             CALL FAR PTR BCD_CLEAR
00F7 C706AC000600          222                             MOV DS:DECIMAL_INDEX, 6
00FD C7069C000800          223                             MOV DS:MAX_INPUT_SIZE, 8
0103 C706AE000000          224                             MOV DS:LANG_FLAG, 0
0109 E9B900                225                             JMP UPDATE_7SEG2
                           226     
010C E97601                227     SUBTRACT2:   JMP SUBTRACT
                           228     
010F E96301                229     KEYPAD3:        JMP KEYPAD_2
                           230     
0112 E97E01                231     RETURN2:    JMP RETURN
                           232                             
0115 803E790010            233     END_TRANS:      CMP DS:REG_AL, 16
011A 751C                  234                             JNE SCROLL_LEFT
011C BB0000                235                             MOV BX, 0
011F C6878D0024            236                             MOV DS:SEND_BUFFER[BX], '$'
0124 43                    237                             INC BX
0125 C6878D002F            238                             MOV DS:SEND_BUFFER[BX], '/'
012A C7069A000200          239                             MOV DS:SEND_BUFFER_LEN, 2
0130 C6068C0001            240                             MOV DS:SEND_FLAG, 1
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:31:49  11/21/;3  PAGE    6


LOC  OBJ                  LINE     SOURCE

0135 E98D00                241                             JMP UPDATE_7SEG2
                           242                             
                           243                             
0138                       244     SCROLL_LEFT:
0138 803E790015            245                             CMP DS:REG_AL, 21
013D 753D                  246                             JNE SCROLL_RIGHT
013F 833E610006            247                             CMP DS:KEYPAD_INDEX, 6
0144 7E7F                  248                             JLE UPDATE_7SEG2
0146 833EA80000            249                             CMP DS:SCROLL_LEN, 0
014B 7478                  250                             JE UPDATE_7SEG2
014D FF0EA800              251                             DEC DS:SCROLL_LEN
0151 FF0EAC00              252                             DEC DS:DECIMAL_INDEX
0155 FF0E6100              253                             DEC DS:KEYPAD_INDEX
0159 8B1E6100              254                             MOV BX, DS:KEYPAD_INDEX
015D 8A4751                255                             MOV AL, DS:KEYPAD_INPUT[BX]
0160 A27900                256                             MOV DS:REG_AL, AL
0163 C706AA000100          257                             MOV DS:DAC_DISABLE, 1
0169 9AAB03----     R      258                             CALL FAR PTR BCD_UPDATE
016E C706AA000000          259                             MOV DS:DAC_DISABLE, 0
0174 C606790015            260                             MOV DS:REG_AL, 21
0179 EB4A90                261                             JMP UPDATE_7SEG2
                           262     
                           263     
                           264     
017C                       265     SCROLL_RIGHT:
017C 803E790013            266                             CMP DS:REG_AL, 19
0181 7545                  267                             JNE LANG_TOGGLE
0183 833E610006            268                             CMP DS:KEYPAD_INDEX, 6
0188 7E3B                  269                             JLE UPDATE_7SEG2
018A A16100                270                             MOV AX, DS:KEYPAD_INDEX
018D 2D0600                271                             SUB AX, 6
0190 3906A800              272                             CMP DS:SCROLL_LEN, AX
0194 742F                  273                             JE UPDATE_7SEG2
0196 FF06A800              274                             INC DS:SCROLL_LEN
019A FF06AC00              275                             INC DS:DECIMAL_INDEX
019E FF0E6100              276                             DEC DS:KEYPAD_INDEX
01A2 8B1E6100              277                             MOV BX, DS:KEYPAD_INDEX
01A6 8A4751                278                             MOV AL, DS:KEYPAD_INPUT[BX]
01A9 A27900                279                             MOV DS:REG_AL, AL
01AC C706AA000100          280                             MOV DS:DAC_DISABLE, 1
01B2 9AAB03----     R      281                             CALL FAR PTR BCD_UPDATE
01B7 C706AA000000          282                             MOV DS:DAC_DISABLE, 0
01BD C606790013            283                             MOV DS:REG_AL, 19
01C2 EB0190                284                             JMP UPDATE_7SEG2
                           285                             
01C5 E99900                286     UPDATE_7SEG2: JMP UPDATE_7SEG
                           287     
01C8                       288     LANG_TOGGLE:
01C8 803E790012            289                             CMP DS:REG_AL, 18
01CD 7537                  290                             JNE QTY_PROMPT
01CF 833EAE0001            291                             CMP DS:LANG_FLAG, 1
01D4 75EF                  292                             JNE UPDATE_7SEG2
01D6 A16400                293                             MOV AX, DS:DAC_BASE
01D9 3D0040                294                             CMP AX, 4000H
01DC 7406                  295                             JE MANDRIN
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:31:49  11/21/;3  PAGE    7


LOC  OBJ                  LINE     SOURCE

01DE B80040                296                             MOV AX, 4000H
01E1 EB0490                297                             JMP SEND_TOGGLE
01E4                       298             MANDRIN:
01E4 B80063                299                             MOV AX, 6300H
01E7                       300             SEND_TOGGLE:
01E7 A36400                301                             MOV DS:DAC_BASE, AX
01EA BB0000                302                             MOV BX, 0
01ED C6878D0021            303                             MOV DS:SEND_BUFFER[BX], '!'
01F2 43                    304                             INC BX
01F3 C6878D002F            305                             MOV DS:SEND_BUFFER[BX], '/'
01F8 C7069A000200          306                             MOV DS:SEND_BUFFER_LEN, 2
01FE C6068C0001            307                             MOV DS:SEND_FLAG, 1
0203 EB5C90                308                             JMP UPDATE_7SEG
0206                       309     QTY_PROMPT:
0206 833E610008            310                             CMP DS:KEYPAD_INDEX, 8
020B 7527                  311                             JNE  QUANTITY
020D 803E790016            312                             CMP DS:REG_AL, 22
0212 7520                  313                             JNE QUANTITY
0214 833E9C0008            314                             CMP DS:MAX_INPUT_SIZE, 8
0219 7519                  315                             JNE QUANTITY
021B 9ACA02----     R      316                             CALL FAR PTR UPDATE_SEND_BUFFER
0220 9A8003----     R      317                             CALL FAR PTR BCD_CLEAR
0225 C7069C000200          318                             MOV DS:MAX_INPUT_SIZE, 2
022B C7069E000100          319                             MOV DS:QTY_FLAG, 1
0231 EB2E90                320                             JMP UPDATE_7SEG
                           321                     
0234                       322     QUANTITY:
0234 833E610000            323                             CMP DS:KEYPAD_INDEX, 0
0239 7426                  324                             JE  UPDATE_7SEG
                           325                             
023B 803E79000E            326                             CMP DS:REG_AL, 14
0240 751F                  327                             JNE UPDATE_7SEG
                           328                             
0242 833E9E0001            329                             CMP DS:QTY_FLAG, 1
0247 7518                  330                             JNE UPDATE_7SEG
                           331                             
0249 9A9802----     R      332                             CALL FAR PTR UPDATE_THE_QUANTITY
                           333                                             
024E C6068C0001            334                             MOV DS:SEND_FLAG, 1
                           335                             
0253 C7069E000000          336                             MOV DS:QTY_FLAG, 0
0259 9A8003----     R      337                             CALL FAR PTR BCD_CLEAR
025E EB0190                338                             JMP UPDATE_7SEG
                           339                             
                           340     
0261                       341     UPDATE_7SEG:
0261 803E790009            342                             CMP DS:REG_AL, 9
0266 7F05                  343                             JG SET_PRESS_FLAG
                           344                             
0268 9AAB03----     R      345                             CALL FAR PTR BCD_UPDATE
                           346                             
026D                       347     SET_PRESS_FLAG:
026D C6067D0001            348                             MOV DS:LONG_PRESS_FLAG, 1
0272 EB1F90                349                             JMP RETURN
                           350             
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:31:49  11/21/;3  PAGE    8


LOC  OBJ                  LINE     SOURCE

0275                       351     KEYPAD_2: 
0275 800679000F            352                 ADD DS:REG_AL,0FH
027A E90FFE                353                             JMP NXTCOL
027D C606790000            354     ZERO_PRINT: MOV DS:REG_AL,00H
0282 E907FE                355                             JMP NXTCOL
0285 802E790006            356     SUBTRACT:   SUB DS:REG_AL,06H
028A 8ADD                  357                             MOV BL,CH
028C FE0E7A00              358                             DEC DS:REG_BH
0290 E9DDFD                359                             JMP NXTROW
                           360             
                           361             
0293                       362     RETURN:
0293 5A                    363                             POP DX
0294 59                    364                             POP CX
0295 5B                    365                             POP BX
0296 58                    366                             POP AX
0297 CB                    367                             RET
                           368     
                           369     KEYPAD_LOOP ENDP
                           370     
0298                       371     UPDATE_THE_QUANTITY PROC FAR
0298 50                    372     PUSH AX
0299 53                    373     PUSH BX
029A 51                    374     PUSH CX
029B 52                    375     PUSH DX
029C 8B0E6100              376             MOV CX, DS:KEYPAD_INDEX
02A0 8B1E9A00              377             MOV BX, DS:SEND_BUFFER_LEN
                           378             
02A4                       379             UPD_QTY:
02A4 53                    380                     PUSH BX
02A5 8B1E6100              381                     MOV BX, DS:KEYPAD_INDEX
02A9 2BD9                  382                     SUB BX, CX
02AB 8A4751                383                     MOV AL, DS:KEYPAD_INPUT[BX]
02AE 5B                    384                     POP BX
02AF 0430                  385                     ADD AL, 30H
02B1 88878D00              386                     MOV DS:SEND_BUFFER[BX], AL
                           387                     
02B5 43                    388                     INC BX
02B6 FF069A00              389                     INC DS:SEND_BUFFER_LEN
                           390                     
02BA E2E8                  391             LOOP UPD_QTY
02BC C6878D002F            392                     MOV DS:SEND_BUFFER[BX], '/'
02C1 FF069A00              393                     INC DS:SEND_BUFFER_LEN
                           394     
02C5 5A                    395     POP DX
02C6 59                    396     POP CX
02C7 5B                    397     POP BX
02C8 58                    398     POP AX
                           399     
02C9 CB                    400     RET
                           401     UPDATE_THE_QUANTITY ENDP
                           402     
02CA                       403     UPDATE_SEND_BUFFER PROC FAR
02CA 50                    404     PUSH AX
02CB 53                    405     PUSH BX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:31:49  11/21/;3  PAGE    9


LOC  OBJ                  LINE     SOURCE

02CC 51                    406     PUSH CX
02CD 52                    407     PUSH DX
                           408     
02CE 8B0E6100              409             MOV CX, DS:KEYPAD_INDEX
02D2 83F900                410             CMP CX, 0
02D5 7435                  411             JE END_UPD_BUFFER
02D7 83C102                412             ADD CX, 2
02DA 890E9A00              413             MOV DS:SEND_BUFFER_LEN, CX
02DE BB0000                414             MOV BX, 0
02E1                       415             BUFFER_LOOP:
02E1 83FB00                416                     CMP BX, 0
02E4 7508                  417                     JNE ASTRISK
02E6 C6878D007E            418                     MOV DS:SEND_BUFFER[BX], '~'
02EB EB1C90                419                     JMP END_BUFFER
02EE                       420             ASTRISK:
02EE A16100                421                     MOV AX, DS:KEYPAD_INDEX
02F1 40                    422                     INC AX
02F2 3BD8                  423                     CMP BX, AX
02F4 7508                  424                     JNE CONT
02F6 C6878D002A            425                     MOV DS:SEND_BUFFER[BX], '*'
02FB EB0C90                426                     JMP END_BUFFER
02FE                       427             CONT:
02FE 4B                    428                     DEC BX
02FF 8A4751                429                     MOV AL, DS:KEYPAD_INPUT[BX]
0302 0430                  430                     ADD AL, 30H
0304 43                    431                     INC BX
0305 88878D00              432                     MOV DS:SEND_BUFFER[BX], AL
                           433                     
0309                       434             END_BUFFER:
0309 43                    435                     INC BX
030A E2D5                  436             LOOP BUFFER_LOOP
030C                       437     END_UPD_BUFFER:
030C 5A                    438     POP DX
030D 59                    439     POP CX
030E 5B                    440     POP BX
030F 58                    441     POP AX
0310 CB                    442     RET
                           443     UPDATE_SEND_BUFFER ENDP
                           444     
0311                       445     BCD_BACKSPACE PROC FAR
                           446     
0311 50                    447     PUSH AX
0312 53                    448     PUSH BX
0313 51                    449     PUSH CX
0314 52                    450     PUSH DX
                           451     
0315 8A167900              452             MOV DL, DS:REG_AL
0319 833E610000            453             CMP DS:KEYPAD_INDEX, 0
031E 7457                  454             JE RETURN_BACK
                           455             
0320 BB0600                456             MOV BX, 6
0323                       457             BCD_CLEAR_LOOP:
0323 4B                    458                     DEC BX
0324 C647592D              459                     MOV DS:BCD_MESSAGE[BX], '-'
0328 43                    460                     INC BX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:31:49  11/21/;3  PAGE   10


LOC  OBJ                  LINE     SOURCE

0329 4B                    461                     DEC BX
032A 75F7                  462             JNZ BCD_CLEAR_LOOP
                           463             
032C 833E610001            464             CMP DS:KEYPAD_INDEX, 1
0331 7E2C                  465             JLE less_than_two
                           466             
0333 FF0E6100              467             DEC DS:KEYPAD_INDEX
0337 FF0E6100              468             DEC DS:KEYPAD_INDEX
033B 8B1E6100              469             MOV BX, DS:KEYPAD_INDEX
033F 8A4751                470             MOV AL, DS:KEYPAD_INPUT[BX]
0342 A27900                471             MOV DS:REG_AL, AL
0345 C706A8000000          472             MOV DS:SCROLL_LEN, 0
034B C706AA000100          473             MOV DS:DAC_DISABLE, 1
0351 9AAB03----     R      474             CALL FAR PTR BCD_UPDATE
0356 C706AA000000          475             MOV DS:DAC_DISABLE, 0
035C EB1990                476             JMP RETURN_BACK
                           477             
035F                       478     less_than_two:
035F FF0E6100              479             DEC DS:KEYPAD_INDEX
0363 C60679002D            480             MOV DS:REG_AL, '-'
0368 C706A8000000          481             MOV DS:SCROLL_LEN, 0
036E 9AAB03----     R      482             CALL FAR PTR BCD_UPDATE
0373 FF0E6100              483             DEC DS:KEYPAD_INDEX
                           484             
0377                       485     RETURN_BACK:
0377 88167900              486             MOV DS:REG_AL, DL
037B 5A                    487     POP DX
037C 59                    488     POP CX
037D 5B                    489     POP BX
037E 58                    490     POP AX
                           491     
037F CB                    492     RET
                           493     BCD_BACKSPACE ENDP
                           494     
0380                       495     BCD_CLEAR PROC FAR
0380 50                    496     PUSH AX
0381 53                    497     PUSH BX
0382 51                    498     PUSH CX
0383 52                    499     PUSH DX
0384 BB0800                500             MOV BX, 8
0387                       501             CLEAR_LOOP:
0387 C6475100              502             MOV DS:KEYPAD_INPUT[BX], 0
038B 4B                    503             DEC BX
038C 75F9                  504             JNZ CLEAR_LOOP
                           505             
038E BB0600                506             MOV BX, 6
0391                       507             CLEAR_LOOP2:
0391 4B                    508                     DEC BX
0392 C647592D              509                     MOV DS:BCD_MESSAGE[BX], '-'
0396 43                    510                     INC BX
0397 4B                    511                     DEC BX
0398 75F7                  512             JNZ CLEAR_LOOP2
                           513     
039A C70661000000          514             MOV DS:KEYPAD_INDEX, 0
03A0 C706A8000000          515             MOV DS:SCROLL_LEN, 0
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:31:49  11/21/;3  PAGE   11


LOC  OBJ                  LINE     SOURCE

03A6 5A                    516     POP DX
03A7 59                    517     POP CX
03A8 5B                    518     POP BX
03A9 58                    519     POP AX
03AA CB                    520     RET
                           521     BCD_CLEAR ENDP
                           522     
03AB                       523     BCD_UPDATE PROC FAR
03AB 50                    524     PUSH AX
03AC 53                    525     PUSH BX
03AD 51                    526     PUSH CX
03AE 52                    527     PUSH DX
03AF A19C00                528                     MOV AX, DS:MAX_INPUT_SIZE
03B2 39066100              529                     CMP DS:KEYPAD_INDEX, AX
03B6 745A                  530                     JE BCD_RET
                           531                     
03B8 8A0E7900              532                     MOV CL, DS:REG_AL
03BC 80F909                533                     CMP CL, 9
03BF 7F0C                  534                     JG SKIP_PAST
03C1 833EAA0001            535                     CMP DS:DAC_DISABLE, 1
03C6 7405                  536                     JE SKIP_PAST
03C8 9A1704----     R      537                     CALL FAR PTR DAC_UPDATE
                           538     
03CD                       539     SKIP_PAST:              
03CD 8A0E7900              540                     MOV CL, DS:REG_AL
                           541     
03D1 8B1E6100              542                     MOV BX, DS:KEYPAD_INDEX
                           543                             
03D5 884F51                544                     MOV DS:KEYPAD_INPUT[BX], CL
                           545                             
03D8 FF066100              546                     INC DS:KEYPAD_INDEX
                           547                             
03DC 8B1E6100              548                     MOV BX, DS:KEYPAD_INDEX
                           549                     
03E0 A1A800                550                     MOV AX, DS:SCROLL_LEN
03E3 2BD8                  551                     SUB BX, AX
                           552                     
03E5 8B166100              553                     MOV DX, DS:KEYPAD_INDEX
03E9 83FA06                554                     CMP DX, 6
03EC 7E03                  555                     JLE update_display
03EE BA0600                556                     MOV DX, 6
                           557                     
03F1                       558             update_display:
                           559             
03F1 B90500                560                     MOV CX, 5
03F4 4B                    561                     DEC BX
03F5 8A4751                562                     MOV AL, DS:KEYPAD_INPUT[BX]
03F8 43                    563                     INC BX
                           564                             
03F9 52                    565                     PUSH DX
03FA 8B166100              566                     MOV DX, DS:KEYPAD_INDEX
03FE 2B16A800              567                     SUB DX, DS:SCROLL_LEN
                           568                     
0402 2BD3                  569                     SUB DX, BX
                           570                             
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:31:49  11/21/;3  PAGE   12


LOC  OBJ                  LINE     SOURCE

0404 53                    571                     PUSH BX
                           572                             
0405 2BCA                  573                     SUB CX, DX
0407 8BD9                  574                     MOV BX, CX
0409 884759                575                     MOV DS:BCD_MESSAGE[BX], AL
                           576                             
040C 5B                    577                     POP BX
040D 5A                    578                     POP DX
                           579             
040E 4B                    580                     DEC BX
040F 4A                    581                     DEC DX
0410 75DF                  582             JNZ update_display
                           583     
0412                       584             BCD_RET:
0412 5A                    585                     POP DX
0413 59                    586                     POP CX
0414 5B                    587                     POP BX
0415 58                    588                     POP AX
0416 CB                    589     RET
                           590     BCD_UPDATE ENDP
                           591     
0417                       592     DAC_UPDATE PROC FAR
0417 50                    593             PUSH AX
0418 53                    594             PUSH BX
0419 51                    595             PUSH CX
041A 52                    596             PUSH DX
                           597             
041B BB0000                598             MOV BX, 0
041E 8A1E7500              599             MOV BL, DS:DAC_LEN
0422 A07900                600             MOV AL, DS:REG_AL
                           601             
0425 884766                602             MOV DS:DAC_ADDR[BX], AL
                           603             
0428 FE067500              604             INC DS:DAC_LEN
                           605     
042C 5A                    606             POP DX
042D 59                    607             POP CX
042E 5B                    608             POP BX
042F 58                    609             POP AX
0430 CB                    610     RET
                           611     DAC_UPDATE ENDP
                           612               
0431                       613     DEBOUNCE PROC FAR
0431 51                    614                       PUSH CX
                           615                       
0432 B94C09                616                       MOV CX, 094CH
0435 90                    617     BACK:     NOP
0436 E2FD                  618                       LOOP BACK
0438 59                    619                       POP CX
0439 CB                    620                       RET
                           621     DEBOUNCE  ENDP
                           622     
043A                       623     SEND_INPUT PROC FAR
043A 50                    624     PUSH AX
043B 53                    625     PUSH BX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:31:49  11/21/;3  PAGE   13


LOC  OBJ                  LINE     SOURCE

043C 51                    626     PUSH CX
043D 52                    627     PUSH DX
043E BB0000                628             MOV BX, 0
0441 8B0E9A00              629             MOV CX, DS:SEND_BUFFER_LEN
                           630             
0445                       631             S_BUFF:
0445 8A878D00              632                     MOV AL, DS:SEND_BUFFER[BX]
0449 9A0000----     E      633                     CALL FAR PTR PRINT_CHAR
044E 43                    634                     INC BX
044F E2F4                  635             LOOP S_BUFF
                           636             
0451                       637     SEND_INPUT_END:
0451 5A                    638     POP DX
0452 59                    639     POP CX
0453 5B                    640     POP BX
0454 58                    641     POP AX
0455 CB                    642     RET
                           643     SEND_INPUT ENDP
                           644     ; ^^^^^^^^^^^^^^^ End of User main routine ^^^^^^^^^^^^^^^^^^^^^^^^^
0456                       645     SERIAL_REC_ACTION       PROC    FAR
0456 51                    646                     PUSH    CX
0457 53                    647                     PUSH    BX
0458 1E                    648                     PUSH    DS
                           649                     
0459 BB----         R      650                     MOV     BX,DATA_SEG             ;initialize data segment register
045C 8EDB                  651                     MOV     DS,BX
                           652                     
045E 803E8B0001            653                     CMP DS:REPLY_FLAG, 1
0463 756A                  654                     JNE next_id1
                           655                     
0465 803E8C0001            656                     CMP DS:SEND_FLAG, 1
046A 7466                  657                     JE send_input_across1
                           658                     
046C 833EA00001            659                     CMP DS:RECEIVE_FLAG, 1
0471 757D                  660                     JNE terminate_session3
                           661                     
0473 3C2F                  662                     CMP AL, '/'
0475 751B                  663                     JNE CHECK_SEND
0477 C706A4000000          664                     MOV DS:PRICE_FLAG, 0
047D C706A0000000          665                     MOV DS:RECEIVE_FLAG, 0
0483 C7069C000000          666                     MOV DS:MAX_INPUT_SIZE, 0
0489 C706AE000100          667                     MOV DS:LANG_FLAG, 1
048F EB5F90                668                     JMP terminate_session3
                           669             
0492                       670             CHECK_SEND:
0492 3C26                  671                     CMP AL, '&'
0494 7515                  672                     JNE receive_price
0496 C706A4000100          673                     MOV DS:PRICE_FLAG, 1
049C C70661000000          674                     MOV DS:KEYPAD_INDEX, 0
04A2 C7069C000800          675                     MOV DS:MAX_INPUT_SIZE, 8
04A8 E98600                676                     JMP id_skip2
                           677                     
04AB                       678             receive_price:
04AB 3C23                  679                     CMP AL, '#'
04AD 750F                  680                     JNE check_price
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:31:49  11/21/;3  PAGE   14


LOC  OBJ                  LINE     SOURCE

04AF C706A2000100          681                     MOV DS:DAC_FLAG, 1
04B5 C706A4000000          682                     MOV DS:PRICE_FLAG, 0
04BB EB7490                683                     JMP id_skip2
                           684             
04BE                       685             check_price:    
                           686             
04BE 833EA40001            687                     CMP DS:PRICE_FLAG, 1
04C3 7431                  688                     JE update_keypad_input
                           689                     
04C5 833EA20001            690                     CMP DS:DAC_FLAG, 1
04CA 7409                  691                     JE dac_change
04CC EB6390                692                     JMP id_skip2
                           693     
04CF                       694             next_id1:
04CF EB6390                695                     JMP next_id
                           696                     
04D2                       697             send_input_across1:
04D2 EB4190                698                     JMP send_input_across
                           699                     
04D5                       700             dac_change:
04D5 8A1E7900              701                     MOV BL, DS:REG_AL
04D9 2C30                  702                     SUB AL, 30H
04DB A27900                703                     MOV DS:REG_AL, AL
04DE 9A1704----     R      704                     CALL FAR PTR DAC_UPDATE
04E3 881E7900              705                     MOV DS:REG_AL, BL
04E7 C706A2000000          706                     MOV DS:DAC_FLAG, 0
04ED EB4290                707                     JMP id_skip2
                           708             
04F0                       709             terminate_session3:
04F0 EB3C90                710                     JMP terminate_session2
04F3 EB3C90                711             id_skip3: JMP id_skip2
                           712     
                           713                     
04F6                       714             update_keypad_input:
04F6 2C30                  715                     SUB AL, 30H
04F8 A27900                716                     MOV DS:REG_AL, AL
04FB C706AC000300          717                     MOV DS:DECIMAL_INDEX, 3
0501 C706AA000100          718                     MOV DS:DAC_DISABLE, 1
0507 9AAB03----     R      719                     CALL FAR PTR BCD_UPDATE
050C C706AA000000          720                     MOV DS:DAC_DISABLE, 0
0512 EB1D90                721                     JMP id_skip2
                           722                     
0515                       723             send_input_across:
0515 9A3A04----     R      724                     CALL FAR PTR SEND_INPUT
                           725                     
051A C7069A000000          726                     MOV DS:SEND_BUFFER_LEN, 0
                           727                     
0520 C6068C0000            728                     MOV DS:SEND_FLAG, 0
                           729                     
0525 C706A0000100          730                     MOV DS:RECEIVE_FLAG, 1
                           731                     
052B EB0490                732                     JMP id_skip2
                           733                     
052E EB3E90                734                     terminate_session2: JMP terminate_session
0531 EB6790                735                     id_skip2: JMP id_skip
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:31:49  11/21/;3  PAGE   15


LOC  OBJ                  LINE     SOURCE

                           736                     
0534                       737             next_id:
                           738                     
0534 803E810001            739                     CMP DS:ID_FLAG_r, 1
0539 7513                  740                     JNE id_flag_label
053B 38067F00              741                     CMP DS:MY_ID[1], AL
053F 7559                  742                     JNE id_skip
                           743                     ;start writing to pc
0541 C6068B0001            744                     MOV DS:REPLY_FLAG, 1
0546 C606810000            745                     MOV DS:ID_FLAG_r, 0
054B EB4D90                746                     JMP id_skip
                           747             
054E                       748             id_flag_label:
                           749             
054E 803E800001            750                     CMP DS:ID_FLAG_@, 1
0553 7539                  751                     JNE protocol_rec
0555 3C72                  752                     CMP AL,'r'
0557 750D                  753                     JNE id_not_r
0559 C606810001            754                     MOV DS:ID_FLAG_r,1
055E C606800000            755                     MOV DS:ID_FLAG_@, 0
0563 EB6C90                756                     JMP S_RET
0566                       757             id_not_r:
0566 C606800000            758                     MOV DS:ID_FLAG_@, 0
056B EB2D90                759                     JMP id_skip
                           760             
056E                       761             terminate_session:
056E C606810000            762                     MOV DS:ID_FLAG_r, 0
0573 33DB                  763                     XOR BX,BX
0575                       764             start_send1:
0575 50                    765                     PUSH AX
0576 33C0                  766                     XOR AX,AX
0578 8A878600              767                     MOV AL, DS:FAIL_MESSAGE[BX]
057C 9A0000----     E      768                     CALL FAR PTR PRINT_CHAR
0581 58                    769                     POP AX
0582 C6068B0000            770                     MOV DS:REPLY_FLAG, 0
0587 43                    771                     INC BX
0588 3A1E8A00              772                     CMP BL, DS:FAIL_COUNT
058C 75E7                  773                     JNE start_send1
                           774                     
058E                       775             protocol_rec:
058E 3C40                  776                     CMP AL,'@'
0590 7508                  777                     JNE id_skip
0592 C606800001            778                     MOV DS:ID_FLAG_@,1
0597 EB3890                779                     JMP S_RET
                           780                     
059A                       781             id_skip:
059A EB3590                782                     JMP S_RET
                           783             
059D 3C3C                  784                     CMP     AL,'<'
059F 750B                  785                     JNE     S_FAST
                           786     
05A1 FE061700              787                     INC     DS:T_COUNT_SET
05A5 FE061700              788                     INC     DS:T_COUNT_SET
                           789     
05A9 EB0D90                790                     JMP     S_NEXT0
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:31:49  11/21/;3  PAGE   16


LOC  OBJ                  LINE     SOURCE

05AC                       791     S_FAST:
05AC 3C3E                  792                     CMP     AL,'>'
05AE 7521                  793                     JNE     S_RET
                           794     
05B0 FE0E1700              795                     DEC     DS:T_COUNT_SET
05B4 FE0E1700              796                     DEC     DS:T_COUNT_SET
                           797     
05B8                       798     S_NEXT0:
05B8 B91600                799                     MOV     CX,22                   ;initialize counter for message
05BB BB0000                800                     MOV     BX,0
                           801     
05BE 8A4718                802     S_NEXT1:        MOV     AL,DS:REC_MESS[BX]      ;print message
05C1 9A0000----     E      803                     call    FAR ptr print_char
05C6 43                    804                     INC     BX
05C7 E2F5                  805                     LOOP    S_NEXT1
                           806     
05C9 A01700                807                     MOV     AL,DS:T_COUNT_SET       ;print current period of timer0
05CC 9A0000----     E      808                     CALL    FAR PTR PRINT_2HEX
05D1                       809     S_RET:
05D1 1F                    810                     POP     DS
05D2 5B                    811                     POP     BX
05D3 59                    812                     POP     CX
05D4 CB                    813                     RET
                           814     SERIAL_REC_ACTION       ENDP
                           815     
05D5                       816     TIMER2_ACTION   PROC    FAR
05D5 50                    817                     PUSH    AX
05D6 1E                    818                     PUSH    DS
05D7 53                    819                     PUSH    BX
05D8 51                    820                     PUSH    CX
05D9 52                    821                     PUSH    DX
                           822                     
                           823                     
05DA B8----         R      824                     MOV     AX,DATA_SEG
05DD 8ED8                  825                     MOV     DS,AX
                           826             
05DF FE0E1600              827                     DEC     DS:T_COUNT
05E3 754A                  828                     JNZ     T_NEXT1
05E5 A01700                829                     MOV     AL,DS:T_COUNT_SET
05E8 A21600                830                     MOV     DS:T_COUNT,AL
                           831     
05EB                       832     T_NEXT0:
05EB A05F00                833                     MOV AL, DS:ENABLE_BYTE
05EE BA8001                834                     MOV DX, 180H
05F1 EE                    835                     OUT DX, AL
                           836                     
05F2 33DB                  837                     XOR BX, BX
05F4 8A1E6000              838                     MOV BL, DS:BCD_INDEX
05F8 8A4759                839                     MOV AL, DS:BCD_MESSAGE[BX]
                           840                     
05FB 3B1EAC00              841                     CMP BX, DS:DECIMAL_INDEX
05FF 7506                  842                     JNE CALL_FUNC
0601 C706A6000100          843                     MOV DS:DECIMAL_FLAG, 1
0607                       844     CALL_FUNC:
0607 9AA006----     R      845                     CALL FAR PTR BCD_TO_7SEG
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:31:49  11/21/;3  PAGE   17


LOC  OBJ                  LINE     SOURCE

060C C706A6000000          846                     MOV DS:DECIMAL_FLAG, 0
                           847     
0612 BA0002                848                     MOV DX, 200H
0615 EE                    849                     OUT DX, AL
                           850     
0616 FE066000              851                     INC DS:BCD_INDEX
061A D0065F00              852                     ROL DS:ENABLE_BYTE, 1
061E 803E5F00BF            853                     CMP DS:ENABLE_BYTE, 10111111b
0623 750A                  854                     JNE T_NEXT1
0625 C6065F00FE            855                     MOV DS:ENABLE_BYTE, 11111110b 
062A C606600000            856                     MOV DS:BCD_INDEX, 0
                           857     
                           858                     
062F                       859     T_NEXT1:
062F 803E750000            860                     CMP DS:DAC_LEN, 0
0634 743C                  861                     JE ISR_END
                           862                     
                           863                     
0636 8B367600              864                     MOV SI, DS:SI_PTR
                           865                             
063A BB0000                866                     MOV BX, 0
063D 33C0                  867                     XOR AX, AX
063F 8A4766                868                     MOV AL, DS:DAC_ADDR[BX]
                           869                     
0642 BB0001                870                     MOV BX, 100H
0645 F7E3                  871                     MUL BX
                           872                     
0647 8B166400              873                     MOV DX, DS:DAC_BASE
064B 03D0                  874                     ADD DX, AX
                           875                     
064D 1E                    876                     PUSH DS
064E 8EDA                  877                     MOV DS, DX
                           878                     
0650 8B04                  879                     MOV AX, [SI]
                           880                     
0652 BA1001                881                     MOV DX, 110H
0655 EE                    882                     OUT DX, AL
                           883                     
0656 1F                    884                     POP DS
                           885                     
0657 FF067600              886                     INC DS:SI_PTR
065B 813E76000010          887                     CMP DS:SI_PTR, 1000H
0661 750F                  888                     JNE ISR_END
                           889                     
0663 C70676000000          890                     MOV DS:SI_PTR, 0
0669 FE0E7500              891                     DEC DS:DAC_LEN
066D 9A7806----     R      892                     CALL FAR PTR DAC_SHIFT
                           893                     
0672                       894     ISR_END:
                           895                     
0672 5A                    896                     POP DX
0673 59                    897                     POP     CX
0674 5B                    898                     POP     BX
0675 1F                    899                     POP     DS
0676 58                    900                     POP AX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:31:49  11/21/;3  PAGE   18


LOC  OBJ                  LINE     SOURCE

0677 CB                    901                     RET
                           902     TIMER2_ACTION   ENDP
                           903     
                           904     
0678                       905     DAC_SHIFT PROC FAR
0678 50                    906             PUSH AX
0679 53                    907             PUSH BX
067A 51                    908             PUSH CX
067B 52                    909             PUSH DX
                           910     
067C 33C9                  911             XOR CX, CX
067E 8A0E7500              912             MOV CL, DS:DAC_LEN
0682 80F900                913             CMP CL, 0
0685 7414                  914             JE END_SHIFT
                           915     
0687                       916             SHIFT_LOOP:
                           917     
0687 33DB                  918             XOR BX, BX
0689 8A1E7500              919             MOV BL, DS:DAC_LEN
068D 2BD9                  920             SUB BX, CX
068F 43                    921             INC BX
                           922             
0690 33D2                  923             XOR DX, DX
0692 8A5766                924             MOV DL, DS:DAC_ADDR[BX]
0695 4B                    925             DEC BX
0696 885766                926             MOV DS:DAC_ADDR[BX], DL
                           927     
0699 E2EC                  928             LOOP SHIFT_LOOP
                           929             
069B                       930             END_SHIFT:
069B 5A                    931             POP DX
069C 59                    932             POP CX
069D 5B                    933             POP BX
069E 58                    934             POP AX
069F CB                    935             RET
                           936     DAC_SHIFT ENDP
                           937     
06A0                       938     BCD_TO_7SEG PROC FAR
                           939     
06A0 53                    940             PUSH BX
06A1 51                    941             PUSH CX
06A2 52                    942             PUSH DX
                           943             
06A3 3C00                  944             CMP AL, 0
06A5 7511                  945             JNE one
06A7 833EA60001            946             CMP DS:DECIMAL_FLAG, 1
06AC 7405                  947             JE decimal0
06AE B03F                  948             MOV AL, 00111111b
06B0 E9D700                949             JMP endfunc
06B3                       950     decimal0:
06B3 B0BF                  951             MOV AL, 10111111b
06B5 E9D200                952             JMP endfunc
                           953             
06B8                       954             one:
06B8 3C01                  955             CMP AL, 1
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:31:49  11/21/;3  PAGE   19


LOC  OBJ                  LINE     SOURCE

06BA 7511                  956             JNE two
06BC 833EA60001            957             CMP DS:DECIMAL_FLAG, 1
06C1 7405                  958             JE decimal1
06C3 B006                  959             MOV AL, 00000110b
06C5 E9C200                960             JMP endfunc
06C8                       961     decimal1:
06C8 B086                  962             MOV AL, 10000110b
06CA E9BD00                963             JMP endfunc
                           964             
06CD                       965             two:
06CD 3C02                  966             CMP AL,2
06CF 7511                  967             JNE three
06D1 833EA60001            968             CMP DS:DECIMAL_FLAG, 1
06D6 7405                  969             JE decimal2
06D8 B05B                  970             MOV AL, 01011011b
06DA E9AD00                971             JMP endfunc
06DD                       972     decimal2:
06DD B0DB                  973             MOV AL, 11011011b
06DF E9A800                974             JMP endfunc
                           975             
06E2                       976             three:
06E2 3C03                  977             CMP AL,3
06E4 7511                  978             JNE four
06E6 833EA60001            979             CMP DS:DECIMAL_FLAG, 1
06EB 7405                  980             JE decimal3
06ED B04F                  981             MOV AL, 01001111b
06EF E99800                982             JMP endfunc
06F2                       983     decimal3:
06F2 B0CF                  984             MOV AL, 11001111b
06F4 E99300                985             JMP endfunc
                           986             
06F7                       987             four:
06F7 3C04                  988             CMP AL,4
06F9 7511                  989             JNE five
06FB 833EA60001            990             CMP DS:DECIMAL_FLAG, 1
0700 7405                  991             JE decimal4
0702 B066                  992             MOV AL, 01100110b
0704 E98300                993             JMP endfunc
0707                       994     decimal4:
0707 B0E6                  995             MOV AL, 11100110b
0709 EB7F90                996             JMP endfunc
                           997             
070C                       998             five:
070C 3C05                  999             CMP AL,5
070E 7511                 1000             JNE six
0710 833EA60001           1001             CMP DS:DECIMAL_FLAG, 1
0715 7405                 1002             JE decimal5
0717 B06D                 1003             MOV AL, 01101101b
0719 EB6F90               1004             JMP endfunc
071C                      1005     decimal5:
071C B0ED                 1006             MOV AL, 11101101b
071E EB6A90               1007             JMP endfunc
                          1008             
0721                      1009             six:
0721 3C06                 1010             CMP AL,6
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:31:49  11/21/;3  PAGE   20


LOC  OBJ                  LINE     SOURCE

0723 7511                 1011             JNE seven
0725 833EA60001           1012             CMP DS:DECIMAL_FLAG, 1
072A 7405                 1013             JE decimal6
072C B07D                 1014             MOV AL, 01111101b
072E EB5A90               1015             JMP endfunc
0731                      1016     decimal6:
0731 B0FD                 1017             MOV AL, 11111101b
0733 EB5590               1018             JMP endfunc
                          1019             
0736                      1020             seven:
0736 3C07                 1021             CMP AL,7
0738 7511                 1022             JNE eight
073A 833EA60001           1023             CMP DS:DECIMAL_FLAG, 1
073F 7405                 1024             JE decimal7
0741 B007                 1025             MOV AL, 00000111b
0743 EB4590               1026             JMP endfunc
0746                      1027     decimal7:
0746 B087                 1028             MOV AL, 10000111b
0748 EB4090               1029             JMP endfunc
                          1030             
074B                      1031             eight:
074B 3C08                 1032             CMP AL,8
074D 7511                 1033             JNE nine
074F 833EA60001           1034             CMP DS:DECIMAL_FLAG, 1
0754 7405                 1035             JE decimal8
0756 B07F                 1036             MOV AL, 01111111b
0758 EB3090               1037             JMP endfunc
075B                      1038     decimal8:
075B B0FF                 1039             MOV AL, 11111111b
075D EB2B90               1040             JMP endfunc
                          1041             
0760                      1042             nine:
0760 3C09                 1043             CMP AL,9
0762 7511                 1044             JNE hifn
0764 833EA60001           1045             CMP DS:DECIMAL_FLAG, 1
0769 7405                 1046             JE decimal9
076B B06F                 1047             MOV AL, 01101111b
076D EB1B90               1048             JMP endfunc
0770                      1049     decimal9:
0770 B0EF                 1050             MOV AL, 11101111b
0772 EB1690               1051             JMP endfunc
                          1052             
0775                      1053             hifn:
0775 3C2D                 1054             CMP AL,'-'
0777 7511                 1055             JNE endfunc
0779 833EA60001           1056             CMP DS:DECIMAL_FLAG, 1
077E 7405                 1057             JE decimal10
0780 B040                 1058             MOV AL, 01000000b
0782 EB0690               1059             JMP endfunc
0785                      1060     decimal10:
0785 B0C0                 1061             MOV AL, 11000000b
0787 EB0190               1062             JMP endfunc
                          1063             
078A                      1064             endfunc:
078A 5A                   1065             POP DX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:31:49  11/21/;3  PAGE   21


LOC  OBJ                  LINE     SOURCE

078B 59                   1066             POP CX
078C 5B                   1067             POP BX
                          1068     
078D CB                   1069     RET
                          1070     BCD_TO_7SEG ENDP
                          1071     
----                      1072     CODE_SEG        ENDS
                          1073     END

ASSEMBLY COMPLETE, NO ERRORS FOUND
