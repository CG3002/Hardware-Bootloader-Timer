8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:50:24  12/06/;3  PAGE    1


DOS 5.0 (038-N) 8086/87/88/186 MACRO ASSEMBLER V3.1 ASSEMBLY OF MODULE TIMER
OBJECT MODULE PLACED IN TIMER.OBJ
ASSEMBLER INVOKED BY:  D:\ASM86.EXE TIMER.ASM


LOC  OBJ                  LINE     SOURCE

                             1 +1  $MOD186
                             2 +1  $EP
                             3     NAME TIMER
                             4     ; Main program for uPD70208 microcomputer system
                             5     ;
                             6     ; Author:       Dr Tay Teng Tiow
                             7     ; Address:      Department of Electrical Engineering 
                             8     ;               National University of Singapore
                             9     ;               10, Kent Ridge Crescent
                            10     ;               Singapore 0511. 
                            11     ; Date:         6th September 1991
                            12     ;
                            13     ; This file contains proprietory information and cannot be copied 
                            14     ; or distributed without prior permission from the author.
                            15     ; =========================================================================
                            16     
                            17     public  serial_rec_action, timer2_action
                            18     extrn   print_char:far, print_2hex:far, iodefine:far
                            19     extrn   set_timer2:far
                            20     
                            21     ;IO Setup for 80C188 
  FFA0                      22             UMCR    EQU    0FFA0H ; Upper Memory Control Register
  FFA2                      23             LMCR    EQU    0FFA2H ; Lower Memory control Register         
  FFA4                      24             PCSBA   EQU    0FFA4H ; Peripheral Chip Select Base Address
  FFA8                      25             MPCS    EQU    0FFA8H ; MMCS and PCS Alter Control Register
  0080                      26             A_8255  EQU    0080H
  0081                      27             B_8255  EQU    0081H
  0082                      28             C_8255  EQU    0082H
  0083                      29             CWR_8255  EQU    0083H
  FF38                      30             INT0CON  EQU   0FF38H
  FF22                      31             EOI EQU 0FF22H
  FF28                      32             IMASK EQU 0FF28H
  FFA6                      33             MMCS    EQU    0FFA6H 
  4000                      34             DAC EQU 4000H
                            35     
                            36     
----                        37     STACK_SEG       SEGMENT
0000 (512                   38                     DB      512 DUP(?)
     ??
     )
0200                        39             TOS     LABEL   WORD
----                        40     STACK_SEG       ENDS
                            41     
                            42     
----                        43     DATA_SEG        SEGMENT
0000 0A                     44             TIMER0_MESS             DB      10,13,'TIMER2 INTERRUPT    '
0001 0D
0002 54494D45523220
     494E5445525255
     505420202020
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:50:24  12/06/;3  PAGE    2


LOC  OBJ                  LINE     SOURCE

0016 18                     45             T_COUNT                 DB      24
0017 18                     46             T_COUNT_SET             DB      24
0018 0A                     47             REC_MESS                DB      10,13,'Period of timer0 =     '
0019 0D
001A 506572696F6420
     6F662074696D65
     7230203D202020
     2020
0031 (32                    48             MESSAGE         DB  32 dup('h')
     68
     )
0051 00                     49             KEYPAD_INPUT    DB  0,0,0,0,0,0,0,0
0052 00
0053 00
0054 00
0055 00
0056 00
0057 00
0058 00
0059 2D                     50             BCD_MESSAGE     DB  '-','-','-','-','-','-'
005A 2D
005B 2D
005C 2D
005D 2D
005E 2D
005F FE                     51             ENABLE_BYTE     DB  11111110b
0060 00                     52             BCD_INDEX       DB  0
0061 0000                   53             KEYPAD_INDEX    DW      0
0063 20                     54             M_SIZE                  DB  32
0064 0040                   55             DAC_BASE        DW  4000H
0066 (15                    56             DAC_ADDR        DB  15 dup(0) 
     00
     )
0075 00                     57             DAC_LEN         DB  0
0076 0000                   58             SI_PTR          DW  0
0078 ??                     59             CHAR                    DB  ?
0079 ??                     60             REG_AL                  DB  ?
007A ??                     61             REG_BH                  DB  ?
007B ??                     62             REG_CL                  DB  ?
007C 00                     63             FLAG            DB  0
007D 00                     64             LONG_PRESS_FLAG DB      0
007E 7231                   65             MY_ID                   DB      'r1'
0080 00                     66             ID_FLAG_@               DB      0
0081 00                     67             ID_FLAG_r               DB      0
0082 4072312F               68             REPLY_MESSAGE   DB      '@r1/'
0086 40302F                 69             FAIL_MESSAGE    DB '@0/'
0089 04                     70             REPLY_COUNT             DB      4
008A 03                     71             FAIL_COUNT              DB      3
008B 00                     72             REPLY_FLAG              DB      0
008C 00                     73             SEND_FLAG       DB  0
008D (13                    74             SEND_BUFFER     DB  13 dup(0)
     00
     )
009A 0000                   75             SEND_BUFFER_LEN DW      0
009C 0000                   76             MAX_INPUT_SIZE  DW      0
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:50:24  12/06/;3  PAGE    3


LOC  OBJ                  LINE     SOURCE

009E 0000                   77             QTY_FLAG                DW      0
00A0 0000                   78             RECEIVE_FLAG    DW      0
00A2 0000                   79             DAC_FLAG                DW      0
00A4 0000                   80             PRICE_FLAG      DW      0
00A6 0100                   81             DECIMAL_FLAG    DW      1
00A8 0000                   82             SCROLL_LEN      DW      0
00AA 0000                   83             DAC_DISABLE     DW  0
00AC 0300                   84             DECIMAL_INDEX   DW  3
00AE 0100                   85             LANG_FLAG       DW  1
00B0 0000                   86             PRICE                   DW      0
00B2 0000                   87             QTY                             DW      0
00B4 0000                   88             TOTAL_PRICE_U   DW      0
00B6 0000                   89             TOTAL_PRICE_L   DW      0
00B8 0000                   90             TOTAL_PRICE_DEC DW      0
00BA (8                     91             TEMP_BCD_ARR    DB  8 dup(0)
     00
     )
00C2 0000                   92             THOUSAND_FLAG   DW  0
00C4 0000                   93             CENT_FLAG               DW      0
00C6 0000                   94             DOLLAR_FLAG             DW      0
00C8 0000                   95             CASH_FLAG               DW      0
00CA (8                     96             CASH_AMT        DB  8 dup(0)
     00
     )
00D2 (8                     97             TEMP_CASH_ARR   DW  8 dup(0)
     0000
     )
00E2 0000                   98             CASH_OK_FLAG    DW  0
00E4 0000                   99             BORROW_POSITION    DW  0
----                       100     DATA_SEG        ENDS
                           101     
                           102     
----                       103     CODE_SEG        SEGMENT
                           104     
                           105             PUBLIC          START
                           106     
                           107     ASSUME  CS:CODE_SEG, SS:STACK_SEG
                           108     
0000                       109     START:
                           110     ;initialize stack area
0000 B8----         R      111                     MOV     AX,STACK_SEG            
0003 8ED0                  112                     MOV     SS,AX
0005 368B260002            113                     MOV     SP,TOS
                           114                     
                           115     ; Initialize the on-chip pheripherals
000A 9A0000----     E      116                     CALL    FAR PTR IODEFINE
                           117                     
000F 9A0000----     E      118     call set_timer2
0014 FB                    119                    STI
                           120     
                           121     ; ^^^^^^^^^^^^^^^^^  Start of User Main Routine  ^^^^^^^^^^^^^^^^^^
                           122     
                           123     ;Initialize MMCS
                           124             
0015 BAA6FF                125             MOV DX, MMCS
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:50:24  12/06/;3  PAGE    4


LOC  OBJ                  LINE     SOURCE

0018 B80340                126             MOV AX, 4003H
001B EF                    127             OUT DX, AX
                           128     
                           129     ; Initialize MPCS to MAP peripheral to IO address
                           130             
001C BAA8FF                131             MOV DX, MPCS
001F B88320                132             MOV AX, 2083H
0022 EF                    133             OUT DX, AX
                           134        
                           135     ; PCSBA initial, set the parallel port start from 00H
0023 BAA4FF                136             MOV DX, PCSBA
0026 B80300                137             MOV AX, 0003H ; Peripheral starting address 00H no READY, No Waits
0029 EF                    138             OUT DX, AX
                           139     
                           140     ; Initialize LMCS 
002A BAA2FF                141         MOV DX, LMCR
002D B8C401                142         MOV AX, 01C4H  ; Starting address 1FFFH, 8K, No waits, last shoud be 5H for 1 wai
                                   ts      
0030 EF                    143         OUT DX, AX
                           144             
0031 B8----         R      145             MOV AX, DATA_SEG
0034 8ED8                  146             MOV DS, AX
                           147                              
0036 BA8300                148             MOV DX, CWR_8255
0039 B88200                149             MOV AX, 0082h
003C EF                    150             OUT DX, AX
                           151             
003D                       152     NEXT:
003D 9A4400----     R      153             CALL FAR PTR KEYPAD_LOOP
                           154             
0042 EBF9                  155     JMP NEXT
                           156     
0044                       157     KEYPAD_LOOP PROC FAR
0044 50                    158     PUSH AX
0045 53                    159     PUSH BX
0046 51                    160     PUSH CX
0047 52                    161     PUSH DX
                           162             
0048 9ADB04----     R      163                             CALL FAR PTR DEBOUNCE           
                           164                             
004D C606790003            165     WAIT_1:         MOV DS:REG_AL, 03H
0052 BB0000                166                         MOV BX, 0000H
0055 BA8200                167                         MOV DX,C_8255
0058 8AC3                  168                         MOV AL,BL
005A EE                    169                         OUT DX,AL
                           170                        
005B BA8100                171                         MOV DX,B_8255
005E EC                    172                         IN AL,DX
005F 8AD8                  173                         MOV BL,AL  
0061 80E3FC                174                         AND BL,0FCH
0064 80FBFC                175                         CMP BL,0FCH
                           176                      
0067 7449                  177                     JE LONG_PRESS
                           178                             
0069 B3FE                  179                         MOV BL, 0FEH
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:50:24  12/06/;3  PAGE    5


LOC  OBJ                  LINE     SOURCE

006B C6067A0004            180                         MOV DS:REG_BH, 04H
                           181                        
0070                       182     NXTROW: 
0070 C0C307                183                     ROL BL,07H
0073 8AEB                  184                             MOV CH,BL
0075 BA8200                185                             MOV DX,C_8255
0078 8AC3                  186                             MOV AL,BL
007A EE                    187                             OUT DX,AL
                           188                             
007B BA8100                189                             MOV DX,B_8255
007E EC                    190                             IN AL,DX
007F 8AD8                  191                             MOV BL,AL
0081 80E3FC                192                             AND BL,0FCH
0084 C6067B0006            193                             MOV DS:REG_CL,06H
0089 C0DB02                194                             RCR BL,02H
008C D0DB                  195     NXTCOL:         RCR BL,01H
008E 732A                  196                             JNC CODEKY
0090 FE0E7900              197                             DEC DS:REG_AL
0094 FE0E7B00              198                             DEC DS:REG_CL
0098 803E7B0003            199                             CMP DS:REG_CL,03H
009D 7453                  200                             JE KEYPAD3
                           201                             
009F 803E7B0000            202                             CMP DS:REG_CL, 0H
00A4 7449                  203                             JE SUBTRACT2
00A6 EBE4                  204                             JMP NXTCOL
                           205                             
00A8 8ADD                  206                             MOV BL,CH
00AA FE0E7A00              207                             DEC DS:REG_BH
00AE 75C0                  208                             JNZ NXTROW
00B0 EB9B                  209                             JMP WAIT_1
                           210                             
00B2                       211     LONG_PRESS:
00B2 C6067D0000            212                             MOV DS:LONG_PRESS_FLAG, 0
00B7 EB3C90                213                             JMP RETURN2
00BA                       214     CODEKY:
00BA 803E79000B            215                         CMP DS:REG_AL, 11
00BF 7505                  216                             JNE bcd_upd
00C1 C606790000            217                             MOV DS:REG_AL, 0
                           218                             
00C6                       219     bcd_upd:
00C6 803E7D0000            220                             CMP DS:LONG_PRESS_FLAG, 0
00CB 7528                  221                             JNE RETURN2
                           222                             
00CD 803E790014            223                             CMP DS:REG_AL, 20
00D2 7524                  224                             JNE SEND_CASH
00D4 833EC80000            225                             CMP DS:CASH_FLAG, 0
00D9 7411                  226                             JE SKIP_CASH
00DB 9A2A04----     R      227                             CALL FAR PTR BCD_CLEAR
00E0 C7069C000800          228                             MOV DS:MAX_INPUT_SIZE, 8
00E6 C706AC000600          229                             MOV DS:DECIMAL_INDEX, 6
00EC                       230                     SKIP_CASH:
00EC E96801                231                             JMP UPDATE_7SEG2
                           232                             
00EF E91E02                233     SUBTRACT2:   JMP SUBTRACT
                           234     
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:50:24  12/06/;3  PAGE    6


LOC  OBJ                  LINE     SOURCE

00F2 E90B02                235     KEYPAD3:        JMP KEYPAD_2
                           236     
00F5 E92602                237     RETURN2:    JMP RETURN
                           238                             
00F8                       239     SEND_CASH:
00F8 803E790017            240                             CMP DS:REG_AL, 23
00FD 7516                  241                             JNE CLEAR_BUTTON
00FF 833EC80000            242                             CMP DS:CASH_FLAG, 0
0104 740C                  243                             JE SKIP_SEND_CASH
0106 833E610000            244                             CMP DS:KEYPAD_INDEX, 0
010B 7405                  245                             JE SKIP_SEND_CASH
010D 9A0005----     R      246                             CALL FAR PTR TAKE_CASH
0112                       247                     SKIP_SEND_CASH:
0112 E94201                248                             JMP UPDATE_7SEG2
                           249                             
0115                       250     CLEAR_BUTTON:
0115 803E79000A            251                             CMP DS:REG_AL, 10
011A 7508                  252                             JNE BACKSPACE
011C 9A2A04----     R      253                             CALL FAR PTR BCD_CLEAR
0121 E93301                254                             JMP UPDATE_7SEG2
                           255                             
0124 803E79000C            256     BACKSPACE:      CMP DS:REG_AL, 12
0129 7508                  257                             JNE ENTER_DATA
012B 9ABB03----     R      258                             CALL FAR PTR BCD_BACKSPACE
0130 E92401                259                             JMP UPDATE_7SEG2
                           260     
0133 803E79000D            261     ENTER_DATA:     CMP DS:REG_AL, 13
0138 7520                  262                             JNE END_TRANS
013A 9A2A04----     R      263                             CALL FAR PTR BCD_CLEAR
013F C706AC000600          264                             MOV DS:DECIMAL_INDEX, 6
0145 C7069C000800          265                             MOV DS:MAX_INPUT_SIZE, 8
014B C706AE000000          266                             MOV DS:LANG_FLAG, 0
0151 C706C8000000          267                             MOV DS:CASH_FLAG, 0
0157 E9FD00                268                             JMP UPDATE_7SEG2
                           269                             
015A 803E790010            270     END_TRANS:      CMP DS:REG_AL, 16
015F 7534                  271                             JNE CANCEL_TRANS
0161 BB0000                272                             MOV BX, 0
0164 C6878D0024            273                             MOV DS:SEND_BUFFER[BX], '$'
0169 43                    274                             INC BX
016A C6878D002F            275                             MOV DS:SEND_BUFFER[BX], '/'
016F C7069A000200          276                             MOV DS:SEND_BUFFER_LEN, 2
0175 C6068C0001            277                             MOV DS:SEND_FLAG, 1
017A C706B8000000          278                             MOV DS:TOTAL_PRICE_DEC, 0
0180 C706B6000000          279                             MOV DS:TOTAL_PRICE_L, 0
0186 C706B4000000          280                             MOV DS:TOTAL_PRICE_U, 0
018C C706C8000100          281                             MOV DS:CASH_FLAG, 1
0192 E9C200                282                             JMP UPDATE_7SEG2
                           283                             
0195                       284     CANCEL_TRANS:   
0195 803E79000F            285                             CMP DS:REG_AL, 15
019A 752E                  286                             JNE SCROLL_LEFT
019C BB0000                287                             MOV BX, 0
019F C6878D003F            288                             MOV DS:SEND_BUFFER[BX], '?'
01A4 43                    289                             INC BX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:50:24  12/06/;3  PAGE    7


LOC  OBJ                  LINE     SOURCE

01A5 C6878D002F            290                             MOV DS:SEND_BUFFER[BX], '/'
01AA C7069A000200          291                             MOV DS:SEND_BUFFER_LEN, 2
01B0 C6068C0001            292                             MOV DS:SEND_FLAG, 1
01B5 C706B8000000          293                             MOV DS:TOTAL_PRICE_DEC, 0
01BB C706B6000000          294                             MOV DS:TOTAL_PRICE_L, 0
01C1 C706B4000000          295                             MOV DS:TOTAL_PRICE_U, 0
01C7 E98D00                296                             JMP UPDATE_7SEG2
                           297                             
01CA                       298     SCROLL_LEFT:
01CA 803E790015            299                             CMP DS:REG_AL, 21
01CF 753D                  300                             JNE SCROLL_RIGHT
01D1 833E610006            301                             CMP DS:KEYPAD_INDEX, 6
01D6 7E7F                  302                             JLE UPDATE_7SEG2
01D8 833EA80000            303                             CMP DS:SCROLL_LEN, 0
01DD 7478                  304                             JE UPDATE_7SEG2
01DF FF0EA800              305                             DEC DS:SCROLL_LEN
01E3 FF0EAC00              306                             DEC DS:DECIMAL_INDEX
01E7 FF0E6100              307                             DEC DS:KEYPAD_INDEX
01EB 8B1E6100              308                             MOV BX, DS:KEYPAD_INDEX
01EF 8A4751                309                             MOV AL, DS:KEYPAD_INPUT[BX]
01F2 A27900                310                             MOV DS:REG_AL, AL
01F5 C706AA000100          311                             MOV DS:DAC_DISABLE, 1
01FB 9A5504----     R      312                             CALL FAR PTR BCD_UPDATE
0200 C706AA000000          313                             MOV DS:DAC_DISABLE, 0
0206 C606790015            314                             MOV DS:REG_AL, 21
020B EB4A90                315                             JMP UPDATE_7SEG2
                           316     
020E                       317     SCROLL_RIGHT:
020E 803E790013            318                             CMP DS:REG_AL, 19
0213 7545                  319                             JNE LANG_TOGGLE
0215 833E610006            320                             CMP DS:KEYPAD_INDEX, 6
021A 7E3B                  321                             JLE UPDATE_7SEG2
021C A16100                322                             MOV AX, DS:KEYPAD_INDEX
021F 2D0600                323                             SUB AX, 6
0222 3906A800              324                             CMP DS:SCROLL_LEN, AX
0226 742F                  325                             JE UPDATE_7SEG2
0228 FF06A800              326                             INC DS:SCROLL_LEN
022C FF06AC00              327                             INC DS:DECIMAL_INDEX
0230 FF0E6100              328                             DEC DS:KEYPAD_INDEX
0234 8B1E6100              329                             MOV BX, DS:KEYPAD_INDEX
0238 8A4751                330                             MOV AL, DS:KEYPAD_INPUT[BX]
023B A27900                331                             MOV DS:REG_AL, AL
023E C706AA000100          332                             MOV DS:DAC_DISABLE, 1
0244 9A5504----     R      333                             CALL FAR PTR BCD_UPDATE
0249 C706AA000000          334                             MOV DS:DAC_DISABLE, 0
024F C606790013            335                             MOV DS:REG_AL, 19
0254 EB0190                336                             JMP UPDATE_7SEG2
                           337                             
0257 E99200                338     UPDATE_7SEG2: JMP UPDATE_7SEG
                           339     
025A                       340     LANG_TOGGLE:
025A 803E790012            341                             CMP DS:REG_AL, 18
025F 7537                  342                             JNE QTY_PROMPT
0261 833EAE0001            343                             CMP DS:LANG_FLAG, 1
0266 75EF                  344                             JNE UPDATE_7SEG2
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:50:24  12/06/;3  PAGE    8


LOC  OBJ                  LINE     SOURCE

0268 A16400                345                             MOV AX, DS:DAC_BASE
026B 3D0040                346                             CMP AX, 4000H
026E 7406                  347                             JE MANDRIN
0270 B80040                348                             MOV AX, 4000H
0273 EB0490                349                             JMP SEND_TOGGLE
0276                       350             MANDRIN:
0276 B80065                351                             MOV AX, 6500H
0279                       352             SEND_TOGGLE:
0279 A36400                353                             MOV DS:DAC_BASE, AX
027C BB0000                354                             MOV BX, 0
027F C6878D0021            355                             MOV DS:SEND_BUFFER[BX], '!'
0284 43                    356                             INC BX
0285 C6878D002F            357                             MOV DS:SEND_BUFFER[BX], '/'
028A C7069A000200          358                             MOV DS:SEND_BUFFER_LEN, 2
0290 C6068C0001            359                             MOV DS:SEND_FLAG, 1
0295 EB5590                360                             JMP UPDATE_7SEG
0298                       361     QTY_PROMPT:
0298 803E790016            362                             CMP DS:REG_AL, 22
029D 7520                  363                             JNE QUANTITY
029F 833E610008            364                             CMP DS:KEYPAD_INDEX, 8
02A4 7519                  365                             JNE  QUANTITY
                           366                             ; CMP DS:MAX_INPUT_SIZE, 8
                           367                             ; JNE QUANTITY
02A6 9A7403----     R      368                             CALL FAR PTR UPDATE_SEND_BUFFER
02AB 9A2A04----     R      369                             CALL FAR PTR BCD_CLEAR
02B0 C7069C000200          370                             MOV DS:MAX_INPUT_SIZE, 2
02B6 C7069E000100          371                             MOV DS:QTY_FLAG, 1
02BC EB2E90                372                             JMP UPDATE_7SEG
                           373                     
02BF                       374     QUANTITY:
02BF 833E610000            375                             CMP DS:KEYPAD_INDEX, 0
02C4 7426                  376                             JE  UPDATE_7SEG
                           377                             
02C6 803E79000E            378                             CMP DS:REG_AL, 14
02CB 751F                  379                             JNE UPDATE_7SEG
                           380                             
02CD 833E9E0001            381                             CMP DS:QTY_FLAG, 1
02D2 7518                  382                             JNE UPDATE_7SEG
                           383                             
02D4 9A2303----     R      384                             CALL FAR PTR UPDATE_THE_QUANTITY
                           385                                             
02D9 C6068C0001            386                             MOV DS:SEND_FLAG, 1
                           387                             
02DE C7069E000000          388                             MOV DS:QTY_FLAG, 0
02E4 9A2A04----     R      389                             CALL FAR PTR BCD_CLEAR
02E9 EB0190                390                             JMP UPDATE_7SEG
                           391                             
                           392     
02EC                       393     UPDATE_7SEG:
02EC 803E790009            394                             CMP DS:REG_AL, 9
02F1 7F05                  395                             JG SET_PRESS_FLAG
                           396                             
02F3 9A5504----     R      397                             CALL FAR PTR BCD_UPDATE
                           398                             
02F8                       399     SET_PRESS_FLAG:
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:50:24  12/06/;3  PAGE    9


LOC  OBJ                  LINE     SOURCE

02F8 C6067D0001            400                             MOV DS:LONG_PRESS_FLAG, 1
02FD EB1F90                401                             JMP RETURN
                           402             
0300                       403     KEYPAD_2: 
0300 800679000F            404                 ADD DS:REG_AL,0FH
0305 E984FD                405                             JMP NXTCOL
0308 C606790000            406     ZERO_PRINT: MOV DS:REG_AL,00H
030D E97CFD                407                             JMP NXTCOL
0310 802E790006            408     SUBTRACT:   SUB DS:REG_AL,06H
0315 8ADD                  409                             MOV BL,CH
0317 FE0E7A00              410                             DEC DS:REG_BH
031B E952FD                411                             JMP NXTROW
                           412             
                           413             
031E                       414     RETURN:
031E 5A                    415                             POP DX
031F 59                    416                             POP CX
0320 5B                    417                             POP BX
0321 58                    418                             POP AX
0322 CB                    419                             RET
                           420     
                           421     KEYPAD_LOOP ENDP
                           422     
0323                       423     UPDATE_THE_QUANTITY PROC FAR
0323 50                    424     PUSH AX
0324 53                    425     PUSH BX
0325 51                    426     PUSH CX
0326 52                    427     PUSH DX
0327 8B0E6100              428             MOV CX, DS:KEYPAD_INDEX
032B BB0000                429             MOV BX, 0
032E BA0000                430             MOV DX, 0
0331                       431             UPD_QTY:
0331 A1B200                432                     MOV AX, DS:QTY
0334 53                    433                     PUSH BX
0335 BB0A00                434                     MOV BX, 10
0338 F7E3                  435                     MUL BX
033A 5B                    436                     POP BX
033B 8A5751                437                     MOV DL, DS:KEYPAD_INPUT[BX]
033E 03C2                  438                     ADD AX, DX
0340 A3B200                439                     MOV DS:QTY, AX
0343 43                    440                     INC BX
0344 E2EB                  441             LOOP UPD_QTY
                           442             
0346 8B0E6100              443             MOV CX, DS:KEYPAD_INDEX
034A 8B1E9A00              444             MOV BX, DS:SEND_BUFFER_LEN
                           445             
034E                       446             UPD_BUFFER:
034E 53                    447                     PUSH BX
034F 8B1E6100              448                     MOV BX, DS:KEYPAD_INDEX
0353 2BD9                  449                     SUB BX, CX
0355 8A4751                450                     MOV AL, DS:KEYPAD_INPUT[BX]
0358 5B                    451                     POP BX
0359 0430                  452                     ADD AL, 30H
035B 88878D00              453                     MOV DS:SEND_BUFFER[BX], AL
                           454                     
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:50:24  12/06/;3  PAGE   10


LOC  OBJ                  LINE     SOURCE

035F 43                    455                     INC BX
0360 FF069A00              456                     INC DS:SEND_BUFFER_LEN
0364 E2E8                  457             LOOP UPD_BUFFER
                           458             
0366 C6878D002F            459             MOV DS:SEND_BUFFER[BX], '/'
036B FF069A00              460             INC DS:SEND_BUFFER_LEN
                           461                     
036F 5A                    462     POP DX
0370 59                    463     POP CX
0371 5B                    464     POP BX
0372 58                    465     POP AX
                           466     
0373 CB                    467     RET
                           468     UPDATE_THE_QUANTITY ENDP
                           469     
0374                       470     UPDATE_SEND_BUFFER PROC FAR
0374 50                    471     PUSH AX
0375 53                    472     PUSH BX
0376 51                    473     PUSH CX
0377 52                    474     PUSH DX
                           475     
0378 8B0E6100              476             MOV CX, DS:KEYPAD_INDEX
037C 83F900                477             CMP CX, 0
037F 7435                  478             JE END_UPD_BUFFER
0381 83C102                479             ADD CX, 2
0384 890E9A00              480             MOV DS:SEND_BUFFER_LEN, CX
0388 BB0000                481             MOV BX, 0
038B                       482             BUFFER_LOOP:
038B 83FB00                483                     CMP BX, 0
038E 7508                  484                     JNE ASTERISK
0390 C6878D007E            485                     MOV DS:SEND_BUFFER[BX], '~'
0395 EB1C90                486                     JMP END_BUFFER
0398                       487             ASTERISK:
0398 A16100                488                     MOV AX, DS:KEYPAD_INDEX
039B 40                    489                     INC AX
039C 3BD8                  490                     CMP BX, AX
039E 7508                  491                     JNE CONT
03A0 C6878D002A            492                     MOV DS:SEND_BUFFER[BX], '*'
03A5 EB0C90                493                     JMP END_BUFFER
03A8                       494             CONT:
03A8 4B                    495                     DEC BX
03A9 8A4751                496                     MOV AL, DS:KEYPAD_INPUT[BX]
03AC 0430                  497                     ADD AL, 30H
03AE 43                    498                     INC BX
03AF 88878D00              499                     MOV DS:SEND_BUFFER[BX], AL
                           500                     
03B3                       501             END_BUFFER:
03B3 43                    502                     INC BX
03B4 E2D5                  503             LOOP BUFFER_LOOP
03B6                       504     END_UPD_BUFFER:
03B6 5A                    505     POP DX
03B7 59                    506     POP CX
03B8 5B                    507     POP BX
03B9 58                    508     POP AX
03BA CB                    509     RET
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:50:24  12/06/;3  PAGE   11


LOC  OBJ                  LINE     SOURCE

                           510     UPDATE_SEND_BUFFER ENDP
                           511     
03BB                       512     BCD_BACKSPACE PROC FAR
                           513     
03BB 50                    514     PUSH AX
03BC 53                    515     PUSH BX
03BD 51                    516     PUSH CX
03BE 52                    517     PUSH DX
                           518     
03BF 8A167900              519             MOV DL, DS:REG_AL
03C3 833E610000            520             CMP DS:KEYPAD_INDEX, 0
03C8 7457                  521             JE RETURN_BACK
                           522             
03CA BB0600                523             MOV BX, 6
03CD                       524             BCD_CLEAR_LOOP:
03CD 4B                    525                     DEC BX
03CE C647592D              526                     MOV DS:BCD_MESSAGE[BX], '-'
03D2 43                    527                     INC BX
03D3 4B                    528                     DEC BX
03D4 75F7                  529             JNZ BCD_CLEAR_LOOP
                           530             
03D6 833E610001            531             CMP DS:KEYPAD_INDEX, 1
03DB 7E2C                  532             JLE less_than_two
                           533             
03DD FF0E6100              534             DEC DS:KEYPAD_INDEX
03E1 FF0E6100              535             DEC DS:KEYPAD_INDEX
03E5 8B1E6100              536             MOV BX, DS:KEYPAD_INDEX
03E9 8A4751                537             MOV AL, DS:KEYPAD_INPUT[BX]
03EC A27900                538             MOV DS:REG_AL, AL
03EF C706A8000000          539             MOV DS:SCROLL_LEN, 0
03F5 C706AA000100          540             MOV DS:DAC_DISABLE, 1
03FB 9A5504----     R      541             CALL FAR PTR BCD_UPDATE
0400 C706AA000000          542             MOV DS:DAC_DISABLE, 0
0406 EB1990                543             JMP RETURN_BACK
                           544             
0409                       545     less_than_two:
0409 FF0E6100              546             DEC DS:KEYPAD_INDEX
040D C60679002D            547             MOV DS:REG_AL, '-'
0412 C706A8000000          548             MOV DS:SCROLL_LEN, 0
0418 9A5504----     R      549             CALL FAR PTR BCD_UPDATE
041D FF0E6100              550             DEC DS:KEYPAD_INDEX
                           551             
0421                       552     RETURN_BACK:
0421 88167900              553             MOV DS:REG_AL, DL
0425 5A                    554     POP DX
0426 59                    555     POP CX
0427 5B                    556     POP BX
0428 58                    557     POP AX
                           558     
0429 CB                    559     RET
                           560     BCD_BACKSPACE ENDP
                           561     
042A                       562     BCD_CLEAR PROC FAR
042A 50                    563     PUSH AX
042B 53                    564     PUSH BX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:50:24  12/06/;3  PAGE   12


LOC  OBJ                  LINE     SOURCE

042C 51                    565     PUSH CX
042D 52                    566     PUSH DX
042E BB0800                567             MOV BX, 8
0431                       568             CLEAR_LOOP:
0431 C6475100              569             MOV DS:KEYPAD_INPUT[BX], 0
0435 4B                    570             DEC BX
0436 75F9                  571             JNZ CLEAR_LOOP
                           572             
0438 BB0600                573             MOV BX, 6
043B                       574             CLEAR_LOOP2:
043B 4B                    575                     DEC BX
043C C647592D              576                     MOV DS:BCD_MESSAGE[BX], '-'
0440 43                    577                     INC BX
0441 4B                    578                     DEC BX
0442 75F7                  579             JNZ CLEAR_LOOP2
                           580     
0444 C70661000000          581             MOV DS:KEYPAD_INDEX, 0
044A C706A8000000          582             MOV DS:SCROLL_LEN, 0
0450 5A                    583     POP DX
0451 59                    584     POP CX
0452 5B                    585     POP BX
0453 58                    586     POP AX
0454 CB                    587     RET
                           588     BCD_CLEAR ENDP
                           589     
0455                       590     BCD_UPDATE PROC FAR
0455 50                    591     PUSH AX
0456 53                    592     PUSH BX
0457 51                    593     PUSH CX
0458 52                    594     PUSH DX
0459 A19C00                595                     MOV AX, DS:MAX_INPUT_SIZE
045C 39066100              596                     CMP DS:KEYPAD_INDEX, AX
0460 7D5A                  597                     JGE BCD_RET
                           598                     
0462 8A0E7900              599                     MOV CL, DS:REG_AL
0466 80F909                600                     CMP CL, 9
0469 7F0C                  601                     JG SKIP_PAST
046B 833EAA0001            602                     CMP DS:DAC_DISABLE, 1
0470 7405                  603                     JE SKIP_PAST
0472 9AC104----     R      604                     CALL FAR PTR DAC_UPDATE
                           605     
0477                       606     SKIP_PAST:              
0477 8A0E7900              607                     MOV CL, DS:REG_AL
                           608     
047B 8B1E6100              609                     MOV BX, DS:KEYPAD_INDEX
                           610                             
047F 884F51                611                     MOV DS:KEYPAD_INPUT[BX], CL
                           612                             
0482 FF066100              613                     INC DS:KEYPAD_INDEX
                           614                             
0486 8B1E6100              615                     MOV BX, DS:KEYPAD_INDEX
                           616                     
048A A1A800                617                     MOV AX, DS:SCROLL_LEN
048D 2BD8                  618                     SUB BX, AX
                           619                     
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:50:24  12/06/;3  PAGE   13


LOC  OBJ                  LINE     SOURCE

048F 8B166100              620                     MOV DX, DS:KEYPAD_INDEX
0493 83FA06                621                     CMP DX, 6
0496 7E03                  622                     JLE update_display
0498 BA0600                623                     MOV DX, 6
                           624                     
049B                       625             update_display:
                           626             
049B B90500                627                     MOV CX, 5
049E 4B                    628                     DEC BX
049F 8A4751                629                     MOV AL, DS:KEYPAD_INPUT[BX]
04A2 43                    630                     INC BX
                           631                             
04A3 52                    632                     PUSH DX
04A4 8B166100              633                     MOV DX, DS:KEYPAD_INDEX
04A8 2B16A800              634                     SUB DX, DS:SCROLL_LEN
                           635                     
04AC 2BD3                  636                     SUB DX, BX
                           637                             
04AE 53                    638                     PUSH BX
                           639                             
04AF 2BCA                  640                     SUB CX, DX
04B1 8BD9                  641                     MOV BX, CX
04B3 884759                642                     MOV DS:BCD_MESSAGE[BX], AL
                           643                             
04B6 5B                    644                     POP BX
04B7 5A                    645                     POP DX
                           646             
04B8 4B                    647                     DEC BX
04B9 4A                    648                     DEC DX
04BA 75DF                  649             JNZ update_display
                           650     
04BC                       651             BCD_RET:
04BC 5A                    652                     POP DX
04BD 59                    653                     POP CX
04BE 5B                    654                     POP BX
04BF 58                    655                     POP AX
04C0 CB                    656     RET
                           657     BCD_UPDATE ENDP
                           658     
04C1                       659     DAC_UPDATE PROC FAR
04C1 50                    660             PUSH AX
04C2 53                    661             PUSH BX
04C3 51                    662             PUSH CX
04C4 52                    663             PUSH DX
                           664             
04C5 BB0000                665             MOV BX, 0
04C8 8A1E7500              666             MOV BL, DS:DAC_LEN
04CC A07900                667             MOV AL, DS:REG_AL
                           668             
04CF 884766                669             MOV DS:DAC_ADDR[BX], AL
                           670             
04D2 FE067500              671             INC DS:DAC_LEN
                           672     
04D6 5A                    673             POP DX
04D7 59                    674             POP CX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:50:24  12/06/;3  PAGE   14


LOC  OBJ                  LINE     SOURCE

04D8 5B                    675             POP BX
04D9 58                    676             POP AX
04DA CB                    677     RET
                           678     DAC_UPDATE ENDP
                           679               
04DB                       680     DEBOUNCE PROC FAR
04DB 51                    681                       PUSH CX
                           682                       
04DC B94C09                683                       MOV CX, 094CH
04DF 90                    684     BACK:     NOP
04E0 E2FD                  685                       LOOP BACK
04E2 59                    686                       POP CX
04E3 CB                    687                       RET
                           688     DEBOUNCE  ENDP
                           689     
04E4                       690     SEND_INPUT PROC FAR
04E4 50                    691     PUSH AX
04E5 53                    692     PUSH BX
04E6 51                    693     PUSH CX
04E7 52                    694     PUSH DX
04E8 BB0000                695             MOV BX, 0
04EB 8B0E9A00              696             MOV CX, DS:SEND_BUFFER_LEN
                           697             
04EF                       698             S_BUFF:
04EF 8A878D00              699                     MOV AL, DS:SEND_BUFFER[BX]
04F3 9A0000----     E      700                     CALL FAR PTR PRINT_CHAR
04F8 43                    701                     INC BX
04F9 E2F4                  702             LOOP S_BUFF
                           703             
04FB                       704     SEND_INPUT_END:
04FB 5A                    705     POP DX
04FC 59                    706     POP CX
04FD 5B                    707     POP BX
04FE 58                    708     POP AX
04FF CB                    709     RET
                           710     SEND_INPUT ENDP
                           711     
0500                       712     TAKE_CASH PROC FAR
0500 50                    713     PUSH AX
0501 53                    714     PUSH BX
0502 51                    715     PUSH CX
0503 52                    716     PUSH DX
                           717             
0504 B90000                718             MOV CX, 0
0507 B108                  719             MOV CL, 8
0509                       720             CLEAR_CASH_AMT:
0509 8BD9                  721                     MOV BX, CX
050B 4B                    722                     DEC BX
050C C687CA0000            723                     MOV DS:CASH_AMT[BX], 0
0511 E2F6                  724             LOOP CLEAR_CASH_AMT
                           725             
0513 8B0E6100              726             MOV CX, DS:KEYPAD_INDEX
0517 BA0600                727             MOV DX, 6
                           728             
051A                       729             UPDATE_CASH_AMT:
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:50:24  12/06/;3  PAGE   15


LOC  OBJ                  LINE     SOURCE

051A 8BD9                  730                     MOV BX, CX
051C 4B                    731                     DEC BX
                           732                     
051D 33C0                  733                     XOR AX, AX
051F 8A4751                734                     MOV AL, DS:KEYPAD_INPUT[BX]
                           735                     
0522 8BDA                  736                     MOV BX, DX
0524 4B                    737                     DEC BX
0525 8887CA00              738                     MOV DS:CASH_AMT[BX], AL
                           739                     
0529 4A                    740                     DEC DX
052A E2EE                  741             LOOP UPDATE_CASH_AMT
                           742             
052C C706E2000100          743             MOV DS:CASH_OK_FLAG, 1
0532 C706E4000700          744             MOV DS:BORROW_POSITION, 7
0538 B90800                745             MOV CX, 8
053B                       746             CHECK_CASH:
053B BB0800                747                     MOV BX, 8
053E 2BD9                  748                     SUB BX, CX
0540 B80000                749                     MOV AX, 0
0543 8A87BA00              750                     MOV AL, DS:TEMP_BCD_ARR[BX]
0547 8A97CA00              751                     MOV DL, DS:CASH_AMT[BX]
054B 3AD0                  752                     CMP DL, AL
054D 741A                  753                     JE NEXT_CASH_DIGIT
                           754                     
054F 3AD0                  755                     CMP DL, AL
0551 7C0D                  756                     JL CASH_NOT_OK
                           757                     
0553 C706E2000100          758                     MOV DS:CASH_OK_FLAG, 1
0559 891EE400              759                     MOV DS:BORROW_POSITION, BX
                           760                     
055D EB0C90                761                     JMP CHEK_CASH_DONE
                           762                     
0560                       763                     CASH_NOT_OK:
0560 C706E2000000          764                     MOV DS:CASH_OK_FLAG, 0
0566 EB0390                765                     JMP CHEK_CASH_DONE
                           766                     
0569                       767             NEXT_CASH_DIGIT:
0569 E2D0                  768             LOOP CHECK_CASH
                           769             
056B                       770     CHEK_CASH_DONE:
                           771             
056B 833EE20001            772             CMP DS:CASH_OK_FLAG, 1
0570 7464                  773             JE CONTINUE_CASH
0572 B90800                774             MOV CX, 8
0575 C70661000000          775             MOV DS:KEYPAD_INDEX, 0
057B C706AC000300          776             MOV DS:DECIMAL_INDEX, 3
0581                       777             RETAIN_BCD:
0581 BB0800                778                     MOV BX, 8
0584 2BD9                  779                     SUB BX, CX
                           780                     
0586 8A87BA00              781                     MOV AL, DS:TEMP_BCD_ARR[BX]
058A A27900                782                     MOV DS:REG_AL, AL
                           783                     
058D C706AA000100          784                     MOV DS:DAC_DISABLE, 1
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:50:24  12/06/;3  PAGE   16


LOC  OBJ                  LINE     SOURCE

0593 9A5504----     R      785                     CALL FAR PTR BCD_UPDATE
0598 C706AA000000          786                     MOV DS:DAC_DISABLE, 0
059E E2E1                  787             LOOP RETAIN_BCD
05A0 813E64000040          788             CMP DS:DAC_BASE, 4000H
05A6 7517                  789             JNE MANDARIN_CASH
                           790             
05A8 C606790023            791             MOV DS:REG_AL, 35
05AD 9AC104----     R      792             CALL FAR PTR DAC_UPDATE
05B2 C606790024            793             MOV DS:REG_AL, 36
05B7 9AC104----     R      794             CALL FAR PTR DAC_UPDATE
05BC E9A600                795             JMP CASH_OVER
                           796             
05BF                       797     MANDARIN_CASH:
05BF C606790012            798             MOV DS:REG_AL, 18
05C4 9AC104----     R      799             CALL FAR PTR DAC_UPDATE
05C9 C606790013            800             MOV DS:REG_AL, 19
05CE 9AC104----     R      801             CALL FAR PTR DAC_UPDATE
05D3 E98F00                802             JMP CASH_OVER
                           803             
05D6                       804     CONTINUE_CASH:
05D6 8B1EE400              805             MOV BX, DS:BORROW_POSITION
05DA B90700                806             MOV CX, 7
05DD 2BCB                  807             SUB CX, BX
05DF 83F900                808             CMP CX, 0
05E2 740C                  809             JE BEGIN_SUB
                           810             
05E4                       811             ADJUST_PLACES:
05E4 FE8FCA00              812                     DEC DS:CASH_AMT[BX]
05E8 43                    813                     INC BX
05E9 8087CA000A            814                     ADD DS:CASH_AMT[BX], 10
05EE E2F4                  815             LOOP ADJUST_PLACES
                           816             
05F0                       817     BEGIN_SUB:
05F0 B90800                818             MOV CX, 8
05F3                       819             CALC_CHANGE:
05F3 BB0800                820                     MOV BX, 8
05F6 2BD9                  821                     SUB BX, CX
05F8 B80000                822                     MOV AX, 0
05FB 8A87CA00              823                     MOV AL, DS:CASH_AMT[BX]
05FF BA0000                824                     MOV DX, 0
0602 8A97BA00              825                     MOV DL, DS:TEMP_BCD_ARR[BX]
0606 2BC2                  826                     SUB AX, DX
0608 8987D200              827                     MOV DS:TEMP_CASH_ARR[BX], AX
060C E2E5                  828             LOOP CALC_CHANGE
                           829             
060E B90800                830             MOV CX, 8
0611                       831             FIX_DIGITS:
0611 8BD9                  832             MOV BX, CX
0613 4B                    833             DEC BX
                           834             
0614 8B87D200              835             MOV AX, DS:TEMP_CASH_ARR[BX]
0618 3C0A                  836             CMP AL, 10
061A 7C0A                  837             JL NEXT_DIGIT_TO_FIX
                           838             
061C 83AFD2000A            839             SUB DS:TEMP_CASH_ARR[BX], 10
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:50:24  12/06/;3  PAGE   17


LOC  OBJ                  LINE     SOURCE

                           840             
0621 4B                    841             DEC BX
0622 FF87D200              842             INC DS:TEMP_CASH_ARR[BX]
                           843             
0626                       844             NEXT_DIGIT_TO_FIX:
                           845             
0626 E2E9                  846             LOOP FIX_DIGITS
                           847             
0628 B90800                848             MOV CX, 8
062B C70661000000          849             MOV DS:KEYPAD_INDEX, 0
0631 C706AC000300          850             MOV DS:DECIMAL_INDEX, 3
0637                       851             UPDATE_BCD_TO_CASH:
0637 BB0800                852                     MOV BX, 8
063A 2BD9                  853                     SUB BX, CX
063C 8B87D200              854                     MOV AX, DS:TEMP_CASH_ARR[BX]
0640 8887BA00              855                     MOV DS:TEMP_BCD_ARR[BX], AL
0644 A27900                856                     MOV DS:REG_AL, AL
0647 C706AA000100          857                     MOV DS:DAC_DISABLE, 1
064D 9A5504----     R      858                     CALL FAR PTR BCD_UPDATE
0652 C706AA000000          859                     MOV DS:DAC_DISABLE, 0
0658 E2DD                  860             LOOP UPDATE_BCD_TO_CASH
                           861             
065A 9A6A06----     R      862             CALL FAR PTR CALC_DAC
                           863             
065F C706C8000000          864             MOV DS:CASH_FLAG, 0
                           865             
0665                       866     CASH_OVER:
0665 5A                    867     POP DX
0666 59                    868     POP CX
0667 5B                    869     POP BX
0668 58                    870     POP AX
                           871     
0669 CB                    872     RET
                           873     TAKE_CASH ENDP
                           874     
066A                       875     CALC_DAC PROC FAR
066A 50                    876     PUSH AX
066B 53                    877     PUSH BX
066C 51                    878     PUSH CX
066D 52                    879     PUSH DX
066E 813E64000040          880             CMP DS:DAC_BASE, 4000H
0674 7403                  881             JE ENGLISH_DAC
0676 E98E01                882             JMP MANDARIN_DAC
                           883             
0679                       884     ENGLISH_DAC:
0679 C706C4000000          885             MOV DS:CENT_FLAG, 0
067F C706C2000000          886             MOV DS:THOUSAND_FLAG, 0
0685 C706C6000000          887             MOV DS:DOLLAR_FLAG,     0
068B BB0000                888             MOV BX, 0
068E 8A87BA00              889             MOV AL, DS:TEMP_BCD_ARR[BX]
0692 A27900                890             MOV DS:REG_AL, AL
0695 3C00                  891             CMP AL, 0
0697 7415                  892             JE NEXT_PLACE
0699 C706C6000100          893             MOV DS:DOLLAR_FLAG, 1
069F 9AC104----     R      894             CALL FAR PTR DAC_UPDATE
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:50:24  12/06/;3  PAGE   18


LOC  OBJ                  LINE     SOURCE

06A4 C60679001C            895             MOV DS:REG_AL, 28
06A9 9AC104----     R      896             CALL FAR PTR DAC_UPDATE
                           897             
06AE                       898     NEXT_PLACE:     
06AE 43                    899             INC BX
06AF 8A87BA00              900             MOV AL, DS:TEMP_BCD_ARR[BX]
06B3 3C01                  901             CMP AL, 1
06B5 751E                  902             JNE NOT_1
06B7 C706C6000100          903             MOV DS:DOLLAR_FLAG, 1
06BD 43                    904             INC BX
06BE 8A87BA00              905             MOV AL, DS:TEMP_BCD_ARR[BX]
06C2 040A                  906             ADD AL, 10
06C4 A27900                907             MOV DS:REG_AL, AL
06C7 9AC104----     R      908             CALL FAR PTR DAC_UPDATE
06CC C706C2000100          909             MOV DS:THOUSAND_FLAG, 1
06D2 EB3890                910             JMP HUNDREDS_PLACE
06D5                       911     NOT_1:
06D5 3C00                  912             CMP AL, 0
06D7 7416                  913             JE NEXT_PLACE_1
06D9 C706C6000100          914             MOV DS:DOLLAR_FLAG, 1
06DF C706C2000100          915             MOV DS:THOUSAND_FLAG, 1
06E5 0412                  916             ADD AL, 18
06E7 A27900                917             MOV DS:REG_AL, AL
06EA 9AC104----     R      918             CALL FAR PTR DAC_UPDATE
06EF                       919     NEXT_PLACE_1:
06EF 43                    920             INC BX
06F0 8A87BA00              921             MOV AL, DS:TEMP_BCD_ARR[BX]
06F4 3C00                  922             CMP AL, 0
06F6 7414                  923             JE HUNDREDS_PLACE
06F8 C706C6000100          924             MOV DS:DOLLAR_FLAG, 1
06FE C706C2000100          925             MOV DS:THOUSAND_FLAG, 1
0704 A27900                926             MOV DS:REG_AL, AL
0707 9AC104----     R      927             CALL FAR PTR DAC_UPDATE
                           928     
070C                       929     HUNDREDS_PLACE:
070C 833EC20000            930             CMP DS:THOUSAND_FLAG, 0
0711 7410                  931             JE NEXT_PLACE_2
0713 C60679001D            932             MOV DS:REG_AL, 29
0718 9AC104----     R      933             CALL FAR PTR DAC_UPDATE
071D C706C2000000          934             MOV DS:THOUSAND_FLAG, 0
                           935             
0723                       936     NEXT_PLACE_2:
0723 43                    937             INC BX
0724 8A87BA00              938             MOV AL, DS:TEMP_BCD_ARR[BX]
0728 3C00                  939             CMP AL, 0
072A 7418                  940             JE NEXT_PLACE_3
072C C706C6000100          941             MOV DS:DOLLAR_FLAG, 1
0732 A27900                942             MOV DS:REG_AL, AL
0735 9AC104----     R      943             CALL FAR PTR DAC_UPDATE
073A C60679001C            944             MOV DS:REG_AL, 28
073F 9AC104----     R      945             CALL FAR PTR DAC_UPDATE
                           946             
0744                       947     NEXT_PLACE_3:   
0744 43                    948             INC BX
0745 8A87BA00              949             MOV AL, DS:TEMP_BCD_ARR[BX]
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:50:24  12/06/;3  PAGE   19


LOC  OBJ                  LINE     SOURCE

0749 3C01                  950             CMP AL, 1
074B 7518                  951             JNE NOT_1_2
074D C706C6000100          952             MOV DS:DOLLAR_FLAG, 1
0753 43                    953             INC BX
0754 8A87BA00              954             MOV AL, DS:TEMP_BCD_ARR[BX]
0758 040A                  955             ADD AL, 10
075A A27900                956             MOV DS:REG_AL, AL
075D 9AC104----     R      957             CALL FAR PTR DAC_UPDATE
0762 EB2C90                958             JMP DECIMAL_DAC
0765                       959     NOT_1_2:
0765 3C00                  960             CMP AL, 0
0767 7410                  961             JE NEXT_PLACE_4
0769 C706C6000100          962             MOV DS:DOLLAR_FLAG, 1
076F 0412                  963             ADD AL, 18
0771 A27900                964             MOV DS:REG_AL, AL
0774 9AC104----     R      965             CALL FAR PTR DAC_UPDATE
0779                       966     NEXT_PLACE_4:
0779 43                    967             INC BX
077A 8A87BA00              968             MOV AL, DS:TEMP_BCD_ARR[BX]
077E 3C00                  969             CMP AL, 0
0780 740E                  970             JE DECIMAL_DAC
0782 C706C6000100          971             MOV DS:DOLLAR_FLAG, 1
0788 A27900                972             MOV DS:REG_AL, AL
078B 9AC104----     R      973             CALL FAR PTR DAC_UPDATE
                           974             
0790                       975     DECIMAL_DAC:
0790 833EC60000            976             CMP DS:DOLLAR_FLAG, 0
0795 740A                  977             JE DECIMAL_DAC_CONT
0797 C60679001E            978             MOV DS:REG_AL, 30
079C 9AC104----     R      979             CALL FAR PTR DAC_UPDATE
                           980             
07A1                       981     DECIMAL_DAC_CONT:
07A1 43                    982             INC BX
07A2 8A87BA00              983             MOV AL, DS:TEMP_BCD_ARR[BX]
07A6 3C01                  984             CMP AL, 1
07A8 7518                  985             JNE NOT_1_3
07AA 43                    986             INC BX
07AB C706C4000100          987             MOV DS:CENT_FLAG, 1
07B1 8A87BA00              988             MOV AL, DS:TEMP_BCD_ARR[BX]
07B5 040A                  989             ADD AL, 10
07B7 A27900                990             MOV DS:REG_AL, AL
07BA 9AC104----     R      991             CALL FAR PTR DAC_UPDATE
07BF EB2C90                992             JMP ENGLISH_END
                           993             
07C2                       994     NOT_1_3:
07C2 3C00                  995             CMP AL, 0
07C4 7410                  996             JE NEXT_PLACE_5
07C6 C706C4000100          997             MOV DS:CENT_FLAG, 1
07CC 0412                  998             ADD AL, 18
07CE A27900                999             MOV DS:REG_AL, AL
07D1 9AC104----     R     1000             CALL FAR PTR DAC_UPDATE
                          1001             
07D6                      1002     NEXT_PLACE_5:
07D6 43                   1003             INC BX
07D7 8A87BA00             1004             MOV AL, DS:TEMP_BCD_ARR[BX]
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:50:24  12/06/;3  PAGE   20


LOC  OBJ                  LINE     SOURCE

07DB 3C00                 1005             CMP AL, 0
07DD 740E                 1006             JE ENGLISH_END
07DF C706C4000100         1007             MOV DS:CENT_FLAG, 1
07E5 A27900               1008             MOV DS:REG_AL, AL
07E8 9AC104----     R     1009             CALL FAR PTR DAC_UPDATE
                          1010             
07ED                      1011     ENGLISH_END:
07ED 833EC40000           1012             CMP DS:CENT_FLAG, 0
07F2 7410                 1013             JE ENGLISH_END2
07F4 C60679001F           1014             MOV DS:REG_AL, 31
07F9 9AC104----     R     1015             CALL FAR PTR DAC_UPDATE
07FE C706C4000000         1016             MOV DS:CENT_FLAG, 0
0804                      1017     ENGLISH_END2:
0804 E94F01               1018             JMP CONT_BCD_UPD_1
                          1019             
0807                      1020     MANDARIN_DAC:
0807 C706C4000000         1021             MOV DS:CENT_FLAG, 0
080D C706C2000000         1022             MOV DS:THOUSAND_FLAG, 0
0813 C706C6000000         1023             MOV DS:DOLLAR_FLAG,     0
0819 BB0000               1024             MOV BX, 0
081C 8A87BA00             1025             MOV AL, DS:TEMP_BCD_ARR[BX]
0820 3C00                 1026             CMP AL, 0
0822 741E                 1027             JE NEXT_PLACE_6
0824 C706C6000100         1028             MOV DS:DOLLAR_FLAG, 1
082A C706C2000100         1029             MOV DS:THOUSAND_FLAG, 1
0830 A27900               1030             MOV DS:REG_AL, AL
0833 9AC104----     R     1031             CALL FAR PTR DAC_UPDATE
0838 C60679000B           1032             MOV DS:REG_AL, 11
083D 9AC104----     R     1033             CALL FAR PTR DAC_UPDATE
                          1034             
0842                      1035     NEXT_PLACE_6:
0842 43                   1036             INC BX
0843 8A87BA00             1037             MOV AL, DS:TEMP_BCD_ARR[BX]
0847 3C00                 1038             CMP AL, 0
0849 741E                 1039             JE NEXT_PLACE_7
084B C706C6000100         1040             MOV DS:DOLLAR_FLAG, 1
0851 C706C2000100         1041             MOV DS:THOUSAND_FLAG, 1
0857 A27900               1042             MOV DS:REG_AL, AL
085A 9AC104----     R     1043             CALL FAR PTR DAC_UPDATE
085F C60679000A           1044             MOV DS:REG_AL, 10
0864 9AC104----     R     1045             CALL FAR PTR DAC_UPDATE
                          1046             
0869                      1047     NEXT_PLACE_7:
0869 43                   1048             INC BX
086A 8A87BA00             1049             MOV AL, DS:TEMP_BCD_ARR[BX]
086E 3C00                 1050             CMP AL, 0
0870 7414                 1051             JE NEXT_PLACE_8
0872 C706C6000100         1052             MOV DS:DOLLAR_FLAG, 1
0878 C706C2000100         1053             MOV DS:THOUSAND_FLAG, 1
087E A27900               1054             MOV DS:REG_AL, AL
0881 9AC104----     R     1055             CALL FAR PTR DAC_UPDATE
                          1056     
0886                      1057     NEXT_PLACE_8:
0886 833EC20000           1058             CMP DS:THOUSAND_FLAG, 0
088B 7410                 1059             JE IGNORE_THOUSAND
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:50:24  12/06/;3  PAGE   21


LOC  OBJ                  LINE     SOURCE

088D C60679000C           1060             MOV DS:REG_AL, 12
0892 9AC104----     R     1061             CALL FAR PTR DAC_UPDATE
0897 C706C2000000         1062             MOV DS:THOUSAND_FLAG, 0
                          1063             
089D                      1064     IGNORE_THOUSAND:
089D 43                   1065             INC BX
089E 8A87BA00             1066             MOV AL, DS:TEMP_BCD_ARR[BX]
08A2 3C00                 1067             CMP AL, 0
08A4 7418                 1068             JE NEXT_PLACE_9
08A6 C706C6000100         1069             MOV DS:DOLLAR_FLAG, 1
08AC A27900               1070             MOV DS:REG_AL, AL
08AF 9AC104----     R     1071             CALL FAR PTR DAC_UPDATE
08B4 C60679000B           1072             MOV DS:REG_AL, 11
08B9 9AC104----     R     1073             CALL FAR PTR DAC_UPDATE
                          1074             
08BE                      1075     NEXT_PLACE_9:
08BE 43                   1076             INC BX
08BF 8A87BA00             1077             MOV AL, DS:TEMP_BCD_ARR[BX]
08C3 3C00                 1078             CMP AL, 0
08C5 7418                 1079             JE NEXT_PLACE_10
08C7 C706C6000100         1080             MOV DS:DOLLAR_FLAG, 1
08CD A27900               1081             MOV DS:REG_AL, AL
08D0 9AC104----     R     1082             CALL FAR PTR DAC_UPDATE
08D5 C60679000A           1083             MOV DS:REG_AL, 10
08DA 9AC104----     R     1084             CALL FAR PTR DAC_UPDATE
                          1085             
08DF                      1086     NEXT_PLACE_10:
08DF 43                   1087             INC BX
08E0 8A87BA00             1088             MOV AL, DS:TEMP_BCD_ARR[BX]
08E4 3C00                 1089             CMP AL, 0
08E6 740E                 1090             JE MANDARIN_DEC
08E8 C706C6000100         1091             MOV DS:DOLLAR_FLAG, 1
08EE A27900               1092             MOV DS:REG_AL, AL
08F1 9AC104----     R     1093             CALL FAR PTR DAC_UPDATE
                          1094             
08F6                      1095     MANDARIN_DEC:
08F6 833EC60000           1096             CMP DS:DOLLAR_FLAG, 0
08FB 740A                 1097             JE MANDARIN_DAC_CONT
08FD C60679000D           1098             MOV DS:REG_AL, 13
0902 9AC104----     R     1099             CALL FAR PTR DAC_UPDATE
0907                      1100     MANDARIN_DAC_CONT:
0907 43                   1101             INC BX
0908 8A87BA00             1102             MOV AL, DS:TEMP_BCD_ARR[BX]
090C 3C00                 1103             CMP AL, 0
090E 7418                 1104             JE NEXT_PLACE_11
0910 C706C4000100         1105             MOV DS:CENT_FLAG, 1
0916 A27900               1106             MOV DS:REG_AL, AL
0919 9AC104----     R     1107             CALL FAR PTR DAC_UPDATE
091E C60679000A           1108             MOV DS:REG_AL, 10
0923 9AC104----     R     1109             CALL FAR PTR DAC_UPDATE
                          1110             
0928                      1111     NEXT_PLACE_11:
                          1112     
0928 43                   1113             INC BX
0929 8A87BA00             1114             MOV AL, DS:TEMP_BCD_ARR[BX]
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:50:24  12/06/;3  PAGE   22


LOC  OBJ                  LINE     SOURCE

092D 3C00                 1115             CMP AL, 0
092F 740E                 1116             JE CONT_BCD_UPD
0931 C706C4000100         1117             MOV DS:CENT_FLAG, 1
0937 A27900               1118             MOV DS:REG_AL, AL
093A 9AC104----     R     1119             CALL FAR PTR DAC_UPDATE
                          1120             
093F                      1121     CONT_BCD_UPD:
093F 833EC40000           1122             CMP DS:CENT_FLAG, 0
0944 7410                 1123             JE CONT_BCD_UPD_1
0946 C60679000E           1124             MOV DS:REG_AL, 14
094B 9AC104----     R     1125             CALL FAR PTR DAC_UPDATE
0950 C706C4000000         1126             MOV DS:CENT_FLAG, 0
                          1127     
0956                      1128     CONT_BCD_UPD_1:
                          1129             
0956 5A                   1130     POP DX
0957 59                   1131     POP CX
0958 5B                   1132     POP BX
0959 58                   1133     POP AX
095A CB                   1134     RET
                          1135     CALC_DAC ENDP
                          1136     
095B                      1137     CALC_UPD_PRICE PROC FAR
095B 50                   1138     PUSH AX
095C 53                   1139     PUSH BX
095D 51                   1140     PUSH CX
095E 52                   1141     PUSH DX
095F 833EB20000           1142             CMP DS:QTY, 0
0964 7503                 1143             JNE CHECK_PRICE_ZERO
0966 E92B01               1144             JMP CALC_END
0969                      1145     CHECK_PRICE_ZERO:
0969 833EB00000           1146             CMP DS:PRICE, 0
096E 7503                 1147             JNE START_CALC
0970 E92101               1148             JMP CALC_END
0973                      1149     START_CALC:
0973 BA0000               1150             MOV DX, 0
0976 A1B000               1151             MOV AX, DS:PRICE
0979 8B1EB200             1152             MOV BX, DS:QTY
097D F7E3                 1153             MUL BX
                          1154             
097F BB6400               1155             MOV BX, 100
0982 F7F3                 1156             DIV BX
0984 A3B000               1157             MOV DS:PRICE, AX
0987 A1B800               1158             MOV AX, DS:TOTAL_PRICE_DEC
098A 03C2                 1159             ADD AX, DX
098C 3D6400               1160             CMP AX, 100
098F 7C07                 1161             JL NON_DECIMAL
0991 FF06B600             1162             INC DS:TOTAL_PRICE_L
0995 2D6400               1163             SUB AX, 100
                          1164             
0998                      1165     NON_DECIMAL:    
0998 A3B800               1166             MOV DS:TOTAL_PRICE_DEC, AX
099B A1B600               1167             MOV AX, DS:TOTAL_PRICE_L
099E 8B1EB000             1168             MOV BX, DS:PRICE
09A2 03C3                 1169             ADD AX, BX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:50:24  12/06/;3  PAGE   23


LOC  OBJ                  LINE     SOURCE

09A4 7304                 1170             JNC update_normal
09A6 FF06B400             1171             INC DS:TOTAL_PRICE_U
                          1172             
09AA                      1173     update_normal:
09AA A3B600               1174             MOV DS:TOTAL_PRICE_L, AX
                          1175             
09AD BA0000               1176             MOV DX, 0
                          1177             ;CMP DS:TOTAL_PRICE_DEC, 9
                          1178             ;JG DECIMAL_CONT
                          1179             ;MOV CX, 10
                          1180             ;MOV AX, DS:TOTAL_PRICE_DEC
                          1181             ;MUL CX
                          1182             ;MOV DS:TOTAL_PRICE_DEC, AX
                          1183     ;DECIMAL_CONT:
09B0 A1B800               1184             MOV AX, DS:TOTAL_PRICE_DEC
09B3 B90A00               1185             MOV CX, 10
09B6 F7F1                 1186             DIV CX
                          1187             
09B8 BB0700               1188             MOV BX, 7
09BB 8897BA00             1189             MOV DS:TEMP_BCD_ARR[BX], DL
09BF 4B                   1190             DEC BX
09C0 8887BA00             1191             MOV DS:TEMP_BCD_ARR[BX], AL
                          1192             
09C4 BB0600               1193             MOV BX, 6
09C7 A1B600               1194             MOV AX, DS:TOTAL_PRICE_L
                          1195             
09CA                      1196             TEMP_UPD_LOOP:
09CA BA0000               1197                     MOV DX, 0
09CD B90A00               1198                     MOV CX, 10
09D0 F7F1                 1199                     DIV CX
                          1200                     
09D2 4B                   1201                     DEC BX
09D3 8897BA00             1202                     MOV DS:TEMP_BCD_ARR[BX], DL
09D7 43                   1203                     INC BX
                          1204                     
09D8 4B                   1205                     DEC BX
                          1206                     
09D9 75EF                 1207             JNZ TEMP_UPD_LOOP
                          1208             
09DB 8B0EB400             1209             MOV CX, DS:TOTAL_PRICE_U
09DF 83F900               1210             CMP CX, 0
09E2 7478                 1211             JE upd_dac_part
09E4                      1212             ADD_EXTRA_PART:
09E4 BB0500               1213                     MOV BX, 5
09E7 8A87BA00             1214                     MOV AL, DS:TEMP_BCD_ARR[BX]
09EB 0406                 1215                     ADD AL, 6
09ED 3C09                 1216                     CMP AL, 9
09EF 7E08                 1217                     JLE CONT_DIGIT_1
09F1 2C0A                 1218                     SUB AL, 10
09F3 4B                   1219                     DEC BX
09F4 FE87BA00             1220                     INC DS:TEMP_BCD_ARR[BX]
09F8 43                   1221                     INC BX
09F9                      1222             CONT_DIGIT_1:
09F9 8887BA00             1223                     MOV DS:TEMP_BCD_ARR[BX], AL
09FD 4B                   1224                     DEC BX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:50:24  12/06/;3  PAGE   24


LOC  OBJ                  LINE     SOURCE

                          1225                     
09FE 8A87BA00             1226                     MOV AL, DS:TEMP_BCD_ARR[BX]
0A02 0403                 1227                     ADD AL, 3
0A04 3C09                 1228                     CMP AL, 9
0A06 7E08                 1229                     JLE CONT_DIGIT_2
0A08 2C0A                 1230                     SUB AL, 10
0A0A 4B                   1231                     DEC BX
0A0B FE87BA00             1232                     INC DS:TEMP_BCD_ARR[BX]
0A0F 43                   1233                     INC BX
0A10                      1234             CONT_DIGIT_2:
0A10 8887BA00             1235                     MOV DS:TEMP_BCD_ARR[BX], AL
0A14 4B                   1236                     DEC BX
                          1237                     
0A15 8A87BA00             1238                     MOV AL, DS:TEMP_BCD_ARR[BX]
0A19 0405                 1239                     ADD AL, 5
0A1B 3C09                 1240                     CMP AL, 9
0A1D 7E08                 1241                     JLE CONT_DIGIT_3
0A1F 2C0A                 1242                     SUB AL, 10
0A21 4B                   1243                     DEC BX
0A22 FE87BA00             1244                     INC DS:TEMP_BCD_ARR[BX]
0A26 43                   1245                     INC BX
0A27                      1246             CONT_DIGIT_3:
0A27 8887BA00             1247                     MOV DS:TEMP_BCD_ARR[BX], AL
0A2B 4B                   1248                     DEC BX
                          1249                     
                          1250                     
0A2C 8A87BA00             1251                     MOV AL, DS:TEMP_BCD_ARR[BX]
0A30 0405                 1252                     ADD AL, 5
0A32 3C09                 1253                     CMP AL, 9
0A34 7E08                 1254                     JLE CONT_DIGIT_4
0A36 2C0A                 1255                     SUB AL, 10
0A38 4B                   1256                     DEC BX
0A39 FE87BA00             1257                     INC DS:TEMP_BCD_ARR[BX]
0A3D 43                   1258                     INC BX
0A3E                      1259             CONT_DIGIT_4:
0A3E 8887BA00             1260                     MOV DS:TEMP_BCD_ARR[BX], AL
0A42 4B                   1261                     DEC BX
                          1262                     
0A43 8A87BA00             1263                     MOV AL, DS:TEMP_BCD_ARR[BX]
0A47 0406                 1264                     ADD AL, 6
0A49 3C09                 1265                     CMP AL, 9
0A4B 7E08                 1266                     JLE CONT_DIGIT_5
0A4D 2C0A                 1267                     SUB AL, 10
0A4F 4B                   1268                     DEC BX
0A50 FE87BA00             1269                     INC DS:TEMP_BCD_ARR[BX]
0A54 43                   1270                     INC BX
0A55                      1271             CONT_DIGIT_5:
0A55 8887BA00             1272                     MOV DS:TEMP_BCD_ARR[BX], AL
0A59 4B                   1273                     DEC BX
                          1274                     
0A5A E288                 1275             LOOP ADD_EXTRA_PART
                          1276             
0A5C                      1277     upd_dac_part:
0A5C 9A6A06----     R     1278             CALL FAR PTR CALC_DAC
                          1279     
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:50:24  12/06/;3  PAGE   25


LOC  OBJ                  LINE     SOURCE

0A61 9A2A04----     R     1280             CALL FAR PTR BCD_CLEAR
0A66 C70661000000         1281             MOV DS:KEYPAD_INDEX, 0
0A6C C706AC000300         1282             MOV DS:DECIMAL_INDEX, 3
0A72 B90800               1283             MOV CX, 8
0A75                      1284             UPD_BCD:
0A75 BB0800               1285                     MOV BX, 8
0A78 2BD9                 1286                     SUB BX, CX
0A7A 8A87BA00             1287                     MOV AL, DS:TEMP_BCD_ARR[BX]
0A7E A27900               1288                     MOV DS:REG_AL, AL
0A81 C706AA000100         1289                     MOV DS:DAC_DISABLE, 1
0A87 9A5504----     R     1290                     CALL FAR PTR BCD_UPDATE
0A8C C706AA000000         1291                     MOV DS:DAC_DISABLE, 0
0A92 E2E1                 1292             LOOP UPD_BCD
                          1293             
0A94                      1294     CALC_END:
0A94 833EB00000           1295             CMP DS:PRICE, 0
0A99 7403                 1296             JE RETAIN_BCD_VALUE
0A9B EB2F90               1297             JMP END_CALC_BCD_DAC
                          1298             
0A9E                      1299     RETAIN_BCD_VALUE:       
0A9E C70661000000         1300             MOV DS:KEYPAD_INDEX, 0
0AA4 C706AC000300         1301             MOV DS:DECIMAL_INDEX, 3
0AAA B90800               1302             MOV CX, 8
0AAD                      1303             UPD_BCD1:
0AAD BB0800               1304                     MOV BX, 8
0AB0 2BD9                 1305                     SUB BX, CX
0AB2 8A87BA00             1306                     MOV AL, DS:TEMP_BCD_ARR[BX]
0AB6 A27900               1307                     MOV DS:REG_AL, AL
0AB9 C706AA000100         1308                     MOV DS:DAC_DISABLE, 1
0ABF 9A5504----     R     1309                     CALL FAR PTR BCD_UPDATE
0AC4 C706AA000000         1310                     MOV DS:DAC_DISABLE, 0
0ACA E2E1                 1311             LOOP UPD_BCD1
                          1312     
0ACC                      1313     END_CALC_BCD_DAC:
0ACC C706B0000000         1314             MOV DS:PRICE, 0
0AD2 C706B2000000         1315             MOV DS:QTY, 0
0AD8 5A                   1316     POP DX
0AD9 59                   1317     POP CX
0ADA 5B                   1318     POP BX
0ADB 58                   1319     POP AX
0ADC CB                   1320     RET
                          1321     CALC_UPD_PRICE ENDP
                          1322     ; ^^^^^^^^^^^^^^^ End of User main routine ^^^^^^^^^^^^^^^^^^^^^^^^^
0ADD                      1323     SERIAL_REC_ACTION       PROC    FAR
0ADD 51                   1324                     PUSH    CX
0ADE 53                   1325                     PUSH    BX
0ADF 1E                   1326                     PUSH    DS
                          1327                     
0AE0 BB----         R     1328                     MOV     BX,DATA_SEG             ;initialize data segment register
0AE3 8EDB                 1329                     MOV     DS,BX
                          1330                     
0AE5 803E8B0001           1331                     CMP DS:REPLY_FLAG, 1
0AEA 7569                 1332                     JNE next_id1
                          1333                     
0AEC 803E8C0001           1334                     CMP DS:SEND_FLAG, 1
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:50:24  12/06/;3  PAGE   26


LOC  OBJ                  LINE     SOURCE

0AF1 7465                 1335                     JE send_input_across1
                          1336                     
0AF3 833EA00001           1337                     CMP DS:RECEIVE_FLAG, 1
0AF8 7561                 1338                     JNE terminate_session3
                          1339                     
0AFA 3C2F                 1340                     CMP AL, '/'
0AFC 751A                 1341                     JNE CHECK_SEND
0AFE C706A4000000         1342                     MOV DS:PRICE_FLAG, 0
0B04 C706A0000000         1343                     MOV DS:RECEIVE_FLAG, 0
0B0A C706AE000100         1344                     MOV DS:LANG_FLAG, 1
0B10 9A5B09----     R     1345                     CALL FAR PTR CALC_UPD_PRICE
0B15 EB4490               1346                     JMP terminate_session3
                          1347             
0B18                      1348             CHECK_SEND:
0B18 3C26                 1349                     CMP AL, '&'
0B1A 7515                 1350                     JNE receive_price
0B1C C706A4000100         1351                     MOV DS:PRICE_FLAG, 1
0B22 C70661000000         1352                     MOV DS:KEYPAD_INDEX, 0
0B28 C7069C000800         1353                     MOV DS:MAX_INPUT_SIZE, 8
0B2E EB7F90               1354                     JMP id_skip2
                          1355                     
0B31                      1356             receive_price:
0B31 3C23                 1357                     CMP AL, '#'
0B33 750F                 1358                     JNE check_price
0B35 C706A2000100         1359                     MOV DS:DAC_FLAG, 1
0B3B C706A4000000         1360                     MOV DS:PRICE_FLAG, 0
0B41 EB6C90               1361                     JMP id_skip2
                          1362             
0B44                      1363             check_price:    
                          1364             
0B44 833EA40001           1365                     CMP DS:PRICE_FLAG, 1
0B49 7431                 1366                     JE update_price_value
                          1367                     
0B4B 833EA20001           1368                     CMP DS:DAC_FLAG, 1
0B50 740C                 1369                     JE dac_change
0B52 EB5B90               1370                     JMP id_skip2
                          1371     
0B55                      1372             next_id1:
0B55 EB5B90               1373                     JMP next_id
                          1374                     
0B58                      1375             send_input_across1:
0B58 EB3990               1376                     JMP send_input_across
                          1377             
0B5B                      1378             terminate_session3:
0B5B EB4F90               1379                     JMP terminate_session2
                          1380             
0B5E                      1381             dac_change:
0B5E 8A1E7900             1382                     MOV BL, DS:REG_AL
0B62 2C30                 1383                     SUB AL, 30H
0B64 A27900               1384                     MOV DS:REG_AL, AL
0B67 9AC104----     R     1385                     CALL FAR PTR DAC_UPDATE
0B6C 881E7900             1386                     MOV DS:REG_AL, BL
0B70 C706A2000000         1387                     MOV DS:DAC_FLAG, 0
0B76 EB3790               1388                     JMP id_skip2
                          1389             
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:50:24  12/06/;3  PAGE   27


LOC  OBJ                  LINE     SOURCE

                          1390     
0B79 EB3490               1391             id_skip3: JMP id_skip2
                          1392     
                          1393                     
0B7C                      1394             update_price_value:
0B7C 2C30                 1395                     SUB AL, 30H
0B7E B90000               1396                     MOV CX, 0
0B81 8AC8                 1397                     MOV CL, AL
0B83 A1B000               1398                     MOV AX, DS:PRICE
0B86 BB0A00               1399                     MOV BX, 10
0B89 F7E3                 1400                     MUL BX
                          1401                     
0B8B 03C1                 1402                     ADD AX, CX
0B8D A3B000               1403                     MOV DS:PRICE, AX
0B90 EB1D90               1404                     JMP id_skip2
                          1405                     
0B93                      1406             send_input_across:
0B93 9AE404----     R     1407                     CALL FAR PTR SEND_INPUT
                          1408                     
0B98 C7069A000000         1409                     MOV DS:SEND_BUFFER_LEN, 0
                          1410                     
0B9E C6068C0000           1411                     MOV DS:SEND_FLAG, 0
                          1412                     
0BA3 C706A0000100         1413                     MOV DS:RECEIVE_FLAG, 1
                          1414                     
0BA9 EB0490               1415                     JMP id_skip2
                          1416                     
0BAC EB3E90               1417                     terminate_session2: JMP terminate_session
0BAF EB6790               1418                     id_skip2: JMP id_skip
                          1419                     
0BB2                      1420             next_id:
                          1421                     
0BB2 803E810001           1422                     CMP DS:ID_FLAG_r, 1
0BB7 7513                 1423                     JNE id_flag_label
0BB9 38067F00             1424                     CMP DS:MY_ID[1], AL
0BBD 7559                 1425                     JNE id_skip
                          1426                     ;start writing to pc
0BBF C6068B0001           1427                     MOV DS:REPLY_FLAG, 1
0BC4 C606810000           1428                     MOV DS:ID_FLAG_r, 0
0BC9 EB4D90               1429                     JMP id_skip
                          1430             
0BCC                      1431             id_flag_label:
                          1432             
0BCC 803E800001           1433                     CMP DS:ID_FLAG_@, 1
0BD1 7539                 1434                     JNE protocol_rec
0BD3 3C72                 1435                     CMP AL,'r'
0BD5 750D                 1436                     JNE id_not_r
0BD7 C606810001           1437                     MOV DS:ID_FLAG_r,1
0BDC C606800000           1438                     MOV DS:ID_FLAG_@, 0
0BE1 EB3590               1439                     JMP S_RET
0BE4                      1440             id_not_r:
0BE4 C606800000           1441                     MOV DS:ID_FLAG_@, 0
0BE9 EB2D90               1442                     JMP id_skip
                          1443             
0BEC                      1444             terminate_session:
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:50:24  12/06/;3  PAGE   28


LOC  OBJ                  LINE     SOURCE

0BEC C606810000           1445                     MOV DS:ID_FLAG_r, 0
0BF1 33DB                 1446                     XOR BX,BX
0BF3                      1447             start_send1:
0BF3 50                   1448                     PUSH AX
0BF4 33C0                 1449                     XOR AX,AX
0BF6 8A878600             1450                     MOV AL, DS:FAIL_MESSAGE[BX]
0BFA 9A0000----     E     1451                     CALL FAR PTR PRINT_CHAR
0BFF 58                   1452                     POP AX
0C00 C6068B0000           1453                     MOV DS:REPLY_FLAG, 0
0C05 43                   1454                     INC BX
0C06 3A1E8A00             1455                     CMP BL, DS:FAIL_COUNT
0C0A 75E7                 1456                     JNE start_send1
                          1457                     
0C0C                      1458             protocol_rec:
0C0C 3C40                 1459                     CMP AL,'@'
0C0E 7508                 1460                     JNE id_skip
0C10 C606800001           1461                     MOV DS:ID_FLAG_@,1
0C15 EB0190               1462                     JMP S_RET
                          1463                     
0C18                      1464             id_skip:
                          1465                     ; JMP S_RET
                          1466             
                          1467                     ; CMP   AL,'<'
                          1468                     ; JNE   S_FAST
                          1469     
                          1470                     ; INC   DS:T_COUNT_SET
                          1471                     ; INC   DS:T_COUNT_SET
                          1472     
                          1473                     ; JMP   S_NEXT0
                          1474     ; S_FAST:
                          1475                     ; CMP   AL,'>'
                          1476                     ; JNE   S_RET
                          1477     
                          1478                     ; DEC   DS:T_COUNT_SET
                          1479                     ; DEC   DS:T_COUNT_SET
                          1480     
                          1481     ; S_NEXT0:
                          1482                     ; MOV   CX,22                   ;initialize counter for message
                          1483                     ; MOV   BX,0
                          1484     
                          1485     ; S_NEXT1:      MOV     AL,DS:REC_MESS[BX]      ;print message
                          1486                     ; call  FAR ptr print_char
                          1487                     ; INC   BX
                          1488                     ; LOOP  S_NEXT1
                          1489     
                          1490                     ; MOV   AL,DS:T_COUNT_SET       ;print current period of timer0
                          1491                     ; CALL  FAR PTR PRINT_2HEX
0C18                      1492     S_RET:
0C18 1F                   1493                     POP     DS
0C19 5B                   1494                     POP     BX
0C1A 59                   1495                     POP     CX
0C1B CB                   1496                     RET
                          1497     SERIAL_REC_ACTION       ENDP
                          1498     
0C1C                      1499     TIMER2_ACTION   PROC    FAR
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:50:24  12/06/;3  PAGE   29


LOC  OBJ                  LINE     SOURCE

0C1C 50                   1500                     PUSH    AX
0C1D 1E                   1501                     PUSH    DS
0C1E 53                   1502                     PUSH    BX
0C1F 51                   1503                     PUSH    CX
0C20 52                   1504                     PUSH    DX
                          1505                     
                          1506                     
0C21 B8----         R     1507                     MOV     AX,DATA_SEG
0C24 8ED8                 1508                     MOV     DS,AX
                          1509             
0C26 FE0E1600             1510                     DEC     DS:T_COUNT
0C2A 754A                 1511                     JNZ     T_NEXT1
0C2C A01700               1512                     MOV     AL,DS:T_COUNT_SET
0C2F A21600               1513                     MOV     DS:T_COUNT,AL
                          1514     
0C32                      1515     T_NEXT0:
                          1516                     
0C32 33DB                 1517                     XOR BX, BX
0C34 8A1E6000             1518                     MOV BL, DS:BCD_INDEX
0C38 8A4759               1519                     MOV AL, DS:BCD_MESSAGE[BX]
                          1520                     
0C3B 3B1EAC00             1521                     CMP BX, DS:DECIMAL_INDEX
0C3F 7506                 1522                     JNE CALL_FUNC
0C41 C706A6000100         1523                     MOV DS:DECIMAL_FLAG, 1
0C47                      1524     CALL_FUNC:
0C47 9AE70C----     R     1525                     CALL FAR PTR BCD_TO_7SEG
0C4C C706A6000000         1526                     MOV DS:DECIMAL_FLAG, 0
                          1527     
0C52 BA0002               1528                     MOV DX, 200H
0C55 EE                   1529                     OUT DX, AL
                          1530                     
0C56 A05F00               1531                     MOV AL, DS:ENABLE_BYTE
0C59 BA8001               1532                     MOV DX, 180H
0C5C EE                   1533                     OUT DX, AL
                          1534                     
                          1535     
0C5D FE066000             1536                     INC DS:BCD_INDEX
0C61 D0065F00             1537                     ROL DS:ENABLE_BYTE, 1
0C65 803E5F00BF           1538                     CMP DS:ENABLE_BYTE, 10111111b
0C6A 750A                 1539                     JNE T_NEXT1
0C6C C6065F00FE           1540                     MOV DS:ENABLE_BYTE, 11111110b 
0C71 C606600000           1541                     MOV DS:BCD_INDEX, 0
                          1542     
                          1543                     
0C76                      1544     T_NEXT1:
0C76 803E750000           1545                     CMP DS:DAC_LEN, 0
0C7B 743C                 1546                     JE ISR_END
                          1547                     
                          1548                     
0C7D 8B367600             1549                     MOV SI, DS:SI_PTR
                          1550                             
0C81 BB0000               1551                     MOV BX, 0
0C84 33C0                 1552                     XOR AX, AX
0C86 8A4766               1553                     MOV AL, DS:DAC_ADDR[BX]
                          1554                     
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:50:24  12/06/;3  PAGE   30


LOC  OBJ                  LINE     SOURCE

0C89 BB0001               1555                     MOV BX, 100H
0C8C F7E3                 1556                     MUL BX
                          1557                     
0C8E 8B166400             1558                     MOV DX, DS:DAC_BASE
0C92 03D0                 1559                     ADD DX, AX
                          1560                     
0C94 1E                   1561                     PUSH DS
0C95 8EDA                 1562                     MOV DS, DX
                          1563                     
0C97 8B04                 1564                     MOV AX, [SI]
                          1565                     
0C99 BA1001               1566                     MOV DX, 110H
0C9C EE                   1567                     OUT DX, AL
                          1568                     
0C9D 1F                   1569                     POP DS
                          1570                     
0C9E FF067600             1571                     INC DS:SI_PTR
0CA2 813E76000010         1572                     CMP DS:SI_PTR, 1000H
0CA8 750F                 1573                     JNE ISR_END
                          1574                     
0CAA C70676000000         1575                     MOV DS:SI_PTR, 0
0CB0 FE0E7500             1576                     DEC DS:DAC_LEN
0CB4 9ABF0C----     R     1577                     CALL FAR PTR DAC_SHIFT
                          1578                     
0CB9                      1579     ISR_END:
                          1580                     
0CB9 5A                   1581                     POP DX
0CBA 59                   1582                     POP     CX
0CBB 5B                   1583                     POP     BX
0CBC 1F                   1584                     POP     DS
0CBD 58                   1585                     POP AX
0CBE CB                   1586                     RET
                          1587     TIMER2_ACTION   ENDP
                          1588     
                          1589     
0CBF                      1590     DAC_SHIFT PROC FAR
0CBF 50                   1591             PUSH AX
0CC0 53                   1592             PUSH BX
0CC1 51                   1593             PUSH CX
0CC2 52                   1594             PUSH DX
                          1595     
0CC3 33C9                 1596             XOR CX, CX
0CC5 8A0E7500             1597             MOV CL, DS:DAC_LEN
0CC9 80F900               1598             CMP CL, 0
0CCC 7414                 1599             JE END_SHIFT
                          1600     
0CCE                      1601             SHIFT_LOOP:
                          1602     
0CCE 33DB                 1603             XOR BX, BX
0CD0 8A1E7500             1604             MOV BL, DS:DAC_LEN
0CD4 2BD9                 1605             SUB BX, CX
0CD6 43                   1606             INC BX
                          1607             
0CD7 33D2                 1608             XOR DX, DX
0CD9 8A5766               1609             MOV DL, DS:DAC_ADDR[BX]
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:50:24  12/06/;3  PAGE   31


LOC  OBJ                  LINE     SOURCE

0CDC 4B                   1610             DEC BX
0CDD 885766               1611             MOV DS:DAC_ADDR[BX], DL
                          1612     
0CE0 E2EC                 1613             LOOP SHIFT_LOOP
                          1614             
0CE2                      1615             END_SHIFT:
0CE2 5A                   1616             POP DX
0CE3 59                   1617             POP CX
0CE4 5B                   1618             POP BX
0CE5 58                   1619             POP AX
0CE6 CB                   1620             RET
                          1621     DAC_SHIFT ENDP
                          1622     
0CE7                      1623     BCD_TO_7SEG PROC FAR
                          1624     
0CE7 53                   1625             PUSH BX
0CE8 51                   1626             PUSH CX
0CE9 52                   1627             PUSH DX
                          1628             
0CEA 3C00                 1629             CMP AL, 0
0CEC 7511                 1630             JNE one
0CEE 833EA60001           1631             CMP DS:DECIMAL_FLAG, 1
0CF3 7405                 1632             JE decimal0
0CF5 B03F                 1633             MOV AL, 00111111b
0CF7 E9D700               1634             JMP endfunc
0CFA                      1635     decimal0:
0CFA B0BF                 1636             MOV AL, 10111111b
0CFC E9D200               1637             JMP endfunc
                          1638             
0CFF                      1639             one:
0CFF 3C01                 1640             CMP AL, 1
0D01 7511                 1641             JNE two
0D03 833EA60001           1642             CMP DS:DECIMAL_FLAG, 1
0D08 7405                 1643             JE decimal1
0D0A B006                 1644             MOV AL, 00000110b
0D0C E9C200               1645             JMP endfunc
0D0F                      1646     decimal1:
0D0F B086                 1647             MOV AL, 10000110b
0D11 E9BD00               1648             JMP endfunc
                          1649             
0D14                      1650             two:
0D14 3C02                 1651             CMP AL,2
0D16 7511                 1652             JNE three
0D18 833EA60001           1653             CMP DS:DECIMAL_FLAG, 1
0D1D 7405                 1654             JE decimal2
0D1F B05B                 1655             MOV AL, 01011011b
0D21 E9AD00               1656             JMP endfunc
0D24                      1657     decimal2:
0D24 B0DB                 1658             MOV AL, 11011011b
0D26 E9A800               1659             JMP endfunc
                          1660             
0D29                      1661             three:
0D29 3C03                 1662             CMP AL,3
0D2B 7511                 1663             JNE four
0D2D 833EA60001           1664             CMP DS:DECIMAL_FLAG, 1
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:50:24  12/06/;3  PAGE   32


LOC  OBJ                  LINE     SOURCE

0D32 7405                 1665             JE decimal3
0D34 B04F                 1666             MOV AL, 01001111b
0D36 E99800               1667             JMP endfunc
0D39                      1668     decimal3:
0D39 B0CF                 1669             MOV AL, 11001111b
0D3B E99300               1670             JMP endfunc
                          1671             
0D3E                      1672             four:
0D3E 3C04                 1673             CMP AL,4
0D40 7511                 1674             JNE five
0D42 833EA60001           1675             CMP DS:DECIMAL_FLAG, 1
0D47 7405                 1676             JE decimal4
0D49 B066                 1677             MOV AL, 01100110b
0D4B E98300               1678             JMP endfunc
0D4E                      1679     decimal4:
0D4E B0E6                 1680             MOV AL, 11100110b
0D50 EB7F90               1681             JMP endfunc
                          1682             
0D53                      1683             five:
0D53 3C05                 1684             CMP AL,5
0D55 7511                 1685             JNE six
0D57 833EA60001           1686             CMP DS:DECIMAL_FLAG, 1
0D5C 7405                 1687             JE decimal5
0D5E B06D                 1688             MOV AL, 01101101b
0D60 EB6F90               1689             JMP endfunc
0D63                      1690     decimal5:
0D63 B0ED                 1691             MOV AL, 11101101b
0D65 EB6A90               1692             JMP endfunc
                          1693             
0D68                      1694             six:
0D68 3C06                 1695             CMP AL,6
0D6A 7511                 1696             JNE seven
0D6C 833EA60001           1697             CMP DS:DECIMAL_FLAG, 1
0D71 7405                 1698             JE decimal6
0D73 B07D                 1699             MOV AL, 01111101b
0D75 EB5A90               1700             JMP endfunc
0D78                      1701     decimal6:
0D78 B0FD                 1702             MOV AL, 11111101b
0D7A EB5590               1703             JMP endfunc
                          1704             
0D7D                      1705             seven:
0D7D 3C07                 1706             CMP AL,7
0D7F 7511                 1707             JNE eight
0D81 833EA60001           1708             CMP DS:DECIMAL_FLAG, 1
0D86 7405                 1709             JE decimal7
0D88 B007                 1710             MOV AL, 00000111b
0D8A EB4590               1711             JMP endfunc
0D8D                      1712     decimal7:
0D8D B087                 1713             MOV AL, 10000111b
0D8F EB4090               1714             JMP endfunc
                          1715             
0D92                      1716             eight:
0D92 3C08                 1717             CMP AL,8
0D94 7511                 1718             JNE nine
0D96 833EA60001           1719             CMP DS:DECIMAL_FLAG, 1
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:50:24  12/06/;3  PAGE   33


LOC  OBJ                  LINE     SOURCE

0D9B 7405                 1720             JE decimal8
0D9D B07F                 1721             MOV AL, 01111111b
0D9F EB3090               1722             JMP endfunc
0DA2                      1723     decimal8:
0DA2 B0FF                 1724             MOV AL, 11111111b
0DA4 EB2B90               1725             JMP endfunc
                          1726             
0DA7                      1727             nine:
0DA7 3C09                 1728             CMP AL,9
0DA9 7511                 1729             JNE hifn
0DAB 833EA60001           1730             CMP DS:DECIMAL_FLAG, 1
0DB0 7405                 1731             JE decimal9
0DB2 B06F                 1732             MOV AL, 01101111b
0DB4 EB1B90               1733             JMP endfunc
0DB7                      1734     decimal9:
0DB7 B0EF                 1735             MOV AL, 11101111b
0DB9 EB1690               1736             JMP endfunc
                          1737             
0DBC                      1738             hifn:
0DBC 3C2D                 1739             CMP AL,'-'
0DBE 7511                 1740             JNE endfunc
0DC0 833EA60001           1741             CMP DS:DECIMAL_FLAG, 1
0DC5 7405                 1742             JE decimal10
0DC7 B040                 1743             MOV AL, 01000000b
0DC9 EB0690               1744             JMP endfunc
0DCC                      1745     decimal10:
0DCC B0C0                 1746             MOV AL, 11000000b
0DCE EB0190               1747             JMP endfunc
                          1748             
0DD1                      1749             endfunc:
0DD1 5A                   1750             POP DX
0DD2 59                   1751             POP CX
0DD3 5B                   1752             POP BX
                          1753     
0DD4 CB                   1754     RET
                          1755     BCD_TO_7SEG ENDP
                          1756     
----                      1757     CODE_SEG        ENDS
                          1758     END

ASSEMBLY COMPLETE, NO ERRORS FOUND
