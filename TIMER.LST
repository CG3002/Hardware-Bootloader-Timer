8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    01:26:24  12/05/;3  PAGE    1


DOS 5.0 (038-N) 8086/87/88/186 MACRO ASSEMBLER V3.1 ASSEMBLY OF MODULE TIMER
OBJECT MODULE PLACED IN TIMER.OBJ
ASSEMBLER INVOKED BY:  D:\ASM86.EXE TIMER.ASM


LOC  OBJ                  LINE     SOURCE

                             1 +1  $MOD186
                             2 +1  $EP
                             3     NAME TIMER
                             4     ; Main program for uPD70208 microcomputer system
                             5     ;
                             6     ; Author:       Dr Tay Teng Tiow
                             7     ; Address:      Department of Electrical Engineering 
                             8     ;               National University of Singapore
                             9     ;               10, Kent Ridge Crescent
                            10     ;               Singapore 0511. 
                            11     ; Date:         6th September 1991
                            12     ;
                            13     ; This file contains proprietory information and cannot be copied 
                            14     ; or distributed without prior permission from the author.
                            15     ; =========================================================================
                            16     
                            17     public  serial_rec_action, timer2_action
                            18     extrn   print_char:far, print_2hex:far, iodefine:far
                            19     extrn   set_timer2:far
                            20     
                            21     ;IO Setup for 80C188 
  FFA0                      22             UMCR    EQU    0FFA0H ; Upper Memory Control Register
  FFA2                      23             LMCR    EQU    0FFA2H ; Lower Memory control Register         
  FFA4                      24             PCSBA   EQU    0FFA4H ; Peripheral Chip Select Base Address
  FFA8                      25             MPCS    EQU    0FFA8H ; MMCS and PCS Alter Control Register
  0080                      26             A_8255  EQU    0080H
  0081                      27             B_8255  EQU    0081H
  0082                      28             C_8255  EQU    0082H
  0083                      29             CWR_8255  EQU    0083H
  FF38                      30             INT0CON  EQU   0FF38H
  FF22                      31             EOI EQU 0FF22H
  FF28                      32             IMASK EQU 0FF28H
  FFA6                      33             MMCS    EQU    0FFA6H 
  4000                      34             DAC EQU 4000H
                            35     
                            36     
----                        37     STACK_SEG       SEGMENT
0000 (512                   38                     DB      512 DUP(?)
     ??
     )
0200                        39             TOS     LABEL   WORD
----                        40     STACK_SEG       ENDS
                            41     
                            42     
----                        43     DATA_SEG        SEGMENT
0000 0A                     44             TIMER0_MESS             DB      10,13,'TIMER2 INTERRUPT    '
0001 0D
0002 54494D45523220
     494E5445525255
     505420202020
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    01:26:24  12/05/;3  PAGE    2


LOC  OBJ                  LINE     SOURCE

0016 18                     45             T_COUNT                 DB      24
0017 18                     46             T_COUNT_SET             DB      24
0018 0A                     47             REC_MESS                DB      10,13,'Period of timer0 =     '
0019 0D
001A 506572696F6420
     6F662074696D65
     7230203D202020
     2020
0031 (32                    48             MESSAGE         DB  32 dup('h')
     68
     )
0051 00                     49             KEYPAD_INPUT    DB  0,0,0,0,0,0,0,0
0052 00
0053 00
0054 00
0055 00
0056 00
0057 00
0058 00
0059 2D                     50             BCD_MESSAGE     DB  '-','-','-','-','-','-'
005A 2D
005B 2D
005C 2D
005D 2D
005E 2D
005F FE                     51             ENABLE_BYTE     DB  11111110b
0060 00                     52             BCD_INDEX       DB  0
0061 0000                   53             KEYPAD_INDEX    DW      0
0063 20                     54             M_SIZE                  DB  32
0064 0040                   55             DAC_BASE        DW  4000H
0066 (15                    56             DAC_ADDR        DB  15 dup(0) 
     00
     )
0075 00                     57             DAC_LEN         DB  0
0076 0000                   58             SI_PTR          DW  0
0078 ??                     59             CHAR                    DB  ?
0079 ??                     60             REG_AL                  DB  ?
007A ??                     61             REG_BH                  DB  ?
007B ??                     62             REG_CL                  DB  ?
007C 00                     63             FLAG            DB  0
007D 00                     64             LONG_PRESS_FLAG DB      0
007E 7231                   65             MY_ID                   DB      'r1'
0080 00                     66             ID_FLAG_@               DB      0
0081 00                     67             ID_FLAG_r               DB      0
0082 4072312F               68             REPLY_MESSAGE   DB      '@r1/'
0086 40302F                 69             FAIL_MESSAGE    DB '@0/'
0089 04                     70             REPLY_COUNT             DB      4
008A 03                     71             FAIL_COUNT              DB      3
008B 00                     72             REPLY_FLAG              DB      0
008C 00                     73             SEND_FLAG       DB  0
008D (13                    74             SEND_BUFFER     DB  13 dup(0)
     00
     )
009A 0000                   75             SEND_BUFFER_LEN DW      0
009C 0000                   76             MAX_INPUT_SIZE  DW      0
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    01:26:24  12/05/;3  PAGE    3


LOC  OBJ                  LINE     SOURCE

009E 0000                   77             QTY_FLAG                DW      0
00A0 0000                   78             RECEIVE_FLAG    DW      0
00A2 0000                   79             DAC_FLAG                DW      0
00A4 0000                   80             PRICE_FLAG      DW      0
00A6 0100                   81             DECIMAL_FLAG    DW      1
00A8 0000                   82             SCROLL_LEN      DW      0
00AA 0000                   83             DAC_DISABLE     DW  0
00AC 0300                   84             DECIMAL_INDEX   DW  3
00AE 0100                   85             LANG_FLAG       DW  1
00B0 0000                   86             PRICE                   DW      0
00B2 0000                   87             QTY                             DW      0
00B4 0000                   88             TOTAL_PRICE_U   DW      0
00B6 0000                   89             TOTAL_PRICE_L   DW      0
00B8 0000                   90             TOTAL_PRICE_DEC DW      0
00BA (8                     91             TEMP_BCD_ARR    DB  8 dup(0)
     00
     )
00C2 0000                   92             THOUSAND_FLAG   DW  0
00C4 0000                   93             CENT_FLAG               DW      0
00C6 0000                   94             CASH_FLAG               DW      0
00C8 (8                     95             CASH_AMT        DB  8 dup(0)
     00
     )
00D0 (8                     96             TEMP_CASH_ARR   DW  8 dup(0)
     0000
     )
00E0 0000                   97             CASH_OK_FLAG    DW  0
00E2 0000                   98             BORROW_POSITION    DW  0
----                        99     DATA_SEG        ENDS
                           100     
                           101     
----                       102     CODE_SEG        SEGMENT
                           103     
                           104             PUBLIC          START
                           105     
                           106     ASSUME  CS:CODE_SEG, SS:STACK_SEG
                           107     
0000                       108     START:
                           109     ;initialize stack area
0000 B8----         R      110                     MOV     AX,STACK_SEG            
0003 8ED0                  111                     MOV     SS,AX
0005 368B260002            112                     MOV     SP,TOS
                           113                     
                           114     ; Initialize the on-chip pheripherals
000A 9A0000----     E      115                     CALL    FAR PTR IODEFINE
                           116                     
000F 9A0000----     E      117     call set_timer2
0014 FB                    118                    STI
                           119     
                           120     ; ^^^^^^^^^^^^^^^^^  Start of User Main Routine  ^^^^^^^^^^^^^^^^^^
                           121     
                           122     ;Initialize MMCS
                           123             
0015 BAA6FF                124             MOV DX, MMCS
0018 B80340                125             MOV AX, 4003H
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    01:26:24  12/05/;3  PAGE    4


LOC  OBJ                  LINE     SOURCE

001B EF                    126             OUT DX, AX
                           127     
                           128     ; Initialize MPCS to MAP peripheral to IO address
                           129             
001C BAA8FF                130             MOV DX, MPCS
001F B88320                131             MOV AX, 2083H
0022 EF                    132             OUT DX, AX
                           133        
                           134     ; PCSBA initial, set the parallel port start from 00H
0023 BAA4FF                135             MOV DX, PCSBA
0026 B80300                136             MOV AX, 0003H ; Peripheral starting address 00H no READY, No Waits
0029 EF                    137             OUT DX, AX
                           138     
                           139     ; Initialize LMCS 
002A BAA2FF                140         MOV DX, LMCR
002D B8C401                141         MOV AX, 01C4H  ; Starting address 1FFFH, 8K, No waits, last shoud be 5H for 1 wai
                                   ts      
0030 EF                    142         OUT DX, AX
                           143             
0031 B8----         R      144             MOV AX, DATA_SEG
0034 8ED8                  145             MOV DS, AX
                           146                              
0036 BA8300                147             MOV DX, CWR_8255
0039 B88200                148             MOV AX, 0082h
003C EF                    149             OUT DX, AX
                           150             
003D                       151     NEXT:
003D 9A4400----     R      152             CALL FAR PTR KEYPAD_LOOP
                           153             
0042 EBF9                  154     JMP NEXT
                           155     
0044                       156     KEYPAD_LOOP PROC FAR
0044 50                    157     PUSH AX
0045 53                    158     PUSH BX
0046 51                    159     PUSH CX
0047 52                    160     PUSH DX
                           161             
0048 9AC204----     R      162                             CALL FAR PTR DEBOUNCE           
                           163                             
004D C606790003            164     WAIT_1:         MOV DS:REG_AL, 03H
0052 BB0000                165                         MOV BX, 0000H
0055 BA8200                166                         MOV DX,C_8255
0058 8AC3                  167                         MOV AL,BL
005A EE                    168                         OUT DX,AL
                           169                        
005B BA8100                170                         MOV DX,B_8255
005E EC                    171                         IN AL,DX
005F 8AD8                  172                         MOV BL,AL  
0061 80E3FC                173                         AND BL,0FCH
0064 80FBFC                174                         CMP BL,0FCH
                           175                      
0067 7449                  176                     JE LONG_PRESS
                           177                             
0069 B3FE                  178                         MOV BL, 0FEH
006B C6067A0004            179                         MOV DS:REG_BH, 04H
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    01:26:24  12/05/;3  PAGE    5


LOC  OBJ                  LINE     SOURCE

                           180                        
0070                       181     NXTROW: 
0070 C0C307                182                     ROL BL,07H
0073 8AEB                  183                             MOV CH,BL
0075 BA8200                184                             MOV DX,C_8255
0078 8AC3                  185                             MOV AL,BL
007A EE                    186                             OUT DX,AL
                           187                             
007B BA8100                188                             MOV DX,B_8255
007E EC                    189                             IN AL,DX
007F 8AD8                  190                             MOV BL,AL
0081 80E3FC                191                             AND BL,0FCH
0084 C6067B0006            192                             MOV DS:REG_CL,06H
0089 C0DB02                193                             RCR BL,02H
008C D0DB                  194     NXTCOL:         RCR BL,01H
008E 732A                  195                             JNC CODEKY
0090 FE0E7900              196                             DEC DS:REG_AL
0094 FE0E7B00              197                             DEC DS:REG_CL
0098 803E7B0003            198                             CMP DS:REG_CL,03H
009D 7453                  199                             JE KEYPAD3
                           200                             
009F 803E7B0000            201                             CMP DS:REG_CL, 0H
00A4 7449                  202                             JE SUBTRACT2
00A6 EBE4                  203                             JMP NXTCOL
                           204                             
00A8 8ADD                  205                             MOV BL,CH
00AA FE0E7A00              206                             DEC DS:REG_BH
00AE 75C0                  207                             JNZ NXTROW
00B0 EB9B                  208                             JMP WAIT_1
                           209                             
00B2                       210     LONG_PRESS:
00B2 C6067D0000            211                             MOV DS:LONG_PRESS_FLAG, 0
00B7 EB3C90                212                             JMP RETURN2
00BA                       213     CODEKY:
00BA 803E79000B            214                         CMP DS:REG_AL, 11
00BF 7505                  215                             JNE bcd_upd
00C1 C606790000            216                             MOV DS:REG_AL, 0
                           217                             
00C6                       218     bcd_upd:
00C6 803E7D0000            219                             CMP DS:LONG_PRESS_FLAG, 0
00CB 7528                  220                             JNE RETURN2
                           221                             
00CD 803E790014            222                             CMP DS:REG_AL, 20
00D2 7524                  223                             JNE SEND_CASH
00D4 833EC60000            224                             CMP DS:CASH_FLAG, 0
00D9 7411                  225                             JE SKIP_CASH
00DB 9A1104----     R      226                             CALL FAR PTR BCD_CLEAR
00E0 C7069C000800          227                             MOV DS:MAX_INPUT_SIZE, 8
00E6 C706AC000600          228                             MOV DS:DECIMAL_INDEX, 6
00EC                       229                     SKIP_CASH:
00EC E96801                230                             JMP UPDATE_7SEG2
                           231                             
00EF E90502                232     SUBTRACT2:   JMP SUBTRACT
                           233     
00F2 E9F201                234     KEYPAD3:        JMP KEYPAD_2
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    01:26:24  12/05/;3  PAGE    6


LOC  OBJ                  LINE     SOURCE

                           235     
00F5 E90D02                236     RETURN2:    JMP RETURN
                           237                             
00F8                       238     SEND_CASH:
00F8 803E790017            239                             CMP DS:REG_AL, 23
00FD 7516                  240                             JNE CLEAR_BUTTON
00FF 833EC60000            241                             CMP DS:CASH_FLAG, 0
0104 740C                  242                             JE SKIP_SEND_CASH
0106 833E610000            243                             CMP DS:KEYPAD_INDEX, 0
010B 7405                  244                             JE SKIP_SEND_CASH
010D 9AE704----     R      245                             CALL FAR PTR TAKE_CASH
0112                       246                     SKIP_SEND_CASH:
0112 E94201                247                             JMP UPDATE_7SEG2
                           248                             
0115                       249     CLEAR_BUTTON:
0115 803E79000A            250                             CMP DS:REG_AL, 10
011A 7508                  251                             JNE BACKSPACE
011C 9A1104----     R      252                             CALL FAR PTR BCD_CLEAR
0121 E93301                253                             JMP UPDATE_7SEG2
                           254                             
0124 803E79000C            255     BACKSPACE:      CMP DS:REG_AL, 12
0129 7508                  256                             JNE ENTER_DATA
012B 9AA203----     R      257                             CALL FAR PTR BCD_BACKSPACE
0130 E92401                258                             JMP UPDATE_7SEG2
                           259     
0133 803E79000D            260     ENTER_DATA:     CMP DS:REG_AL, 13
0138 7520                  261                             JNE END_TRANS
013A 9A1104----     R      262                             CALL FAR PTR BCD_CLEAR
013F C706AC000600          263                             MOV DS:DECIMAL_INDEX, 6
0145 C7069C000800          264                             MOV DS:MAX_INPUT_SIZE, 8
014B C706AE000000          265                             MOV DS:LANG_FLAG, 0
0151 C706C6000000          266                             MOV DS:CASH_FLAG, 0
0157 E9FD00                267                             JMP UPDATE_7SEG2
                           268                             
015A 803E790010            269     END_TRANS:      CMP DS:REG_AL, 16
015F 7534                  270                             JNE CANCEL_TRANS
0161 BB0000                271                             MOV BX, 0
0164 C6878D0024            272                             MOV DS:SEND_BUFFER[BX], '$'
0169 43                    273                             INC BX
016A C6878D002F            274                             MOV DS:SEND_BUFFER[BX], '/'
016F C7069A000200          275                             MOV DS:SEND_BUFFER_LEN, 2
0175 C6068C0001            276                             MOV DS:SEND_FLAG, 1
017A C706B8000000          277                             MOV DS:TOTAL_PRICE_DEC, 0
0180 C706B6000000          278                             MOV DS:TOTAL_PRICE_L, 0
0186 C706B4000000          279                             MOV DS:TOTAL_PRICE_U, 0
018C C706C6000100          280                             MOV DS:CASH_FLAG, 1
0192 E9C200                281                             JMP UPDATE_7SEG2
                           282                             
0195                       283     CANCEL_TRANS:   
0195 803E79000F            284                             CMP DS:REG_AL, 15
019A 752E                  285                             JNE SCROLL_LEFT
019C BB0000                286                             MOV BX, 0
019F C6878D003F            287                             MOV DS:SEND_BUFFER[BX], '?'
01A4 43                    288                             INC BX
01A5 C6878D002F            289                             MOV DS:SEND_BUFFER[BX], '/'
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    01:26:24  12/05/;3  PAGE    7


LOC  OBJ                  LINE     SOURCE

01AA C7069A000200          290                             MOV DS:SEND_BUFFER_LEN, 2
01B0 C6068C0001            291                             MOV DS:SEND_FLAG, 1
01B5 C706B8000000          292                             MOV DS:TOTAL_PRICE_DEC, 0
01BB C706B6000000          293                             MOV DS:TOTAL_PRICE_L, 0
01C1 C706B4000000          294                             MOV DS:TOTAL_PRICE_U, 0
01C7 E98D00                295                             JMP UPDATE_7SEG2
                           296                             
01CA                       297     SCROLL_LEFT:
01CA 803E790015            298                             CMP DS:REG_AL, 21
01CF 753D                  299                             JNE SCROLL_RIGHT
01D1 833E610006            300                             CMP DS:KEYPAD_INDEX, 6
01D6 7E7F                  301                             JLE UPDATE_7SEG2
01D8 833EA80000            302                             CMP DS:SCROLL_LEN, 0
01DD 7478                  303                             JE UPDATE_7SEG2
01DF FF0EA800              304                             DEC DS:SCROLL_LEN
01E3 FF0EAC00              305                             DEC DS:DECIMAL_INDEX
01E7 FF0E6100              306                             DEC DS:KEYPAD_INDEX
01EB 8B1E6100              307                             MOV BX, DS:KEYPAD_INDEX
01EF 8A4751                308                             MOV AL, DS:KEYPAD_INPUT[BX]
01F2 A27900                309                             MOV DS:REG_AL, AL
01F5 C706AA000100          310                             MOV DS:DAC_DISABLE, 1
01FB 9A3C04----     R      311                             CALL FAR PTR BCD_UPDATE
0200 C706AA000000          312                             MOV DS:DAC_DISABLE, 0
0206 C606790015            313                             MOV DS:REG_AL, 21
020B EB4A90                314                             JMP UPDATE_7SEG2
                           315     
020E                       316     SCROLL_RIGHT:
020E 803E790013            317                             CMP DS:REG_AL, 19
0213 7545                  318                             JNE LANG_TOGGLE
0215 833E610006            319                             CMP DS:KEYPAD_INDEX, 6
021A 7E3B                  320                             JLE UPDATE_7SEG2
021C A16100                321                             MOV AX, DS:KEYPAD_INDEX
021F 2D0600                322                             SUB AX, 6
0222 3906A800              323                             CMP DS:SCROLL_LEN, AX
0226 742F                  324                             JE UPDATE_7SEG2
0228 FF06A800              325                             INC DS:SCROLL_LEN
022C FF06AC00              326                             INC DS:DECIMAL_INDEX
0230 FF0E6100              327                             DEC DS:KEYPAD_INDEX
0234 8B1E6100              328                             MOV BX, DS:KEYPAD_INDEX
0238 8A4751                329                             MOV AL, DS:KEYPAD_INPUT[BX]
023B A27900                330                             MOV DS:REG_AL, AL
023E C706AA000100          331                             MOV DS:DAC_DISABLE, 1
0244 9A3C04----     R      332                             CALL FAR PTR BCD_UPDATE
0249 C706AA000000          333                             MOV DS:DAC_DISABLE, 0
024F C606790013            334                             MOV DS:REG_AL, 19
0254 EB0190                335                             JMP UPDATE_7SEG2
                           336                             
0257 EB7A90                337     UPDATE_7SEG2: JMP UPDATE_7SEG
                           338     
025A                       339     LANG_TOGGLE:
025A 803E790012            340                             CMP DS:REG_AL, 18
025F 751E                  341                             JNE QTY_PROMPT
0261 833EAE0001            342                             CMP DS:LANG_FLAG, 1
0266 75EF                  343                             JNE UPDATE_7SEG2
0268 A16400                344                             MOV AX, DS:DAC_BASE
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    01:26:24  12/05/;3  PAGE    8


LOC  OBJ                  LINE     SOURCE

026B 3D0040                345                             CMP AX, 4000H
026E 7406                  346                             JE MANDRIN
0270 B80040                347                             MOV AX, 4000H
0273 EB0490                348                             JMP SEND_TOGGLE
0276                       349             MANDRIN:
0276 B80063                350                             MOV AX, 6300H
0279                       351             SEND_TOGGLE:
0279 A36400                352                             MOV DS:DAC_BASE, AX
027C EB5590                353                             JMP UPDATE_7SEG
027F                       354     QTY_PROMPT:
027F 803E790016            355                             CMP DS:REG_AL, 22
0284 7520                  356                             JNE QUANTITY
0286 833E610008            357                             CMP DS:KEYPAD_INDEX, 8
028B 7519                  358                             JNE  QUANTITY
                           359                             ; CMP DS:MAX_INPUT_SIZE, 8
                           360                             ; JNE QUANTITY
028D 9A5B03----     R      361                             CALL FAR PTR UPDATE_SEND_BUFFER
0292 9A1104----     R      362                             CALL FAR PTR BCD_CLEAR
0297 C7069C000200          363                             MOV DS:MAX_INPUT_SIZE, 2
029D C7069E000100          364                             MOV DS:QTY_FLAG, 1
02A3 EB2E90                365                             JMP UPDATE_7SEG
                           366                     
02A6                       367     QUANTITY:
02A6 833E610000            368                             CMP DS:KEYPAD_INDEX, 0
02AB 7426                  369                             JE  UPDATE_7SEG
                           370                             
02AD 803E79000E            371                             CMP DS:REG_AL, 14
02B2 751F                  372                             JNE UPDATE_7SEG
                           373                             
02B4 833E9E0001            374                             CMP DS:QTY_FLAG, 1
02B9 7518                  375                             JNE UPDATE_7SEG
                           376                             
02BB 9A0A03----     R      377                             CALL FAR PTR UPDATE_THE_QUANTITY
                           378                                             
02C0 C6068C0001            379                             MOV DS:SEND_FLAG, 1
                           380                             
02C5 C7069E000000          381                             MOV DS:QTY_FLAG, 0
02CB 9A1104----     R      382                             CALL FAR PTR BCD_CLEAR
02D0 EB0190                383                             JMP UPDATE_7SEG
                           384                             
                           385     
02D3                       386     UPDATE_7SEG:
02D3 803E790009            387                             CMP DS:REG_AL, 9
02D8 7F05                  388                             JG SET_PRESS_FLAG
                           389                             
02DA 9A3C04----     R      390                             CALL FAR PTR BCD_UPDATE
                           391                             
02DF                       392     SET_PRESS_FLAG:
02DF C6067D0001            393                             MOV DS:LONG_PRESS_FLAG, 1
02E4 EB1F90                394                             JMP RETURN
                           395             
02E7                       396     KEYPAD_2: 
02E7 800679000F            397                 ADD DS:REG_AL,0FH
02EC E99DFD                398                             JMP NXTCOL
02EF C606790000            399     ZERO_PRINT: MOV DS:REG_AL,00H
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    01:26:24  12/05/;3  PAGE    9


LOC  OBJ                  LINE     SOURCE

02F4 E995FD                400                             JMP NXTCOL
02F7 802E790006            401     SUBTRACT:   SUB DS:REG_AL,06H
02FC 8ADD                  402                             MOV BL,CH
02FE FE0E7A00              403                             DEC DS:REG_BH
0302 E96BFD                404                             JMP NXTROW
                           405             
                           406             
0305                       407     RETURN:
0305 5A                    408                             POP DX
0306 59                    409                             POP CX
0307 5B                    410                             POP BX
0308 58                    411                             POP AX
0309 CB                    412                             RET
                           413     
                           414     KEYPAD_LOOP ENDP
                           415     
030A                       416     UPDATE_THE_QUANTITY PROC FAR
030A 50                    417     PUSH AX
030B 53                    418     PUSH BX
030C 51                    419     PUSH CX
030D 52                    420     PUSH DX
030E 8B0E6100              421             MOV CX, DS:KEYPAD_INDEX
0312 BB0000                422             MOV BX, 0
0315 BA0000                423             MOV DX, 0
0318                       424             UPD_QTY:
0318 A1B200                425                     MOV AX, DS:QTY
031B 53                    426                     PUSH BX
031C BB0A00                427                     MOV BX, 10
031F F7E3                  428                     MUL BX
0321 5B                    429                     POP BX
0322 8A5751                430                     MOV DL, DS:KEYPAD_INPUT[BX]
0325 03C2                  431                     ADD AX, DX
0327 A3B200                432                     MOV DS:QTY, AX
032A 43                    433                     INC BX
032B E2EB                  434             LOOP UPD_QTY
                           435             
032D 8B0E6100              436             MOV CX, DS:KEYPAD_INDEX
0331 8B1E9A00              437             MOV BX, DS:SEND_BUFFER_LEN
                           438             
0335                       439             UPD_BUFFER:
0335 53                    440                     PUSH BX
0336 8B1E6100              441                     MOV BX, DS:KEYPAD_INDEX
033A 2BD9                  442                     SUB BX, CX
033C 8A4751                443                     MOV AL, DS:KEYPAD_INPUT[BX]
033F 5B                    444                     POP BX
0340 0430                  445                     ADD AL, 30H
0342 88878D00              446                     MOV DS:SEND_BUFFER[BX], AL
                           447                     
0346 43                    448                     INC BX
0347 FF069A00              449                     INC DS:SEND_BUFFER_LEN
034B E2E8                  450             LOOP UPD_BUFFER
                           451             
034D C6878D002F            452             MOV DS:SEND_BUFFER[BX], '/'
0352 FF069A00              453             INC DS:SEND_BUFFER_LEN
                           454                     
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    01:26:24  12/05/;3  PAGE   10


LOC  OBJ                  LINE     SOURCE

0356 5A                    455     POP DX
0357 59                    456     POP CX
0358 5B                    457     POP BX
0359 58                    458     POP AX
                           459     
035A CB                    460     RET
                           461     UPDATE_THE_QUANTITY ENDP
                           462     
035B                       463     UPDATE_SEND_BUFFER PROC FAR
035B 50                    464     PUSH AX
035C 53                    465     PUSH BX
035D 51                    466     PUSH CX
035E 52                    467     PUSH DX
                           468     
035F 8B0E6100              469             MOV CX, DS:KEYPAD_INDEX
0363 83F900                470             CMP CX, 0
0366 7435                  471             JE END_UPD_BUFFER
0368 83C102                472             ADD CX, 2
036B 890E9A00              473             MOV DS:SEND_BUFFER_LEN, CX
036F BB0000                474             MOV BX, 0
0372                       475             BUFFER_LOOP:
0372 83FB00                476                     CMP BX, 0
0375 7508                  477                     JNE ASTERISK
0377 C6878D007E            478                     MOV DS:SEND_BUFFER[BX], '~'
037C EB1C90                479                     JMP END_BUFFER
037F                       480             ASTERISK:
037F A16100                481                     MOV AX, DS:KEYPAD_INDEX
0382 40                    482                     INC AX
0383 3BD8                  483                     CMP BX, AX
0385 7508                  484                     JNE CONT
0387 C6878D002A            485                     MOV DS:SEND_BUFFER[BX], '*'
038C EB0C90                486                     JMP END_BUFFER
038F                       487             CONT:
038F 4B                    488                     DEC BX
0390 8A4751                489                     MOV AL, DS:KEYPAD_INPUT[BX]
0393 0430                  490                     ADD AL, 30H
0395 43                    491                     INC BX
0396 88878D00              492                     MOV DS:SEND_BUFFER[BX], AL
                           493                     
039A                       494             END_BUFFER:
039A 43                    495                     INC BX
039B E2D5                  496             LOOP BUFFER_LOOP
039D                       497     END_UPD_BUFFER:
039D 5A                    498     POP DX
039E 59                    499     POP CX
039F 5B                    500     POP BX
03A0 58                    501     POP AX
03A1 CB                    502     RET
                           503     UPDATE_SEND_BUFFER ENDP
                           504     
03A2                       505     BCD_BACKSPACE PROC FAR
                           506     
03A2 50                    507     PUSH AX
03A3 53                    508     PUSH BX
03A4 51                    509     PUSH CX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    01:26:24  12/05/;3  PAGE   11


LOC  OBJ                  LINE     SOURCE

03A5 52                    510     PUSH DX
                           511     
03A6 8A167900              512             MOV DL, DS:REG_AL
03AA 833E610000            513             CMP DS:KEYPAD_INDEX, 0
03AF 7457                  514             JE RETURN_BACK
                           515             
03B1 BB0600                516             MOV BX, 6
03B4                       517             BCD_CLEAR_LOOP:
03B4 4B                    518                     DEC BX
03B5 C647592D              519                     MOV DS:BCD_MESSAGE[BX], '-'
03B9 43                    520                     INC BX
03BA 4B                    521                     DEC BX
03BB 75F7                  522             JNZ BCD_CLEAR_LOOP
                           523             
03BD 833E610001            524             CMP DS:KEYPAD_INDEX, 1
03C2 7E2C                  525             JLE less_than_two
                           526             
03C4 FF0E6100              527             DEC DS:KEYPAD_INDEX
03C8 FF0E6100              528             DEC DS:KEYPAD_INDEX
03CC 8B1E6100              529             MOV BX, DS:KEYPAD_INDEX
03D0 8A4751                530             MOV AL, DS:KEYPAD_INPUT[BX]
03D3 A27900                531             MOV DS:REG_AL, AL
03D6 C706A8000000          532             MOV DS:SCROLL_LEN, 0
03DC C706AA000100          533             MOV DS:DAC_DISABLE, 1
03E2 9A3C04----     R      534             CALL FAR PTR BCD_UPDATE
03E7 C706AA000000          535             MOV DS:DAC_DISABLE, 0
03ED EB1990                536             JMP RETURN_BACK
                           537             
03F0                       538     less_than_two:
03F0 FF0E6100              539             DEC DS:KEYPAD_INDEX
03F4 C60679002D            540             MOV DS:REG_AL, '-'
03F9 C706A8000000          541             MOV DS:SCROLL_LEN, 0
03FF 9A3C04----     R      542             CALL FAR PTR BCD_UPDATE
0404 FF0E6100              543             DEC DS:KEYPAD_INDEX
                           544             
0408                       545     RETURN_BACK:
0408 88167900              546             MOV DS:REG_AL, DL
040C 5A                    547     POP DX
040D 59                    548     POP CX
040E 5B                    549     POP BX
040F 58                    550     POP AX
                           551     
0410 CB                    552     RET
                           553     BCD_BACKSPACE ENDP
                           554     
0411                       555     BCD_CLEAR PROC FAR
0411 50                    556     PUSH AX
0412 53                    557     PUSH BX
0413 51                    558     PUSH CX
0414 52                    559     PUSH DX
0415 BB0800                560             MOV BX, 8
0418                       561             CLEAR_LOOP:
0418 C6475100              562             MOV DS:KEYPAD_INPUT[BX], 0
041C 4B                    563             DEC BX
041D 75F9                  564             JNZ CLEAR_LOOP
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    01:26:24  12/05/;3  PAGE   12


LOC  OBJ                  LINE     SOURCE

                           565             
041F BB0600                566             MOV BX, 6
0422                       567             CLEAR_LOOP2:
0422 4B                    568                     DEC BX
0423 C647592D              569                     MOV DS:BCD_MESSAGE[BX], '-'
0427 43                    570                     INC BX
0428 4B                    571                     DEC BX
0429 75F7                  572             JNZ CLEAR_LOOP2
                           573     
042B C70661000000          574             MOV DS:KEYPAD_INDEX, 0
0431 C706A8000000          575             MOV DS:SCROLL_LEN, 0
0437 5A                    576     POP DX
0438 59                    577     POP CX
0439 5B                    578     POP BX
043A 58                    579     POP AX
043B CB                    580     RET
                           581     BCD_CLEAR ENDP
                           582     
043C                       583     BCD_UPDATE PROC FAR
043C 50                    584     PUSH AX
043D 53                    585     PUSH BX
043E 51                    586     PUSH CX
043F 52                    587     PUSH DX
0440 A19C00                588                     MOV AX, DS:MAX_INPUT_SIZE
0443 39066100              589                     CMP DS:KEYPAD_INDEX, AX
0447 7D5A                  590                     JGE BCD_RET
                           591                     
0449 8A0E7900              592                     MOV CL, DS:REG_AL
044D 80F909                593                     CMP CL, 9
0450 7F0C                  594                     JG SKIP_PAST
0452 833EAA0001            595                     CMP DS:DAC_DISABLE, 1
0457 7405                  596                     JE SKIP_PAST
0459 9AA804----     R      597                     CALL FAR PTR DAC_UPDATE
                           598     
045E                       599     SKIP_PAST:              
045E 8A0E7900              600                     MOV CL, DS:REG_AL
                           601     
0462 8B1E6100              602                     MOV BX, DS:KEYPAD_INDEX
                           603                             
0466 884F51                604                     MOV DS:KEYPAD_INPUT[BX], CL
                           605                             
0469 FF066100              606                     INC DS:KEYPAD_INDEX
                           607                             
046D 8B1E6100              608                     MOV BX, DS:KEYPAD_INDEX
                           609                     
0471 A1A800                610                     MOV AX, DS:SCROLL_LEN
0474 2BD8                  611                     SUB BX, AX
                           612                     
0476 8B166100              613                     MOV DX, DS:KEYPAD_INDEX
047A 83FA06                614                     CMP DX, 6
047D 7E03                  615                     JLE update_display
047F BA0600                616                     MOV DX, 6
                           617                     
0482                       618             update_display:
                           619             
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    01:26:24  12/05/;3  PAGE   13


LOC  OBJ                  LINE     SOURCE

0482 B90500                620                     MOV CX, 5
0485 4B                    621                     DEC BX
0486 8A4751                622                     MOV AL, DS:KEYPAD_INPUT[BX]
0489 43                    623                     INC BX
                           624                             
048A 52                    625                     PUSH DX
048B 8B166100              626                     MOV DX, DS:KEYPAD_INDEX
048F 2B16A800              627                     SUB DX, DS:SCROLL_LEN
                           628                     
0493 2BD3                  629                     SUB DX, BX
                           630                             
0495 53                    631                     PUSH BX
                           632                             
0496 2BCA                  633                     SUB CX, DX
0498 8BD9                  634                     MOV BX, CX
049A 884759                635                     MOV DS:BCD_MESSAGE[BX], AL
                           636                             
049D 5B                    637                     POP BX
049E 5A                    638                     POP DX
                           639             
049F 4B                    640                     DEC BX
04A0 4A                    641                     DEC DX
04A1 75DF                  642             JNZ update_display
                           643     
04A3                       644             BCD_RET:
04A3 5A                    645                     POP DX
04A4 59                    646                     POP CX
04A5 5B                    647                     POP BX
04A6 58                    648                     POP AX
04A7 CB                    649     RET
                           650     BCD_UPDATE ENDP
                           651     
04A8                       652     DAC_UPDATE PROC FAR
04A8 50                    653             PUSH AX
04A9 53                    654             PUSH BX
04AA 51                    655             PUSH CX
04AB 52                    656             PUSH DX
                           657             
04AC BB0000                658             MOV BX, 0
04AF 8A1E7500              659             MOV BL, DS:DAC_LEN
04B3 A07900                660             MOV AL, DS:REG_AL
                           661             
04B6 884766                662             MOV DS:DAC_ADDR[BX], AL
                           663             
04B9 FE067500              664             INC DS:DAC_LEN
                           665     
04BD 5A                    666             POP DX
04BE 59                    667             POP CX
04BF 5B                    668             POP BX
04C0 58                    669             POP AX
04C1 CB                    670     RET
                           671     DAC_UPDATE ENDP
                           672               
04C2                       673     DEBOUNCE PROC FAR
04C2 51                    674                       PUSH CX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    01:26:24  12/05/;3  PAGE   14


LOC  OBJ                  LINE     SOURCE

                           675                       
04C3 B94C09                676                       MOV CX, 094CH
04C6 90                    677     BACK:     NOP
04C7 E2FD                  678                       LOOP BACK
04C9 59                    679                       POP CX
04CA CB                    680                       RET
                           681     DEBOUNCE  ENDP
                           682     
04CB                       683     SEND_INPUT PROC FAR
04CB 50                    684     PUSH AX
04CC 53                    685     PUSH BX
04CD 51                    686     PUSH CX
04CE 52                    687     PUSH DX
04CF BB0000                688             MOV BX, 0
04D2 8B0E9A00              689             MOV CX, DS:SEND_BUFFER_LEN
                           690             
04D6                       691             S_BUFF:
04D6 8A878D00              692                     MOV AL, DS:SEND_BUFFER[BX]
04DA 9A0000----     E      693                     CALL FAR PTR PRINT_CHAR
04DF 43                    694                     INC BX
04E0 E2F4                  695             LOOP S_BUFF
                           696             
04E2                       697     SEND_INPUT_END:
04E2 5A                    698     POP DX
04E3 59                    699     POP CX
04E4 5B                    700     POP BX
04E5 58                    701     POP AX
04E6 CB                    702     RET
                           703     SEND_INPUT ENDP
                           704     
04E7                       705     TAKE_CASH PROC FAR
04E7 50                    706     PUSH AX
04E8 53                    707     PUSH BX
04E9 51                    708     PUSH CX
04EA 52                    709     PUSH DX
                           710             
04EB B90000                711             MOV CX, 0
04EE B108                  712             MOV CL, 8
04F0                       713             CLEAR_CASH_AMT:
04F0 8BD9                  714                     MOV BX, CX
04F2 4B                    715                     DEC BX
04F3 C687C80000            716                     MOV DS:CASH_AMT[BX], 0
04F8 E2F6                  717             LOOP CLEAR_CASH_AMT
                           718             
04FA 8B0E6100              719             MOV CX, DS:KEYPAD_INDEX
04FE BA0600                720             MOV DX, 6
                           721             
0501                       722             UPDATE_CASH_AMT:
0501 8BD9                  723                     MOV BX, CX
0503 4B                    724                     DEC BX
                           725                     
0504 33C0                  726                     XOR AX, AX
0506 8A4751                727                     MOV AL, DS:KEYPAD_INPUT[BX]
                           728                     
0509 8BDA                  729                     MOV BX, DX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    01:26:24  12/05/;3  PAGE   15


LOC  OBJ                  LINE     SOURCE

050B 4B                    730                     DEC BX
050C 8887C800              731                     MOV DS:CASH_AMT[BX], AL
                           732                     
0510 4A                    733                     DEC DX
0511 E2EE                  734             LOOP UPDATE_CASH_AMT
                           735             
0513 C706E0000100          736             MOV DS:CASH_OK_FLAG, 1
0519 C706E2000700          737             MOV DS:BORROW_POSITION, 7
051F B90800                738             MOV CX, 8
0522                       739             CHECK_CASH:
0522 BB0800                740                     MOV BX, 8
0525 2BD9                  741                     SUB BX, CX
0527 B80000                742                     MOV AX, 0
052A 8A87BA00              743                     MOV AL, DS:TEMP_BCD_ARR[BX]
052E 8A97C800              744                     MOV DL, DS:CASH_AMT[BX]
0532 3AD0                  745                     CMP DL, AL
0534 741A                  746                     JE NEXT_CASH_DIGIT
                           747                     
0536 3AD0                  748                     CMP DL, AL
0538 7C0D                  749                     JL CASH_NOT_OK
                           750                     
053A C706E0000100          751                     MOV DS:CASH_OK_FLAG, 1
0540 891EE200              752                     MOV DS:BORROW_POSITION, BX
                           753                     
0544 EB0C90                754                     JMP CHEK_CASH_DONE
                           755                     
0547                       756                     CASH_NOT_OK:
0547 C706E0000000          757                     MOV DS:CASH_OK_FLAG, 0
054D EB0390                758                     JMP CHEK_CASH_DONE
                           759                     
0550                       760             NEXT_CASH_DIGIT:
0550 E2D0                  761             LOOP CHECK_CASH
                           762             
0552                       763     CHEK_CASH_DONE:
                           764             
0552 833EE00001            765             CMP DS:CASH_OK_FLAG, 1
0557 7431                  766             JE CONTINUE_CASH
0559 B90800                767             MOV CX, 8
055C C70661000000          768             MOV DS:KEYPAD_INDEX, 0
0562 C706AC000300          769             MOV DS:DECIMAL_INDEX, 3
0568                       770             RETAIN_BCD:
0568 BB0800                771                     MOV BX, 8
056B 2BD9                  772                     SUB BX, CX
                           773                     
056D 8A87BA00              774                     MOV AL, DS:TEMP_BCD_ARR[BX]
0571 A27900                775                     MOV DS:REG_AL, AL
                           776                     
0574 C706AA000100          777                     MOV DS:DAC_DISABLE, 1
057A 9A3C04----     R      778                     CALL FAR PTR BCD_UPDATE
057F C706AA000000          779                     MOV DS:DAC_DISABLE, 0
0585 E2E1                  780             LOOP RETAIN_BCD
0587 E98F00                781             JMP CASH_OVER
                           782             
058A                       783     CONTINUE_CASH:
058A 8B1EE200              784             MOV BX, DS:BORROW_POSITION
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    01:26:24  12/05/;3  PAGE   16


LOC  OBJ                  LINE     SOURCE

058E B90700                785             MOV CX, 7
0591 2BCB                  786             SUB CX, BX
0593 83F900                787             CMP CX, 0
0596 740C                  788             JE BEGIN_SUB
                           789             
0598                       790             ADJUST_PLACES:
0598 FE8FC800              791                     DEC DS:CASH_AMT[BX]
059C 43                    792                     INC BX
059D 8087C8000A            793                     ADD DS:CASH_AMT[BX], 10
05A2 E2F4                  794             LOOP ADJUST_PLACES
                           795             
05A4                       796     BEGIN_SUB:
05A4 B90800                797             MOV CX, 8
05A7                       798             CALC_CHANGE:
05A7 BB0800                799                     MOV BX, 8
05AA 2BD9                  800                     SUB BX, CX
05AC B80000                801                     MOV AX, 0
05AF 8A87C800              802                     MOV AL, DS:CASH_AMT[BX]
05B3 BA0000                803                     MOV DX, 0
05B6 8A97BA00              804                     MOV DL, DS:TEMP_BCD_ARR[BX]
05BA 2BC2                  805                     SUB AX, DX
05BC 8987D000              806                     MOV DS:TEMP_CASH_ARR[BX], AX
05C0 E2E5                  807             LOOP CALC_CHANGE
                           808             
05C2 B90800                809             MOV CX, 8
05C5                       810             FIX_DIGITS:
05C5 8BD9                  811             MOV BX, CX
05C7 4B                    812             DEC BX
                           813             
05C8 8B87D000              814             MOV AX, DS:TEMP_CASH_ARR[BX]
05CC 3C0A                  815             CMP AL, 10
05CE 7C0A                  816             JL NEXT_DIGIT_TO_FIX
                           817             
05D0 83AFD0000A            818             SUB DS:TEMP_CASH_ARR[BX], 10
                           819             
05D5 4B                    820             DEC BX
05D6 FF87D000              821             INC DS:TEMP_CASH_ARR[BX]
                           822             
05DA                       823             NEXT_DIGIT_TO_FIX:
                           824             
05DA E2E9                  825             LOOP FIX_DIGITS
                           826             
05DC B90800                827             MOV CX, 8
05DF C70661000000          828             MOV DS:KEYPAD_INDEX, 0
05E5 C706AC000300          829             MOV DS:DECIMAL_INDEX, 3
05EB                       830             UPDATE_BCD_TO_CASH:
05EB BB0800                831                     MOV BX, 8
05EE 2BD9                  832                     SUB BX, CX
05F0 8B87D000              833                     MOV AX, DS:TEMP_CASH_ARR[BX]
05F4 8887BA00              834                     MOV DS:TEMP_BCD_ARR[BX], AL
05F8 A27900                835                     MOV DS:REG_AL, AL
05FB C706AA000100          836                     MOV DS:DAC_DISABLE, 1
0601 9A3C04----     R      837                     CALL FAR PTR BCD_UPDATE
0606 C706AA000000          838                     MOV DS:DAC_DISABLE, 0
060C E2DD                  839             LOOP UPDATE_BCD_TO_CASH
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    01:26:24  12/05/;3  PAGE   17


LOC  OBJ                  LINE     SOURCE

                           840             
060E 9A1E06----     R      841             CALL FAR PTR CALC_DAC
                           842             
0613 C706C6000000          843             MOV DS:CASH_FLAG, 0
                           844             
0619                       845     CASH_OVER:
0619 5A                    846     POP DX
061A 59                    847     POP CX
061B 5B                    848     POP BX
061C 58                    849     POP AX
                           850     
061D CB                    851     RET
                           852     TAKE_CASH ENDP
                           853     
061E                       854     CALC_DAC PROC FAR
061E 50                    855     PUSH AX
061F 53                    856     PUSH BX
0620 51                    857     PUSH CX
0621 52                    858     PUSH DX
0622 813E64000040          859             CMP DS:DAC_BASE, 4000H
0628 7403                  860             JE ENGLISH_DAC
062A E95101                861             JMP MANDARIN_DAC
                           862             
062D                       863     ENGLISH_DAC:
062D C706C4000000          864             MOV DS:CENT_FLAG, 0
0633 C706C2000000          865             MOV DS:THOUSAND_FLAG, 0
0639 BB0000                866             MOV BX, 0
063C 8A87BA00              867             MOV AL, DS:TEMP_BCD_ARR[BX]
0640 A27900                868             MOV DS:REG_AL, AL
0643 3C00                  869             CMP AL, 0
0645 740F                  870             JE NEXT_PLACE
0647 9AA804----     R      871             CALL FAR PTR DAC_UPDATE
064C C60679001C            872             MOV DS:REG_AL, 28
0651 9AA804----     R      873             CALL FAR PTR DAC_UPDATE
                           874             
0656                       875     NEXT_PLACE:     
0656 43                    876             INC BX
0657 8A87BA00              877             MOV AL, DS:TEMP_BCD_ARR[BX]
065B 3C01                  878             CMP AL, 1
065D 7518                  879             JNE NOT_1
065F 43                    880             INC BX
0660 8A87BA00              881             MOV AL, DS:TEMP_BCD_ARR[BX]
0664 040A                  882             ADD AL, 10
0666 A27900                883             MOV DS:REG_AL, AL
0669 9AA804----     R      884             CALL FAR PTR DAC_UPDATE
066E C706C2000100          885             MOV DS:THOUSAND_FLAG, 1
0674 EB2C90                886             JMP HUNDREDS_PLACE
0677                       887     NOT_1:
0677 3C00                  888             CMP AL, 0
0679 7410                  889             JE NEXT_PLACE_1
067B C706C2000100          890             MOV DS:THOUSAND_FLAG, 1
0681 0412                  891             ADD AL, 18
0683 A27900                892             MOV DS:REG_AL, AL
0686 9AA804----     R      893             CALL FAR PTR DAC_UPDATE
068B                       894     NEXT_PLACE_1:
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    01:26:24  12/05/;3  PAGE   18


LOC  OBJ                  LINE     SOURCE

068B 43                    895             INC BX
068C 8A87BA00              896             MOV AL, DS:TEMP_BCD_ARR[BX]
0690 3C00                  897             CMP AL, 0
0692 740E                  898             JE HUNDREDS_PLACE
0694 C706C2000100          899             MOV DS:THOUSAND_FLAG, 1
069A A27900                900             MOV DS:REG_AL, AL
069D 9AA804----     R      901             CALL FAR PTR DAC_UPDATE
                           902     
06A2                       903     HUNDREDS_PLACE:
06A2 833EC20000            904             CMP DS:THOUSAND_FLAG, 0
06A7 7410                  905             JE NEXT_PLACE_2
06A9 C60679001D            906             MOV DS:REG_AL, 29
06AE 9AA804----     R      907             CALL FAR PTR DAC_UPDATE
06B3 C706C2000000          908             MOV DS:THOUSAND_FLAG, 0
                           909             
06B9                       910     NEXT_PLACE_2:
06B9 43                    911             INC BX
06BA 8A87BA00              912             MOV AL, DS:TEMP_BCD_ARR[BX]
06BE 3C00                  913             CMP AL, 0
06C0 7412                  914             JE NEXT_PLACE_3
06C2 A27900                915             MOV DS:REG_AL, AL
06C5 9AA804----     R      916             CALL FAR PTR DAC_UPDATE
06CA C60679001C            917             MOV DS:REG_AL, 28
06CF 9AA804----     R      918             CALL FAR PTR DAC_UPDATE
                           919             
06D4                       920     NEXT_PLACE_3:   
06D4 43                    921             INC BX
06D5 8A87BA00              922             MOV AL, DS:TEMP_BCD_ARR[BX]
06D9 3C01                  923             CMP AL, 1
06DB 7512                  924             JNE NOT_1_2
06DD 43                    925             INC BX
06DE 8A87BA00              926             MOV AL, DS:TEMP_BCD_ARR[BX]
06E2 040A                  927             ADD AL, 10
06E4 A27900                928             MOV DS:REG_AL, AL
06E7 9AA804----     R      929             CALL FAR PTR DAC_UPDATE
06EC EB2090                930             JMP DECIMAL_DAC
06EF                       931     NOT_1_2:
06EF 3C00                  932             CMP AL, 0
06F1 740A                  933             JE NEXT_PLACE_4
06F3 0412                  934             ADD AL, 18
06F5 A27900                935             MOV DS:REG_AL, AL
06F8 9AA804----     R      936             CALL FAR PTR DAC_UPDATE
06FD                       937     NEXT_PLACE_4:
06FD 43                    938             INC BX
06FE 8A87BA00              939             MOV AL, DS:TEMP_BCD_ARR[BX]
0702 3C00                  940             CMP AL, 0
0704 7408                  941             JE DECIMAL_DAC
0706 A27900                942             MOV DS:REG_AL, AL
0709 9AA804----     R      943             CALL FAR PTR DAC_UPDATE
                           944             
070E                       945     DECIMAL_DAC:
070E C60679001E            946             MOV DS:REG_AL, 30
0713 9AA804----     R      947             CALL FAR PTR DAC_UPDATE
                           948             
0718 43                    949             INC BX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    01:26:24  12/05/;3  PAGE   19


LOC  OBJ                  LINE     SOURCE

0719 8A87BA00              950             MOV AL, DS:TEMP_BCD_ARR[BX]
071D 3C01                  951             CMP AL, 1
071F 7518                  952             JNE NOT_1_3
0721 43                    953             INC BX
0722 C706C4000100          954             MOV DS:CENT_FLAG, 1
0728 8A87BA00              955             MOV AL, DS:TEMP_BCD_ARR[BX]
072C 040A                  956             ADD AL, 10
072E A27900                957             MOV DS:REG_AL, AL
0731 9AA804----     R      958             CALL FAR PTR DAC_UPDATE
0736 EB2C90                959             JMP ENGLISH_END
                           960             
0739                       961     NOT_1_3:
0739 3C00                  962             CMP AL, 0
073B 7410                  963             JE NEXT_PLACE_5
073D C706C4000100          964             MOV DS:CENT_FLAG, 1
0743 0412                  965             ADD AL, 18
0745 A27900                966             MOV DS:REG_AL, AL
0748 9AA804----     R      967             CALL FAR PTR DAC_UPDATE
                           968             
074D                       969     NEXT_PLACE_5:
074D 43                    970             INC BX
074E 8A87BA00              971             MOV AL, DS:TEMP_BCD_ARR[BX]
0752 3C00                  972             CMP AL, 0
0754 740E                  973             JE ENGLISH_END
0756 C706C4000100          974             MOV DS:CENT_FLAG, 1
075C A27900                975             MOV DS:REG_AL, AL
075F 9AA804----     R      976             CALL FAR PTR DAC_UPDATE
                           977             
0764                       978     ENGLISH_END:
0764 833EC40000            979             CMP DS:CENT_FLAG, 0
0769 7410                  980             JE ENGLISH_END2
076B C60679001F            981             MOV DS:REG_AL, 31
0770 9AA804----     R      982             CALL FAR PTR DAC_UPDATE
0775 C706C4000000          983             MOV DS:CENT_FLAG, 0
077B                       984     ENGLISH_END2:
077B E91E01                985             JMP CONT_BCD_UPD_1
                           986             
077E                       987     MANDARIN_DAC:
077E C706C4000000          988             MOV DS:CENT_FLAG, 0
0784 C706C2000000          989             MOV DS:THOUSAND_FLAG, 0
078A BB0000                990             MOV BX, 0
078D 8A87BA00              991             MOV AL, DS:TEMP_BCD_ARR[BX]
0791 3C00                  992             CMP AL, 0
0793 7418                  993             JE NEXT_PLACE_6
0795 C706C2000100          994             MOV DS:THOUSAND_FLAG, 1
079B A27900                995             MOV DS:REG_AL, AL
079E 9AA804----     R      996             CALL FAR PTR DAC_UPDATE
07A3 C60679000B            997             MOV DS:REG_AL, 11
07A8 9AA804----     R      998             CALL FAR PTR DAC_UPDATE
                           999             
07AD                      1000     NEXT_PLACE_6:
07AD 43                   1001             INC BX
07AE 8A87BA00             1002             MOV AL, DS:TEMP_BCD_ARR[BX]
07B2 3C00                 1003             CMP AL, 0
07B4 7418                 1004             JE NEXT_PLACE_7
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    01:26:24  12/05/;3  PAGE   20


LOC  OBJ                  LINE     SOURCE

07B6 C706C2000100         1005             MOV DS:THOUSAND_FLAG, 1
07BC A27900               1006             MOV DS:REG_AL, AL
07BF 9AA804----     R     1007             CALL FAR PTR DAC_UPDATE
07C4 C60679000A           1008             MOV DS:REG_AL, 10
07C9 9AA804----     R     1009             CALL FAR PTR DAC_UPDATE
                          1010             
07CE                      1011     NEXT_PLACE_7:
07CE 43                   1012             INC BX
07CF 8A87BA00             1013             MOV AL, DS:TEMP_BCD_ARR[BX]
07D3 3C00                 1014             CMP AL, 0
07D5 740E                 1015             JE NEXT_PLACE_8
07D7 C706C2000100         1016             MOV DS:THOUSAND_FLAG, 1
07DD A27900               1017             MOV DS:REG_AL, AL
07E0 9AA804----     R     1018             CALL FAR PTR DAC_UPDATE
                          1019     
07E5                      1020     NEXT_PLACE_8:
07E5 833EC20000           1021             CMP DS:THOUSAND_FLAG, 0
07EA 7410                 1022             JE IGNORE_THOUSAND
07EC C60679000C           1023             MOV DS:REG_AL, 12
07F1 9AA804----     R     1024             CALL FAR PTR DAC_UPDATE
07F6 C706C2000000         1025             MOV DS:THOUSAND_FLAG, 0
                          1026             
07FC                      1027     IGNORE_THOUSAND:
07FC 43                   1028             INC BX
07FD 8A87BA00             1029             MOV AL, DS:TEMP_BCD_ARR[BX]
0801 3C00                 1030             CMP AL, 0
0803 7412                 1031             JE NEXT_PLACE_9
0805 A27900               1032             MOV DS:REG_AL, AL
0808 9AA804----     R     1033             CALL FAR PTR DAC_UPDATE
080D C60679000B           1034             MOV DS:REG_AL, 11
0812 9AA804----     R     1035             CALL FAR PTR DAC_UPDATE
                          1036             
0817                      1037     NEXT_PLACE_9:
0817 43                   1038             INC BX
0818 8A87BA00             1039             MOV AL, DS:TEMP_BCD_ARR[BX]
081C 3C00                 1040             CMP AL, 0
081E 7412                 1041             JE NEXT_PLACE_10
0820 A27900               1042             MOV DS:REG_AL, AL
0823 9AA804----     R     1043             CALL FAR PTR DAC_UPDATE
0828 C60679000A           1044             MOV DS:REG_AL, 10
082D 9AA804----     R     1045             CALL FAR PTR DAC_UPDATE
                          1046             
0832                      1047     NEXT_PLACE_10:
0832 43                   1048             INC BX
0833 8A87BA00             1049             MOV AL, DS:TEMP_BCD_ARR[BX]
0837 3C00                 1050             CMP AL, 0
0839 7408                 1051             JE MANDARIN_DEC
083B A27900               1052             MOV DS:REG_AL, AL
083E 9AA804----     R     1053             CALL FAR PTR DAC_UPDATE
                          1054             
0843                      1055     MANDARIN_DEC:
0843 C60679000D           1056             MOV DS:REG_AL, 13
0848 9AA804----     R     1057             CALL FAR PTR DAC_UPDATE
                          1058             
084D 43                   1059             INC BX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    01:26:24  12/05/;3  PAGE   21


LOC  OBJ                  LINE     SOURCE

084E 8A87BA00             1060             MOV AL, DS:TEMP_BCD_ARR[BX]
0852 3C00                 1061             CMP AL, 0
0854 7418                 1062             JE NEXT_PLACE_11
0856 C706C4000100         1063             MOV DS:CENT_FLAG, 1
085C A27900               1064             MOV DS:REG_AL, AL
085F 9AA804----     R     1065             CALL FAR PTR DAC_UPDATE
0864 C60679000A           1066             MOV DS:REG_AL, 10
0869 9AA804----     R     1067             CALL FAR PTR DAC_UPDATE
                          1068             
086E                      1069     NEXT_PLACE_11:
                          1070     
086E 43                   1071             INC BX
086F 8A87BA00             1072             MOV AL, DS:TEMP_BCD_ARR[BX]
0873 3C00                 1073             CMP AL, 0
0875 740E                 1074             JE CONT_BCD_UPD
0877 C706C4000100         1075             MOV DS:CENT_FLAG, 1
087D A27900               1076             MOV DS:REG_AL, AL
0880 9AA804----     R     1077             CALL FAR PTR DAC_UPDATE
                          1078             
0885                      1079     CONT_BCD_UPD:
0885 833EC40000           1080             CMP DS:CENT_FLAG, 0
088A 7410                 1081             JE CONT_BCD_UPD_1
088C C60679000E           1082             MOV DS:REG_AL, 14
0891 9AA804----     R     1083             CALL FAR PTR DAC_UPDATE
0896 C706C4000000         1084             MOV DS:CENT_FLAG, 0
                          1085     
089C                      1086     CONT_BCD_UPD_1:
                          1087             
089C 5A                   1088     POP DX
089D 59                   1089     POP CX
089E 5B                   1090     POP BX
089F 58                   1091     POP AX
08A0 CB                   1092     RET
                          1093     CALC_DAC ENDP
                          1094     
08A1                      1095     CALC_UPD_PRICE PROC FAR
08A1 50                   1096     PUSH AX
08A2 53                   1097     PUSH BX
08A3 51                   1098     PUSH CX
08A4 52                   1099     PUSH DX
08A5 833EB20000           1100             CMP DS:QTY, 0
08AA 7503                 1101             JNE START_CALC
08AC E93F01               1102             JMP CALC_END
08AF                      1103     START_CALC:
08AF BA0000               1104             MOV DX, 0
08B2 A1B000               1105             MOV AX, DS:PRICE
08B5 8B1EB200             1106             MOV BX, DS:QTY
08B9 F7E3                 1107             MUL BX
                          1108             
08BB BB6400               1109             MOV BX, 100
08BE F7F3                 1110             DIV BX
08C0 A3B000               1111             MOV DS:PRICE, AX
08C3 A1B800               1112             MOV AX, DS:TOTAL_PRICE_DEC
08C6 03C2                 1113             ADD AX, DX
08C8 3D6400               1114             CMP AX, 100
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    01:26:24  12/05/;3  PAGE   22


LOC  OBJ                  LINE     SOURCE

08CB 7C07                 1115             JL NON_DECIMAL
08CD FF06B600             1116             INC DS:TOTAL_PRICE_L
08D1 2D6400               1117             SUB AX, 100
                          1118             
08D4                      1119     NON_DECIMAL:    
08D4 A3B800               1120             MOV DS:TOTAL_PRICE_DEC, AX
08D7 A1B600               1121             MOV AX, DS:TOTAL_PRICE_L
08DA 8B1EB000             1122             MOV BX, DS:PRICE
08DE 03C3                 1123             ADD AX, BX
08E0 7304                 1124             JNC update_normal
08E2 FF06B400             1125             INC DS:TOTAL_PRICE_U
                          1126             
08E6                      1127     update_normal:
08E6 A3B600               1128             MOV DS:TOTAL_PRICE_L, AX
                          1129             
08E9 BA0000               1130             MOV DX, 0
08EC 833EB80009           1131             CMP DS:TOTAL_PRICE_DEC, 9
08F1 7F0B                 1132             JG DECIMAL_CONT
08F3 B90A00               1133             MOV CX, 10
08F6 A1B800               1134             MOV AX, DS:TOTAL_PRICE_DEC
08F9 F7E1                 1135             MUL CX
08FB A3B800               1136             MOV DS:TOTAL_PRICE_DEC, AX
08FE                      1137     DECIMAL_CONT:
08FE A1B800               1138             MOV AX, DS:TOTAL_PRICE_DEC
0901 B90A00               1139             MOV CX, 10
0904 F7F1                 1140             DIV CX
                          1141             
0906 BB0700               1142             MOV BX, 7
0909 8897BA00             1143             MOV DS:TEMP_BCD_ARR[BX], DL
090D 4B                   1144             DEC BX
090E 8887BA00             1145             MOV DS:TEMP_BCD_ARR[BX], AL
                          1146             
0912 BB0600               1147             MOV BX, 6
0915 A1B600               1148             MOV AX, DS:TOTAL_PRICE_L
                          1149             
0918                      1150             TEMP_UPD_LOOP:
0918 BA0000               1151                     MOV DX, 0
091B B90A00               1152                     MOV CX, 10
091E F7F1                 1153                     DIV CX
                          1154                     
0920 4B                   1155                     DEC BX
0921 8897BA00             1156                     MOV DS:TEMP_BCD_ARR[BX], DL
0925 43                   1157                     INC BX
                          1158                     
0926 4B                   1159                     DEC BX
                          1160                     
0927 75EF                 1161             JNZ TEMP_UPD_LOOP
                          1162             
0929 8B0EB400             1163             MOV CX, DS:TOTAL_PRICE_U
092D 83F900               1164             CMP CX, 0
0930 7478                 1165             JE upd_dac_part
0932                      1166             ADD_EXTRA_PART:
0932 BB0500               1167                     MOV BX, 5
0935 8A87BA00             1168                     MOV AL, DS:TEMP_BCD_ARR[BX]
0939 0406                 1169                     ADD AL, 6
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    01:26:24  12/05/;3  PAGE   23


LOC  OBJ                  LINE     SOURCE

093B 3C09                 1170                     CMP AL, 9
093D 7E08                 1171                     JLE CONT_DIGIT_1
093F 2C0A                 1172                     SUB AL, 10
0941 4B                   1173                     DEC BX
0942 FE87BA00             1174                     INC DS:TEMP_BCD_ARR[BX]
0946 43                   1175                     INC BX
0947                      1176             CONT_DIGIT_1:
0947 8887BA00             1177                     MOV DS:TEMP_BCD_ARR[BX], AL
094B 4B                   1178                     DEC BX
                          1179                     
094C 8A87BA00             1180                     MOV AL, DS:TEMP_BCD_ARR[BX]
0950 0403                 1181                     ADD AL, 3
0952 3C09                 1182                     CMP AL, 9
0954 7E08                 1183                     JLE CONT_DIGIT_2
0956 2C0A                 1184                     SUB AL, 10
0958 4B                   1185                     DEC BX
0959 FE87BA00             1186                     INC DS:TEMP_BCD_ARR[BX]
095D 43                   1187                     INC BX
095E                      1188             CONT_DIGIT_2:
095E 8887BA00             1189                     MOV DS:TEMP_BCD_ARR[BX], AL
0962 4B                   1190                     DEC BX
                          1191                     
0963 8A87BA00             1192                     MOV AL, DS:TEMP_BCD_ARR[BX]
0967 0405                 1193                     ADD AL, 5
0969 3C09                 1194                     CMP AL, 9
096B 7E08                 1195                     JLE CONT_DIGIT_3
096D 2C0A                 1196                     SUB AL, 10
096F 4B                   1197                     DEC BX
0970 FE87BA00             1198                     INC DS:TEMP_BCD_ARR[BX]
0974 43                   1199                     INC BX
0975                      1200             CONT_DIGIT_3:
0975 8887BA00             1201                     MOV DS:TEMP_BCD_ARR[BX], AL
0979 4B                   1202                     DEC BX
                          1203                     
                          1204                     
097A 8A87BA00             1205                     MOV AL, DS:TEMP_BCD_ARR[BX]
097E 0405                 1206                     ADD AL, 5
0980 3C09                 1207                     CMP AL, 9
0982 7E08                 1208                     JLE CONT_DIGIT_4
0984 2C0A                 1209                     SUB AL, 10
0986 4B                   1210                     DEC BX
0987 FE87BA00             1211                     INC DS:TEMP_BCD_ARR[BX]
098B 43                   1212                     INC BX
098C                      1213             CONT_DIGIT_4:
098C 8887BA00             1214                     MOV DS:TEMP_BCD_ARR[BX], AL
0990 4B                   1215                     DEC BX
                          1216                     
0991 8A87BA00             1217                     MOV AL, DS:TEMP_BCD_ARR[BX]
0995 0406                 1218                     ADD AL, 6
0997 3C09                 1219                     CMP AL, 9
0999 7E08                 1220                     JLE CONT_DIGIT_5
099B 2C0A                 1221                     SUB AL, 10
099D 4B                   1222                     DEC BX
099E FE87BA00             1223                     INC DS:TEMP_BCD_ARR[BX]
09A2 43                   1224                     INC BX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    01:26:24  12/05/;3  PAGE   24


LOC  OBJ                  LINE     SOURCE

09A3                      1225             CONT_DIGIT_5:
09A3 8887BA00             1226                     MOV DS:TEMP_BCD_ARR[BX], AL
09A7 4B                   1227                     DEC BX
                          1228                     
09A8 E288                 1229             LOOP ADD_EXTRA_PART
                          1230             
09AA                      1231     upd_dac_part:
09AA 9A1E06----     R     1232             CALL FAR PTR CALC_DAC
                          1233     
09AF 9A1104----     R     1234             CALL FAR PTR BCD_CLEAR
09B4 C70661000000         1235             MOV DS:KEYPAD_INDEX, 0
09BA C706AC000300         1236             MOV DS:DECIMAL_INDEX, 3
09C0 B90800               1237             MOV CX, 8
09C3                      1238             UPD_BCD:
09C3 BB0800               1239                     MOV BX, 8
09C6 2BD9                 1240                     SUB BX, CX
09C8 8A87BA00             1241                     MOV AL, DS:TEMP_BCD_ARR[BX]
09CC A27900               1242                     MOV DS:REG_AL, AL
09CF C706AA000100         1243                     MOV DS:DAC_DISABLE, 1
09D5 9A3C04----     R     1244                     CALL FAR PTR BCD_UPDATE
09DA C706AA000000         1245                     MOV DS:DAC_DISABLE, 0
09E0 E2E1                 1246             LOOP UPD_BCD
                          1247             
09E2 C706B0000000         1248             MOV DS:PRICE, 0
09E8 C706B2000000         1249             MOV DS:QTY, 0
09EE                      1250     CALC_END:
09EE 5A                   1251     POP DX
09EF 59                   1252     POP CX
09F0 5B                   1253     POP BX
09F1 58                   1254     POP AX
09F2 CB                   1255     RET
                          1256     CALC_UPD_PRICE ENDP
                          1257     ; ^^^^^^^^^^^^^^^ End of User main routine ^^^^^^^^^^^^^^^^^^^^^^^^^
09F3                      1258     SERIAL_REC_ACTION       PROC    FAR
09F3 51                   1259                     PUSH    CX
09F4 53                   1260                     PUSH    BX
09F5 1E                   1261                     PUSH    DS
                          1262                     
09F6 BB----         R     1263                     MOV     BX,DATA_SEG             ;initialize data segment register
09F9 8EDB                 1264                     MOV     DS,BX
                          1265                     
09FB 803E8B0001           1266                     CMP DS:REPLY_FLAG, 1
0A00 7569                 1267                     JNE next_id1
                          1268                     
0A02 803E8C0001           1269                     CMP DS:SEND_FLAG, 1
0A07 7465                 1270                     JE send_input_across1
                          1271                     
0A09 833EA00001           1272                     CMP DS:RECEIVE_FLAG, 1
0A0E 7561                 1273                     JNE terminate_session3
                          1274                     
0A10 3C2F                 1275                     CMP AL, '/'
0A12 751A                 1276                     JNE CHECK_SEND
0A14 C706A4000000         1277                     MOV DS:PRICE_FLAG, 0
0A1A C706A0000000         1278                     MOV DS:RECEIVE_FLAG, 0
0A20 C706AE000100         1279                     MOV DS:LANG_FLAG, 1
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    01:26:24  12/05/;3  PAGE   25


LOC  OBJ                  LINE     SOURCE

0A26 9AA108----     R     1280                     CALL FAR PTR CALC_UPD_PRICE
0A2B EB4490               1281                     JMP terminate_session3
                          1282             
0A2E                      1283             CHECK_SEND:
0A2E 3C26                 1284                     CMP AL, '&'
0A30 7515                 1285                     JNE receive_price
0A32 C706A4000100         1286                     MOV DS:PRICE_FLAG, 1
0A38 C70661000000         1287                     MOV DS:KEYPAD_INDEX, 0
0A3E C7069C000800         1288                     MOV DS:MAX_INPUT_SIZE, 8
0A44 EB7F90               1289                     JMP id_skip2
                          1290                     
0A47                      1291             receive_price:
0A47 3C23                 1292                     CMP AL, '#'
0A49 750F                 1293                     JNE check_price
0A4B C706A2000100         1294                     MOV DS:DAC_FLAG, 1
0A51 C706A4000000         1295                     MOV DS:PRICE_FLAG, 0
0A57 EB6C90               1296                     JMP id_skip2
                          1297             
0A5A                      1298             check_price:    
                          1299             
0A5A 833EA40001           1300                     CMP DS:PRICE_FLAG, 1
0A5F 7431                 1301                     JE update_price_value
                          1302                     
0A61 833EA20001           1303                     CMP DS:DAC_FLAG, 1
0A66 740C                 1304                     JE dac_change
0A68 EB5B90               1305                     JMP id_skip2
                          1306     
0A6B                      1307             next_id1:
0A6B EB5B90               1308                     JMP next_id
                          1309                     
0A6E                      1310             send_input_across1:
0A6E EB3990               1311                     JMP send_input_across
                          1312             
0A71                      1313             terminate_session3:
0A71 EB4F90               1314                     JMP terminate_session2
                          1315             
0A74                      1316             dac_change:
0A74 8A1E7900             1317                     MOV BL, DS:REG_AL
0A78 2C30                 1318                     SUB AL, 30H
0A7A A27900               1319                     MOV DS:REG_AL, AL
0A7D 9AA804----     R     1320                     CALL FAR PTR DAC_UPDATE
0A82 881E7900             1321                     MOV DS:REG_AL, BL
0A86 C706A2000000         1322                     MOV DS:DAC_FLAG, 0
0A8C EB3790               1323                     JMP id_skip2
                          1324             
                          1325     
0A8F EB3490               1326             id_skip3: JMP id_skip2
                          1327     
                          1328                     
0A92                      1329             update_price_value:
0A92 2C30                 1330                     SUB AL, 30H
0A94 B90000               1331                     MOV CX, 0
0A97 8AC8                 1332                     MOV CL, AL
0A99 A1B000               1333                     MOV AX, DS:PRICE
0A9C BB0A00               1334                     MOV BX, 10
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    01:26:24  12/05/;3  PAGE   26


LOC  OBJ                  LINE     SOURCE

0A9F F7E3                 1335                     MUL BX
                          1336                     
0AA1 03C1                 1337                     ADD AX, CX
0AA3 A3B000               1338                     MOV DS:PRICE, AX
0AA6 EB1D90               1339                     JMP id_skip2
                          1340                     
0AA9                      1341             send_input_across:
0AA9 9ACB04----     R     1342                     CALL FAR PTR SEND_INPUT
                          1343                     
0AAE C7069A000000         1344                     MOV DS:SEND_BUFFER_LEN, 0
                          1345                     
0AB4 C6068C0000           1346                     MOV DS:SEND_FLAG, 0
                          1347                     
0AB9 C706A0000100         1348                     MOV DS:RECEIVE_FLAG, 1
                          1349                     
0ABF EB0490               1350                     JMP id_skip2
                          1351                     
0AC2 EB3E90               1352                     terminate_session2: JMP terminate_session
0AC5 EB6790               1353                     id_skip2: JMP id_skip
                          1354                     
0AC8                      1355             next_id:
                          1356                     
0AC8 803E810001           1357                     CMP DS:ID_FLAG_r, 1
0ACD 7513                 1358                     JNE id_flag_label
0ACF 38067F00             1359                     CMP DS:MY_ID[1], AL
0AD3 7559                 1360                     JNE id_skip
                          1361                     ;start writing to pc
0AD5 C6068B0001           1362                     MOV DS:REPLY_FLAG, 1
0ADA C606810000           1363                     MOV DS:ID_FLAG_r, 0
0ADF EB4D90               1364                     JMP id_skip
                          1365             
0AE2                      1366             id_flag_label:
                          1367             
0AE2 803E800001           1368                     CMP DS:ID_FLAG_@, 1
0AE7 7539                 1369                     JNE protocol_rec
0AE9 3C72                 1370                     CMP AL,'r'
0AEB 750D                 1371                     JNE id_not_r
0AED C606810001           1372                     MOV DS:ID_FLAG_r,1
0AF2 C606800000           1373                     MOV DS:ID_FLAG_@, 0
0AF7 EB6C90               1374                     JMP S_RET
0AFA                      1375             id_not_r:
0AFA C606800000           1376                     MOV DS:ID_FLAG_@, 0
0AFF EB2D90               1377                     JMP id_skip
                          1378             
0B02                      1379             terminate_session:
0B02 C606810000           1380                     MOV DS:ID_FLAG_r, 0
0B07 33DB                 1381                     XOR BX,BX
0B09                      1382             start_send1:
0B09 50                   1383                     PUSH AX
0B0A 33C0                 1384                     XOR AX,AX
0B0C 8A878600             1385                     MOV AL, DS:FAIL_MESSAGE[BX]
0B10 9A0000----     E     1386                     CALL FAR PTR PRINT_CHAR
0B15 58                   1387                     POP AX
0B16 C6068B0000           1388                     MOV DS:REPLY_FLAG, 0
0B1B 43                   1389                     INC BX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    01:26:24  12/05/;3  PAGE   27


LOC  OBJ                  LINE     SOURCE

0B1C 3A1E8A00             1390                     CMP BL, DS:FAIL_COUNT
0B20 75E7                 1391                     JNE start_send1
                          1392                     
0B22                      1393             protocol_rec:
0B22 3C40                 1394                     CMP AL,'@'
0B24 7508                 1395                     JNE id_skip
0B26 C606800001           1396                     MOV DS:ID_FLAG_@,1
0B2B EB3890               1397                     JMP S_RET
                          1398                     
0B2E                      1399             id_skip:
0B2E EB3590               1400                     JMP S_RET
                          1401             
0B31 3C3C                 1402                     CMP     AL,'<'
0B33 750B                 1403                     JNE     S_FAST
                          1404     
0B35 FE061700             1405                     INC     DS:T_COUNT_SET
0B39 FE061700             1406                     INC     DS:T_COUNT_SET
                          1407     
0B3D EB0D90               1408                     JMP     S_NEXT0
0B40                      1409     S_FAST:
0B40 3C3E                 1410                     CMP     AL,'>'
0B42 7521                 1411                     JNE     S_RET
                          1412     
0B44 FE0E1700             1413                     DEC     DS:T_COUNT_SET
0B48 FE0E1700             1414                     DEC     DS:T_COUNT_SET
                          1415     
0B4C                      1416     S_NEXT0:
0B4C B91600               1417                     MOV     CX,22                   ;initialize counter for message
0B4F BB0000               1418                     MOV     BX,0
                          1419     
0B52 8A4718               1420     S_NEXT1:        MOV     AL,DS:REC_MESS[BX]      ;print message
0B55 9A0000----     E     1421                     call    FAR ptr print_char
0B5A 43                   1422                     INC     BX
0B5B E2F5                 1423                     LOOP    S_NEXT1
                          1424     
0B5D A01700               1425                     MOV     AL,DS:T_COUNT_SET       ;print current period of timer0
0B60 9A0000----     E     1426                     CALL    FAR PTR PRINT_2HEX
0B65                      1427     S_RET:
0B65 1F                   1428                     POP     DS
0B66 5B                   1429                     POP     BX
0B67 59                   1430                     POP     CX
0B68 CB                   1431                     RET
                          1432     SERIAL_REC_ACTION       ENDP
                          1433     
0B69                      1434     TIMER2_ACTION   PROC    FAR
0B69 50                   1435                     PUSH    AX
0B6A 1E                   1436                     PUSH    DS
0B6B 53                   1437                     PUSH    BX
0B6C 51                   1438                     PUSH    CX
0B6D 52                   1439                     PUSH    DX
                          1440                     
                          1441                     
0B6E B8----         R     1442                     MOV     AX,DATA_SEG
0B71 8ED8                 1443                     MOV     DS,AX
                          1444             
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    01:26:24  12/05/;3  PAGE   28


LOC  OBJ                  LINE     SOURCE

0B73 FE0E1600             1445                     DEC     DS:T_COUNT
0B77 754A                 1446                     JNZ     T_NEXT1
0B79 A01700               1447                     MOV     AL,DS:T_COUNT_SET
0B7C A21600               1448                     MOV     DS:T_COUNT,AL
                          1449     
0B7F                      1450     T_NEXT0:
                          1451                     
0B7F 33DB                 1452                     XOR BX, BX
0B81 8A1E6000             1453                     MOV BL, DS:BCD_INDEX
0B85 8A4759               1454                     MOV AL, DS:BCD_MESSAGE[BX]
                          1455                     
0B88 3B1EAC00             1456                     CMP BX, DS:DECIMAL_INDEX
0B8C 7506                 1457                     JNE CALL_FUNC
0B8E C706A6000100         1458                     MOV DS:DECIMAL_FLAG, 1
0B94                      1459     CALL_FUNC:
0B94 9A340C----     R     1460                     CALL FAR PTR BCD_TO_7SEG
0B99 C706A6000000         1461                     MOV DS:DECIMAL_FLAG, 0
                          1462     
0B9F BA0002               1463                     MOV DX, 200H
0BA2 EE                   1464                     OUT DX, AL
                          1465                     
0BA3 A05F00               1466                     MOV AL, DS:ENABLE_BYTE
0BA6 BA8001               1467                     MOV DX, 180H
0BA9 EE                   1468                     OUT DX, AL
                          1469                     
                          1470     
0BAA FE066000             1471                     INC DS:BCD_INDEX
0BAE D0065F00             1472                     ROL DS:ENABLE_BYTE, 1
0BB2 803E5F00BF           1473                     CMP DS:ENABLE_BYTE, 10111111b
0BB7 750A                 1474                     JNE T_NEXT1
0BB9 C6065F00FE           1475                     MOV DS:ENABLE_BYTE, 11111110b 
0BBE C606600000           1476                     MOV DS:BCD_INDEX, 0
                          1477     
                          1478                     
0BC3                      1479     T_NEXT1:
0BC3 803E750000           1480                     CMP DS:DAC_LEN, 0
0BC8 743C                 1481                     JE ISR_END
                          1482                     
                          1483                     
0BCA 8B367600             1484                     MOV SI, DS:SI_PTR
                          1485                             
0BCE BB0000               1486                     MOV BX, 0
0BD1 33C0                 1487                     XOR AX, AX
0BD3 8A4766               1488                     MOV AL, DS:DAC_ADDR[BX]
                          1489                     
0BD6 BB0001               1490                     MOV BX, 100H
0BD9 F7E3                 1491                     MUL BX
                          1492                     
0BDB 8B166400             1493                     MOV DX, DS:DAC_BASE
0BDF 03D0                 1494                     ADD DX, AX
                          1495                     
0BE1 1E                   1496                     PUSH DS
0BE2 8EDA                 1497                     MOV DS, DX
                          1498                     
0BE4 8B04                 1499                     MOV AX, [SI]
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    01:26:24  12/05/;3  PAGE   29


LOC  OBJ                  LINE     SOURCE

                          1500                     
0BE6 BA1001               1501                     MOV DX, 110H
0BE9 EE                   1502                     OUT DX, AL
                          1503                     
0BEA 1F                   1504                     POP DS
                          1505                     
0BEB FF067600             1506                     INC DS:SI_PTR
0BEF 813E76000010         1507                     CMP DS:SI_PTR, 1000H
0BF5 750F                 1508                     JNE ISR_END
                          1509                     
0BF7 C70676000000         1510                     MOV DS:SI_PTR, 0
0BFD FE0E7500             1511                     DEC DS:DAC_LEN
0C01 9A0C0C----     R     1512                     CALL FAR PTR DAC_SHIFT
                          1513                     
0C06                      1514     ISR_END:
                          1515                     
0C06 5A                   1516                     POP DX
0C07 59                   1517                     POP     CX
0C08 5B                   1518                     POP     BX
0C09 1F                   1519                     POP     DS
0C0A 58                   1520                     POP AX
0C0B CB                   1521                     RET
                          1522     TIMER2_ACTION   ENDP
                          1523     
                          1524     
0C0C                      1525     DAC_SHIFT PROC FAR
0C0C 50                   1526             PUSH AX
0C0D 53                   1527             PUSH BX
0C0E 51                   1528             PUSH CX
0C0F 52                   1529             PUSH DX
                          1530     
0C10 33C9                 1531             XOR CX, CX
0C12 8A0E7500             1532             MOV CL, DS:DAC_LEN
0C16 80F900               1533             CMP CL, 0
0C19 7414                 1534             JE END_SHIFT
                          1535     
0C1B                      1536             SHIFT_LOOP:
                          1537     
0C1B 33DB                 1538             XOR BX, BX
0C1D 8A1E7500             1539             MOV BL, DS:DAC_LEN
0C21 2BD9                 1540             SUB BX, CX
0C23 43                   1541             INC BX
                          1542             
0C24 33D2                 1543             XOR DX, DX
0C26 8A5766               1544             MOV DL, DS:DAC_ADDR[BX]
0C29 4B                   1545             DEC BX
0C2A 885766               1546             MOV DS:DAC_ADDR[BX], DL
                          1547     
0C2D E2EC                 1548             LOOP SHIFT_LOOP
                          1549             
0C2F                      1550             END_SHIFT:
0C2F 5A                   1551             POP DX
0C30 59                   1552             POP CX
0C31 5B                   1553             POP BX
0C32 58                   1554             POP AX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    01:26:24  12/05/;3  PAGE   30


LOC  OBJ                  LINE     SOURCE

0C33 CB                   1555             RET
                          1556     DAC_SHIFT ENDP
                          1557     
0C34                      1558     BCD_TO_7SEG PROC FAR
                          1559     
0C34 53                   1560             PUSH BX
0C35 51                   1561             PUSH CX
0C36 52                   1562             PUSH DX
                          1563             
0C37 3C00                 1564             CMP AL, 0
0C39 7511                 1565             JNE one
0C3B 833EA60001           1566             CMP DS:DECIMAL_FLAG, 1
0C40 7405                 1567             JE decimal0
0C42 B03F                 1568             MOV AL, 00111111b
0C44 E9D700               1569             JMP endfunc
0C47                      1570     decimal0:
0C47 B0BF                 1571             MOV AL, 10111111b
0C49 E9D200               1572             JMP endfunc
                          1573             
0C4C                      1574             one:
0C4C 3C01                 1575             CMP AL, 1
0C4E 7511                 1576             JNE two
0C50 833EA60001           1577             CMP DS:DECIMAL_FLAG, 1
0C55 7405                 1578             JE decimal1
0C57 B006                 1579             MOV AL, 00000110b
0C59 E9C200               1580             JMP endfunc
0C5C                      1581     decimal1:
0C5C B086                 1582             MOV AL, 10000110b
0C5E E9BD00               1583             JMP endfunc
                          1584             
0C61                      1585             two:
0C61 3C02                 1586             CMP AL,2
0C63 7511                 1587             JNE three
0C65 833EA60001           1588             CMP DS:DECIMAL_FLAG, 1
0C6A 7405                 1589             JE decimal2
0C6C B05B                 1590             MOV AL, 01011011b
0C6E E9AD00               1591             JMP endfunc
0C71                      1592     decimal2:
0C71 B0DB                 1593             MOV AL, 11011011b
0C73 E9A800               1594             JMP endfunc
                          1595             
0C76                      1596             three:
0C76 3C03                 1597             CMP AL,3
0C78 7511                 1598             JNE four
0C7A 833EA60001           1599             CMP DS:DECIMAL_FLAG, 1
0C7F 7405                 1600             JE decimal3
0C81 B04F                 1601             MOV AL, 01001111b
0C83 E99800               1602             JMP endfunc
0C86                      1603     decimal3:
0C86 B0CF                 1604             MOV AL, 11001111b
0C88 E99300               1605             JMP endfunc
                          1606             
0C8B                      1607             four:
0C8B 3C04                 1608             CMP AL,4
0C8D 7511                 1609             JNE five
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    01:26:24  12/05/;3  PAGE   31


LOC  OBJ                  LINE     SOURCE

0C8F 833EA60001           1610             CMP DS:DECIMAL_FLAG, 1
0C94 7405                 1611             JE decimal4
0C96 B066                 1612             MOV AL, 01100110b
0C98 E98300               1613             JMP endfunc
0C9B                      1614     decimal4:
0C9B B0E6                 1615             MOV AL, 11100110b
0C9D EB7F90               1616             JMP endfunc
                          1617             
0CA0                      1618             five:
0CA0 3C05                 1619             CMP AL,5
0CA2 7511                 1620             JNE six
0CA4 833EA60001           1621             CMP DS:DECIMAL_FLAG, 1
0CA9 7405                 1622             JE decimal5
0CAB B06D                 1623             MOV AL, 01101101b
0CAD EB6F90               1624             JMP endfunc
0CB0                      1625     decimal5:
0CB0 B0ED                 1626             MOV AL, 11101101b
0CB2 EB6A90               1627             JMP endfunc
                          1628             
0CB5                      1629             six:
0CB5 3C06                 1630             CMP AL,6
0CB7 7511                 1631             JNE seven
0CB9 833EA60001           1632             CMP DS:DECIMAL_FLAG, 1
0CBE 7405                 1633             JE decimal6
0CC0 B07D                 1634             MOV AL, 01111101b
0CC2 EB5A90               1635             JMP endfunc
0CC5                      1636     decimal6:
0CC5 B0FD                 1637             MOV AL, 11111101b
0CC7 EB5590               1638             JMP endfunc
                          1639             
0CCA                      1640             seven:
0CCA 3C07                 1641             CMP AL,7
0CCC 7511                 1642             JNE eight
0CCE 833EA60001           1643             CMP DS:DECIMAL_FLAG, 1
0CD3 7405                 1644             JE decimal7
0CD5 B007                 1645             MOV AL, 00000111b
0CD7 EB4590               1646             JMP endfunc
0CDA                      1647     decimal7:
0CDA B087                 1648             MOV AL, 10000111b
0CDC EB4090               1649             JMP endfunc
                          1650             
0CDF                      1651             eight:
0CDF 3C08                 1652             CMP AL,8
0CE1 7511                 1653             JNE nine
0CE3 833EA60001           1654             CMP DS:DECIMAL_FLAG, 1
0CE8 7405                 1655             JE decimal8
0CEA B07F                 1656             MOV AL, 01111111b
0CEC EB3090               1657             JMP endfunc
0CEF                      1658     decimal8:
0CEF B0FF                 1659             MOV AL, 11111111b
0CF1 EB2B90               1660             JMP endfunc
                          1661             
0CF4                      1662             nine:
0CF4 3C09                 1663             CMP AL,9
0CF6 7511                 1664             JNE hifn
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    01:26:24  12/05/;3  PAGE   32


LOC  OBJ                  LINE     SOURCE

0CF8 833EA60001           1665             CMP DS:DECIMAL_FLAG, 1
0CFD 7405                 1666             JE decimal9
0CFF B06F                 1667             MOV AL, 01101111b
0D01 EB1B90               1668             JMP endfunc
0D04                      1669     decimal9:
0D04 B0EF                 1670             MOV AL, 11101111b
0D06 EB1690               1671             JMP endfunc
                          1672             
0D09                      1673             hifn:
0D09 3C2D                 1674             CMP AL,'-'
0D0B 7511                 1675             JNE endfunc
0D0D 833EA60001           1676             CMP DS:DECIMAL_FLAG, 1
0D12 7405                 1677             JE decimal10
0D14 B040                 1678             MOV AL, 01000000b
0D16 EB0690               1679             JMP endfunc
0D19                      1680     decimal10:
0D19 B0C0                 1681             MOV AL, 11000000b
0D1B EB0190               1682             JMP endfunc
                          1683             
0D1E                      1684             endfunc:
0D1E 5A                   1685             POP DX
0D1F 59                   1686             POP CX
0D20 5B                   1687             POP BX
                          1688     
0D21 CB                   1689     RET
                          1690     BCD_TO_7SEG ENDP
                          1691     
----                      1692     CODE_SEG        ENDS
                          1693     END

ASSEMBLY COMPLETE, NO ERRORS FOUND
