8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:38:32  10/13/;3  PAGE    1


DOS 5.0 (038-N) 8086/87/88/186 MACRO ASSEMBLER V3.1 ASSEMBLY OF MODULE TIMER
OBJECT MODULE PLACED IN TIMER.OBJ
ASSEMBLER INVOKED BY:  D:\ASM86.EXE TIMER.ASM


LOC  OBJ                  LINE     SOURCE

                             1 +1  $MOD186
                             2 +1  $EP
                             3     NAME TIMER
                             4     ; Main program for uPD70208 microcomputer system
                             5     ;
                             6     ; Author:       Dr Tay Teng Tiow
                             7     ; Address:      Department of Electrical Engineering 
                             8     ;               National University of Singapore
                             9     ;               10, Kent Ridge Crescent
                            10     ;               Singapore 0511. 
                            11     ; Date:         6th September 1991
                            12     ;
                            13     ; This file contains proprietory information and cannot be copied 
                            14     ; or distributed without prior permission from the author.
                            15     ; =========================================================================
                            16     
                            17     public  serial_rec_action, timer2_action
                            18     extrn   print_char:far, print_2hex:far, iodefine:far
                            19     extrn   set_timer2:far
                            20     
                            21     ;IO Setup for 80C188 
  FFA0                      22             UMCR    EQU    0FFA0H ; Upper Memory Control Register
  FFA2                      23             LMCR    EQU    0FFA2H ; Lower Memory control Register         
  FFA4                      24             PCSBA   EQU    0FFA4H ; Peripheral Chip Select Base Address
  FFA8                      25             MPCS    EQU    0FFA8H ; MMCS and PCS Alter Control Register
  0080                      26             A_8255  EQU    0080H
  0081                      27             B_8255  EQU    0081H
  0082                      28             C_8255  EQU    0082H
  0083                      29             CWR_8255  EQU    0083H
  FF38                      30             INT0CON  EQU   0FF38H
  FF22                      31             EOI EQU 0FF22H
  FF28                      32             IMASK EQU 0FF28H
                            33     
----                        34     STACK_SEG       SEGMENT
0000 (256                   35                     DB      256 DUP(?)
     ??
     )
0100                        36             TOS     LABEL   WORD
----                        37     STACK_SEG       ENDS
                            38     
                            39     
----                        40     DATA_SEG        SEGMENT
0000 0A                     41             TIMER0_MESS     DB      10,13,'TIMER2 INTERRUPT    '
0001 0D
0002 54494D45523220
     494E5445525255
     505420202020
0016 2F                     42             T_COUNT         DB      2FH
0017 2F                     43             T_COUNT_SET     DB      2FH
0018 0A                     44             REC_MESS        DB      10,13,'Period of timer0 =     '
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:38:32  10/13/;3  PAGE    2


LOC  OBJ                  LINE     SOURCE

0019 0D
001A 506572696F6420
     6F662074696D65
     7230203D202020
     2020
0031 (32                    45             MESSAGE     DB  32 dup('h')
     68
     )
0051 20                     46             M_SIZE          DB  32
0052 (32                    47             INPUT       DB  32 dup('q')
     71
     )
0072 00                     48             INPUT_SIZE  DB  0
0073 00                     49             FLAG            DB  0
0074 ??                     50             CHAR            DB  ?
----                        51     DATA_SEG        ENDS
                            52     
                            53     
----                        54     CODE_SEG        SEGMENT
                            55     
                            56             PUBLIC          START
                            57     
                            58     ASSUME  CS:CODE_SEG, SS:STACK_SEG
                            59     
0000                        60     START:
                            61     ;initialize stack area
0000 B8----         R       62                     MOV     AX,STACK_SEG            
0003 8ED0                   63                     MOV     SS,AX
0005 368B260001             64                     MOV     SP,TOS
                            65     
                            66     ; Initialize the on-chip pheripherals
000A 9A0000----     E       67                     CALL    FAR PTR IODEFINE
                            68                     
000F 9A0000----     E       69     call set_timer2
0014 FB                     70                      STI
                            71     
                            72     ; ^^^^^^^^^^^^^^^^^  Start of User Main Routine  ^^^^^^^^^^^^^^^^^^
                            73        
                            74     ; Initialize MPCS to MAP peripheral to IO address
                            75             
0015 BAA8FF                 76             MOV DX, MPCS
0018 B88300                 77             MOV AX, 0083H
001B EF                     78             OUT DX, AX
                            79     
                            80     ; PCSBA initial, set the parallel port start from 00H
001C BAA4FF                 81             MOV DX, PCSBA
001F B80300                 82             MOV AX, 0003H ; Peripheral starting address 00H no READY, No Waits
0022 EF                     83             OUT DX, AX
                            84     
                            85     ; Initialize LMCS 
0023 BAA2FF                 86         MOV DX, LMCR
0026 B8C401                 87         MOV AX, 01C4H  ; Starting address 1FFFH, 8K, No waits, last shoud be 5H for 1 wai
                                   ts      
0029 EF                     88         OUT DX, AX
                            89     
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:38:32  10/13/;3  PAGE    3


LOC  OBJ                  LINE     SOURCE

002A B8----         R       90             MOV AX, DATA_SEG
002D 8ED8                   91             MOV DS, AX
                            92                              
002F BA8300                 93             MOV DX, CWR_8255
0032 B88000                 94             MOV AX, 0080h
0035 EF                     95             OUT DX, AX
                            96             
0036 BA8000                 97             MOV DX, A_8255
0039 B023                   98             MOV AL, 23h
003B F6D0                   99             NOT AL
003D EE                    100             OUT DX, AL
                           101     
                           102             
003E 9A4A00----     R      103             CALL FAR PTR LCD_INIT
                           104             
0043                       105     NEXT:
                           106             ; Begin 
                           107             
                           108             
                           109             ; XOR AX, AX
                           110             ; MOV AL, DS:M_SIZE1
                           111             ; MOV DS:M_SIZE, AL
                           112             
                           113             ; displayloop:
                           114             ; XOR BX, BX
                           115             ; MOV BL, DS:M_SIZE1
                           116             ; SUB BL, AL
                           117     
                           118             ; MOV DL, DS:MESSAGE_1[BX]
                           119             ; MOV DS:MESSAGE[BX], DL
                           120             
                           121             ; DEC AL
                           122             ; JNZ displayloop
                           123             
0043 9A2B01----     R      124             CALL FAR PTR MESSAGE_LCD
                           125             
                           126             
0048 EBF9                  127     JMP NEXT
                           128     
004A                       129     LCD_INIT PROC FAR
                           130     
                           131             ; LCD Initialization ;
                           132     
                           133     ;Function set 1;
                           134     ; 60 ms delay ;
004A B975AA                135             MOV CX, 0AA75h ; 43637 dec
004D                       136             loop60ms:       
004D 90                    137                     NOP        ; 3 clocks
004E 49                    138                     DEC CX     ; 3 clocks
004F 75FC                  139             JNZ loop60ms ; 16 clocks
                           140             
0051 33C0                  141             XOR AX, AX
0053 B020                  142             MOV AL, 00100000b
0055 BA8100                143             MOV DX, B_8255
0058 EE                    144             OUT DX, AL
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:38:32  10/13/;3  PAGE    4


LOC  OBJ                  LINE     SOURCE

                           145             
0059 33C0                  146             XOR AX, AX
005B B03C                  147             MOV AL, 00111100b
005D BA8200                148             MOV DX, C_8255
0060 EE                    149             OUT DX, AL
                           150             
0061 33C0                  151             XOR AX, AX
0063 B000                  152             MOV AL, 00000000b
0065 BA8100                153             MOV DX, B_8255
0068 EE                    154             OUT DX, AL
                           155             
                           156     
                           157     ;Function set 2;
                           158     ; 5 ms delay;
0069 B9350E                159             MOV CX, 0E35h ; 3637 dec
006C                       160             loop5ms:        
006C 90                    161                     NOP        ; 3 clocks
006D 49                    162                     DEC CX     ; 3 clocks
006E 75FC                  163             JNZ loop5ms ; 16 clocks
                           164             
0070 33C0                  165             XOR AX, AX
0072 B020                  166             MOV AL, 00100000b
0074 BA8100                167             MOV DX, B_8255
0077 EE                    168             OUT DX, AL
                           169             
0078 33C0                  170             XOR AX, AX
007A B03C                  171             MOV AL, 00111100b
007C BA8200                172             MOV DX, C_8255
007F EE                    173             OUT DX, AL
                           174             
0080 33C0                  175             XOR AX, AX
0082 B000                  176             MOV AL, 00000000b
0084 BA8100                177             MOV DX, B_8255
0087 EE                    178             OUT DX, AL
                           179             
                           180             
                           181     ;Function set 3;
                           182     ; 100 us delay;
0088 B94900                183             MOV CX, 0049h ; 73 dec
008B                       184             loop4point100us:        
008B 90                    185                     NOP        ; 3 clocks
008C 49                    186                     DEC CX     ; 3 clocks
008D 75FC                  187             JNZ loop4point100us ; 16 clocks
                           188             
008F 33C0                  189             XOR AX, AX
0091 B020                  190             MOV AL, 00100000b
0093 BA8100                191             MOV DX, B_8255
0096 EE                    192             OUT DX, AL
                           193             
0097 33C0                  194             XOR AX, AX
0099 B03C                  195             MOV AL, 00111100b
009B BA8200                196             MOV DX, C_8255
009E EE                    197             OUT DX, AL
                           198             
009F 33C0                  199             XOR AX, AX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:38:32  10/13/;3  PAGE    5


LOC  OBJ                  LINE     SOURCE

00A1 B000                  200             MOV AL, 00000000b
00A3 BA8100                201             MOV DX, B_8255
00A6 EE                    202             OUT DX, AL
                           203                     
                           204             ; 40 us delay;
00A7 B91E00                205             MOV CX, 001Eh ; 30 dec
00AA                       206             loop40us:       
00AA 90                    207                     NOP        ; 3 clocks
00AB 49                    208                     DEC CX     ; 3 clocks
00AC 75FC                  209             JNZ loop40us ; 16 clocks
                           210             
                           211             ;Display Clear;
                           212             
00AE 33C0                  213             XOR AX, AX
00B0 B020                  214             MOV AL, 00100000b
00B2 BA8100                215             MOV DX, B_8255
00B5 EE                    216             OUT DX, AL
                           217             
00B6 33C0                  218             XOR AX, AX
00B8 B001                  219             MOV AL, 00000001b
00BA BA8200                220             MOV DX, C_8255
00BD EE                    221             OUT DX, AL
                           222             
00BE 33C0                  223             XOR AX, AX
00C0 B000                  224             MOV AL, 00000000b
00C2 BA8100                225             MOV DX, B_8255
00C5 EE                    226             OUT DX, AL
                           227             
                           228             ; 1.6ms delay;
00C6 B98C04                229             MOV CX, 048Ch ; 30 dec
00C9                       230             loop1point6ms:  
00C9 90                    231                     NOP        ; 3 clocks
00CA 49                    232                     DEC CX     ; 3 clocks
00CB 75FC                  233             JNZ loop1point6ms ; 16 clocks
                           234             
                           235             
                           236             ;Entry Mode Set;
                           237             
00CD 33C0                  238             XOR AX, AX
00CF B020                  239             MOV AL, 00100000b
00D1 BA8100                240             MOV DX, B_8255
00D4 EE                    241             OUT DX, AL
                           242             
00D5 33C0                  243             XOR AX, AX
00D7 B006                  244             MOV AL, 00000110b
00D9 BA8200                245             MOV DX, C_8255
00DC EE                    246             OUT DX, AL
                           247             
00DD 33C0                  248             XOR AX, AX
00DF B000                  249             MOV AL, 00000000b
00E1 BA8100                250             MOV DX, B_8255
00E4 EE                    251             OUT DX, AL
                           252             
                           253             ; 40 us delay;
00E5 B91E00                254             MOV CX, 001Eh ; 30 dec
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:38:32  10/13/;3  PAGE    6


LOC  OBJ                  LINE     SOURCE

00E8                       255             loop40us2:      
00E8 90                    256                     NOP        ; 3 clocks
00E9 49                    257                     DEC CX     ; 3 clocks
00EA 75FC                  258             JNZ loop40us2 ; 16 clocks
                           259             
                           260             
                           261             ;Setting Address of DDRAM;
                           262             
00EC 33C0                  263             XOR AX, AX
00EE B020                  264             MOV AL, 00100000b
00F0 BA8100                265             MOV DX, B_8255
00F3 EE                    266             OUT DX, AL
                           267             
00F4 33C0                  268             XOR AX, AX
00F6 B080                  269             MOV AL, 10000000b
00F8 BA8200                270             MOV DX, C_8255
00FB EE                    271             OUT DX, AL
                           272             
00FC 33C0                  273             XOR AX, AX
00FE B000                  274             MOV AL, 00000000b
0100 BA8100                275             MOV DX, B_8255
0103 EE                    276             OUT DX, AL
                           277             
                           278             ; 40 us delay;
0104 B91E00                279             MOV CX, 001Eh ; 30 dec
0107                       280             loop40us3:      
0107 90                    281                     NOP        ; 3 clocks
0108 49                    282                     DEC CX     ; 3 clocks
0109 75FC                  283             JNZ loop40us3 ; 16 clocks
                           284             
                           285             
                           286             ;Display On;
                           287             
010B 33C0                  288             XOR AX, AX
010D B020                  289             MOV AL, 00100000b
010F BA8100                290             MOV DX, B_8255
0112 EE                    291             OUT DX, AL
                           292             
0113 33C0                  293             XOR AX, AX
0115 B00C                  294             MOV AL, 00001100b
0117 BA8200                295             MOV DX, C_8255
011A EE                    296             OUT DX, AL
                           297             
011B 33C0                  298             XOR AX, AX
011D B000                  299             MOV AL, 00000000b
011F BA8100                300             MOV DX, B_8255
0122 EE                    301             OUT DX, AL
                           302             
                           303             ; 40 us delay;
0123 B91E00                304             MOV CX, 001Eh ; 30 dec
0126                       305             loop40us4:      
0126 90                    306                     NOP        ; 3 clocks
0127 49                    307                     DEC CX     ; 3 clocks
0128 75FC                  308             JNZ loop40us4 ; 16 clocks
                           309             
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:38:32  10/13/;3  PAGE    7


LOC  OBJ                  LINE     SOURCE

                           310     
012A CB                    311     RET
                           312     LCD_INIT ENDP
                           313     
012B                       314     MESSAGE_LCD     PROC FAR
012B 50                    315             PUSH AX
012C 53                    316             PUSH BX
012D 51                    317             PUSH CX
012E 52                    318             PUSH DX
                           319     
                           320             ;Display Clear;
                           321             
012F 33C0                  322             XOR AX, AX
0131 B020                  323             MOV AL, 00100000b
0133 BA8100                324             MOV DX, B_8255
0136 EE                    325             OUT DX, AL
                           326             
0137 33C0                  327             XOR AX, AX
0139 B001                  328             MOV AL, 00000001b
013B BA8200                329             MOV DX, C_8255
013E EE                    330             OUT DX, AL
                           331             
013F 33C0                  332             XOR AX, AX
0141 B000                  333             MOV AL, 00000000b
0143 BA8100                334             MOV DX, B_8255
0146 EE                    335             OUT DX, AL
                           336             
                           337             ; 1.6ms delay;
0147 B98C04                338             MOV CX, 048Ch ; 30 dec
014A                       339             loop1point6ms2: 
014A 90                    340                     NOP        ; 3 clocks
014B 49                    341                     DEC CX     ; 3 clocks
014C 75FC                  342             JNZ loop1point6ms2 ; 16 clocks
                           343             
014E 33DB                  344             XOR BX, BX
0150 8A1E7200              345             MOV BL, DS:INPUT_SIZE
0154 80FB00                346             CMP BL, 0
0157 7503                  347             JNE display
0159 E99C00                348             JMP overfunc
                           349             
015C                       350             display:
015C 33D2                  351             XOR DX, DX
015E 8A167200              352             MOV DL, DS:INPUT_SIZE
0162 2AD3                  353             SUB DL, BL
0164 80FA10                354             CMP DL, 10h
0167 7403                  355             JE address
0169 EB2090                356             JMP continue
                           357             
016C                       358             address:
                           359             ;Setting Addres of DDRAM;       
016C 33C0                  360             XOR AX, AX
016E B020                  361             MOV AL, 00100000b
0170 BA8100                362             MOV DX, B_8255
0173 EE                    363             OUT DX, AL
                           364             
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:38:32  10/13/;3  PAGE    8


LOC  OBJ                  LINE     SOURCE

0174 33C0                  365             XOR AX, AX
0176 B0C0                  366             MOV AL, 11000000b
0178 BA8200                367             MOV DX, C_8255
017B EE                    368             OUT DX, AL
                           369             
017C 33C0                  370             XOR AX, AX
017E B000                  371             MOV AL, 00000000b
0180 BA8100                372             MOV DX, B_8255
0183 EE                    373             OUT DX, AL
                           374             
                           375             ; 40 us delay;
0184 B91E00                376             MOV CX, 001Eh ; 30 dec
0187                       377             loop40us30:     
0187 90                    378                     NOP        ; 3 clocks
0188 49                    379                     DEC CX     ; 3 clocks
0189 75FC                  380             JNZ loop40us30 ; 16 clocks
                           381             
018B                       382             continue:
                           383             ;Letter Begin;
                           384             
                           385             ;Writing Data to DDRAM;
018B 33C0                  386             XOR AX, AX
018D B0A0                  387             MOV AL, 10100000b
018F BA8100                388             MOV DX, B_8255
0192 EE                    389             OUT DX, AL
                           390             
0193 8BD3                  391             MOV DX, BX
0195 8A1E7200              392             MOV BL, DS:INPUT_SIZE
0199 2ADA                  393             SUB BL, DL
019B 33C0                  394             XOR AX, AX
019D 8A4752                395             MOV AL, DS:INPUT[BX]
01A0 8BDA                  396             MOV BX, DX
01A2 BA8200                397             MOV DX, C_8255
01A5 EE                    398             OUT DX, AL
                           399             
01A6 33C0                  400             XOR AX, AX
01A8 B080                  401             MOV AL, 10000000b
01AA BA8100                402             MOV DX, B_8255
01AD EE                    403             OUT DX, AL
                           404             
                           405             ;Letter End;
                           406     
                           407     ; 40 us delay;
01AE B91E00                408             MOV CX, 001Eh ; 30 dec
01B1                       409             loop40us5:      
01B1 90                    410                     NOP        ; 3 clocks
01B2 49                    411                     DEC CX     ; 3 clocks
01B3 75FC                  412             JNZ loop40us5 ; 16 clocks
                           413     
01B5 4B                    414             DEC BX
01B6 75A4                  415             JNZ display
                           416             
                           417             ; 40 us delay;
01B8 B9FFFF                418             MOV CX, 0FFFFh ; 30 dec
01BB                       419             looplong:       
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:38:32  10/13/;3  PAGE    9


LOC  OBJ                  LINE     SOURCE

01BB 90                    420                     NOP        ; 3 clocks
01BC 90                    421                     NOP        ; 3 clocks
01BD 90                    422                     NOP        ; 3 clocks
01BE 90                    423                     NOP        ; 3 clocks
01BF 90                    424                     NOP        ; 3 clocks
01C0 90                    425                     NOP        ; 3 clocks
01C1 90                    426                     NOP        ; 3 clocks
01C2 90                    427                     NOP        ; 3 clocks
01C3 90                    428                     NOP        ; 3 clocks
01C4 90                    429                     NOP        ; 3 clocks
01C5 90                    430                     NOP        ; 3 clocks
01C6 90                    431                     NOP        ; 3 clocks
01C7 90                    432                     NOP        ; 3 clocks
01C8 90                    433                     NOP        ; 3 clocks
01C9 90                    434                     NOP        ; 3 clocks
01CA 90                    435                     NOP        ; 3 clocks
01CB 90                    436                     NOP        ; 3 clocks
01CC 90                    437                     NOP        ; 3 clocks
01CD 90                    438                     NOP        ; 3 clocks
01CE 90                    439                     NOP        ; 3 clocks
01CF 90                    440                     NOP        ; 3 clocks
01D0 90                    441                     NOP        ; 3 clocks
01D1 90                    442                     NOP        ; 3 clocks
01D2 90                    443                     NOP        ; 3 clocks
01D3 90                    444                     NOP        ; 3 clocks
01D4 90                    445                     NOP        ; 3 clocks
01D5 90                    446                     NOP        ; 3 clock
01D6 49                    447                     DEC CX     ; 3 clocks
01D7 75E2                  448             JNZ looplong ; 16 clocks
                           449             
                           450             ;Display Clear;
                           451             
01D9 33C0                  452             XOR AX, AX
01DB B020                  453             MOV AL, 00100000b
01DD BA8100                454             MOV DX, B_8255
01E0 EE                    455             OUT DX, AL
                           456             
01E1 33C0                  457             XOR AX, AX
01E3 B001                  458             MOV AL, 00000001b
01E5 BA8200                459             MOV DX, C_8255
01E8 EE                    460             OUT DX, AL
                           461             
01E9 33C0                  462             XOR AX, AX
01EB B000                  463             MOV AL, 00000000b
01ED BA8100                464             MOV DX, B_8255
01F0 EE                    465             OUT DX, AL
                           466             
                           467             ; 1.6ms delay;
01F1 B98C04                468             MOV CX, 048Ch ; 30 dec
01F4                       469             loop1point6ms3: 
01F4 90                    470                     NOP        ; 3 clocks
01F5 49                    471                     DEC CX     ; 3 clocks
01F6 75FC                  472             JNZ loop1point6ms3 ; 16 clocks
01F8                       473     overfunc:
01F8 5A                    474             POP DX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:38:32  10/13/;3  PAGE   10


LOC  OBJ                  LINE     SOURCE

01F9 59                    475             POP CX
01FA 5B                    476             POP BX
01FB 58                    477             POP AX
01FC CB                    478             RET
                           479     MESSAGE_LCD     ENDP
                           480     
01FD                       481     CLEAR_LCD PROC FAR
01FD 50                    482             PUSH AX
01FE 53                    483             PUSH BX
01FF 51                    484             PUSH CX
0200 52                    485             PUSH DX
                           486             ;Display Clear;
                           487             
0201 33C0                  488             XOR AX, AX
0203 B020                  489             MOV AL, 00100000b
0205 BA8100                490             MOV DX, B_8255
0208 EE                    491             OUT DX, AL
                           492             
0209 33C0                  493             XOR AX, AX
020B B001                  494             MOV AL, 00000001b
020D BA8200                495             MOV DX, C_8255
0210 EE                    496             OUT DX, AL
                           497             
0211 33C0                  498             XOR AX, AX
0213 B000                  499             MOV AL, 00000000b
0215 BA8100                500             MOV DX, B_8255
0218 EE                    501             OUT DX, AL
                           502             
                           503             ; 1.6ms delay;
0219 B98C04                504             MOV CX, 048Ch ; 30 dec
021C                       505             loop1point6ms2_1:       
021C 90                    506                     NOP        ; 3 clocks
021D 49                    507                     DEC CX     ; 3 clocks
021E 75FC                  508             JNZ loop1point6ms2_1 ; 16 clocks
                           509             
                           510             ;Setting Address of DDRAM;
                           511             
0220 33C0                  512             XOR AX, AX
0222 B020                  513             MOV AL, 00100000b
0224 BA8100                514             MOV DX, B_8255
0227 EE                    515             OUT DX, AL
                           516             
0228 33C0                  517             XOR AX, AX
022A B080                  518             MOV AL, 10000000b
022C BA8200                519             MOV DX, C_8255
022F EE                    520             OUT DX, AL
                           521             
0230 33C0                  522             XOR AX, AX
0232 B000                  523             MOV AL, 00000000b
0234 BA8100                524             MOV DX, B_8255
0237 EE                    525             OUT DX, AL
                           526             
                           527             ; 40 us delay;
0238 B91E00                528             MOV CX, 001Eh ; 30 dec
023B                       529             loop40us3_1:    
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:38:32  10/13/;3  PAGE   11


LOC  OBJ                  LINE     SOURCE

023B 90                    530                     NOP        ; 3 clocks
023C 49                    531                     DEC CX     ; 3 clocks
023D 75FC                  532             JNZ loop40us3_1 ; 16 clocks
                           533             
023F B300                  534             MOV BL, 0
0241 881E7200              535             MOV DS:INPUT_SIZE, BL
                           536             
0245 5A                    537             POP DX
0246 59                    538             POP CX
0247 5B                    539             POP BX
0248 58                    540             POP AX
0249 CB                    541     RET
                           542     CLEAR_LCD ENDP
                           543     
                           544     ; ^^^^^^^^^^^^^^^ End of User main routine ^^^^^^^^^^^^^^^^^^^^^^^^^
024A                       545     SERIAL_REC_ACTION       PROC    FAR
024A 51                    546                     PUSH    CX
024B 53                    547                     PUSH    BX
024C 1E                    548                     PUSH    DS
                           549                     
024D BB----         R      550                     MOV     BX,DATA_SEG             ;initialize data segment register
0250 8EDB                  551                     MOV     DS,BX
                           552                     
0252 3C7E                  553                     CMP AL, '~'
0254 7508                  554                     JNE resume
                           555                     
0256 9AFD01----     R      556                     CALL FAR PTR CLEAR_LCD
025B EB4490                557                     JMP S_RET
                           558                     
025E                       559                     resume:
025E 33DB                  560                     XOR BX, BX
0260 8A1E7200              561                     MOV BL, DS:INPUT_SIZE
0264 884752                562                     MOV DS:INPUT[BX], AL
0267 FEC3                  563                     INC BL
0269 881E7200              564                     MOV DS:INPUT_SIZE, BL
                           565                     
026D                       566                     continue3:
                           567                     
026D 3C3C                  568                     CMP     AL,'<'
026F 750B                  569                     JNE     S_FAST
                           570     
0271 FE061700              571                     INC     DS:T_COUNT_SET
0275 FE061700              572                     INC     DS:T_COUNT_SET
                           573     
0279 EB0D90                574                     JMP     S_NEXT0
027C                       575     S_FAST:
027C 3C3E                  576                     CMP     AL,'>'
027E 7521                  577                     JNE     S_RET
                           578     
0280 FE0E1700              579                     DEC     DS:T_COUNT_SET
0284 FE0E1700              580                     DEC     DS:T_COUNT_SET
                           581     
0288                       582     S_NEXT0:
0288 B91600                583                     MOV     CX,22                   ;initialize counter for message
028B BB0000                584                     MOV     BX,0
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:38:32  10/13/;3  PAGE   12


LOC  OBJ                  LINE     SOURCE

                           585     
028E 8A4718                586     S_NEXT1:        MOV     AL,DS:REC_MESS[BX]      ;print message
0291 9A0000----     E      587                     call    FAR ptr print_char
0296 43                    588                     INC     BX
0297 E2F5                  589                     LOOP    S_NEXT1
                           590     
0299 A01700                591                     MOV     AL,DS:T_COUNT_SET       ;print current period of timer0
029C 9A0000----     E      592                     CALL    FAR PTR PRINT_2HEX
02A1                       593     S_RET:
02A1 1F                    594                     POP     DS
02A2 5B                    595                     POP     BX
02A3 59                    596                     POP     CX
02A4 CB                    597                     RET
                           598     SERIAL_REC_ACTION       ENDP
                           599     
                           600     
                           601     
02A5                       602     TIMER2_ACTION   PROC    FAR
02A5 50                    603                     PUSH    AX
02A6 1E                    604                     PUSH    DS
02A7 53                    605                     PUSH    BX
02A8 51                    606                     PUSH    CX
                           607     
02A9 B8----         R      608                     MOV     AX,DATA_SEG
02AC 8ED8                  609                     MOV     DS,AX
                           610             
02AE FE0E1600              611                     DEC     DS:T_COUNT
02B2 7516                  612                     JNZ     T_NEXT1
02B4 A01700                613                     MOV     AL,DS:T_COUNT_SET
02B7 A21600                614                     MOV     DS:T_COUNT,AL
                           615     
02BA B91400                616                     MOV     CX,20
02BD BB0000                617                     MOV     BX,0H
02C0                       618     T_NEXT0:
02C0 8A07                  619                     MOV     AL,DS:TIMER0_MESS[BX]
02C2 43                    620                     INC     BX
02C3 9A0000----     E      621                     CALL    FAR PTR PRINT_CHAR
02C8 E2F6                  622                     LOOP    T_NEXT0
                           623     
02CA                       624     T_NEXT1:        
02CA 59                    625                     POP     CX
02CB 5B                    626                     POP     BX
02CC 1F                    627                     POP     DS
02CD 58                    628                     POP     AX
02CE CB                    629                     RET
                           630     TIMER2_ACTION   ENDP
                           631     
                           632     
----                       633     CODE_SEG        ENDS
                           634     END

ASSEMBLY COMPLETE, NO ERRORS FOUND
