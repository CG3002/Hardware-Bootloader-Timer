8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:06:23  10/13/;3  PAGE    1


DOS 5.0 (038-N) 8086/87/88/186 MACRO ASSEMBLER V3.1 ASSEMBLY OF MODULE TIMER
OBJECT MODULE PLACED IN TIMER.OBJ
ASSEMBLER INVOKED BY:  D:\ASM86.EXE TIMER.ASM


LOC  OBJ                  LINE     SOURCE

                             1 +1  $MOD186
                             2 +1  $EP
                             3     NAME TIMER
                             4     ; Main program for uPD70208 microcomputer system
                             5     ;
                             6     ; Author:       Dr Tay Teng Tiow
                             7     ; Address:      Department of Electrical Engineering 
                             8     ;               National University of Singapore
                             9     ;               10, Kent Ridge Crescent
                            10     ;               Singapore 0511. 
                            11     ; Date:         6th September 1991
                            12     ;
                            13     ; This file contains proprietory information and cannot be copied 
                            14     ; or distributed without prior permission from the author.
                            15     ; =========================================================================
                            16     
                            17     public  serial_rec_action, timer2_action
                            18     extrn   print_char:far, print_2hex:far, iodefine:far
                            19     extrn   set_timer2:far
                            20     
                            21     ;IO Setup for 80C188 
  FFA0                      22             UMCR    EQU    0FFA0H ; Upper Memory Control Register
  FFA2                      23             LMCR    EQU    0FFA2H ; Lower Memory control Register         
  FFA4                      24             PCSBA   EQU    0FFA4H ; Peripheral Chip Select Base Address
  FFA8                      25             MPCS    EQU    0FFA8H ; MMCS and PCS Alter Control Register
  0080                      26             A_8255  EQU    0080H
  0081                      27             B_8255  EQU    0081H
  0082                      28             C_8255  EQU    0082H
  0083                      29             CWR_8255  EQU    0083H
  FF38                      30             INT0CON  EQU   0FF38H
  FF22                      31             EOI EQU 0FF22H
  FF28                      32             IMASK EQU 0FF28H
                            33     
----                        34     STACK_SEG       SEGMENT
0000 (256                   35                     DB      256 DUP(?)
     ??
     )
0100                        36             TOS     LABEL   WORD
----                        37     STACK_SEG       ENDS
                            38     
                            39     
----                        40     DATA_SEG        SEGMENT
0000 0A                     41             TIMER0_MESS     DB      10,13,'TIMER2 INTERRUPT    '
0001 0D
0002 54494D45523220
     494E5445525255
     505420202020
0016 2F                     42             T_COUNT         DB      2FH
0017 2F                     43             T_COUNT_SET     DB      2FH
0018 0A                     44             REC_MESS        DB      10,13,'Period of timer0 =     '
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:06:23  10/13/;3  PAGE    2


LOC  OBJ                  LINE     SOURCE

0019 0D
001A 506572696F6420
     6F662074696D65
     7230203D202020
     2020
0031 (32                    45             MESSAGE     DB  32 dup('h')
     68
     )
0051 20                     46             M_SIZE          DB  32
0052 (32                    47             INPUT       DB  32 dup('q')
     71
     )
0072 00                     48             INPUT_SIZE  DB  0
0073 00                     49             FLAG            DB  0
0074 ??                     50             CHAR            DB  ?
----                        51     DATA_SEG        ENDS
                            52     
                            53     
----                        54     CODE_SEG        SEGMENT
                            55     
                            56             PUBLIC          START
                            57     
                            58     ASSUME  CS:CODE_SEG, SS:STACK_SEG
                            59     
0000                        60     START:
                            61     ;initialize stack area
0000 B8----         R       62                     MOV     AX,STACK_SEG            
0003 8ED0                   63                     MOV     SS,AX
0005 368B260001             64                     MOV     SP,TOS
                            65     
                            66     ; Initialize the on-chip pheripherals
000A 9A0000----     E       67                     CALL    FAR PTR IODEFINE
                            68                     
000F 9A0000----     E       69     call set_timer2
0014 FB                     70                      STI
                            71     
                            72     ; ^^^^^^^^^^^^^^^^^  Start of User Main Routine  ^^^^^^^^^^^^^^^^^^
                            73        
                            74     ; Initialize MPCS to MAP peripheral to IO address
                            75             
0015 BAA8FF                 76             MOV DX, MPCS
0018 B88300                 77             MOV AX, 0083H
001B EF                     78             OUT DX, AX
                            79     
                            80     ; PCSBA initial, set the parallel port start from 00H
001C BAA4FF                 81             MOV DX, PCSBA
001F B80300                 82             MOV AX, 0003H ; Peripheral starting address 00H no READY, No Waits
0022 EF                     83             OUT DX, AX
                            84     
                            85     ; Initialize LMCS 
0023 BAA2FF                 86         MOV DX, LMCR
0026 B8C401                 87         MOV AX, 01C4H  ; Starting address 1FFFH, 8K, No waits, last shoud be 5H for 1 wai
                                   ts      
0029 EF                     88         OUT DX, AX
                            89     
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:06:23  10/13/;3  PAGE    3


LOC  OBJ                  LINE     SOURCE

002A B8----         R       90             MOV AX, DATA_SEG
002D 8ED8                   91             MOV DS, AX
                            92                              
002F BA8300                 93             MOV DX, CWR_8255
0032 B88000                 94             MOV AX, 0080h
0035 EF                     95             OUT DX, AX
                            96             
0036 BA8000                 97             MOV DX, A_8255
0039 B023                   98             MOV AL, 23h
003B F6D0                   99             NOT AL
003D EE                    100             OUT DX, AL
                           101     
                           102     ; LCD Initialization ;
                           103     
                           104     ;Function set 1;
                           105     ; 60 ms delay ;
003E B975AA                106             MOV CX, 0AA75h ; 43637 dec
0041                       107             loop60ms:       
0041 90                    108                     NOP        ; 3 clocks
0042 49                    109                     DEC CX     ; 3 clocks
0043 75FC                  110             JNZ loop60ms ; 16 clocks
                           111             
0045 33C0                  112             XOR AX, AX
0047 B020                  113             MOV AL, 00100000b
0049 BA8100                114             MOV DX, B_8255
004C EE                    115             OUT DX, AL
                           116             
004D 33C0                  117             XOR AX, AX
004F B03C                  118             MOV AL, 00111100b
0051 BA8200                119             MOV DX, C_8255
0054 EE                    120             OUT DX, AL
                           121             
0055 33C0                  122             XOR AX, AX
0057 B000                  123             MOV AL, 00000000b
0059 BA8100                124             MOV DX, B_8255
005C EE                    125             OUT DX, AL
                           126             
                           127     
                           128     ;Function set 2;
                           129     ; 5 ms delay;
005D B9350E                130             MOV CX, 0E35h ; 3637 dec
0060                       131             loop5ms:        
0060 90                    132                     NOP        ; 3 clocks
0061 49                    133                     DEC CX     ; 3 clocks
0062 75FC                  134             JNZ loop5ms ; 16 clocks
                           135             
0064 33C0                  136             XOR AX, AX
0066 B020                  137             MOV AL, 00100000b
0068 BA8100                138             MOV DX, B_8255
006B EE                    139             OUT DX, AL
                           140             
006C 33C0                  141             XOR AX, AX
006E B03C                  142             MOV AL, 00111100b
0070 BA8200                143             MOV DX, C_8255
0073 EE                    144             OUT DX, AL
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:06:23  10/13/;3  PAGE    4


LOC  OBJ                  LINE     SOURCE

                           145             
0074 33C0                  146             XOR AX, AX
0076 B000                  147             MOV AL, 00000000b
0078 BA8100                148             MOV DX, B_8255
007B EE                    149             OUT DX, AL
                           150             
                           151             
                           152     ;Function set 3;
                           153     ; 100 us delay;
007C B94900                154             MOV CX, 0049h ; 73 dec
007F                       155             loop4point100us:        
007F 90                    156                     NOP        ; 3 clocks
0080 49                    157                     DEC CX     ; 3 clocks
0081 75FC                  158             JNZ loop4point100us ; 16 clocks
                           159             
0083 33C0                  160             XOR AX, AX
0085 B020                  161             MOV AL, 00100000b
0087 BA8100                162             MOV DX, B_8255
008A EE                    163             OUT DX, AL
                           164             
008B 33C0                  165             XOR AX, AX
008D B03C                  166             MOV AL, 00111100b
008F BA8200                167             MOV DX, C_8255
0092 EE                    168             OUT DX, AL
                           169             
0093 33C0                  170             XOR AX, AX
0095 B000                  171             MOV AL, 00000000b
0097 BA8100                172             MOV DX, B_8255
009A EE                    173             OUT DX, AL
                           174                     
                           175             ; 40 us delay;
009B B91E00                176             MOV CX, 001Eh ; 30 dec
009E                       177             loop40us:       
009E 90                    178                     NOP        ; 3 clocks
009F 49                    179                     DEC CX     ; 3 clocks
00A0 75FC                  180             JNZ loop40us ; 16 clocks
                           181             
                           182             ;Display Clear;
                           183             
00A2 33C0                  184             XOR AX, AX
00A4 B020                  185             MOV AL, 00100000b
00A6 BA8100                186             MOV DX, B_8255
00A9 EE                    187             OUT DX, AL
                           188             
00AA 33C0                  189             XOR AX, AX
00AC B001                  190             MOV AL, 00000001b
00AE BA8200                191             MOV DX, C_8255
00B1 EE                    192             OUT DX, AL
                           193             
00B2 33C0                  194             XOR AX, AX
00B4 B000                  195             MOV AL, 00000000b
00B6 BA8100                196             MOV DX, B_8255
00B9 EE                    197             OUT DX, AL
                           198             
                           199             ; 1.6ms delay;
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:06:23  10/13/;3  PAGE    5


LOC  OBJ                  LINE     SOURCE

00BA B98C04                200             MOV CX, 048Ch ; 30 dec
00BD                       201             loop1point6ms:  
00BD 90                    202                     NOP        ; 3 clocks
00BE 49                    203                     DEC CX     ; 3 clocks
00BF 75FC                  204             JNZ loop1point6ms ; 16 clocks
                           205             
                           206             
                           207             ;Entry Mode Set;
                           208             
00C1 33C0                  209             XOR AX, AX
00C3 B020                  210             MOV AL, 00100000b
00C5 BA8100                211             MOV DX, B_8255
00C8 EE                    212             OUT DX, AL
                           213             
00C9 33C0                  214             XOR AX, AX
00CB B006                  215             MOV AL, 00000110b
00CD BA8200                216             MOV DX, C_8255
00D0 EE                    217             OUT DX, AL
                           218             
00D1 33C0                  219             XOR AX, AX
00D3 B000                  220             MOV AL, 00000000b
00D5 BA8100                221             MOV DX, B_8255
00D8 EE                    222             OUT DX, AL
                           223             
                           224             ; 40 us delay;
00D9 B91E00                225             MOV CX, 001Eh ; 30 dec
00DC                       226             loop40us2:      
00DC 90                    227                     NOP        ; 3 clocks
00DD 49                    228                     DEC CX     ; 3 clocks
00DE 75FC                  229             JNZ loop40us2 ; 16 clocks
                           230             
                           231             
                           232             ;Setting Address of DDRAM;
                           233             
00E0 33C0                  234             XOR AX, AX
00E2 B020                  235             MOV AL, 00100000b
00E4 BA8100                236             MOV DX, B_8255
00E7 EE                    237             OUT DX, AL
                           238             
00E8 33C0                  239             XOR AX, AX
00EA B080                  240             MOV AL, 10000000b
00EC BA8200                241             MOV DX, C_8255
00EF EE                    242             OUT DX, AL
                           243             
00F0 33C0                  244             XOR AX, AX
00F2 B000                  245             MOV AL, 00000000b
00F4 BA8100                246             MOV DX, B_8255
00F7 EE                    247             OUT DX, AL
                           248             
                           249             ; 40 us delay;
00F8 B91E00                250             MOV CX, 001Eh ; 30 dec
00FB                       251             loop40us3:      
00FB 90                    252                     NOP        ; 3 clocks
00FC 49                    253                     DEC CX     ; 3 clocks
00FD 75FC                  254             JNZ loop40us3 ; 16 clocks
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:06:23  10/13/;3  PAGE    6


LOC  OBJ                  LINE     SOURCE

                           255             
                           256             
                           257             ;Display On;
                           258             
00FF 33C0                  259             XOR AX, AX
0101 B020                  260             MOV AL, 00100000b
0103 BA8100                261             MOV DX, B_8255
0106 EE                    262             OUT DX, AL
                           263             
0107 33C0                  264             XOR AX, AX
0109 B00C                  265             MOV AL, 00001100b
010B BA8200                266             MOV DX, C_8255
010E EE                    267             OUT DX, AL
                           268             
010F 33C0                  269             XOR AX, AX
0111 B000                  270             MOV AL, 00000000b
0113 BA8100                271             MOV DX, B_8255
0116 EE                    272             OUT DX, AL
                           273             
                           274             ; 40 us delay;
0117 B91E00                275             MOV CX, 001Eh ; 30 dec
011A                       276             loop40us4:      
011A 90                    277                     NOP        ; 3 clocks
011B 49                    278                     DEC CX     ; 3 clocks
011C 75FC                  279             JNZ loop40us4 ; 16 clocks
                           280             
                           281             
                           282     
011E                       283     NEXT:
                           284             ; Begin 
                           285             
                           286             
                           287             ; XOR AX, AX
                           288             ; MOV AL, DS:M_SIZE1
                           289             ; MOV DS:M_SIZE, AL
                           290             
                           291             ; displayloop:
                           292             ; XOR BX, BX
                           293             ; MOV BL, DS:M_SIZE1
                           294             ; SUB BL, AL
                           295     
                           296             ; MOV DL, DS:MESSAGE_1[BX]
                           297             ; MOV DS:MESSAGE[BX], DL
                           298             
                           299             ; DEC AL
                           300             ; JNZ displayloop
                           301             
011E 9A2501----     R      302             CALL FAR PTR MESSAGE_LCD
                           303             
                           304             
0123 EBF9                  305     JMP NEXT
                           306     
0125                       307     MESSAGE_LCD     PROC FAR
0125 50                    308             PUSH AX
0126 53                    309             PUSH BX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:06:23  10/13/;3  PAGE    7


LOC  OBJ                  LINE     SOURCE

0127 51                    310             PUSH CX
0128 52                    311             PUSH DX
                           312     
                           313             ;Display Clear;
                           314             
0129 33C0                  315             XOR AX, AX
012B B020                  316             MOV AL, 00100000b
012D BA8100                317             MOV DX, B_8255
0130 EE                    318             OUT DX, AL
                           319             
0131 33C0                  320             XOR AX, AX
0133 B001                  321             MOV AL, 00000001b
0135 BA8200                322             MOV DX, C_8255
0138 EE                    323             OUT DX, AL
                           324             
0139 33C0                  325             XOR AX, AX
013B B000                  326             MOV AL, 00000000b
013D BA8100                327             MOV DX, B_8255
0140 EE                    328             OUT DX, AL
                           329             
                           330             ; 1.6ms delay;
0141 B98C04                331             MOV CX, 048Ch ; 30 dec
0144                       332             loop1point6ms2: 
0144 90                    333                     NOP        ; 3 clocks
0145 49                    334                     DEC CX     ; 3 clocks
0146 75FC                  335             JNZ loop1point6ms2 ; 16 clocks
                           336             
0148 33DB                  337             XOR BX, BX
014A 8A1E7200              338             MOV BL, DS:INPUT_SIZE
014E 80FB00                339             CMP BL, 0
0151 7503                  340             JNE display
0153 E99C00                341             JMP overfunc
                           342             
0156                       343             display:
0156 33D2                  344             XOR DX, DX
0158 8A167200              345             MOV DL, DS:INPUT_SIZE
015C 2AD3                  346             SUB DL, BL
015E 80FA10                347             CMP DL, 10h
0161 7403                  348             JE address
0163 EB2090                349             JMP continue
                           350             
0166                       351             address:
                           352             ;Setting Addres of DDRAM;       
0166 33C0                  353             XOR AX, AX
0168 B020                  354             MOV AL, 00100000b
016A BA8100                355             MOV DX, B_8255
016D EE                    356             OUT DX, AL
                           357             
016E 33C0                  358             XOR AX, AX
0170 B0C0                  359             MOV AL, 11000000b
0172 BA8200                360             MOV DX, C_8255
0175 EE                    361             OUT DX, AL
                           362             
0176 33C0                  363             XOR AX, AX
0178 B000                  364             MOV AL, 00000000b
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:06:23  10/13/;3  PAGE    8


LOC  OBJ                  LINE     SOURCE

017A BA8100                365             MOV DX, B_8255
017D EE                    366             OUT DX, AL
                           367             
                           368             ; 40 us delay;
017E B91E00                369             MOV CX, 001Eh ; 30 dec
0181                       370             loop40us30:     
0181 90                    371                     NOP        ; 3 clocks
0182 49                    372                     DEC CX     ; 3 clocks
0183 75FC                  373             JNZ loop40us30 ; 16 clocks
                           374             
0185                       375             continue:
                           376             ;Letter Begin;
                           377             
                           378             ;Writing Data to DDRAM;
0185 33C0                  379             XOR AX, AX
0187 B0A0                  380             MOV AL, 10100000b
0189 BA8100                381             MOV DX, B_8255
018C EE                    382             OUT DX, AL
                           383             
018D 8BD3                  384             MOV DX, BX
018F 8A1E7200              385             MOV BL, DS:INPUT_SIZE
0193 2ADA                  386             SUB BL, DL
0195 33C0                  387             XOR AX, AX
0197 8A4752                388             MOV AL, DS:INPUT[BX]
019A 8BDA                  389             MOV BX, DX
019C BA8200                390             MOV DX, C_8255
019F EE                    391             OUT DX, AL
                           392             
01A0 33C0                  393             XOR AX, AX
01A2 B080                  394             MOV AL, 10000000b
01A4 BA8100                395             MOV DX, B_8255
01A7 EE                    396             OUT DX, AL
                           397             
                           398             ;Letter End;
                           399     
                           400     ; 40 us delay;
01A8 B91E00                401             MOV CX, 001Eh ; 30 dec
01AB                       402             loop40us5:      
01AB 90                    403                     NOP        ; 3 clocks
01AC 49                    404                     DEC CX     ; 3 clocks
01AD 75FC                  405             JNZ loop40us5 ; 16 clocks
                           406     
01AF 4B                    407             DEC BX
01B0 75A4                  408             JNZ display
                           409             
                           410             ; 40 us delay;
01B2 B9FFFF                411             MOV CX, 0FFFFh ; 30 dec
01B5                       412             looplong:       
01B5 90                    413                     NOP        ; 3 clocks
01B6 90                    414                     NOP        ; 3 clocks
01B7 90                    415                     NOP        ; 3 clocks
01B8 90                    416                     NOP        ; 3 clocks
01B9 90                    417                     NOP        ; 3 clocks
01BA 90                    418                     NOP        ; 3 clocks
01BB 90                    419                     NOP        ; 3 clocks
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:06:23  10/13/;3  PAGE    9


LOC  OBJ                  LINE     SOURCE

01BC 90                    420                     NOP        ; 3 clocks
01BD 90                    421                     NOP        ; 3 clocks
01BE 90                    422                     NOP        ; 3 clocks
01BF 90                    423                     NOP        ; 3 clocks
01C0 90                    424                     NOP        ; 3 clocks
01C1 90                    425                     NOP        ; 3 clocks
01C2 90                    426                     NOP        ; 3 clocks
01C3 90                    427                     NOP        ; 3 clocks
01C4 90                    428                     NOP        ; 3 clocks
01C5 90                    429                     NOP        ; 3 clocks
01C6 90                    430                     NOP        ; 3 clocks
01C7 90                    431                     NOP        ; 3 clocks
01C8 90                    432                     NOP        ; 3 clocks
01C9 90                    433                     NOP        ; 3 clocks
01CA 90                    434                     NOP        ; 3 clocks
01CB 90                    435                     NOP        ; 3 clocks
01CC 90                    436                     NOP        ; 3 clocks
01CD 90                    437                     NOP        ; 3 clocks
01CE 90                    438                     NOP        ; 3 clocks
01CF 90                    439                     NOP        ; 3 clock
01D0 49                    440                     DEC CX     ; 3 clocks
01D1 75E2                  441             JNZ looplong ; 16 clocks
                           442             
                           443             ;Display Clear;
                           444             
01D3 33C0                  445             XOR AX, AX
01D5 B020                  446             MOV AL, 00100000b
01D7 BA8100                447             MOV DX, B_8255
01DA EE                    448             OUT DX, AL
                           449             
01DB 33C0                  450             XOR AX, AX
01DD B001                  451             MOV AL, 00000001b
01DF BA8200                452             MOV DX, C_8255
01E2 EE                    453             OUT DX, AL
                           454             
01E3 33C0                  455             XOR AX, AX
01E5 B000                  456             MOV AL, 00000000b
01E7 BA8100                457             MOV DX, B_8255
01EA EE                    458             OUT DX, AL
                           459             
                           460             ; 1.6ms delay;
01EB B98C04                461             MOV CX, 048Ch ; 30 dec
01EE                       462             loop1point6ms3: 
01EE 90                    463                     NOP        ; 3 clocks
01EF 49                    464                     DEC CX     ; 3 clocks
01F0 75FC                  465             JNZ loop1point6ms3 ; 16 clocks
01F2                       466     overfunc:
01F2 5A                    467             POP DX
01F3 59                    468             POP CX
01F4 5B                    469             POP BX
01F5 58                    470             POP AX
01F6 CB                    471             RET
                           472     MESSAGE_LCD     ENDP
                           473     
01F7                       474     CLEAR_LCD PROC FAR
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:06:23  10/13/;3  PAGE   10


LOC  OBJ                  LINE     SOURCE

01F7 50                    475             PUSH AX
01F8 53                    476             PUSH BX
01F9 51                    477             PUSH CX
01FA 52                    478             PUSH DX
                           479             ;Display Clear;
                           480             
01FB 33C0                  481             XOR AX, AX
01FD B020                  482             MOV AL, 00100000b
01FF BA8100                483             MOV DX, B_8255
0202 EE                    484             OUT DX, AL
                           485             
0203 33C0                  486             XOR AX, AX
0205 B001                  487             MOV AL, 00000001b
0207 BA8200                488             MOV DX, C_8255
020A EE                    489             OUT DX, AL
                           490             
020B 33C0                  491             XOR AX, AX
020D B000                  492             MOV AL, 00000000b
020F BA8100                493             MOV DX, B_8255
0212 EE                    494             OUT DX, AL
                           495             
                           496             ; 1.6ms delay;
0213 B98C04                497             MOV CX, 048Ch ; 30 dec
0216                       498             loop1point6ms2_1:       
0216 90                    499                     NOP        ; 3 clocks
0217 49                    500                     DEC CX     ; 3 clocks
0218 75FC                  501             JNZ loop1point6ms2_1 ; 16 clocks
                           502             
                           503             ;Setting Address of DDRAM;
                           504             
021A 33C0                  505             XOR AX, AX
021C B020                  506             MOV AL, 00100000b
021E BA8100                507             MOV DX, B_8255
0221 EE                    508             OUT DX, AL
                           509             
0222 33C0                  510             XOR AX, AX
0224 B080                  511             MOV AL, 10000000b
0226 BA8200                512             MOV DX, C_8255
0229 EE                    513             OUT DX, AL
                           514             
022A 33C0                  515             XOR AX, AX
022C B000                  516             MOV AL, 00000000b
022E BA8100                517             MOV DX, B_8255
0231 EE                    518             OUT DX, AL
                           519             
                           520             ; 40 us delay;
0232 B91E00                521             MOV CX, 001Eh ; 30 dec
0235                       522             loop40us3_1:    
0235 90                    523                     NOP        ; 3 clocks
0236 49                    524                     DEC CX     ; 3 clocks
0237 75FC                  525             JNZ loop40us3_1 ; 16 clocks
                           526             
0239 B300                  527             MOV BL, 0
023B 881E7200              528             MOV DS:INPUT_SIZE, BL
                           529             
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:06:23  10/13/;3  PAGE   11


LOC  OBJ                  LINE     SOURCE

023F 5A                    530             POP DX
0240 59                    531             POP CX
0241 5B                    532             POP BX
0242 58                    533             POP AX
0243 CB                    534     RET
                           535     CLEAR_LCD ENDP
                           536     
                           537     ; ^^^^^^^^^^^^^^^ End of User main routine ^^^^^^^^^^^^^^^^^^^^^^^^^
0244                       538     SERIAL_REC_ACTION       PROC    FAR
0244 51                    539                     PUSH    CX
0245 53                    540                     PUSH    BX
0246 1E                    541                     PUSH    DS
                           542                     
0247 BB----         R      543                     MOV     BX,DATA_SEG             ;initialize data segment register
024A 8EDB                  544                     MOV     DS,BX
                           545                     
024C 3C7E                  546                     CMP AL, '~'
024E 7508                  547                     JNE resume
                           548                     
0250 9AF701----     R      549                     CALL FAR PTR CLEAR_LCD
0255 EB4490                550                     JMP S_RET
                           551                     
0258                       552                     resume:
0258 33DB                  553                     XOR BX, BX
025A 8A1E7200              554                     MOV BL, DS:INPUT_SIZE
025E 884752                555                     MOV DS:INPUT[BX], AL
0261 FEC3                  556                     INC BL
0263 881E7200              557                     MOV DS:INPUT_SIZE, BL
                           558                     
0267                       559                     continue3:
                           560                     
0267 3C3C                  561                     CMP     AL,'<'
0269 750B                  562                     JNE     S_FAST
                           563     
026B FE061700              564                     INC     DS:T_COUNT_SET
026F FE061700              565                     INC     DS:T_COUNT_SET
                           566     
0273 EB0D90                567                     JMP     S_NEXT0
0276                       568     S_FAST:
0276 3C3E                  569                     CMP     AL,'>'
0278 7521                  570                     JNE     S_RET
                           571     
027A FE0E1700              572                     DEC     DS:T_COUNT_SET
027E FE0E1700              573                     DEC     DS:T_COUNT_SET
                           574     
0282                       575     S_NEXT0:
0282 B91600                576                     MOV     CX,22                   ;initialize counter for message
0285 BB0000                577                     MOV     BX,0
                           578     
0288 8A4718                579     S_NEXT1:        MOV     AL,DS:REC_MESS[BX]      ;print message
028B 9A0000----     E      580                     call    FAR ptr print_char
0290 43                    581                     INC     BX
0291 E2F5                  582                     LOOP    S_NEXT1
                           583     
0293 A01700                584                     MOV     AL,DS:T_COUNT_SET       ;print current period of timer0
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    17:06:23  10/13/;3  PAGE   12


LOC  OBJ                  LINE     SOURCE

0296 9A0000----     E      585                     CALL    FAR PTR PRINT_2HEX
029B                       586     S_RET:
029B 1F                    587                     POP     DS
029C 5B                    588                     POP     BX
029D 59                    589                     POP     CX
029E CB                    590                     RET
                           591     SERIAL_REC_ACTION       ENDP
                           592     
                           593     
                           594     
029F                       595     TIMER2_ACTION   PROC    FAR
029F 50                    596                     PUSH    AX
02A0 1E                    597                     PUSH    DS
02A1 53                    598                     PUSH    BX
02A2 51                    599                     PUSH    CX
                           600     
02A3 B8----         R      601                     MOV     AX,DATA_SEG
02A6 8ED8                  602                     MOV     DS,AX
                           603             
02A8 FE0E1600              604                     DEC     DS:T_COUNT
02AC 7516                  605                     JNZ     T_NEXT1
02AE A01700                606                     MOV     AL,DS:T_COUNT_SET
02B1 A21600                607                     MOV     DS:T_COUNT,AL
                           608     
02B4 B91400                609                     MOV     CX,20
02B7 BB0000                610                     MOV     BX,0H
02BA                       611     T_NEXT0:
02BA 8A07                  612                     MOV     AL,DS:TIMER0_MESS[BX]
02BC 43                    613                     INC     BX
02BD 9A0000----     E      614                     CALL    FAR PTR PRINT_CHAR
02C2 E2F6                  615                     LOOP    T_NEXT0
                           616     
02C4                       617     T_NEXT1:        
02C4 59                    618                     POP     CX
02C5 5B                    619                     POP     BX
02C6 1F                    620                     POP     DS
02C7 58                    621                     POP     AX
02C8 CB                    622                     RET
                           623     TIMER2_ACTION   ENDP
                           624     
                           625     
----                       626     CODE_SEG        ENDS
                           627     END

ASSEMBLY COMPLETE, NO ERRORS FOUND
