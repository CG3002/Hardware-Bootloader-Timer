8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    22:24:58  12/07/;3  PAGE    1


DOS 5.0 (038-N) 8086/87/88/186 MACRO ASSEMBLER V3.1 ASSEMBLY OF MODULE TIMER
OBJECT MODULE PLACED IN TIMER.OBJ
ASSEMBLER INVOKED BY:  D:\ASM86.EXE TIMER.ASM


LOC  OBJ                  LINE     SOURCE

                             1 +1  $MOD186
                             2 +1  $EP
                             3     NAME TIMER
                             4     ; Main program for uPD70208 microcomputer system
                             5     ;
                             6     ; Author:       Dr Tay Teng Tiow
                             7     ; Address:      Department of Electrical Engineering 
                             8     ;               National University of Singapore
                             9     ;               10, Kent Ridge Crescent
                            10     ;               Singapore 0511. 
                            11     ; Date:         6th September 1991
                            12     ;
                            13     ; This file contains proprietory information and cannot be copied 
                            14     ; or distributed without prior permission from the author.
                            15     ; =========================================================================
                            16     
                            17     public  serial_rec_action, timer2_action
                            18     extrn   print_char:far, print_2hex:far, iodefine:far
                            19     extrn   set_timer2:far
                            20     
                            21     ;IO Setup for 80C188 
  FFA0                      22             UMCR    EQU    0FFA0H ; Upper Memory Control Register
  FFA2                      23             LMCR    EQU    0FFA2H ; Lower Memory control Register         
  FFA4                      24             PCSBA   EQU    0FFA4H ; Peripheral Chip Select Base Address
  FFA8                      25             MPCS    EQU    0FFA8H ; MMCS and PCS Alter Control Register
  0080                      26             A_8255  EQU    0080H
  0081                      27             B_8255  EQU    0081H
  0082                      28             C_8255  EQU    0082H
  0083                      29             CWR_8255  EQU    0083H
  FF38                      30             INT0CON  EQU   0FF38H
  FF22                      31             EOI EQU 0FF22H
  FF28                      32             IMASK EQU 0FF28H
  FFA6                      33             MMCS    EQU    0FFA6H 
  4000                      34             DAC EQU 4000H
                            35     
                            36     
----                        37     STACK_SEG       SEGMENT
0000 (512                   38                     DB      512 DUP(?)
     ??
     )
0200                        39             TOS     LABEL   WORD
----                        40     STACK_SEG       ENDS
                            41     
                            42     
----                        43     DATA_SEG        SEGMENT
0000 0A                     44             TIMER0_MESS             DB      10,13,'TIMER2 INTERRUPT    '
0001 0D
0002 54494D45523220
     494E5445525255
     505420202020
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    22:24:58  12/07/;3  PAGE    2


LOC  OBJ                  LINE     SOURCE

0016 18                     45             T_COUNT                 DB      24
0017 18                     46             T_COUNT_SET             DB      24
0018 0A                     47             REC_MESS                DB      10,13,'Period of timer0 =     '
0019 0D
001A 506572696F6420
     6F662074696D65
     7230203D202020
     2020
0031 (32                    48             MESSAGE         DB  32 dup('h')
     68
     )
0051 00                     49             KEYPAD_INPUT    DB  0,0,0,0,0,0,0,0
0052 00
0053 00
0054 00
0055 00
0056 00
0057 00
0058 00
0059 2D                     50             BCD_MESSAGE     DB  '-','-','-','-','-','-'
005A 2D
005B 2D
005C 2D
005D 2D
005E 2D
005F FE                     51             ENABLE_BYTE     DB  11111110b
0060 00                     52             BCD_INDEX       DB  0
0061 0000                   53             KEYPAD_INDEX    DW      0
0063 20                     54             M_SIZE                  DB  32
0064 0040                   55             DAC_BASE        DW  4000H
0066 (15                    56             DAC_ADDR        DB  15 dup(0) 
     00
     )
0075 00                     57             DAC_LEN         DB  0
0076 0000                   58             SI_PTR          DW  0
0078 ??                     59             CHAR                    DB  ?
0079 ??                     60             REG_AL                  DB  ?
007A ??                     61             REG_BH                  DB  ?
007B ??                     62             REG_CL                  DB  ?
007C 00                     63             FLAG            DB  0
007D 00                     64             LONG_PRESS_FLAG DB      0
007E 7231                   65             MY_ID                   DB      'r1'
0080 00                     66             ID_FLAG_@               DB      0
0081 00                     67             ID_FLAG_r               DB      0
0082 4072312F               68             REPLY_MESSAGE   DB      '@r1/'
0086 40302F                 69             FAIL_MESSAGE    DB '@0/'
0089 04                     70             REPLY_COUNT             DB      4
008A 03                     71             FAIL_COUNT              DB      3
008B 00                     72             REPLY_FLAG              DB      0
008C 00                     73             SEND_FLAG       DB  0
008D (13                    74             SEND_BUFFER     DB  13 dup(0)
     00
     )
009A 0000                   75             SEND_BUFFER_LEN DW      0
009C 0000                   76             MAX_INPUT_SIZE  DW      0
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    22:24:58  12/07/;3  PAGE    3


LOC  OBJ                  LINE     SOURCE

009E 0000                   77             QTY_FLAG                DW      0
00A0 0000                   78             RECEIVE_FLAG    DW      0
00A2 0000                   79             DAC_FLAG                DW      0
00A4 0000                   80             PRICE_FLAG      DW      0
00A6 0100                   81             DECIMAL_FLAG    DW      1
00A8 0000                   82             SCROLL_LEN      DW      0
00AA 0000                   83             DAC_DISABLE     DW  0
00AC 0300                   84             DECIMAL_INDEX   DW  3
00AE 0100                   85             LANG_FLAG       DW  1
00B0 0000                   86             PRICE                   DW      0
00B2 0000                   87             QTY                             DW      0
00B4 0000                   88             TOTAL_PRICE_U   DW      0
00B6 0000                   89             TOTAL_PRICE_L   DW      0
00B8 0000                   90             TOTAL_PRICE_DEC DW      0
00BA (8                     91             TEMP_BCD_ARR    DB  8 dup(0)
     00
     )
00C2 0000                   92             THOUSAND_FLAG   DW  0
00C4 0000                   93             CENT_FLAG               DW      0
00C6 0000                   94             DOLLAR_FLAG             DW      0
00C8 0000                   95             CASH_FLAG               DW      0
00CA (8                     96             CASH_AMT        DB  8 dup(0)
     00
     )
00D2 (8                     97             TEMP_CASH_ARR   DW  8 dup(0)
     0000
     )
00E2 0000                   98             CASH_OK_FLAG    DW  0
00E4 0000                   99             BORROW_POSITION DW  0
00E6 0100                  100             CANCEL_FLAG             DW  1
00E8 0000                  101             TRANSACTION_OVER DW 0
00EA 0100                  102             DATA_ENTER              DW  1
00EC (8                    103             TROLLEY_ARRAY   DB  8 dup(0)
     00
     )
00F4 0000                  104             TROLLEY_INDEX   DW  0
00F6 0000                  105             TROLLEY_FLAG    DW  0
00F8 0000                  106             TROLLEY_ID              DW  0
00FA 0000                  107             TROLLEY_DISABLED DW 0
00FC 0000                  108             TEN_THOUSAND_FLAG DW 0
00FE 0000                  109             ZERO_TELL               DW  0
----                       110     DATA_SEG        ENDS
                           111     
                           112     
----                       113     CODE_SEG        SEGMENT
                           114     
                           115             PUBLIC          START
                           116     
                           117     ASSUME  CS:CODE_SEG, SS:STACK_SEG
                           118     
0000                       119     START:
                           120     ;initialize stack area
0000 B8----         R      121                     MOV     AX,STACK_SEG            
0003 8ED0                  122                     MOV     SS,AX
0005 368B260002            123                     MOV     SP,TOS
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    22:24:58  12/07/;3  PAGE    4


LOC  OBJ                  LINE     SOURCE

                           124                     
                           125     ; Initialize the on-chip pheripherals
000A 9A0000----     E      126                     CALL    FAR PTR IODEFINE
                           127                     
000F 9A0000----     E      128     call set_timer2
0014 FB                    129                    STI
                           130     
                           131     ; ^^^^^^^^^^^^^^^^^  Start of User Main Routine  ^^^^^^^^^^^^^^^^^^
                           132     
                           133     ;Initialize MMCS
                           134             
0015 BAA6FF                135             MOV DX, MMCS
0018 B80340                136             MOV AX, 4003H
001B EF                    137             OUT DX, AX
                           138     
                           139     ; Initialize MPCS to MAP peripheral to IO address
                           140             
001C BAA8FF                141             MOV DX, MPCS
001F B88320                142             MOV AX, 2083H
0022 EF                    143             OUT DX, AX
                           144        
                           145     ; PCSBA initial, set the parallel port start from 00H
0023 BAA4FF                146             MOV DX, PCSBA
0026 B80300                147             MOV AX, 0003H ; Peripheral starting address 00H no READY, No Waits
0029 EF                    148             OUT DX, AX
                           149     
                           150     ; Initialize LMCS 
002A BAA2FF                151         MOV DX, LMCR
002D B8C401                152         MOV AX, 01C4H  ; Starting address 1FFFH, 8K, No waits, last shoud be 5H for 1 wai
                                   ts      
0030 EF                    153         OUT DX, AX
                           154             
0031 B8----         R      155             MOV AX, DATA_SEG
0034 8ED8                  156             MOV DS, AX
                           157                              
0036 BA8300                158             MOV DX, CWR_8255
0039 B88200                159             MOV AX, 0082h
003C EF                    160             OUT DX, AX
                           161             
003D                       162     NEXT:
003D 9A4400----     R      163             CALL FAR PTR KEYPAD_LOOP
                           164             
0042 EBF9                  165     JMP NEXT
                           166     
0044                       167     KEYPAD_LOOP PROC FAR
0044 50                    168     PUSH AX
0045 53                    169     PUSH BX
0046 51                    170     PUSH CX
0047 52                    171     PUSH DX
                           172             
0048 9A9C06----     R      173                             CALL FAR PTR DEBOUNCE           
                           174                             
004D C606790003            175     WAIT_1:         MOV DS:REG_AL, 03H
0052 BB0000                176                         MOV BX, 0000H
0055 BA8200                177                         MOV DX,C_8255
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    22:24:58  12/07/;3  PAGE    5


LOC  OBJ                  LINE     SOURCE

0058 8AC3                  178                         MOV AL,BL
005A EE                    179                         OUT DX,AL
                           180                        
005B BA8100                181                         MOV DX,B_8255
005E EC                    182                         IN AL,DX
005F 8AD8                  183                         MOV BL,AL  
0061 80E3FC                184                         AND BL,0FCH
0064 80FBFC                185                         CMP BL,0FCH
                           186                      
0067 744F                  187                     JE LONG_PRESS
                           188                             
0069 B3FE                  189                         MOV BL, 0FEH
006B C6067A0004            190                         MOV DS:REG_BH, 04H
                           191                        
0070                       192     NXTROW: 
0070 C0C307                193                     ROL BL,07H
0073 8AEB                  194                             MOV CH,BL
0075 BA8200                195                             MOV DX,C_8255
0078 8AC3                  196                             MOV AL,BL
007A EE                    197                             OUT DX,AL
                           198                             
007B BA8100                199                             MOV DX,B_8255
007E EC                    200                             IN AL,DX
007F 8AD8                  201                             MOV BL,AL
0081 80E3FC                202                             AND BL,0FCH
0084 C6067B0006            203                             MOV DS:REG_CL,06H
0089 C0DB02                204                             RCR BL,02H
008C D0DB                  205     NXTCOL:         RCR BL,01H
008E 7330                  206                             JNC CODEKY
0090 FE0E7900              207                             DEC DS:REG_AL
0094 FE0E7B00              208                             DEC DS:REG_CL
0098 803E7B0003            209                             CMP DS:REG_CL,03H
009D 7413                  210                             JE KEYPAD4
                           211                             
009F 803E7B0000            212                             CMP DS:REG_CL, 0H
00A4 740F                  213                             JE SUBTRACT3
00A6 EBE4                  214                             JMP NXTCOL
                           215                             
00A8 8ADD                  216                             MOV BL,CH
00AA FE0E7A00              217                             DEC DS:REG_BH
00AE 75C0                  218                             JNZ NXTROW
00B0 EB9B                  219                             JMP WAIT_1
                           220                             
00B2 E99E00                221     KEYPAD4:    JMP KEYPAD3
00B5 E99E00                222     SUBTRACT3:  JMP SUBTRACT2
                           223                             
00B8                       224     LONG_PRESS:
00B8 C6067D0000            225                             MOV DS:LONG_PRESS_FLAG, 0
00BD E99000                226                             JMP RETURN2
00C0                       227     CODEKY:
00C0 803E79000B            228                         CMP DS:REG_AL, 11
00C5 7505                  229                             JNE bcd_upd
00C7 C606790000            230                             MOV DS:REG_AL, 0
                           231                             
00CC                       232     bcd_upd:
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    22:24:58  12/07/;3  PAGE    6


LOC  OBJ                  LINE     SOURCE

00CC 803E7D0000            233                             CMP DS:LONG_PRESS_FLAG, 0
00D1 757D                  234                             JNE RETURN2
                           235                             
00D3 803E790018            236                             CMP DS:REG_AL, 24
00D8 7523                  237                             JNE TROLLEY
00DA 833EE80000            238                             CMP DS:TRANSACTION_OVER, 0
00DF 741C                  239                             JE TROLLEY
00E1 BB0000                240                             MOV BX, 0
00E4 C6878D003E            241                             MOV DS:SEND_BUFFER[BX], '>'
00E9 43                    242                             INC BX
00EA C6878D002F            243                             MOV DS:SEND_BUFFER[BX], '/'
00EF C7069A000200          244                             MOV DS:SEND_BUFFER_LEN, 2
00F5 C6068C0001            245                             MOV DS:SEND_FLAG, 1
00FA E95A02                246                             JMP UPDATE_7SEG2
00FD                       247     TROLLEY:
00FD 803E790011            248                             CMP DS:REG_AL, 17
0102 7555                  249                             JNE ENTER_CASH
                           250                             
0104 833EFA0001            251                             CMP DS:TROLLEY_DISABLED, 1
0109 7442                  252                             JE SKIP_ENTER_DATA1
                           253                             
010B 833EC80001            254                             CMP DS:CASH_FLAG, 1
0110 743B                  255                             JE SKIP_ENTER_DATA1
0112 9AEB05----     R      256                             CALL FAR PTR BCD_CLEAR
                           257                             
0117 833EE80000            258                             CMP DS:TRANSACTION_OVER, 0
011C 7405                  259                             JE NO_RESET_NEEDED1
                           260                             
011E 9AA904----     R      261                             CALL FAR PTR CLEAR_TEMP_BCD
                           262                             
0123                       263             NO_RESET_NEEDED1:
0123 C706EA000100          264                             MOV DS:DATA_ENTER, 1
0129 C706AC000600          265                             MOV DS:DECIMAL_INDEX, 6
012F C7069C000600          266                             MOV DS:MAX_INPUT_SIZE, 6
0135 C706F8000100          267                             MOV DS:TROLLEY_ID, 1
013B C706AE000000          268                             MOV DS:LANG_FLAG, 0
0141 C706C8000000          269                             MOV DS:CASH_FLAG, 0
0147 C706E8000000          270                             MOV DS:TRANSACTION_OVER, 0
014D                       271             SKIP_ENTER_DATA1:
014D E90702                272                             JMP UPDATE_7SEG2
                           273                             
0150 E91E03                274     RETURN2:    JMP RETURN
                           275                             
0153 E9FD02                276     KEYPAD3:        JMP KEYPAD_2
                           277                             
0156 E90A03                278     SUBTRACT2:   JMP SUBTRACT
                           279     
                           280                             
                           281                             
0159                       282     ENTER_CASH:     
0159 803E790014            283                             CMP DS:REG_AL, 20
015E 7521                  284                             JNE SEND_CASH
0160 833EC80000            285                             CMP DS:CASH_FLAG, 0
0165 7417                  286                             JE SKIP_CASH
0167 C706EA000100          287                             MOV DS:DATA_ENTER, 1
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    22:24:58  12/07/;3  PAGE    7


LOC  OBJ                  LINE     SOURCE

016D 9AEB05----     R      288                             CALL FAR PTR BCD_CLEAR
0172 C7069C000800          289                             MOV DS:MAX_INPUT_SIZE, 8
0178 C706AC000600          290                             MOV DS:DECIMAL_INDEX, 6
017E                       291                     SKIP_CASH:
017E E9D601                292                             JMP UPDATE_7SEG2
                           293                             
0181                       294     SEND_CASH:
0181 803E790017            295                             CMP DS:REG_AL, 23
0186 7523                  296                             JNE CLEAR_BUTTON
0188 833EC80000            297                             CMP DS:CASH_FLAG, 0
018D 7419                  298                             JE SKIP_SEND_CASH
018F 833E610000            299                             CMP DS:KEYPAD_INDEX, 0
0194 7412                  300                             JE SKIP_SEND_CASH
0196 833EAC0003            301                             CMP DS:DECIMAL_INDEX, 3
019B 740B                  302                             JE SKIP_SEND_CASH
019D C706EA000000          303                             MOV DS:DATA_ENTER, 0
01A3 9AC106----     R      304                             CALL FAR PTR TAKE_CASH
01A8                       305                     SKIP_SEND_CASH:
01A8 E9AC01                306                             JMP UPDATE_7SEG2
                           307                             
01AB                       308     CLEAR_BUTTON:
01AB 803E79000A            309                             CMP DS:REG_AL, 10
01B0 7508                  310                             JNE BACKSPACE
01B2 9AEB05----     R      311                             CALL FAR PTR BCD_CLEAR
01B7 E99D01                312                             JMP UPDATE_7SEG2
                           313                             
01BA 803E79000C            314     BACKSPACE:      CMP DS:REG_AL, 12
01BF 7508                  315                             JNE ENTER_DATA
01C1 9A7C05----     R      316                             CALL FAR PTR BCD_BACKSPACE
01C6 E98E01                317                             JMP UPDATE_7SEG2
                           318     
01C9 803E79000D            319     ENTER_DATA:     CMP DS:REG_AL, 13
01CE 753F                  320                             JNE END_TRANS
01D0 833EC80001            321                             CMP DS:CASH_FLAG, 1
01D5 7435                  322                             JE SKIP_ENTER_DATA
01D7 9AEB05----     R      323                             CALL FAR PTR BCD_CLEAR
                           324                             
01DC 833EE80000            325                             CMP DS:TRANSACTION_OVER, 0
01E1 7405                  326                             JE NO_RESET_NEEDED
                           327                             
01E3 9AA904----     R      328                             CALL FAR PTR CLEAR_TEMP_BCD
                           329                             
01E8                       330             NO_RESET_NEEDED:
01E8 C706EA000100          331                             MOV DS:DATA_ENTER, 1
01EE C706AC000600          332                             MOV DS:DECIMAL_INDEX, 6
01F4 C7069C000800          333                             MOV DS:MAX_INPUT_SIZE, 8
01FA C706AE000000          334                             MOV DS:LANG_FLAG, 0
0200 C706C8000000          335                             MOV DS:CASH_FLAG, 0
0206 C706E8000000          336                             MOV DS:TRANSACTION_OVER, 0
020C                       337             SKIP_ENTER_DATA:
020C E94801                338                             JMP UPDATE_7SEG2
                           339                             
020F 803E790010            340     END_TRANS:      CMP DS:REG_AL, 16
0214 7553                  341                             JNE CANCEL_TRANS
0216 833EF80001            342                             CMP DS:TROLLEY_ID, 1
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    22:24:58  12/07/;3  PAGE    8


LOC  OBJ                  LINE     SOURCE

021B 7449                  343                             JE END_TRANS_CONT
021D 833EC80001            344                             CMP DS:CASH_FLAG, 1
0222 7442                  345                             JE END_TRANS_CONT
0224 833EE80000            346                             CMP DS:TRANSACTION_OVER, 0
0229 7403                  347                             JE TRANSACTION_NOT_OVER
022B E92901                348                             JMP UPDATE_7SEG2
022E                       349     TRANSACTION_NOT_OVER:
022E BB0000                350                             MOV BX, 0
0231 C6878D0024            351                             MOV DS:SEND_BUFFER[BX], '$'
0236 43                    352                             INC BX
0237 C6878D002F            353                             MOV DS:SEND_BUFFER[BX], '/'
023C C7069A000200          354                             MOV DS:SEND_BUFFER_LEN, 2
0242 C6068C0001            355                             MOV DS:SEND_FLAG, 1
0247 C706B8000000          356                             MOV DS:TOTAL_PRICE_DEC, 0
024D C706B6000000          357                             MOV DS:TOTAL_PRICE_L, 0
0253 C706B4000000          358                             MOV DS:TOTAL_PRICE_U, 0
0259 833EE60001            359                             CMP DS:CANCEL_FLAG, 1
025E 7406                  360                             JE END_TRANS_CONT
0260 C706C8000100          361                             MOV DS:CASH_FLAG, 1
0266                       362                     END_TRANS_CONT:
0266 E9EE00                363                             JMP UPDATE_7SEG2
                           364                             
0269                       365     CANCEL_TRANS:   
0269 803E79000F            366                             CMP DS:REG_AL, 15
026E 755A                  367                             JNE SCROLL_LEFT
0270 833EC80001            368                             CMP DS:CASH_FLAG, 1
0275 7503                  369                             JNE CONT_CANCEL
0277 E9DD00                370                             JMP UPDATE_7SEG2
027A                       371                     CONT_CANCEL:
027A BB0000                372                             MOV BX, 0
027D C6878D003F            373                             MOV DS:SEND_BUFFER[BX], '?'
0282 43                    374                             INC BX
0283 C6878D002F            375                             MOV DS:SEND_BUFFER[BX], '/'
0288 C7069A000200          376                             MOV DS:SEND_BUFFER_LEN, 2
028E C6068C0001            377                             MOV DS:SEND_FLAG, 1
0293 C706B8000000          378                             MOV DS:TOTAL_PRICE_DEC, 0
0299 C706B6000000          379                             MOV DS:TOTAL_PRICE_L, 0
029F C706B4000000          380                             MOV DS:TOTAL_PRICE_U, 0
02A5 C706AC000300          381                             MOV DS:DECIMAL_INDEX, 3
02AB 9AEB05----     R      382                             CALL FAR PTR BCD_CLEAR
02B0 C7069C000000          383                             MOV DS:MAX_INPUT_SIZE, 0
                           384                             
02B6 9AA904----     R      385                             CALL FAR PTR CLEAR_TEMP_BCD
                           386                             
02BB C706E6000100          387                             MOV DS:CANCEL_FLAG, 1
02C1 C706FA000000          388                             MOV DS:TROLLEY_DISABLED, 0
02C7 E98D00                389                             JMP UPDATE_7SEG2
                           390                             
02CA                       391     SCROLL_LEFT:
02CA 803E790015            392                             CMP DS:REG_AL, 21
02CF 753D                  393                             JNE SCROLL_RIGHT
02D1 833E610006            394                             CMP DS:KEYPAD_INDEX, 6
02D6 7E7F                  395                             JLE UPDATE_7SEG2
02D8 833EA80000            396                             CMP DS:SCROLL_LEN, 0
02DD 7478                  397                             JE UPDATE_7SEG2
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    22:24:58  12/07/;3  PAGE    9


LOC  OBJ                  LINE     SOURCE

02DF FF0EA800              398                             DEC DS:SCROLL_LEN
02E3 FF0EAC00              399                             DEC DS:DECIMAL_INDEX
02E7 FF0E6100              400                             DEC DS:KEYPAD_INDEX
02EB 8B1E6100              401                             MOV BX, DS:KEYPAD_INDEX
02EF 8A4751                402                             MOV AL, DS:KEYPAD_INPUT[BX]
02F2 A27900                403                             MOV DS:REG_AL, AL
02F5 C706AA000100          404                             MOV DS:DAC_DISABLE, 1
02FB 9A1606----     R      405                             CALL FAR PTR BCD_UPDATE
0300 C706AA000000          406                             MOV DS:DAC_DISABLE, 0
0306 C606790015            407                             MOV DS:REG_AL, 21
030B EB4A90                408                             JMP UPDATE_7SEG2
                           409     
030E                       410     SCROLL_RIGHT:
030E 803E790013            411                             CMP DS:REG_AL, 19
0313 7545                  412                             JNE LANG_TOGGLE
0315 833E610006            413                             CMP DS:KEYPAD_INDEX, 6
031A 7E3B                  414                             JLE UPDATE_7SEG2
031C A16100                415                             MOV AX, DS:KEYPAD_INDEX
031F 2D0600                416                             SUB AX, 6
0322 3906A800              417                             CMP DS:SCROLL_LEN, AX
0326 742F                  418                             JE UPDATE_7SEG2
0328 FF06A800              419                             INC DS:SCROLL_LEN
032C FF06AC00              420                             INC DS:DECIMAL_INDEX
0330 FF0E6100              421                             DEC DS:KEYPAD_INDEX
0334 8B1E6100              422                             MOV BX, DS:KEYPAD_INDEX
0338 8A4751                423                             MOV AL, DS:KEYPAD_INPUT[BX]
033B A27900                424                             MOV DS:REG_AL, AL
033E C706AA000100          425                             MOV DS:DAC_DISABLE, 1
0344 9A1606----     R      426                             CALL FAR PTR BCD_UPDATE
0349 C706AA000000          427                             MOV DS:DAC_DISABLE, 0
034F C606790013            428                             MOV DS:REG_AL, 19
0354 EB0190                429                             JMP UPDATE_7SEG2
                           430                             
0357 E9DE00                431     UPDATE_7SEG2: JMP UPDATE_7SEG
                           432     
035A                       433     LANG_TOGGLE:
035A 803E790012            434                             CMP DS:REG_AL, 18
035F 7537                  435                             JNE QTY_PROMPT
0361 833EAE0001            436                             CMP DS:LANG_FLAG, 1
0366 75EF                  437                             JNE UPDATE_7SEG2
0368 A16400                438                             MOV AX, DS:DAC_BASE
036B 3D0040                439                             CMP AX, 4000H
036E 7406                  440                             JE MANDRIN
0370 B80040                441                             MOV AX, 4000H
0373 EB0490                442                             JMP SEND_TOGGLE
0376                       443             MANDRIN:
0376 B80066                444                             MOV AX, 6600H
0379                       445             SEND_TOGGLE:
0379 A36400                446                             MOV DS:DAC_BASE, AX
037C BB0000                447                             MOV BX, 0
037F C6878D0021            448                             MOV DS:SEND_BUFFER[BX], '!'
0384 43                    449                             INC BX
0385 C6878D002F            450                             MOV DS:SEND_BUFFER[BX], '/'
038A C7069A000200          451                             MOV DS:SEND_BUFFER_LEN, 2
0390 C6068C0001            452                             MOV DS:SEND_FLAG, 1
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    22:24:58  12/07/;3  PAGE   10


LOC  OBJ                  LINE     SOURCE

0395 E9A000                453                             JMP UPDATE_7SEG
0398                       454     QTY_PROMPT:
0398 803E790016            455                             CMP DS:REG_AL, 22
039D 7527                  456                             JNE QUANTITY
039F 833EC80001            457                             CMP DS:CASH_FLAG, 1
03A4 7420                  458                             JE QUANTITY
03A6 833E610008            459                             CMP DS:KEYPAD_INDEX, 8
03AB 7519                  460                             JNE  QUANTITY
                           461                             ; CMP DS:MAX_INPUT_SIZE, 8
                           462                             ; JNE QUANTITY
03AD 9A3505----     R      463                             CALL FAR PTR UPDATE_SEND_BUFFER
03B2 9AEB05----     R      464                             CALL FAR PTR BCD_CLEAR
03B7 C7069C000200          465                             MOV DS:MAX_INPUT_SIZE, 2
03BD C7069E000100          466                             MOV DS:QTY_FLAG, 1
03C3 EB7390                467                             JMP UPDATE_7SEG
                           468                     
03C6                       469     QUANTITY:
03C6 833E610000            470                             CMP DS:KEYPAD_INDEX, 0
03CB 746B                  471                             JE  UPDATE_7SEG
                           472                             
03CD 803E79000E            473                             CMP DS:REG_AL, 14
03D2 7564                  474                             JNE UPDATE_7SEG
                           475                             
03D4 833EF80001            476                             CMP DS:TROLLEY_ID, 1
03D9 752C                  477                             JNE NORMAL_UPDATE
                           478                             
03DB 833E610006            479                             CMP DS:KEYPAD_INDEX, 6
03E0 7525                  480                             JNE NORMAL_UPDATE
                           481                             
03E2 9A7604----     R      482                             CALL FAR PTR UPDATE_TROLLEY_ID
                           483                             
03E7 C706F8000000          484                             MOV DS:TROLLEY_ID, 0
03ED C6068C0001            485                             MOV DS:SEND_FLAG, 1
03F2 C706EA000000          486                             MOV DS:DATA_ENTER, 0
03F8 C706E6000000          487                             MOV DS:CANCEL_FLAG, 0
03FE C706C8000100          488                             MOV DS:CASH_FLAG, 1
                           489                             
0404 EB3290                490                             JMP UPDATE_7SEG
                           491                             
0407                       492                     NORMAL_UPDATE:  
0407 833E9E0001            493                             CMP DS:QTY_FLAG, 1
040C 752A                  494                             JNE UPDATE_7SEG
                           495                             
040E C706EA000000          496                             MOV DS:DATA_ENTER, 0
                           497                             
0414 C706E6000000          498                             MOV DS:CANCEL_FLAG, 0
                           499                     
041A 9AE404----     R      500                             CALL FAR PTR UPDATE_THE_QUANTITY
                           501                             
041F C706FA000100          502                             MOV DS:TROLLEY_DISABLED, 1
0425 C6068C0001            503                             MOV DS:SEND_FLAG, 1
                           504                             
042A C7069E000000          505                             MOV DS:QTY_FLAG, 0
0430 9AEB05----     R      506                             CALL FAR PTR BCD_CLEAR
0435 EB0190                507                             JMP UPDATE_7SEG
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    22:24:58  12/07/;3  PAGE   11


LOC  OBJ                  LINE     SOURCE

                           508                             
                           509     
0438                       510     UPDATE_7SEG:
0438 803E790009            511                             CMP DS:REG_AL, 9
043D 7F0C                  512                             JG SET_PRESS_FLAG
                           513                             
043F 833EEA0001            514                             CMP DS:DATA_ENTER, 1
0444 7505                  515                             JNE SET_PRESS_FLAG
                           516                             
0446 9A1606----     R      517                             CALL FAR PTR BCD_UPDATE
                           518                             
044B                       519     SET_PRESS_FLAG:
044B C6067D0001            520                             MOV DS:LONG_PRESS_FLAG, 1
0450 EB1F90                521                             JMP RETURN
                           522             
0453                       523     KEYPAD_2: 
0453 800679000F            524                 ADD DS:REG_AL,0FH
0458 E931FC                525                             JMP NXTCOL
045B C606790000            526     ZERO_PRINT: MOV DS:REG_AL,00H
0460 E929FC                527                             JMP NXTCOL
0463 802E790006            528     SUBTRACT:   SUB DS:REG_AL,06H
0468 8ADD                  529                             MOV BL,CH
046A FE0E7A00              530                             DEC DS:REG_BH
046E E9FFFB                531                             JMP NXTROW
                           532             
                           533             
0471                       534     RETURN:
0471 5A                    535                             POP DX
0472 59                    536                             POP CX
0473 5B                    537                             POP BX
0474 58                    538                             POP AX
0475 CB                    539                             RET
                           540     
                           541     KEYPAD_LOOP ENDP
                           542     
0476                       543     UPDATE_TROLLEY_ID PROC FAR
0476 50                    544     PUSH AX
0477 53                    545     PUSH BX
0478 51                    546     PUSH CX
0479 52                    547     PUSH DX
047A BB0000                548             MOV BX, 0
047D C6878D005E            549             MOV DS:SEND_BUFFER[BX], '^'
0482 B90600                550             MOV CX, 6
0485                       551             UPDATE_TROLLEY_BUFFER:
0485 BB0600                552                     MOV BX, 6
0488 2BD9                  553                     SUB BX, CX
                           554                     
048A 8A4751                555                     MOV AL, DS:KEYPAD_INPUT[BX]
                           556                     
048D 43                    557                     INC BX
048E 0430                  558                     ADD AL, 30H
0490 88878D00              559                     MOV DS:SEND_BUFFER[BX], AL
0494 E2EF                  560             LOOP UPDATE_TROLLEY_BUFFER
                           561             
0496 BB0700                562             MOV BX, 7
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    22:24:58  12/07/;3  PAGE   12


LOC  OBJ                  LINE     SOURCE

0499 C6878D002F            563             MOV DS:SEND_BUFFER[BX], '/'
                           564             
049E C7069A000800          565             MOV DS:SEND_BUFFER_LEN, 8
                           566     
04A4 5A                    567     POP DX
04A5 59                    568     POP CX
04A6 5B                    569     POP BX
04A7 58                    570     POP AX
04A8 CB                    571     RET
                           572     UPDATE_TROLLEY_ID ENDP
                           573     
04A9                       574     CLEAR_TEMP_BCD PROC FAR
04A9 50                    575     PUSH AX
04AA 53                    576     PUSH BX
04AB 51                    577     PUSH CX
04AC 52                    578     PUSH DX
                           579     
04AD BB0000                580             MOV BX, 0
04B0 C687BA002D            581             MOV DS:TEMP_BCD_ARR[BX], '-'
04B5 43                    582             INC BX
04B6 C687BA002D            583             MOV DS:TEMP_BCD_ARR[BX], '-'
04BB 43                    584             INC BX
04BC C687BA002D            585             MOV DS:TEMP_BCD_ARR[BX], '-'
04C1 43                    586             INC BX
04C2 C687BA002D            587             MOV DS:TEMP_BCD_ARR[BX], '-'
04C7 43                    588             INC BX
04C8 C687BA002D            589             MOV DS:TEMP_BCD_ARR[BX], '-'
04CD 43                    590             INC BX
04CE C687BA002D            591             MOV DS:TEMP_BCD_ARR[BX], '-'
04D3 43                    592             INC BX
04D4 C687BA002D            593             MOV DS:TEMP_BCD_ARR[BX], '-'
04D9 43                    594             INC BX
04DA C687BA002D            595             MOV DS:TEMP_BCD_ARR[BX], '-'
                           596             
04DF 5A                    597     POP DX
04E0 59                    598     POP CX
04E1 5B                    599     POP BX
04E2 58                    600     POP AX
04E3 CB                    601     RET
                           602     CLEAR_TEMP_BCD ENDP
                           603     
                           604     
04E4                       605     UPDATE_THE_QUANTITY PROC FAR
04E4 50                    606     PUSH AX
04E5 53                    607     PUSH BX
04E6 51                    608     PUSH CX
04E7 52                    609     PUSH DX
04E8 8B0E6100              610             MOV CX, DS:KEYPAD_INDEX
04EC BB0000                611             MOV BX, 0
04EF BA0000                612             MOV DX, 0
04F2                       613             UPD_QTY:
04F2 A1B200                614                     MOV AX, DS:QTY
04F5 53                    615                     PUSH BX
04F6 BB0A00                616                     MOV BX, 10
04F9 F7E3                  617                     MUL BX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    22:24:58  12/07/;3  PAGE   13


LOC  OBJ                  LINE     SOURCE

04FB 5B                    618                     POP BX
04FC 8A5751                619                     MOV DL, DS:KEYPAD_INPUT[BX]
04FF 03C2                  620                     ADD AX, DX
0501 A3B200                621                     MOV DS:QTY, AX
0504 43                    622                     INC BX
0505 E2EB                  623             LOOP UPD_QTY
                           624             
0507 8B0E6100              625             MOV CX, DS:KEYPAD_INDEX
050B 8B1E9A00              626             MOV BX, DS:SEND_BUFFER_LEN
                           627             
050F                       628             UPD_BUFFER:
050F 53                    629                     PUSH BX
0510 8B1E6100              630                     MOV BX, DS:KEYPAD_INDEX
0514 2BD9                  631                     SUB BX, CX
0516 8A4751                632                     MOV AL, DS:KEYPAD_INPUT[BX]
0519 5B                    633                     POP BX
051A 0430                  634                     ADD AL, 30H
051C 88878D00              635                     MOV DS:SEND_BUFFER[BX], AL
                           636                     
0520 43                    637                     INC BX
0521 FF069A00              638                     INC DS:SEND_BUFFER_LEN
0525 E2E8                  639             LOOP UPD_BUFFER
                           640             
0527 C6878D002F            641             MOV DS:SEND_BUFFER[BX], '/'
052C FF069A00              642             INC DS:SEND_BUFFER_LEN
                           643                     
0530 5A                    644     POP DX
0531 59                    645     POP CX
0532 5B                    646     POP BX
0533 58                    647     POP AX
                           648     
0534 CB                    649     RET
                           650     UPDATE_THE_QUANTITY ENDP
                           651     
0535                       652     UPDATE_SEND_BUFFER PROC FAR
0535 50                    653     PUSH AX
0536 53                    654     PUSH BX
0537 51                    655     PUSH CX
0538 52                    656     PUSH DX
                           657     
0539 8B0E6100              658             MOV CX, DS:KEYPAD_INDEX
053D 83F900                659             CMP CX, 0
0540 7435                  660             JE END_UPD_BUFFER
0542 83C102                661             ADD CX, 2
0545 890E9A00              662             MOV DS:SEND_BUFFER_LEN, CX
0549 BB0000                663             MOV BX, 0
054C                       664             BUFFER_LOOP:
054C 83FB00                665                     CMP BX, 0
054F 7508                  666                     JNE ASTERISK
0551 C6878D007E            667                     MOV DS:SEND_BUFFER[BX], '~'
0556 EB1C90                668                     JMP END_BUFFER
0559                       669             ASTERISK:
0559 A16100                670                     MOV AX, DS:KEYPAD_INDEX
055C 40                    671                     INC AX
055D 3BD8                  672                     CMP BX, AX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    22:24:58  12/07/;3  PAGE   14


LOC  OBJ                  LINE     SOURCE

055F 7508                  673                     JNE CONT
0561 C6878D002A            674                     MOV DS:SEND_BUFFER[BX], '*'
0566 EB0C90                675                     JMP END_BUFFER
0569                       676             CONT:
0569 4B                    677                     DEC BX
056A 8A4751                678                     MOV AL, DS:KEYPAD_INPUT[BX]
056D 0430                  679                     ADD AL, 30H
056F 43                    680                     INC BX
0570 88878D00              681                     MOV DS:SEND_BUFFER[BX], AL
                           682                     
0574                       683             END_BUFFER:
0574 43                    684                     INC BX
0575 E2D5                  685             LOOP BUFFER_LOOP
0577                       686     END_UPD_BUFFER:
0577 5A                    687     POP DX
0578 59                    688     POP CX
0579 5B                    689     POP BX
057A 58                    690     POP AX
057B CB                    691     RET
                           692     UPDATE_SEND_BUFFER ENDP
                           693     
057C                       694     BCD_BACKSPACE PROC FAR
                           695     
057C 50                    696     PUSH AX
057D 53                    697     PUSH BX
057E 51                    698     PUSH CX
057F 52                    699     PUSH DX
                           700     
0580 8A167900              701             MOV DL, DS:REG_AL
0584 833E610000            702             CMP DS:KEYPAD_INDEX, 0
0589 7457                  703             JE RETURN_BACK
                           704             
058B BB0600                705             MOV BX, 6
058E                       706             BCD_CLEAR_LOOP:
058E 4B                    707                     DEC BX
058F C647592D              708                     MOV DS:BCD_MESSAGE[BX], '-'
0593 43                    709                     INC BX
0594 4B                    710                     DEC BX
0595 75F7                  711             JNZ BCD_CLEAR_LOOP
                           712             
0597 833E610001            713             CMP DS:KEYPAD_INDEX, 1
059C 7E2C                  714             JLE less_than_two
                           715             
059E FF0E6100              716             DEC DS:KEYPAD_INDEX
05A2 FF0E6100              717             DEC DS:KEYPAD_INDEX
05A6 8B1E6100              718             MOV BX, DS:KEYPAD_INDEX
05AA 8A4751                719             MOV AL, DS:KEYPAD_INPUT[BX]
05AD A27900                720             MOV DS:REG_AL, AL
05B0 C706A8000000          721             MOV DS:SCROLL_LEN, 0
05B6 C706AA000100          722             MOV DS:DAC_DISABLE, 1
05BC 9A1606----     R      723             CALL FAR PTR BCD_UPDATE
05C1 C706AA000000          724             MOV DS:DAC_DISABLE, 0
05C7 EB1990                725             JMP RETURN_BACK
                           726             
05CA                       727     less_than_two:
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    22:24:58  12/07/;3  PAGE   15


LOC  OBJ                  LINE     SOURCE

05CA FF0E6100              728             DEC DS:KEYPAD_INDEX
05CE C60679002D            729             MOV DS:REG_AL, '-'
05D3 C706A8000000          730             MOV DS:SCROLL_LEN, 0
05D9 9A1606----     R      731             CALL FAR PTR BCD_UPDATE
05DE FF0E6100              732             DEC DS:KEYPAD_INDEX
                           733             
05E2                       734     RETURN_BACK:
05E2 88167900              735             MOV DS:REG_AL, DL
05E6 5A                    736     POP DX
05E7 59                    737     POP CX
05E8 5B                    738     POP BX
05E9 58                    739     POP AX
                           740     
05EA CB                    741     RET
                           742     BCD_BACKSPACE ENDP
                           743     
05EB                       744     BCD_CLEAR PROC FAR
05EB 50                    745     PUSH AX
05EC 53                    746     PUSH BX
05ED 51                    747     PUSH CX
05EE 52                    748     PUSH DX
05EF BB0800                749             MOV BX, 8
05F2                       750             CLEAR_LOOP:
05F2 C6475100              751             MOV DS:KEYPAD_INPUT[BX], 0
05F6 4B                    752             DEC BX
05F7 75F9                  753             JNZ CLEAR_LOOP
                           754             
05F9 BB0600                755             MOV BX, 6
05FC                       756             CLEAR_LOOP2:
05FC 4B                    757                     DEC BX
05FD C647592D              758                     MOV DS:BCD_MESSAGE[BX], '-'
0601 43                    759                     INC BX
0602 4B                    760                     DEC BX
0603 75F7                  761             JNZ CLEAR_LOOP2
                           762     
0605 C70661000000          763             MOV DS:KEYPAD_INDEX, 0
060B C706A8000000          764             MOV DS:SCROLL_LEN, 0
0611 5A                    765     POP DX
0612 59                    766     POP CX
0613 5B                    767     POP BX
0614 58                    768     POP AX
0615 CB                    769     RET
                           770     BCD_CLEAR ENDP
                           771     
0616                       772     BCD_UPDATE PROC FAR
0616 50                    773     PUSH AX
0617 53                    774     PUSH BX
0618 51                    775     PUSH CX
0619 52                    776     PUSH DX
061A A19C00                777                     MOV AX, DS:MAX_INPUT_SIZE
061D 39066100              778                     CMP DS:KEYPAD_INDEX, AX
0621 7D5A                  779                     JGE BCD_RET
                           780                     
0623 8A0E7900              781                     MOV CL, DS:REG_AL
0627 80F909                782                     CMP CL, 9
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    22:24:58  12/07/;3  PAGE   16


LOC  OBJ                  LINE     SOURCE

062A 7F0C                  783                     JG SKIP_PAST
062C 833EAA0001            784                     CMP DS:DAC_DISABLE, 1
0631 7405                  785                     JE SKIP_PAST
0633 9A8206----     R      786                     CALL FAR PTR DAC_UPDATE
                           787     
0638                       788     SKIP_PAST:              
0638 8A0E7900              789                     MOV CL, DS:REG_AL
                           790     
063C 8B1E6100              791                     MOV BX, DS:KEYPAD_INDEX
                           792                             
0640 884F51                793                     MOV DS:KEYPAD_INPUT[BX], CL
                           794                             
0643 FF066100              795                     INC DS:KEYPAD_INDEX
                           796                             
0647 8B1E6100              797                     MOV BX, DS:KEYPAD_INDEX
                           798                     
064B A1A800                799                     MOV AX, DS:SCROLL_LEN
064E 2BD8                  800                     SUB BX, AX
                           801                     
0650 8B166100              802                     MOV DX, DS:KEYPAD_INDEX
0654 83FA06                803                     CMP DX, 6
0657 7E03                  804                     JLE update_display
0659 BA0600                805                     MOV DX, 6
                           806                     
065C                       807             update_display:
                           808             
065C B90500                809                     MOV CX, 5
065F 4B                    810                     DEC BX
0660 8A4751                811                     MOV AL, DS:KEYPAD_INPUT[BX]
0663 43                    812                     INC BX
                           813                             
0664 52                    814                     PUSH DX
0665 8B166100              815                     MOV DX, DS:KEYPAD_INDEX
0669 2B16A800              816                     SUB DX, DS:SCROLL_LEN
                           817                     
066D 2BD3                  818                     SUB DX, BX
                           819                             
066F 53                    820                     PUSH BX
                           821                             
0670 2BCA                  822                     SUB CX, DX
0672 8BD9                  823                     MOV BX, CX
0674 884759                824                     MOV DS:BCD_MESSAGE[BX], AL
                           825                             
0677 5B                    826                     POP BX
0678 5A                    827                     POP DX
                           828             
0679 4B                    829                     DEC BX
067A 4A                    830                     DEC DX
067B 75DF                  831             JNZ update_display
                           832     
067D                       833             BCD_RET:
067D 5A                    834                     POP DX
067E 59                    835                     POP CX
067F 5B                    836                     POP BX
0680 58                    837                     POP AX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    22:24:58  12/07/;3  PAGE   17


LOC  OBJ                  LINE     SOURCE

0681 CB                    838     RET
                           839     BCD_UPDATE ENDP
                           840     
0682                       841     DAC_UPDATE PROC FAR
0682 50                    842             PUSH AX
0683 53                    843             PUSH BX
0684 51                    844             PUSH CX
0685 52                    845             PUSH DX
                           846             
0686 BB0000                847             MOV BX, 0
0689 8A1E7500              848             MOV BL, DS:DAC_LEN
068D A07900                849             MOV AL, DS:REG_AL
                           850             
0690 884766                851             MOV DS:DAC_ADDR[BX], AL
                           852             
0693 FE067500              853             INC DS:DAC_LEN
                           854     
0697 5A                    855             POP DX
0698 59                    856             POP CX
0699 5B                    857             POP BX
069A 58                    858             POP AX
069B CB                    859     RET
                           860     DAC_UPDATE ENDP
                           861               
069C                       862     DEBOUNCE PROC FAR
069C 51                    863                       PUSH CX
                           864                       
069D B94C09                865                       MOV CX, 094CH
06A0 90                    866     BACK:     NOP
06A1 E2FD                  867                       LOOP BACK
06A3 59                    868                       POP CX
06A4 CB                    869                       RET
                           870     DEBOUNCE  ENDP
                           871     
06A5                       872     SEND_INPUT PROC FAR
06A5 50                    873     PUSH AX
06A6 53                    874     PUSH BX
06A7 51                    875     PUSH CX
06A8 52                    876     PUSH DX
06A9 BB0000                877             MOV BX, 0
06AC 8B0E9A00              878             MOV CX, DS:SEND_BUFFER_LEN
                           879             
06B0                       880             S_BUFF:
06B0 8A878D00              881                     MOV AL, DS:SEND_BUFFER[BX]
06B4 9A0000----     E      882                     CALL FAR PTR PRINT_CHAR
06B9 43                    883                     INC BX
06BA E2F4                  884             LOOP S_BUFF
                           885             
06BC                       886     SEND_INPUT_END:
06BC 5A                    887     POP DX
06BD 59                    888     POP CX
06BE 5B                    889     POP BX
06BF 58                    890     POP AX
06C0 CB                    891     RET
                           892     SEND_INPUT ENDP
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    22:24:58  12/07/;3  PAGE   18


LOC  OBJ                  LINE     SOURCE

                           893     
06C1                       894     TAKE_CASH PROC FAR
06C1 50                    895     PUSH AX
06C2 53                    896     PUSH BX
06C3 51                    897     PUSH CX
06C4 52                    898     PUSH DX
                           899             
06C5 B90000                900             MOV CX, 0
06C8 B108                  901             MOV CL, 8
06CA                       902             CLEAR_CASH_AMT:
06CA 8BD9                  903                     MOV BX, CX
06CC 4B                    904                     DEC BX
06CD C687CA0000            905                     MOV DS:CASH_AMT[BX], 0
06D2 E2F6                  906             LOOP CLEAR_CASH_AMT
                           907             
06D4 8B0E6100              908             MOV CX, DS:KEYPAD_INDEX
06D8 BA0600                909             MOV DX, 6
                           910             
06DB                       911             UPDATE_CASH_AMT:
06DB 8BD9                  912                     MOV BX, CX
06DD 4B                    913                     DEC BX
                           914                     
06DE 33C0                  915                     XOR AX, AX
06E0 8A4751                916                     MOV AL, DS:KEYPAD_INPUT[BX]
                           917                     
06E3 8BDA                  918                     MOV BX, DX
06E5 4B                    919                     DEC BX
06E6 8887CA00              920                     MOV DS:CASH_AMT[BX], AL
                           921                     
06EA 4A                    922                     DEC DX
06EB E2EE                  923             LOOP UPDATE_CASH_AMT
                           924             
06ED C706E2000100          925             MOV DS:CASH_OK_FLAG, 1
06F3 C706E4000700          926             MOV DS:BORROW_POSITION, 7
06F9 B90800                927             MOV CX, 8
06FC                       928             CHECK_CASH:
06FC BB0800                929                     MOV BX, 8
06FF 2BD9                  930                     SUB BX, CX
0701 B80000                931                     MOV AX, 0
0704 8A87BA00              932                     MOV AL, DS:TEMP_BCD_ARR[BX]
0708 8A97CA00              933                     MOV DL, DS:CASH_AMT[BX]
070C 3AD0                  934                     CMP DL, AL
070E 741A                  935                     JE NEXT_CASH_DIGIT
                           936                     
0710 3AD0                  937                     CMP DL, AL
0712 7C0D                  938                     JL CASH_NOT_OK
                           939                     
0714 C706E2000100          940                     MOV DS:CASH_OK_FLAG, 1
071A 891EE400              941                     MOV DS:BORROW_POSITION, BX
                           942                     
071E EB0C90                943                     JMP CHEK_CASH_DONE
                           944                     
0721                       945                     CASH_NOT_OK:
0721 C706E2000000          946                     MOV DS:CASH_OK_FLAG, 0
0727 EB0390                947                     JMP CHEK_CASH_DONE
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    22:24:58  12/07/;3  PAGE   19


LOC  OBJ                  LINE     SOURCE

                           948                     
072A                       949             NEXT_CASH_DIGIT:
072A E2D0                  950             LOOP CHECK_CASH
                           951             
072C                       952     CHEK_CASH_DONE:
                           953             
072C 833EE20001            954             CMP DS:CASH_OK_FLAG, 1
0731 7464                  955             JE CONTINUE_CASH
0733 B90800                956             MOV CX, 8
0736 C70661000000          957             MOV DS:KEYPAD_INDEX, 0
073C C706AC000300          958             MOV DS:DECIMAL_INDEX, 3
0742                       959             RETAIN_BCD:
0742 BB0800                960                     MOV BX, 8
0745 2BD9                  961                     SUB BX, CX
                           962                     
0747 8A87BA00              963                     MOV AL, DS:TEMP_BCD_ARR[BX]
074B A27900                964                     MOV DS:REG_AL, AL
                           965                     
074E C706AA000100          966                     MOV DS:DAC_DISABLE, 1
0754 9A1606----     R      967                     CALL FAR PTR BCD_UPDATE
0759 C706AA000000          968                     MOV DS:DAC_DISABLE, 0
075F E2E1                  969             LOOP RETAIN_BCD
0761 813E64000040          970             CMP DS:DAC_BASE, 4000H
0767 7517                  971             JNE MANDARIN_CASH
                           972             
0769 C606790023            973             MOV DS:REG_AL, 35
076E 9A8206----     R      974             CALL FAR PTR DAC_UPDATE
0773 C606790024            975             MOV DS:REG_AL, 36
0778 9A8206----     R      976             CALL FAR PTR DAC_UPDATE
077D E9B200                977             JMP CASH_OVER
                           978             
0780                       979     MANDARIN_CASH:
0780 C606790012            980             MOV DS:REG_AL, 18
0785 9A8206----     R      981             CALL FAR PTR DAC_UPDATE
078A C606790013            982             MOV DS:REG_AL, 19
078F 9A8206----     R      983             CALL FAR PTR DAC_UPDATE
0794 E99B00                984             JMP CASH_OVER
                           985             
0797                       986     CONTINUE_CASH:
0797 8B1EE400              987             MOV BX, DS:BORROW_POSITION
079B B90700                988             MOV CX, 7
079E 2BCB                  989             SUB CX, BX
07A0 83F900                990             CMP CX, 0
07A3 740C                  991             JE BEGIN_SUB
                           992             
07A5                       993             ADJUST_PLACES:
07A5 FE8FCA00              994                     DEC DS:CASH_AMT[BX]
07A9 43                    995                     INC BX
07AA 8087CA000A            996                     ADD DS:CASH_AMT[BX], 10
07AF E2F4                  997             LOOP ADJUST_PLACES
                           998             
07B1                       999     BEGIN_SUB:
07B1 B90800               1000             MOV CX, 8
07B4                      1001             CALC_CHANGE:
07B4 BB0800               1002                     MOV BX, 8
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    22:24:58  12/07/;3  PAGE   20


LOC  OBJ                  LINE     SOURCE

07B7 2BD9                 1003                     SUB BX, CX
07B9 B80000               1004                     MOV AX, 0
07BC 8A87CA00             1005                     MOV AL, DS:CASH_AMT[BX]
07C0 BA0000               1006                     MOV DX, 0
07C3 8A97BA00             1007                     MOV DL, DS:TEMP_BCD_ARR[BX]
07C7 2BC2                 1008                     SUB AX, DX
07C9 8987D200             1009                     MOV DS:TEMP_CASH_ARR[BX], AX
07CD E2E5                 1010             LOOP CALC_CHANGE
                          1011             
07CF B90800               1012             MOV CX, 8
07D2                      1013             FIX_DIGITS:
07D2 8BD9                 1014             MOV BX, CX
07D4 4B                   1015             DEC BX
                          1016             
07D5 8B87D200             1017             MOV AX, DS:TEMP_CASH_ARR[BX]
07D9 3C0A                 1018             CMP AL, 10
07DB 7C0A                 1019             JL NEXT_DIGIT_TO_FIX
                          1020             
07DD 83AFD2000A           1021             SUB DS:TEMP_CASH_ARR[BX], 10
                          1022             
07E2 4B                   1023             DEC BX
07E3 FF87D200             1024             INC DS:TEMP_CASH_ARR[BX]
                          1025             
07E7                      1026             NEXT_DIGIT_TO_FIX:
                          1027             
07E7 E2E9                 1028             LOOP FIX_DIGITS
                          1029             
07E9 B90800               1030             MOV CX, 8
07EC C70661000000         1031             MOV DS:KEYPAD_INDEX, 0
07F2 C706AC000300         1032             MOV DS:DECIMAL_INDEX, 3
07F8                      1033             UPDATE_BCD_TO_CASH:
07F8 BB0800               1034                     MOV BX, 8
07FB 2BD9                 1035                     SUB BX, CX
07FD 8B87D200             1036                     MOV AX, DS:TEMP_CASH_ARR[BX]
0801 8887BA00             1037                     MOV DS:TEMP_BCD_ARR[BX], AL
0805 A27900               1038                     MOV DS:REG_AL, AL
0808 C706AA000100         1039                     MOV DS:DAC_DISABLE, 1
080E 9A1606----     R     1040                     CALL FAR PTR BCD_UPDATE
0813 C706AA000000         1041                     MOV DS:DAC_DISABLE, 0
0819 E2DD                 1042             LOOP UPDATE_BCD_TO_CASH
                          1043             
081B 9A3708----     R     1044             CALL FAR PTR CALC_DAC
                          1045             
0820 C706C8000000         1046             MOV DS:CASH_FLAG, 0
0826 C706E8000100         1047             MOV DS:TRANSACTION_OVER, 1
082C C706FA000000         1048             MOV DS:TROLLEY_DISABLED, 0
                          1049             
0832                      1050     CASH_OVER:
0832 5A                   1051     POP DX
0833 59                   1052     POP CX
0834 5B                   1053     POP BX
0835 58                   1054     POP AX
                          1055     
0836 CB                   1056     RET
                          1057     TAKE_CASH ENDP
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    22:24:58  12/07/;3  PAGE   21


LOC  OBJ                  LINE     SOURCE

                          1058     
0837                      1059     CALC_DAC PROC FAR
0837 50                   1060     PUSH AX
0838 53                   1061     PUSH BX
0839 51                   1062     PUSH CX
083A 52                   1063     PUSH DX
083B 813E64000040         1064             CMP DS:DAC_BASE, 4000H
0841 7403                 1065             JE ENGLISH_DAC
0843 E98E01               1066             JMP MANDARIN_DAC
                          1067             
0846                      1068     ENGLISH_DAC:
0846 C706C4000000         1069             MOV DS:CENT_FLAG, 0
084C C706C2000000         1070             MOV DS:THOUSAND_FLAG, 0
0852 C706C6000000         1071             MOV DS:DOLLAR_FLAG,     0
0858 BB0000               1072             MOV BX, 0
085B 8A87BA00             1073             MOV AL, DS:TEMP_BCD_ARR[BX]
085F A27900               1074             MOV DS:REG_AL, AL
0862 3C00                 1075             CMP AL, 0
0864 7415                 1076             JE NEXT_PLACE
0866 C706C6000100         1077             MOV DS:DOLLAR_FLAG, 1
086C 9A8206----     R     1078             CALL FAR PTR DAC_UPDATE
0871 C60679001C           1079             MOV DS:REG_AL, 28
0876 9A8206----     R     1080             CALL FAR PTR DAC_UPDATE
                          1081             
087B                      1082     NEXT_PLACE:     
087B 43                   1083             INC BX
087C 8A87BA00             1084             MOV AL, DS:TEMP_BCD_ARR[BX]
0880 3C01                 1085             CMP AL, 1
0882 751E                 1086             JNE NOT_1
0884 C706C6000100         1087             MOV DS:DOLLAR_FLAG, 1
088A 43                   1088             INC BX
088B 8A87BA00             1089             MOV AL, DS:TEMP_BCD_ARR[BX]
088F 040A                 1090             ADD AL, 10
0891 A27900               1091             MOV DS:REG_AL, AL
0894 9A8206----     R     1092             CALL FAR PTR DAC_UPDATE
0899 C706C2000100         1093             MOV DS:THOUSAND_FLAG, 1
089F EB3890               1094             JMP HUNDREDS_PLACE
08A2                      1095     NOT_1:
08A2 3C00                 1096             CMP AL, 0
08A4 7416                 1097             JE NEXT_PLACE_1
08A6 C706C6000100         1098             MOV DS:DOLLAR_FLAG, 1
08AC C706C2000100         1099             MOV DS:THOUSAND_FLAG, 1
08B2 0412                 1100             ADD AL, 18
08B4 A27900               1101             MOV DS:REG_AL, AL
08B7 9A8206----     R     1102             CALL FAR PTR DAC_UPDATE
08BC                      1103     NEXT_PLACE_1:
08BC 43                   1104             INC BX
08BD 8A87BA00             1105             MOV AL, DS:TEMP_BCD_ARR[BX]
08C1 3C00                 1106             CMP AL, 0
08C3 7414                 1107             JE HUNDREDS_PLACE
08C5 C706C6000100         1108             MOV DS:DOLLAR_FLAG, 1
08CB C706C2000100         1109             MOV DS:THOUSAND_FLAG, 1
08D1 A27900               1110             MOV DS:REG_AL, AL
08D4 9A8206----     R     1111             CALL FAR PTR DAC_UPDATE
                          1112     
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    22:24:58  12/07/;3  PAGE   22


LOC  OBJ                  LINE     SOURCE

08D9                      1113     HUNDREDS_PLACE:
08D9 833EC20000           1114             CMP DS:THOUSAND_FLAG, 0
08DE 7410                 1115             JE NEXT_PLACE_2
08E0 C60679001D           1116             MOV DS:REG_AL, 29
08E5 9A8206----     R     1117             CALL FAR PTR DAC_UPDATE
08EA C706C2000000         1118             MOV DS:THOUSAND_FLAG, 0
                          1119             
08F0                      1120     NEXT_PLACE_2:
08F0 43                   1121             INC BX
08F1 8A87BA00             1122             MOV AL, DS:TEMP_BCD_ARR[BX]
08F5 3C00                 1123             CMP AL, 0
08F7 7418                 1124             JE NEXT_PLACE_3
08F9 C706C6000100         1125             MOV DS:DOLLAR_FLAG, 1
08FF A27900               1126             MOV DS:REG_AL, AL
0902 9A8206----     R     1127             CALL FAR PTR DAC_UPDATE
0907 C60679001C           1128             MOV DS:REG_AL, 28
090C 9A8206----     R     1129             CALL FAR PTR DAC_UPDATE
                          1130             
0911                      1131     NEXT_PLACE_3:   
0911 43                   1132             INC BX
0912 8A87BA00             1133             MOV AL, DS:TEMP_BCD_ARR[BX]
0916 3C01                 1134             CMP AL, 1
0918 7518                 1135             JNE NOT_1_2
091A C706C6000100         1136             MOV DS:DOLLAR_FLAG, 1
0920 43                   1137             INC BX
0921 8A87BA00             1138             MOV AL, DS:TEMP_BCD_ARR[BX]
0925 040A                 1139             ADD AL, 10
0927 A27900               1140             MOV DS:REG_AL, AL
092A 9A8206----     R     1141             CALL FAR PTR DAC_UPDATE
092F EB2C90               1142             JMP DECIMAL_DAC
0932                      1143     NOT_1_2:
0932 3C00                 1144             CMP AL, 0
0934 7410                 1145             JE NEXT_PLACE_4
0936 C706C6000100         1146             MOV DS:DOLLAR_FLAG, 1
093C 0412                 1147             ADD AL, 18
093E A27900               1148             MOV DS:REG_AL, AL
0941 9A8206----     R     1149             CALL FAR PTR DAC_UPDATE
0946                      1150     NEXT_PLACE_4:
0946 43                   1151             INC BX
0947 8A87BA00             1152             MOV AL, DS:TEMP_BCD_ARR[BX]
094B 3C00                 1153             CMP AL, 0
094D 740E                 1154             JE DECIMAL_DAC
094F C706C6000100         1155             MOV DS:DOLLAR_FLAG, 1
0955 A27900               1156             MOV DS:REG_AL, AL
0958 9A8206----     R     1157             CALL FAR PTR DAC_UPDATE
                          1158             
095D                      1159     DECIMAL_DAC:
095D 833EC60000           1160             CMP DS:DOLLAR_FLAG, 0
0962 740A                 1161             JE DECIMAL_DAC_CONT
0964 C60679001E           1162             MOV DS:REG_AL, 30
0969 9A8206----     R     1163             CALL FAR PTR DAC_UPDATE
                          1164             
096E                      1165     DECIMAL_DAC_CONT:
096E 43                   1166             INC BX
096F 8A87BA00             1167             MOV AL, DS:TEMP_BCD_ARR[BX]
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    22:24:58  12/07/;3  PAGE   23


LOC  OBJ                  LINE     SOURCE

0973 3C01                 1168             CMP AL, 1
0975 7518                 1169             JNE NOT_1_3
0977 43                   1170             INC BX
0978 C706C4000100         1171             MOV DS:CENT_FLAG, 1
097E 8A87BA00             1172             MOV AL, DS:TEMP_BCD_ARR[BX]
0982 040A                 1173             ADD AL, 10
0984 A27900               1174             MOV DS:REG_AL, AL
0987 9A8206----     R     1175             CALL FAR PTR DAC_UPDATE
098C EB2C90               1176             JMP ENGLISH_END
                          1177             
098F                      1178     NOT_1_3:
098F 3C00                 1179             CMP AL, 0
0991 7410                 1180             JE NEXT_PLACE_5
0993 C706C4000100         1181             MOV DS:CENT_FLAG, 1
0999 0412                 1182             ADD AL, 18
099B A27900               1183             MOV DS:REG_AL, AL
099E 9A8206----     R     1184             CALL FAR PTR DAC_UPDATE
                          1185             
09A3                      1186     NEXT_PLACE_5:
09A3 43                   1187             INC BX
09A4 8A87BA00             1188             MOV AL, DS:TEMP_BCD_ARR[BX]
09A8 3C00                 1189             CMP AL, 0
09AA 740E                 1190             JE ENGLISH_END
09AC C706C4000100         1191             MOV DS:CENT_FLAG, 1
09B2 A27900               1192             MOV DS:REG_AL, AL
09B5 9A8206----     R     1193             CALL FAR PTR DAC_UPDATE
                          1194             
09BA                      1195     ENGLISH_END:
09BA 833EC40000           1196             CMP DS:CENT_FLAG, 0
09BF 7410                 1197             JE ENGLISH_END2
09C1 C60679001F           1198             MOV DS:REG_AL, 31
09C6 9A8206----     R     1199             CALL FAR PTR DAC_UPDATE
09CB C706C4000000         1200             MOV DS:CENT_FLAG, 0
09D1                      1201     ENGLISH_END2:
09D1 E9CE01               1202             JMP CONT_BCD_UPD_1
                          1203             
09D4                      1204     MANDARIN_DAC:
09D4 C706C4000000         1205             MOV DS:CENT_FLAG, 0
09DA C706C2000000         1206             MOV DS:THOUSAND_FLAG, 0
09E0 C706FC000000         1207             MOV DS:TEN_THOUSAND_FLAG, 0
09E6 C706FE000000         1208             MOV DS:ZERO_TELL, 0
09EC C706C6000000         1209             MOV DS:DOLLAR_FLAG,     0
09F2 BB0000               1210             MOV BX, 0
09F5 8A87BA00             1211             MOV AL, DS:TEMP_BCD_ARR[BX]
09F9 3C00                 1212             CMP AL, 0
09FB 7424                 1213             JE NEXT_PLACE_6
09FD C706C6000100         1214             MOV DS:DOLLAR_FLAG, 1
0A03 C706FC000100         1215             MOV DS:TEN_THOUSAND_FLAG, 1
0A09 C706C2000000         1216             MOV DS:THOUSAND_FLAG, 0
0A0F A27900               1217             MOV DS:REG_AL, AL
0A12 9A8206----     R     1218             CALL FAR PTR DAC_UPDATE
0A17 C60679000A           1219             MOV DS:REG_AL, 10
0A1C 9A8206----     R     1220             CALL FAR PTR DAC_UPDATE
                          1221             
0A21                      1222     NEXT_PLACE_6:
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    22:24:58  12/07/;3  PAGE   24


LOC  OBJ                  LINE     SOURCE

0A21 43                   1223             INC BX
0A22 8A87BA00             1224             MOV AL, DS:TEMP_BCD_ARR[BX]
0A26 3C00                 1225             CMP AL, 0
0A28 741A                 1226             JE NEXT_PLACE_7
0A2A C706C6000100         1227             MOV DS:DOLLAR_FLAG, 1
0A30 C706FC000100         1228             MOV DS:TEN_THOUSAND_FLAG, 1
0A36 C706C2000000         1229             MOV DS:THOUSAND_FLAG, 0
0A3C A27900               1230             MOV DS:REG_AL, AL
0A3F 9A8206----     R     1231             CALL FAR PTR DAC_UPDATE
                          1232             
0A44                      1233     NEXT_PLACE_7:
0A44 833EFC0001           1234             CMP DS:TEN_THOUSAND_FLAG, 1
0A49 750A                 1235             JNE NO_TEN_THOUSAND
0A4B C60679000D           1236             MOV DS:REG_AL, 13
0A50 9A8206----     R     1237             CALL FAR PTR DAC_UPDATE
0A55                      1238     NO_TEN_THOUSAND:
0A55 43                   1239             INC BX
0A56 8A87BA00             1240             MOV AL, DS:TEMP_BCD_ARR[BX]
0A5A 3C00                 1241             CMP AL, 0
0A5C 7509                 1242             JNE CONTINUE_MAND
0A5E C706FE000100         1243             MOV DS:ZERO_TELL, 1
0A64 EB1590               1244             JMP NEXT_PLACE_8
0A67                      1245     CONTINUE_MAND:  
0A67 C706C6000100         1246             MOV DS:DOLLAR_FLAG, 1
0A6D C706C2000100         1247             MOV DS:THOUSAND_FLAG, 1
                          1248     
0A73 A27900               1249             MOV DS:REG_AL, AL
0A76 9A8206----     R     1250             CALL FAR PTR DAC_UPDATE
                          1251     
0A7B                      1252     NEXT_PLACE_8:
0A7B 833EC20000           1253             CMP DS:THOUSAND_FLAG, 0
0A80 7410                 1254             JE IGNORE_THOUSAND
0A82 C60679000C           1255             MOV DS:REG_AL, 12
0A87 9A8206----     R     1256             CALL FAR PTR DAC_UPDATE
0A8C C706C2000000         1257             MOV DS:THOUSAND_FLAG, 0
                          1258             
0A92                      1259     IGNORE_THOUSAND:
0A92 43                   1260             INC BX
0A93 8A87BA00             1261             MOV AL, DS:TEMP_BCD_ARR[BX]
0A97 3C00                 1262             CMP AL, 0
0A99 7509                 1263             JNE CONTINUE_MAND1
0A9B C706FE000100         1264             MOV DS:ZERO_TELL, 1
0AA1 EB3090               1265             JMP NEXT_PLACE_9
0AA4                      1266     CONTINUE_MAND1:
0AA4 833EFE0001           1267             CMP DS:ZERO_TELL, 1
0AA9 7510                 1268             JNE DONT_ZERO
0AAB C606790000           1269             MOV DS:REG_AL, 0
0AB0 9A8206----     R     1270             CALL FAR PTR DAC_UPDATE
0AB5 C706FE000000         1271             MOV DS:ZERO_TELL, 0
0ABB                      1272     DONT_ZERO:
0ABB C706C6000100         1273             MOV DS:DOLLAR_FLAG, 1
0AC1 A27900               1274             MOV DS:REG_AL, AL
0AC4 9A8206----     R     1275             CALL FAR PTR DAC_UPDATE
0AC9 C60679000B           1276             MOV DS:REG_AL, 11
0ACE 9A8206----     R     1277             CALL FAR PTR DAC_UPDATE
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    22:24:58  12/07/;3  PAGE   25


LOC  OBJ                  LINE     SOURCE

                          1278             
0AD3                      1279     NEXT_PLACE_9:
0AD3 43                   1280             INC BX
0AD4 8A87BA00             1281             MOV AL, DS:TEMP_BCD_ARR[BX]
0AD8 3C00                 1282             CMP AL, 0
0ADA 7509                 1283             JNE CONTINUE_MAND2
0ADC C706FE000100         1284             MOV DS:ZERO_TELL, 1
0AE2 EB3090               1285             JMP NEXT_PLACE_10
0AE5                      1286     CONTINUE_MAND2:
0AE5 833EFE0001           1287             CMP DS:ZERO_TELL, 1
0AEA 7510                 1288             JNE DONT_ZERO1
0AEC C606790000           1289             MOV DS:REG_AL, 0
0AF1 9A8206----     R     1290             CALL FAR PTR DAC_UPDATE
0AF6 C706FE000000         1291             MOV DS:ZERO_TELL, 0
0AFC                      1292     DONT_ZERO1:
0AFC C706C6000100         1293             MOV DS:DOLLAR_FLAG, 1
0B02 A27900               1294             MOV DS:REG_AL, AL
0B05 9A8206----     R     1295             CALL FAR PTR DAC_UPDATE
0B0A C60679000A           1296             MOV DS:REG_AL, 10
0B0F 9A8206----     R     1297             CALL FAR PTR DAC_UPDATE
                          1298             
0B14                      1299     NEXT_PLACE_10:
0B14 43                   1300             INC BX
0B15 8A87BA00             1301             MOV AL, DS:TEMP_BCD_ARR[BX]
0B19 3C00                 1302             CMP AL, 0
0B1B 7425                 1303             JE MANDARIN_DEC
0B1D 833EFE0001           1304             CMP DS:ZERO_TELL, 1
0B22 7510                 1305             JNE DONT_ZERO2
0B24 C606790000           1306             MOV DS:REG_AL, 0
0B29 9A8206----     R     1307             CALL FAR PTR DAC_UPDATE
0B2E C706FE000000         1308             MOV DS:ZERO_TELL, 0
0B34                      1309     DONT_ZERO2:
0B34 C706C6000100         1310             MOV DS:DOLLAR_FLAG, 1
0B3A A27900               1311             MOV DS:REG_AL, AL
0B3D 9A8206----     R     1312             CALL FAR PTR DAC_UPDATE
                          1313             
0B42                      1314     MANDARIN_DEC:
0B42 833EC60000           1315             CMP DS:DOLLAR_FLAG, 0
0B47 740A                 1316             JE MANDARIN_DAC_CONT
0B49 C60679000E           1317             MOV DS:REG_AL, 14
0B4E 9A8206----     R     1318             CALL FAR PTR DAC_UPDATE
0B53                      1319     MANDARIN_DAC_CONT:
0B53 43                   1320             INC BX
0B54 8A87BA00             1321             MOV AL, DS:TEMP_BCD_ARR[BX]
0B58 3C00                 1322             CMP AL, 0
0B5A 7418                 1323             JE NEXT_PLACE_11
0B5C C706C4000100         1324             MOV DS:CENT_FLAG, 1
0B62 A27900               1325             MOV DS:REG_AL, AL
0B65 9A8206----     R     1326             CALL FAR PTR DAC_UPDATE
0B6A C60679000A           1327             MOV DS:REG_AL, 10
0B6F 9A8206----     R     1328             CALL FAR PTR DAC_UPDATE
                          1329             
0B74                      1330     NEXT_PLACE_11:
                          1331     
0B74 43                   1332             INC BX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    22:24:58  12/07/;3  PAGE   26


LOC  OBJ                  LINE     SOURCE

0B75 8A87BA00             1333             MOV AL, DS:TEMP_BCD_ARR[BX]
0B79 3C00                 1334             CMP AL, 0
0B7B 740E                 1335             JE CONT_BCD_UPD
0B7D C706C4000100         1336             MOV DS:CENT_FLAG, 1
0B83 A27900               1337             MOV DS:REG_AL, AL
0B86 9A8206----     R     1338             CALL FAR PTR DAC_UPDATE
                          1339             
0B8B                      1340     CONT_BCD_UPD:
0B8B 833EC40000           1341             CMP DS:CENT_FLAG, 0
0B90 7410                 1342             JE CONT_BCD_UPD_1
0B92 C60679000F           1343             MOV DS:REG_AL, 15
0B97 9A8206----     R     1344             CALL FAR PTR DAC_UPDATE
0B9C C706C4000000         1345             MOV DS:CENT_FLAG, 0
                          1346     
0BA2                      1347     CONT_BCD_UPD_1:
                          1348             
0BA2 5A                   1349     POP DX
0BA3 59                   1350     POP CX
0BA4 5B                   1351     POP BX
0BA5 58                   1352     POP AX
0BA6 CB                   1353     RET
                          1354     CALC_DAC ENDP
                          1355     
0BA7                      1356     CALC_UPD_PRICE PROC FAR
0BA7 50                   1357     PUSH AX
0BA8 53                   1358     PUSH BX
0BA9 51                   1359     PUSH CX
0BAA 52                   1360     PUSH DX
0BAB 833EB20000           1361             CMP DS:QTY, 0
0BB0 7503                 1362             JNE CHECK_PRICE_ZERO
0BB2 E92B01               1363             JMP CALC_END
0BB5                      1364     CHECK_PRICE_ZERO:
0BB5 833EB00000           1365             CMP DS:PRICE, 0
0BBA 7503                 1366             JNE START_CALC
0BBC E92101               1367             JMP CALC_END
0BBF                      1368     START_CALC:
0BBF BA0000               1369             MOV DX, 0
0BC2 A1B000               1370             MOV AX, DS:PRICE
0BC5 8B1EB200             1371             MOV BX, DS:QTY
0BC9 F7E3                 1372             MUL BX
                          1373             
0BCB BB6400               1374             MOV BX, 100
0BCE F7F3                 1375             DIV BX
0BD0 A3B000               1376             MOV DS:PRICE, AX
0BD3 A1B800               1377             MOV AX, DS:TOTAL_PRICE_DEC
0BD6 03C2                 1378             ADD AX, DX
0BD8 3D6400               1379             CMP AX, 100
0BDB 7C07                 1380             JL NON_DECIMAL
0BDD FF06B600             1381             INC DS:TOTAL_PRICE_L
0BE1 2D6400               1382             SUB AX, 100
                          1383             
0BE4                      1384     NON_DECIMAL:    
0BE4 A3B800               1385             MOV DS:TOTAL_PRICE_DEC, AX
0BE7 A1B600               1386             MOV AX, DS:TOTAL_PRICE_L
0BEA 8B1EB000             1387             MOV BX, DS:PRICE
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    22:24:58  12/07/;3  PAGE   27


LOC  OBJ                  LINE     SOURCE

0BEE 03C3                 1388             ADD AX, BX
0BF0 7304                 1389             JNC update_normal
0BF2 FF06B400             1390             INC DS:TOTAL_PRICE_U
                          1391             
0BF6                      1392     update_normal:
0BF6 A3B600               1393             MOV DS:TOTAL_PRICE_L, AX
                          1394             
0BF9 BA0000               1395             MOV DX, 0
                          1396             ;CMP DS:TOTAL_PRICE_DEC, 9
                          1397             ;JG DECIMAL_CONT
                          1398             ;MOV CX, 10
                          1399             ;MOV AX, DS:TOTAL_PRICE_DEC
                          1400             ;MUL CX
                          1401             ;MOV DS:TOTAL_PRICE_DEC, AX
                          1402     ;DECIMAL_CONT:
0BFC A1B800               1403             MOV AX, DS:TOTAL_PRICE_DEC
0BFF B90A00               1404             MOV CX, 10
0C02 F7F1                 1405             DIV CX
                          1406             
0C04 BB0700               1407             MOV BX, 7
0C07 8897BA00             1408             MOV DS:TEMP_BCD_ARR[BX], DL
0C0B 4B                   1409             DEC BX
0C0C 8887BA00             1410             MOV DS:TEMP_BCD_ARR[BX], AL
                          1411             
0C10 BB0600               1412             MOV BX, 6
0C13 A1B600               1413             MOV AX, DS:TOTAL_PRICE_L
                          1414             
0C16                      1415             TEMP_UPD_LOOP:
0C16 BA0000               1416                     MOV DX, 0
0C19 B90A00               1417                     MOV CX, 10
0C1C F7F1                 1418                     DIV CX
                          1419                     
0C1E 4B                   1420                     DEC BX
0C1F 8897BA00             1421                     MOV DS:TEMP_BCD_ARR[BX], DL
0C23 43                   1422                     INC BX
                          1423                     
0C24 4B                   1424                     DEC BX
                          1425                     
0C25 75EF                 1426             JNZ TEMP_UPD_LOOP
                          1427             
0C27 8B0EB400             1428             MOV CX, DS:TOTAL_PRICE_U
0C2B 83F900               1429             CMP CX, 0
0C2E 7478                 1430             JE upd_dac_part
0C30                      1431             ADD_EXTRA_PART:
0C30 BB0500               1432                     MOV BX, 5
0C33 8A87BA00             1433                     MOV AL, DS:TEMP_BCD_ARR[BX]
0C37 0406                 1434                     ADD AL, 6
0C39 3C09                 1435                     CMP AL, 9
0C3B 7E08                 1436                     JLE CONT_DIGIT_1
0C3D 2C0A                 1437                     SUB AL, 10
0C3F 4B                   1438                     DEC BX
0C40 FE87BA00             1439                     INC DS:TEMP_BCD_ARR[BX]
0C44 43                   1440                     INC BX
0C45                      1441             CONT_DIGIT_1:
0C45 8887BA00             1442                     MOV DS:TEMP_BCD_ARR[BX], AL
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    22:24:58  12/07/;3  PAGE   28


LOC  OBJ                  LINE     SOURCE

0C49 4B                   1443                     DEC BX
                          1444                     
0C4A 8A87BA00             1445                     MOV AL, DS:TEMP_BCD_ARR[BX]
0C4E 0403                 1446                     ADD AL, 3
0C50 3C09                 1447                     CMP AL, 9
0C52 7E08                 1448                     JLE CONT_DIGIT_2
0C54 2C0A                 1449                     SUB AL, 10
0C56 4B                   1450                     DEC BX
0C57 FE87BA00             1451                     INC DS:TEMP_BCD_ARR[BX]
0C5B 43                   1452                     INC BX
0C5C                      1453             CONT_DIGIT_2:
0C5C 8887BA00             1454                     MOV DS:TEMP_BCD_ARR[BX], AL
0C60 4B                   1455                     DEC BX
                          1456                     
0C61 8A87BA00             1457                     MOV AL, DS:TEMP_BCD_ARR[BX]
0C65 0405                 1458                     ADD AL, 5
0C67 3C09                 1459                     CMP AL, 9
0C69 7E08                 1460                     JLE CONT_DIGIT_3
0C6B 2C0A                 1461                     SUB AL, 10
0C6D 4B                   1462                     DEC BX
0C6E FE87BA00             1463                     INC DS:TEMP_BCD_ARR[BX]
0C72 43                   1464                     INC BX
0C73                      1465             CONT_DIGIT_3:
0C73 8887BA00             1466                     MOV DS:TEMP_BCD_ARR[BX], AL
0C77 4B                   1467                     DEC BX
                          1468                     
                          1469                     
0C78 8A87BA00             1470                     MOV AL, DS:TEMP_BCD_ARR[BX]
0C7C 0405                 1471                     ADD AL, 5
0C7E 3C09                 1472                     CMP AL, 9
0C80 7E08                 1473                     JLE CONT_DIGIT_4
0C82 2C0A                 1474                     SUB AL, 10
0C84 4B                   1475                     DEC BX
0C85 FE87BA00             1476                     INC DS:TEMP_BCD_ARR[BX]
0C89 43                   1477                     INC BX
0C8A                      1478             CONT_DIGIT_4:
0C8A 8887BA00             1479                     MOV DS:TEMP_BCD_ARR[BX], AL
0C8E 4B                   1480                     DEC BX
                          1481                     
0C8F 8A87BA00             1482                     MOV AL, DS:TEMP_BCD_ARR[BX]
0C93 0406                 1483                     ADD AL, 6
0C95 3C09                 1484                     CMP AL, 9
0C97 7E08                 1485                     JLE CONT_DIGIT_5
0C99 2C0A                 1486                     SUB AL, 10
0C9B 4B                   1487                     DEC BX
0C9C FE87BA00             1488                     INC DS:TEMP_BCD_ARR[BX]
0CA0 43                   1489                     INC BX
0CA1                      1490             CONT_DIGIT_5:
0CA1 8887BA00             1491                     MOV DS:TEMP_BCD_ARR[BX], AL
0CA5 4B                   1492                     DEC BX
                          1493                     
0CA6 E288                 1494             LOOP ADD_EXTRA_PART
                          1495             
0CA8                      1496     upd_dac_part:
0CA8 9A3708----     R     1497             CALL FAR PTR CALC_DAC
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    22:24:58  12/07/;3  PAGE   29


LOC  OBJ                  LINE     SOURCE

                          1498     
0CAD 9AEB05----     R     1499             CALL FAR PTR BCD_CLEAR
0CB2 C70661000000         1500             MOV DS:KEYPAD_INDEX, 0
0CB8 C706AC000300         1501             MOV DS:DECIMAL_INDEX, 3
0CBE B90800               1502             MOV CX, 8
0CC1                      1503             UPD_BCD:
0CC1 BB0800               1504                     MOV BX, 8
0CC4 2BD9                 1505                     SUB BX, CX
0CC6 8A87BA00             1506                     MOV AL, DS:TEMP_BCD_ARR[BX]
0CCA A27900               1507                     MOV DS:REG_AL, AL
0CCD C706AA000100         1508                     MOV DS:DAC_DISABLE, 1
0CD3 9A1606----     R     1509                     CALL FAR PTR BCD_UPDATE
0CD8 C706AA000000         1510                     MOV DS:DAC_DISABLE, 0
0CDE E2E1                 1511             LOOP UPD_BCD
                          1512             
0CE0                      1513     CALC_END:
0CE0 833EB00000           1514             CMP DS:PRICE, 0
0CE5 7403                 1515             JE RETAIN_BCD_VALUE
0CE7 EB2F90               1516             JMP END_CALC_BCD_DAC
                          1517             
0CEA                      1518     RETAIN_BCD_VALUE:       
0CEA C70661000000         1519             MOV DS:KEYPAD_INDEX, 0
0CF0 C706AC000300         1520             MOV DS:DECIMAL_INDEX, 3
0CF6 B90800               1521             MOV CX, 8
0CF9                      1522             UPD_BCD1:
0CF9 BB0800               1523                     MOV BX, 8
0CFC 2BD9                 1524                     SUB BX, CX
0CFE 8A87BA00             1525                     MOV AL, DS:TEMP_BCD_ARR[BX]
0D02 A27900               1526                     MOV DS:REG_AL, AL
0D05 C706AA000100         1527                     MOV DS:DAC_DISABLE, 1
0D0B 9A1606----     R     1528                     CALL FAR PTR BCD_UPDATE
0D10 C706AA000000         1529                     MOV DS:DAC_DISABLE, 0
0D16 E2E1                 1530             LOOP UPD_BCD1
                          1531     
0D18                      1532     END_CALC_BCD_DAC:
0D18 C706B0000000         1533             MOV DS:PRICE, 0
0D1E C706B2000000         1534             MOV DS:QTY, 0
0D24 5A                   1535     POP DX
0D25 59                   1536     POP CX
0D26 5B                   1537     POP BX
0D27 58                   1538     POP AX
0D28 CB                   1539     RET
                          1540     CALC_UPD_PRICE ENDP
                          1541     
0D29                      1542     UPDATE_TROLLEY PROC FAR
0D29 50                   1543     PUSH AX
0D2A 53                   1544     PUSH BX
0D2B 51                   1545     PUSH CX
0D2C 52                   1546     PUSH DX
0D2D B90800               1547             MOV CX, 8
0D30                      1548             CLEAR_TEMP_BCD_TROLLEY:
0D30 8BD9                 1549                     MOV BX, CX
0D32 4B                   1550                     DEC BX
0D33 C687BA0000           1551                     MOV DS:TEMP_BCD_ARR[BX], 0
0D38 E2F6                 1552             LOOP CLEAR_TEMP_BCD_TROLLEY
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    22:24:58  12/07/;3  PAGE   30


LOC  OBJ                  LINE     SOURCE

                          1553             
0D3A 8B0EF400             1554             MOV CX, DS:TROLLEY_INDEX
0D3E BA0800               1555             MOV DX, 8
                          1556             
0D41                      1557             UPD_TROLLEY_PRICE:
0D41 8BD9                 1558                     MOV BX, CX
0D43 4B                   1559                     DEC BX
                          1560                     
0D44 8A87EC00             1561                     MOV AL, DS:TROLLEY_ARRAY[BX]
                          1562                     
0D48 8BDA                 1563                     MOV BX, DX
0D4A 4B                   1564                     DEC BX
                          1565                     
0D4B 8887BA00             1566                     MOV DS:TEMP_BCD_ARR[BX], AL
                          1567                     
0D4F 4A                   1568                     DEC DX
0D50 E2EF                 1569             LOOP UPD_TROLLEY_PRICE
                          1570             
0D52 B90800               1571             MOV CX, 8
0D55 C70661000000         1572             MOV DS:KEYPAD_INDEX, 0
0D5B                      1573             UPDATE_TROLLEY_PRICE_DISPLAY:
0D5B BB0800               1574                     MOV BX, 8
0D5E 2BD9                 1575                     SUB BX, CX
0D60 8A87BA00             1576                     MOV AL, DS:TEMP_BCD_ARR[BX]
0D64 A27900               1577                     MOV DS:REG_AL, AL
0D67 C706AA000100         1578                     MOV DS:DAC_DISABLE, 1
0D6D 9A1606----     R     1579                     CALL FAR PTR BCD_UPDATE
0D72 C706AA000000         1580                     MOV DS:DAC_DISABLE, 0
0D78 E2E1                 1581             LOOP UPDATE_TROLLEY_PRICE_DISPLAY
                          1582             
0D7A 9A3708----     R     1583             CALL FAR PTR CALC_DAC
                          1584     
0D7F 5A                   1585     POP DX
0D80 59                   1586     POP CX
0D81 5B                   1587     POP BX
0D82 5A                   1588     POP DX
0D83 CB                   1589     RET
                          1590     UPDATE_TROLLEY ENDP
                          1591     ; ^^^^^^^^^^^^^^^ End of User main routine ^^^^^^^^^^^^^^^^^^^^^^^^^
0D84                      1592     SERIAL_REC_ACTION       PROC    FAR
0D84 51                   1593                     PUSH    CX
0D85 53                   1594                     PUSH    BX
0D86 1E                   1595                     PUSH    DS
                          1596                     
0D87 BB----         R     1597                     MOV     BX,DATA_SEG             ;initialize data segment register
0D8A 8EDB                 1598                     MOV     DS,BX
                          1599                     
0D8C 803E8B0001           1600                     CMP DS:REPLY_FLAG, 1
0D91 7557                 1601                     JNE next_id1
                          1602                     
0D93 803E8C0001           1603                     CMP DS:SEND_FLAG, 1
0D98 7453                 1604                     JE send_input_across1
                          1605                     
0D9A 833EA00001           1606                     CMP DS:RECEIVE_FLAG, 1
0D9F 754F                 1607                     JNE terminate_session3
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    22:24:58  12/07/;3  PAGE   31


LOC  OBJ                  LINE     SOURCE

                          1608                     
0DA1 3C2F                 1609                     CMP AL, '/'
0DA3 752C                 1610                     JNE CHECK_SEND
0DA5 C706A4000000         1611                     MOV DS:PRICE_FLAG, 0
0DAB C706A0000000         1612                     MOV DS:RECEIVE_FLAG, 0
0DB1 C706AE000100         1613                     MOV DS:LANG_FLAG, 1
0DB7 833EF60000           1614                     CMP DS:TROLLEY_FLAG, 0
0DBC 7405                 1615                     JE TROLLEY_UPD_SKIP
0DBE 9A290D----     R     1616                     CALL FAR PTR UPDATE_TROLLEY
0DC3                      1617             TROLLEY_UPD_SKIP:
0DC3 C706F6000000         1618                     MOV DS:TROLLEY_FLAG, 0
0DC9 9AA70B----     R     1619                     CALL FAR PTR CALC_UPD_PRICE
0DCE EB2090               1620                     JMP terminate_session3
                          1621             
0DD1                      1622             CHECK_SEND:
0DD1 3C26                 1623                     CMP AL, '&'
0DD3 751E                 1624                     JNE TROLLEY_PRICE
0DD5 C706A4000100         1625                     MOV DS:PRICE_FLAG, 1
0DDB C70661000000         1626                     MOV DS:KEYPAD_INDEX, 0
0DE1 C7069C000800         1627                     MOV DS:MAX_INPUT_SIZE, 8
0DE7 E9E300               1628                     JMP id_skip2
                          1629             
                          1630             
0DEA                      1631             next_id1:
0DEA E9E300               1632                     JMP next_id
                          1633                     
0DED                      1634             send_input_across1:
0DED E9C100               1635                     JMP send_input_across
                          1636             
0DF0                      1637             terminate_session3:
0DF0 E9D700               1638                     JMP terminate_session2
                          1639             
                          1640                     
0DF3                      1641             TROLLEY_PRICE:
0DF3 3C2B                 1642                     CMP AL, '+'
0DF5 7515                 1643                     JNE receive_price
0DF7 C7069C000800         1644                     MOV DS:MAX_INPUT_SIZE, 8
0DFD C706F6000100         1645                     MOV DS:TROLLEY_FLAG, 1
0E03 C706F4000000         1646                     MOV DS:TROLLEY_INDEX, 0
0E09 E9C100               1647                     JMP id_skip2
                          1648                     
0E0C                      1649             receive_price:
0E0C 3C23                 1650                     CMP AL, '#'
0E0E 7543                 1651                     JNE check_price
0E10 C706A2000100         1652                     MOV DS:DAC_FLAG, 1
0E16 C706A4000000         1653                     MOV DS:PRICE_FLAG, 0
0E1C C706B0000000         1654                     MOV DS:PRICE, 0
0E22 833EF60000           1655                     CMP DS:TROLLEY_FLAG, 0
0E27 7421                 1656                     JE TROLLEY_UPD_SKIP2
0E29 9A290D----     R     1657                     CALL FAR PTR UPDATE_TROLLEY
                          1658                     ;CLEAN STATE
0E2E C706AC000300         1659                     MOV DS:DECIMAL_INDEX, 3
0E34 9AEB05----     R     1660                     CALL FAR PTR BCD_CLEAR
0E39 C7069C000000         1661                     MOV DS:MAX_INPUT_SIZE, 0
0E3F 9AA904----     R     1662                     CALL FAR PTR CLEAR_TEMP_BCD
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    22:24:58  12/07/;3  PAGE   32


LOC  OBJ                  LINE     SOURCE

                          1663                     
0E44 C706C8000000         1664                     MOV DS:CASH_FLAG, 0
                          1665                     
0E4A                      1666             TROLLEY_UPD_SKIP2:
0E4A C706F6000000         1667                     MOV DS:TROLLEY_FLAG, 0
                          1668                     
0E50 EB7B90               1669                     JMP id_skip2
                          1670             
0E53                      1671             check_price:    
                          1672             
0E53 833EA40001           1673                     CMP DS:PRICE_FLAG, 1
0E58 7440                 1674                     JE update_price_value
                          1675                     
0E5A 833EF60001           1676                     CMP DS:TROLLEY_FLAG, 1
0E5F 7428                 1677                     JE update_trolley_arr
                          1678                     
0E61 833EA20001           1679                     CMP DS:DAC_FLAG, 1
0E66 7403                 1680                     JE dac_change
0E68 EB6390               1681                     JMP id_skip2
                          1682     
0E6B                      1683             dac_change:
0E6B 8A1E7900             1684                     MOV BL, DS:REG_AL
0E6F 2C30                 1685                     SUB AL, 30H
0E71 A27900               1686                     MOV DS:REG_AL, AL
0E74 9A8206----     R     1687                     CALL FAR PTR DAC_UPDATE
0E79 881E7900             1688                     MOV DS:REG_AL, BL
0E7D C706A2000000         1689                     MOV DS:DAC_FLAG, 0
0E83 EB4890               1690                     JMP id_skip2
                          1691             
                          1692     
0E86 EB4590               1693             id_skip3: JMP id_skip2
                          1694             
0E89                      1695             update_trolley_arr:
0E89 8B1EF400             1696                     MOV BX, DS:TROLLEY_INDEX
0E8D 2C30                 1697                     SUB AL, 30H
0E8F 8887EC00             1698                     MOV DS:TROLLEY_ARRAY[BX], AL
0E93 FF06F400             1699                     INC DS:TROLLEY_INDEX
0E97 EB3490               1700                     JMP id_skip2
                          1701                     
0E9A                      1702             update_price_value:
0E9A 2C30                 1703                     SUB AL, 30H
0E9C B90000               1704                     MOV CX, 0
0E9F 8AC8                 1705                     MOV CL, AL
0EA1 A1B000               1706                     MOV AX, DS:PRICE
0EA4 BB0A00               1707                     MOV BX, 10
0EA7 F7E3                 1708                     MUL BX
                          1709                     
0EA9 03C1                 1710                     ADD AX, CX
0EAB A3B000               1711                     MOV DS:PRICE, AX
0EAE EB1D90               1712                     JMP id_skip2
                          1713                     
0EB1                      1714             send_input_across:
0EB1 9AA506----     R     1715                     CALL FAR PTR SEND_INPUT
                          1716                     
0EB6 C7069A000000         1717                     MOV DS:SEND_BUFFER_LEN, 0
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    22:24:58  12/07/;3  PAGE   33


LOC  OBJ                  LINE     SOURCE

                          1718                     
0EBC C6068C0000           1719                     MOV DS:SEND_FLAG, 0
                          1720                     
0EC1 C706A0000100         1721                     MOV DS:RECEIVE_FLAG, 1
                          1722                     
0EC7 EB0490               1723                     JMP id_skip2
                          1724                     
0ECA EB3E90               1725                     terminate_session2: JMP terminate_session
0ECD EB6790               1726                     id_skip2: JMP id_skip
                          1727                     
0ED0                      1728             next_id:
                          1729                     
0ED0 803E810001           1730                     CMP DS:ID_FLAG_r, 1
0ED5 7513                 1731                     JNE id_flag_label
0ED7 38067F00             1732                     CMP DS:MY_ID[1], AL
0EDB 7559                 1733                     JNE id_skip
                          1734                     ;start writing to pc
0EDD C6068B0001           1735                     MOV DS:REPLY_FLAG, 1
0EE2 C606810000           1736                     MOV DS:ID_FLAG_r, 0
0EE7 EB4D90               1737                     JMP id_skip
                          1738             
0EEA                      1739             id_flag_label:
                          1740             
0EEA 803E800001           1741                     CMP DS:ID_FLAG_@, 1
0EEF 7539                 1742                     JNE protocol_rec
0EF1 3C72                 1743                     CMP AL,'r'
0EF3 750D                 1744                     JNE id_not_r
0EF5 C606810001           1745                     MOV DS:ID_FLAG_r,1
0EFA C606800000           1746                     MOV DS:ID_FLAG_@, 0
0EFF EB3590               1747                     JMP S_RET
0F02                      1748             id_not_r:
0F02 C606800000           1749                     MOV DS:ID_FLAG_@, 0
0F07 EB2D90               1750                     JMP id_skip
                          1751             
0F0A                      1752             terminate_session:
0F0A C606810000           1753                     MOV DS:ID_FLAG_r, 0
0F0F 33DB                 1754                     XOR BX,BX
0F11                      1755             start_send1:
0F11 50                   1756                     PUSH AX
0F12 33C0                 1757                     XOR AX,AX
0F14 8A878600             1758                     MOV AL, DS:FAIL_MESSAGE[BX]
0F18 9A0000----     E     1759                     CALL FAR PTR PRINT_CHAR
0F1D 58                   1760                     POP AX
0F1E C6068B0000           1761                     MOV DS:REPLY_FLAG, 0
0F23 43                   1762                     INC BX
0F24 3A1E8A00             1763                     CMP BL, DS:FAIL_COUNT
0F28 75E7                 1764                     JNE start_send1
                          1765                     
0F2A                      1766             protocol_rec:
0F2A 3C40                 1767                     CMP AL,'@'
0F2C 7508                 1768                     JNE id_skip
0F2E C606800001           1769                     MOV DS:ID_FLAG_@,1
0F33 EB0190               1770                     JMP S_RET
                          1771                     
0F36                      1772             id_skip:
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    22:24:58  12/07/;3  PAGE   34


LOC  OBJ                  LINE     SOURCE

                          1773                     ; JMP S_RET
                          1774             
                          1775                     ; CMP   AL,'<'
                          1776                     ; JNE   S_FAST
                          1777     
                          1778                     ; INC   DS:T_COUNT_SET
                          1779                     ; INC   DS:T_COUNT_SET
                          1780     
                          1781                     ; JMP   S_NEXT0
                          1782     ; S_FAST:
                          1783                     ; CMP   AL,'>'
                          1784                     ; JNE   S_RET
                          1785     
                          1786                     ; DEC   DS:T_COUNT_SET
                          1787                     ; DEC   DS:T_COUNT_SET
                          1788     
                          1789     ; S_NEXT0:
                          1790                     ; MOV   CX,22                   ;initialize counter for message
                          1791                     ; MOV   BX,0
                          1792     
                          1793     ; S_NEXT1:      MOV     AL,DS:REC_MESS[BX]      ;print message
                          1794                     ; call  FAR ptr print_char
                          1795                     ; INC   BX
                          1796                     ; LOOP  S_NEXT1
                          1797     
                          1798                     ; MOV   AL,DS:T_COUNT_SET       ;print current period of timer0
                          1799                     ; CALL  FAR PTR PRINT_2HEX
0F36                      1800     S_RET:
0F36 1F                   1801                     POP     DS
0F37 5B                   1802                     POP     BX
0F38 59                   1803                     POP     CX
0F39 CB                   1804                     RET
                          1805     SERIAL_REC_ACTION       ENDP
                          1806     
0F3A                      1807     TIMER2_ACTION   PROC    FAR
0F3A 50                   1808                     PUSH    AX
0F3B 1E                   1809                     PUSH    DS
0F3C 53                   1810                     PUSH    BX
0F3D 51                   1811                     PUSH    CX
0F3E 52                   1812                     PUSH    DX
                          1813                     
                          1814                     
0F3F B8----         R     1815                     MOV     AX,DATA_SEG
0F42 8ED8                 1816                     MOV     DS,AX
                          1817             
0F44 FE0E1600             1818                     DEC     DS:T_COUNT
0F48 754A                 1819                     JNZ     T_NEXT1
0F4A A01700               1820                     MOV     AL,DS:T_COUNT_SET
0F4D A21600               1821                     MOV     DS:T_COUNT,AL
                          1822     
0F50                      1823     T_NEXT0:
                          1824                     
0F50 33DB                 1825                     XOR BX, BX
0F52 8A1E6000             1826                     MOV BL, DS:BCD_INDEX
0F56 8A4759               1827                     MOV AL, DS:BCD_MESSAGE[BX]
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    22:24:58  12/07/;3  PAGE   35


LOC  OBJ                  LINE     SOURCE

                          1828                     
0F59 3B1EAC00             1829                     CMP BX, DS:DECIMAL_INDEX
0F5D 7506                 1830                     JNE CALL_FUNC
0F5F C706A6000100         1831                     MOV DS:DECIMAL_FLAG, 1
0F65                      1832     CALL_FUNC:
0F65 9A0510----     R     1833                     CALL FAR PTR BCD_TO_7SEG
0F6A C706A6000000         1834                     MOV DS:DECIMAL_FLAG, 0
                          1835     
0F70 BA0002               1836                     MOV DX, 200H
0F73 EE                   1837                     OUT DX, AL
                          1838                     
0F74 A05F00               1839                     MOV AL, DS:ENABLE_BYTE
0F77 BA8001               1840                     MOV DX, 180H
0F7A EE                   1841                     OUT DX, AL
                          1842                     
                          1843     
0F7B FE066000             1844                     INC DS:BCD_INDEX
0F7F D0065F00             1845                     ROL DS:ENABLE_BYTE, 1
0F83 803E5F00BF           1846                     CMP DS:ENABLE_BYTE, 10111111b
0F88 750A                 1847                     JNE T_NEXT1
0F8A C6065F00FE           1848                     MOV DS:ENABLE_BYTE, 11111110b 
0F8F C606600000           1849                     MOV DS:BCD_INDEX, 0
                          1850     
                          1851                     
0F94                      1852     T_NEXT1:
0F94 803E750000           1853                     CMP DS:DAC_LEN, 0
0F99 743C                 1854                     JE ISR_END
                          1855                     
                          1856                     
0F9B 8B367600             1857                     MOV SI, DS:SI_PTR
                          1858                             
0F9F BB0000               1859                     MOV BX, 0
0FA2 33C0                 1860                     XOR AX, AX
0FA4 8A4766               1861                     MOV AL, DS:DAC_ADDR[BX]
                          1862                     
0FA7 BB0001               1863                     MOV BX, 100H
0FAA F7E3                 1864                     MUL BX
                          1865                     
0FAC 8B166400             1866                     MOV DX, DS:DAC_BASE
0FB0 03D0                 1867                     ADD DX, AX
                          1868                     
0FB2 1E                   1869                     PUSH DS
0FB3 8EDA                 1870                     MOV DS, DX
                          1871                     
0FB5 8B04                 1872                     MOV AX, [SI]
                          1873                     
0FB7 BA1001               1874                     MOV DX, 110H
0FBA EE                   1875                     OUT DX, AL
                          1876                     
0FBB 1F                   1877                     POP DS
                          1878                     
0FBC FF067600             1879                     INC DS:SI_PTR
0FC0 813E76000010         1880                     CMP DS:SI_PTR, 1000H
0FC6 750F                 1881                     JNE ISR_END
                          1882                     
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    22:24:58  12/07/;3  PAGE   36


LOC  OBJ                  LINE     SOURCE

0FC8 C70676000000         1883                     MOV DS:SI_PTR, 0
0FCE FE0E7500             1884                     DEC DS:DAC_LEN
0FD2 9ADD0F----     R     1885                     CALL FAR PTR DAC_SHIFT
                          1886                     
0FD7                      1887     ISR_END:
                          1888                     
0FD7 5A                   1889                     POP DX
0FD8 59                   1890                     POP     CX
0FD9 5B                   1891                     POP     BX
0FDA 1F                   1892                     POP     DS
0FDB 58                   1893                     POP AX
0FDC CB                   1894                     RET
                          1895     TIMER2_ACTION   ENDP
                          1896     
                          1897     
0FDD                      1898     DAC_SHIFT PROC FAR
0FDD 50                   1899             PUSH AX
0FDE 53                   1900             PUSH BX
0FDF 51                   1901             PUSH CX
0FE0 52                   1902             PUSH DX
                          1903     
0FE1 33C9                 1904             XOR CX, CX
0FE3 8A0E7500             1905             MOV CL, DS:DAC_LEN
0FE7 80F900               1906             CMP CL, 0
0FEA 7414                 1907             JE END_SHIFT
                          1908     
0FEC                      1909             SHIFT_LOOP:
                          1910     
0FEC 33DB                 1911             XOR BX, BX
0FEE 8A1E7500             1912             MOV BL, DS:DAC_LEN
0FF2 2BD9                 1913             SUB BX, CX
0FF4 43                   1914             INC BX
                          1915             
0FF5 33D2                 1916             XOR DX, DX
0FF7 8A5766               1917             MOV DL, DS:DAC_ADDR[BX]
0FFA 4B                   1918             DEC BX
0FFB 885766               1919             MOV DS:DAC_ADDR[BX], DL
                          1920     
0FFE E2EC                 1921             LOOP SHIFT_LOOP
                          1922             
1000                      1923             END_SHIFT:
1000 5A                   1924             POP DX
1001 59                   1925             POP CX
1002 5B                   1926             POP BX
1003 58                   1927             POP AX
1004 CB                   1928             RET
                          1929     DAC_SHIFT ENDP
                          1930     
1005                      1931     BCD_TO_7SEG PROC FAR
                          1932     
1005 53                   1933             PUSH BX
1006 51                   1934             PUSH CX
1007 52                   1935             PUSH DX
                          1936             
1008 3C00                 1937             CMP AL, 0
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    22:24:58  12/07/;3  PAGE   37


LOC  OBJ                  LINE     SOURCE

100A 7511                 1938             JNE one
100C 833EA60001           1939             CMP DS:DECIMAL_FLAG, 1
1011 7405                 1940             JE decimal0
1013 B03F                 1941             MOV AL, 00111111b
1015 E9D700               1942             JMP endfunc
1018                      1943     decimal0:
1018 B0BF                 1944             MOV AL, 10111111b
101A E9D200               1945             JMP endfunc
                          1946             
101D                      1947             one:
101D 3C01                 1948             CMP AL, 1
101F 7511                 1949             JNE two
1021 833EA60001           1950             CMP DS:DECIMAL_FLAG, 1
1026 7405                 1951             JE decimal1
1028 B006                 1952             MOV AL, 00000110b
102A E9C200               1953             JMP endfunc
102D                      1954     decimal1:
102D B086                 1955             MOV AL, 10000110b
102F E9BD00               1956             JMP endfunc
                          1957             
1032                      1958             two:
1032 3C02                 1959             CMP AL,2
1034 7511                 1960             JNE three
1036 833EA60001           1961             CMP DS:DECIMAL_FLAG, 1
103B 7405                 1962             JE decimal2
103D B05B                 1963             MOV AL, 01011011b
103F E9AD00               1964             JMP endfunc
1042                      1965     decimal2:
1042 B0DB                 1966             MOV AL, 11011011b
1044 E9A800               1967             JMP endfunc
                          1968             
1047                      1969             three:
1047 3C03                 1970             CMP AL,3
1049 7511                 1971             JNE four
104B 833EA60001           1972             CMP DS:DECIMAL_FLAG, 1
1050 7405                 1973             JE decimal3
1052 B04F                 1974             MOV AL, 01001111b
1054 E99800               1975             JMP endfunc
1057                      1976     decimal3:
1057 B0CF                 1977             MOV AL, 11001111b
1059 E99300               1978             JMP endfunc
                          1979             
105C                      1980             four:
105C 3C04                 1981             CMP AL,4
105E 7511                 1982             JNE five
1060 833EA60001           1983             CMP DS:DECIMAL_FLAG, 1
1065 7405                 1984             JE decimal4
1067 B066                 1985             MOV AL, 01100110b
1069 E98300               1986             JMP endfunc
106C                      1987     decimal4:
106C B0E6                 1988             MOV AL, 11100110b
106E EB7F90               1989             JMP endfunc
                          1990             
1071                      1991             five:
1071 3C05                 1992             CMP AL,5
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    22:24:58  12/07/;3  PAGE   38


LOC  OBJ                  LINE     SOURCE

1073 7511                 1993             JNE six
1075 833EA60001           1994             CMP DS:DECIMAL_FLAG, 1
107A 7405                 1995             JE decimal5
107C B06D                 1996             MOV AL, 01101101b
107E EB6F90               1997             JMP endfunc
1081                      1998     decimal5:
1081 B0ED                 1999             MOV AL, 11101101b
1083 EB6A90               2000             JMP endfunc
                          2001             
1086                      2002             six:
1086 3C06                 2003             CMP AL,6
1088 7511                 2004             JNE seven
108A 833EA60001           2005             CMP DS:DECIMAL_FLAG, 1
108F 7405                 2006             JE decimal6
1091 B07D                 2007             MOV AL, 01111101b
1093 EB5A90               2008             JMP endfunc
1096                      2009     decimal6:
1096 B0FD                 2010             MOV AL, 11111101b
1098 EB5590               2011             JMP endfunc
                          2012             
109B                      2013             seven:
109B 3C07                 2014             CMP AL,7
109D 7511                 2015             JNE eight
109F 833EA60001           2016             CMP DS:DECIMAL_FLAG, 1
10A4 7405                 2017             JE decimal7
10A6 B007                 2018             MOV AL, 00000111b
10A8 EB4590               2019             JMP endfunc
10AB                      2020     decimal7:
10AB B087                 2021             MOV AL, 10000111b
10AD EB4090               2022             JMP endfunc
                          2023             
10B0                      2024             eight:
10B0 3C08                 2025             CMP AL,8
10B2 7511                 2026             JNE nine
10B4 833EA60001           2027             CMP DS:DECIMAL_FLAG, 1
10B9 7405                 2028             JE decimal8
10BB B07F                 2029             MOV AL, 01111111b
10BD EB3090               2030             JMP endfunc
10C0                      2031     decimal8:
10C0 B0FF                 2032             MOV AL, 11111111b
10C2 EB2B90               2033             JMP endfunc
                          2034             
10C5                      2035             nine:
10C5 3C09                 2036             CMP AL,9
10C7 7511                 2037             JNE hifn
10C9 833EA60001           2038             CMP DS:DECIMAL_FLAG, 1
10CE 7405                 2039             JE decimal9
10D0 B06F                 2040             MOV AL, 01101111b
10D2 EB1B90               2041             JMP endfunc
10D5                      2042     decimal9:
10D5 B0EF                 2043             MOV AL, 11101111b
10D7 EB1690               2044             JMP endfunc
                          2045             
10DA                      2046             hifn:
10DA 3C2D                 2047             CMP AL,'-'
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    22:24:58  12/07/;3  PAGE   39


LOC  OBJ                  LINE     SOURCE

10DC 7511                 2048             JNE endfunc
10DE 833EA60001           2049             CMP DS:DECIMAL_FLAG, 1
10E3 7405                 2050             JE decimal10
10E5 B040                 2051             MOV AL, 01000000b
10E7 EB0690               2052             JMP endfunc
10EA                      2053     decimal10:
10EA B0C0                 2054             MOV AL, 11000000b
10EC EB0190               2055             JMP endfunc
                          2056             
10EF                      2057             endfunc:
10EF 5A                   2058             POP DX
10F0 59                   2059             POP CX
10F1 5B                   2060             POP BX
                          2061     
10F2 CB                   2062     RET
                          2063     BCD_TO_7SEG ENDP
                          2064     
----                      2065     CODE_SEG        ENDS
                          2066     END

ASSEMBLY COMPLETE, NO ERRORS FOUND
