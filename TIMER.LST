8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    02:42:25  12/07/;3  PAGE    1


DOS 5.0 (038-N) 8086/87/88/186 MACRO ASSEMBLER V3.1 ASSEMBLY OF MODULE TIMER
OBJECT MODULE PLACED IN TIMER.OBJ
ASSEMBLER INVOKED BY:  D:\ASM86.EXE TIMER.ASM


LOC  OBJ                  LINE     SOURCE

                             1 +1  $MOD186
                             2 +1  $EP
                             3     NAME TIMER
                             4     ; Main program for uPD70208 microcomputer system
                             5     ;
                             6     ; Author:       Dr Tay Teng Tiow
                             7     ; Address:      Department of Electrical Engineering 
                             8     ;               National University of Singapore
                             9     ;               10, Kent Ridge Crescent
                            10     ;               Singapore 0511. 
                            11     ; Date:         6th September 1991
                            12     ;
                            13     ; This file contains proprietory information and cannot be copied 
                            14     ; or distributed without prior permission from the author.
                            15     ; =========================================================================
                            16     
                            17     public  serial_rec_action, timer2_action
                            18     extrn   print_char:far, print_2hex:far, iodefine:far
                            19     extrn   set_timer2:far
                            20     
                            21     ;IO Setup for 80C188 
  FFA0                      22             UMCR    EQU    0FFA0H ; Upper Memory Control Register
  FFA2                      23             LMCR    EQU    0FFA2H ; Lower Memory control Register         
  FFA4                      24             PCSBA   EQU    0FFA4H ; Peripheral Chip Select Base Address
  FFA8                      25             MPCS    EQU    0FFA8H ; MMCS and PCS Alter Control Register
  0080                      26             A_8255  EQU    0080H
  0081                      27             B_8255  EQU    0081H
  0082                      28             C_8255  EQU    0082H
  0083                      29             CWR_8255  EQU    0083H
  FF38                      30             INT0CON  EQU   0FF38H
  FF22                      31             EOI EQU 0FF22H
  FF28                      32             IMASK EQU 0FF28H
  FFA6                      33             MMCS    EQU    0FFA6H 
  4000                      34             DAC EQU 4000H
                            35     
                            36     
----                        37     STACK_SEG       SEGMENT
0000 (512                   38                     DB      512 DUP(?)
     ??
     )
0200                        39             TOS     LABEL   WORD
----                        40     STACK_SEG       ENDS
                            41     
                            42     
----                        43     DATA_SEG        SEGMENT
0000 0A                     44             TIMER0_MESS             DB      10,13,'TIMER2 INTERRUPT    '
0001 0D
0002 54494D45523220
     494E5445525255
     505420202020
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    02:42:25  12/07/;3  PAGE    2


LOC  OBJ                  LINE     SOURCE

0016 18                     45             T_COUNT                 DB      24
0017 18                     46             T_COUNT_SET             DB      24
0018 0A                     47             REC_MESS                DB      10,13,'Period of timer0 =     '
0019 0D
001A 506572696F6420
     6F662074696D65
     7230203D202020
     2020
0031 (32                    48             MESSAGE         DB  32 dup('h')
     68
     )
0051 00                     49             KEYPAD_INPUT    DB  0,0,0,0,0,0,0,0
0052 00
0053 00
0054 00
0055 00
0056 00
0057 00
0058 00
0059 2D                     50             BCD_MESSAGE     DB  '-','-','-','-','-','-'
005A 2D
005B 2D
005C 2D
005D 2D
005E 2D
005F FE                     51             ENABLE_BYTE     DB  11111110b
0060 00                     52             BCD_INDEX       DB  0
0061 0000                   53             KEYPAD_INDEX    DW      0
0063 20                     54             M_SIZE                  DB  32
0064 0040                   55             DAC_BASE        DW  4000H
0066 (15                    56             DAC_ADDR        DB  15 dup(0) 
     00
     )
0075 00                     57             DAC_LEN         DB  0
0076 0000                   58             SI_PTR          DW  0
0078 ??                     59             CHAR                    DB  ?
0079 ??                     60             REG_AL                  DB  ?
007A ??                     61             REG_BH                  DB  ?
007B ??                     62             REG_CL                  DB  ?
007C 00                     63             FLAG            DB  0
007D 00                     64             LONG_PRESS_FLAG DB      0
007E 7231                   65             MY_ID                   DB      'r1'
0080 00                     66             ID_FLAG_@               DB      0
0081 00                     67             ID_FLAG_r               DB      0
0082 4072312F               68             REPLY_MESSAGE   DB      '@r1/'
0086 40302F                 69             FAIL_MESSAGE    DB '@0/'
0089 04                     70             REPLY_COUNT             DB      4
008A 03                     71             FAIL_COUNT              DB      3
008B 00                     72             REPLY_FLAG              DB      0
008C 00                     73             SEND_FLAG       DB  0
008D (13                    74             SEND_BUFFER     DB  13 dup(0)
     00
     )
009A 0000                   75             SEND_BUFFER_LEN DW      0
009C 0000                   76             MAX_INPUT_SIZE  DW      0
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    02:42:25  12/07/;3  PAGE    3


LOC  OBJ                  LINE     SOURCE

009E 0000                   77             QTY_FLAG                DW      0
00A0 0000                   78             RECEIVE_FLAG    DW      0
00A2 0000                   79             DAC_FLAG                DW      0
00A4 0000                   80             PRICE_FLAG      DW      0
00A6 0100                   81             DECIMAL_FLAG    DW      1
00A8 0000                   82             SCROLL_LEN      DW      0
00AA 0000                   83             DAC_DISABLE     DW  0
00AC 0300                   84             DECIMAL_INDEX   DW  3
00AE 0100                   85             LANG_FLAG       DW  1
00B0 0000                   86             PRICE                   DW      0
00B2 0000                   87             QTY                             DW      0
00B4 0000                   88             TOTAL_PRICE_U   DW      0
00B6 0000                   89             TOTAL_PRICE_L   DW      0
00B8 0000                   90             TOTAL_PRICE_DEC DW      0
00BA (8                     91             TEMP_BCD_ARR    DB  8 dup(0)
     00
     )
00C2 0000                   92             THOUSAND_FLAG   DW  0
00C4 0000                   93             CENT_FLAG               DW      0
00C6 0000                   94             DOLLAR_FLAG             DW      0
00C8 0000                   95             CASH_FLAG               DW      0
00CA (8                     96             CASH_AMT        DB  8 dup(0)
     00
     )
00D2 (8                     97             TEMP_CASH_ARR   DW  8 dup(0)
     0000
     )
00E2 0000                   98             CASH_OK_FLAG    DW  0
00E4 0000                   99             BORROW_POSITION DW  0
00E6 0100                  100             CANCEL_FLAG             DW  1
00E8 0000                  101             TRANSACTION_OVER DW 0
00EA 0100                  102             DATA_ENTER              DW  1
00EC (8                    103             TROLLEY_ARRAY   DB  8 dup(0)
     00
     )
00F4 0000                  104             TROLLEY_INDEX   DW  0
00F6 0000                  105             TROLLEY_FLAG    DW  0
00F8 0000                  106             TROLLEY_ID              DW  0
----                       107     DATA_SEG        ENDS
                           108     
                           109     
----                       110     CODE_SEG        SEGMENT
                           111     
                           112             PUBLIC          START
                           113     
                           114     ASSUME  CS:CODE_SEG, SS:STACK_SEG
                           115     
0000                       116     START:
                           117     ;initialize stack area
0000 B8----         R      118                     MOV     AX,STACK_SEG            
0003 8ED0                  119                     MOV     SS,AX
0005 368B260002            120                     MOV     SP,TOS
                           121                     
                           122     ; Initialize the on-chip pheripherals
000A 9A0000----     E      123                     CALL    FAR PTR IODEFINE
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    02:42:25  12/07/;3  PAGE    4


LOC  OBJ                  LINE     SOURCE

                           124                     
000F 9A0000----     E      125     call set_timer2
0014 FB                    126                    STI
                           127     
                           128     ; ^^^^^^^^^^^^^^^^^  Start of User Main Routine  ^^^^^^^^^^^^^^^^^^
                           129     
                           130     ;Initialize MMCS
                           131             
0015 BAA6FF                132             MOV DX, MMCS
0018 B80340                133             MOV AX, 4003H
001B EF                    134             OUT DX, AX
                           135     
                           136     ; Initialize MPCS to MAP peripheral to IO address
                           137             
001C BAA8FF                138             MOV DX, MPCS
001F B88320                139             MOV AX, 2083H
0022 EF                    140             OUT DX, AX
                           141        
                           142     ; PCSBA initial, set the parallel port start from 00H
0023 BAA4FF                143             MOV DX, PCSBA
0026 B80300                144             MOV AX, 0003H ; Peripheral starting address 00H no READY, No Waits
0029 EF                    145             OUT DX, AX
                           146     
                           147     ; Initialize LMCS 
002A BAA2FF                148         MOV DX, LMCR
002D B8C401                149         MOV AX, 01C4H  ; Starting address 1FFFH, 8K, No waits, last shoud be 5H for 1 wai
                                   ts      
0030 EF                    150         OUT DX, AX
                           151             
0031 B8----         R      152             MOV AX, DATA_SEG
0034 8ED8                  153             MOV DS, AX
                           154                              
0036 BA8300                155             MOV DX, CWR_8255
0039 B88200                156             MOV AX, 0082h
003C EF                    157             OUT DX, AX
                           158             
003D                       159     NEXT:
003D 9A4400----     R      160             CALL FAR PTR KEYPAD_LOOP
                           161             
0042 EBF9                  162     JMP NEXT
                           163     
0044                       164     KEYPAD_LOOP PROC FAR
0044 50                    165     PUSH AX
0045 53                    166     PUSH BX
0046 51                    167     PUSH CX
0047 52                    168     PUSH DX
                           169             
0048 9A5206----     R      170                             CALL FAR PTR DEBOUNCE           
                           171                             
004D C606790003            172     WAIT_1:         MOV DS:REG_AL, 03H
0052 BB0000                173                         MOV BX, 0000H
0055 BA8200                174                         MOV DX,C_8255
0058 8AC3                  175                         MOV AL,BL
005A EE                    176                         OUT DX,AL
                           177                        
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    02:42:25  12/07/;3  PAGE    5


LOC  OBJ                  LINE     SOURCE

005B BA8100                178                         MOV DX,B_8255
005E EC                    179                         IN AL,DX
005F 8AD8                  180                         MOV BL,AL  
0061 80E3FC                181                         AND BL,0FCH
0064 80FBFC                182                         CMP BL,0FCH
                           183                      
0067 7449                  184                     JE LONG_PRESS
                           185                             
0069 B3FE                  186                         MOV BL, 0FEH
006B C6067A0004            187                         MOV DS:REG_BH, 04H
                           188                        
0070                       189     NXTROW: 
0070 C0C307                190                     ROL BL,07H
0073 8AEB                  191                             MOV CH,BL
0075 BA8200                192                             MOV DX,C_8255
0078 8AC3                  193                             MOV AL,BL
007A EE                    194                             OUT DX,AL
                           195                             
007B BA8100                196                             MOV DX,B_8255
007E EC                    197                             IN AL,DX
007F 8AD8                  198                             MOV BL,AL
0081 80E3FC                199                             AND BL,0FCH
0084 C6067B0006            200                             MOV DS:REG_CL,06H
0089 C0DB02                201                             RCR BL,02H
008C D0DB                  202     NXTCOL:         RCR BL,01H
008E 732A                  203                             JNC CODEKY
0090 FE0E7900              204                             DEC DS:REG_AL
0094 FE0E7B00              205                             DEC DS:REG_CL
0098 803E7B0003            206                             CMP DS:REG_CL,03H
009D 747D                  207                             JE KEYPAD3
                           208                             
009F 803E7B0000            209                             CMP DS:REG_CL, 0H
00A4 7473                  210                             JE SUBTRACT2
00A6 EBE4                  211                             JMP NXTCOL
                           212                             
00A8 8ADD                  213                             MOV BL,CH
00AA FE0E7A00              214                             DEC DS:REG_BH
00AE 75C0                  215                             JNZ NXTROW
00B0 EB9B                  216                             JMP WAIT_1
                           217                             
00B2                       218     LONG_PRESS:
00B2 C6067D0000            219                             MOV DS:LONG_PRESS_FLAG, 0
00B7 EB6690                220                             JMP RETURN2
00BA                       221     CODEKY:
00BA 803E79000B            222                         CMP DS:REG_AL, 11
00BF 7505                  223                             JNE bcd_upd
00C1 C606790000            224                             MOV DS:REG_AL, 0
                           225                             
00C6                       226     bcd_upd:
00C6 803E7D0000            227                             CMP DS:LONG_PRESS_FLAG, 0
00CB 7552                  228                             JNE RETURN2
                           229                             
00CD 803E790011            230                             CMP DS:REG_AL, 17
00D2 754E                  231                             JNE ENTER_CASH
                           232                             
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    02:42:25  12/07/;3  PAGE    6


LOC  OBJ                  LINE     SOURCE

00D4 833EC80001            233                             CMP DS:CASH_FLAG, 1
00D9 743B                  234                             JE SKIP_ENTER_DATA1
00DB 9AA105----     R      235                             CALL FAR PTR BCD_CLEAR
                           236                             
00E0 833EE80000            237                             CMP DS:TRANSACTION_OVER, 0
00E5 7405                  238                             JE NO_RESET_NEEDED1
                           239                             
00E7 9A5F04----     R      240                             CALL FAR PTR CLEAR_TEMP_BCD
                           241                             
00EC                       242             NO_RESET_NEEDED1:
00EC C706EA000100          243                             MOV DS:DATA_ENTER, 1
00F2 C706AC000600          244                             MOV DS:DECIMAL_INDEX, 6
00F8 C7069C000600          245                             MOV DS:MAX_INPUT_SIZE, 6
00FE C706F8000100          246                             MOV DS:TROLLEY_ID, 1
0104 C706AE000000          247                             MOV DS:LANG_FLAG, 0
010A C706C8000000          248                             MOV DS:CASH_FLAG, 0
0110 C706E8000000          249                             MOV DS:TRANSACTION_OVER, 0
0116                       250             SKIP_ENTER_DATA1:
0116 E9FA01                251                             JMP UPDATE_7SEG2
                           252                             
                           253             
0119 E9FD02                254     SUBTRACT2:   JMP SUBTRACT
                           255     
011C E9EA02                256     KEYPAD3:        JMP KEYPAD_2
                           257     
011F E90503                258     RETURN2:    JMP RETURN
                           259                             
                           260                             
0122                       261     ENTER_CASH:     
0122 803E790014            262                             CMP DS:REG_AL, 20
0127 7521                  263                             JNE SEND_CASH
0129 833EC80000            264                             CMP DS:CASH_FLAG, 0
012E 7417                  265                             JE SKIP_CASH
0130 C706EA000100          266                             MOV DS:DATA_ENTER, 1
0136 9AA105----     R      267                             CALL FAR PTR BCD_CLEAR
013B C7069C000800          268                             MOV DS:MAX_INPUT_SIZE, 8
0141 C706AC000600          269                             MOV DS:DECIMAL_INDEX, 6
0147                       270                     SKIP_CASH:
0147 E9C901                271                             JMP UPDATE_7SEG2
                           272                             
014A                       273     SEND_CASH:
014A 803E790017            274                             CMP DS:REG_AL, 23
014F 751C                  275                             JNE CLEAR_BUTTON
0151 833EC80000            276                             CMP DS:CASH_FLAG, 0
0156 7412                  277                             JE SKIP_SEND_CASH
0158 833E610000            278                             CMP DS:KEYPAD_INDEX, 0
015D 740B                  279                             JE SKIP_SEND_CASH
015F C706EA000000          280                             MOV DS:DATA_ENTER, 0
0165 9A7706----     R      281                             CALL FAR PTR TAKE_CASH
016A                       282                     SKIP_SEND_CASH:
016A E9A601                283                             JMP UPDATE_7SEG2
                           284                             
016D                       285     CLEAR_BUTTON:
016D 803E79000A            286                             CMP DS:REG_AL, 10
0172 7508                  287                             JNE BACKSPACE
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    02:42:25  12/07/;3  PAGE    7


LOC  OBJ                  LINE     SOURCE

0174 9AA105----     R      288                             CALL FAR PTR BCD_CLEAR
0179 E99701                289                             JMP UPDATE_7SEG2
                           290                             
017C 803E79000C            291     BACKSPACE:      CMP DS:REG_AL, 12
0181 7508                  292                             JNE ENTER_DATA
0183 9A3205----     R      293                             CALL FAR PTR BCD_BACKSPACE
0188 E98801                294                             JMP UPDATE_7SEG2
                           295     
018B 803E79000D            296     ENTER_DATA:     CMP DS:REG_AL, 13
0190 753F                  297                             JNE END_TRANS
0192 833EC80001            298                             CMP DS:CASH_FLAG, 1
0197 7435                  299                             JE SKIP_ENTER_DATA
0199 9AA105----     R      300                             CALL FAR PTR BCD_CLEAR
                           301                             
019E 833EE80000            302                             CMP DS:TRANSACTION_OVER, 0
01A3 7405                  303                             JE NO_RESET_NEEDED
                           304                             
01A5 9A5F04----     R      305                             CALL FAR PTR CLEAR_TEMP_BCD
                           306                             
01AA                       307             NO_RESET_NEEDED:
01AA C706EA000100          308                             MOV DS:DATA_ENTER, 1
01B0 C706AC000600          309                             MOV DS:DECIMAL_INDEX, 6
01B6 C7069C000800          310                             MOV DS:MAX_INPUT_SIZE, 8
01BC C706AE000000          311                             MOV DS:LANG_FLAG, 0
01C2 C706C8000000          312                             MOV DS:CASH_FLAG, 0
01C8 C706E8000000          313                             MOV DS:TRANSACTION_OVER, 0
01CE                       314             SKIP_ENTER_DATA:
01CE E94201                315                             JMP UPDATE_7SEG2
                           316                             
01D1 803E790010            317     END_TRANS:      CMP DS:REG_AL, 16
01D6 7553                  318                             JNE CANCEL_TRANS
01D8 833EF80001            319                             CMP DS:TROLLEY_ID, 1
01DD 7449                  320                             JE END_TRANS_CONT
01DF 833EC80001            321                             CMP DS:CASH_FLAG, 1
01E4 7442                  322                             JE END_TRANS_CONT
01E6 833EE80000            323                             CMP DS:TRANSACTION_OVER, 0
01EB 7403                  324                             JE TRANSACTION_NOT_OVER
01ED E92301                325                             JMP UPDATE_7SEG2
01F0                       326     TRANSACTION_NOT_OVER:
01F0 BB0000                327                             MOV BX, 0
01F3 C6878D0024            328                             MOV DS:SEND_BUFFER[BX], '$'
01F8 43                    329                             INC BX
01F9 C6878D002F            330                             MOV DS:SEND_BUFFER[BX], '/'
01FE C7069A000200          331                             MOV DS:SEND_BUFFER_LEN, 2
0204 C6068C0001            332                             MOV DS:SEND_FLAG, 1
0209 C706B8000000          333                             MOV DS:TOTAL_PRICE_DEC, 0
020F C706B6000000          334                             MOV DS:TOTAL_PRICE_L, 0
0215 C706B4000000          335                             MOV DS:TOTAL_PRICE_U, 0
021B 833EE60001            336                             CMP DS:CANCEL_FLAG, 1
0220 7406                  337                             JE END_TRANS_CONT
0222 C706C8000100          338                             MOV DS:CASH_FLAG, 1
0228                       339                     END_TRANS_CONT:
0228 E9E800                340                             JMP UPDATE_7SEG2
                           341                             
022B                       342     CANCEL_TRANS:   
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    02:42:25  12/07/;3  PAGE    8


LOC  OBJ                  LINE     SOURCE

022B 803E79000F            343                             CMP DS:REG_AL, 15
0230 7554                  344                             JNE SCROLL_LEFT
0232 833EC80001            345                             CMP DS:CASH_FLAG, 1
0237 7503                  346                             JNE CONT_CANCEL
0239 E9D700                347                             JMP UPDATE_7SEG2
023C                       348                     CONT_CANCEL:
023C BB0000                349                             MOV BX, 0
023F C6878D003F            350                             MOV DS:SEND_BUFFER[BX], '?'
0244 43                    351                             INC BX
0245 C6878D002F            352                             MOV DS:SEND_BUFFER[BX], '/'
024A C7069A000200          353                             MOV DS:SEND_BUFFER_LEN, 2
0250 C6068C0001            354                             MOV DS:SEND_FLAG, 1
0255 C706B8000000          355                             MOV DS:TOTAL_PRICE_DEC, 0
025B C706B6000000          356                             MOV DS:TOTAL_PRICE_L, 0
0261 C706B4000000          357                             MOV DS:TOTAL_PRICE_U, 0
0267 C706AC000300          358                             MOV DS:DECIMAL_INDEX, 3
026D 9AA105----     R      359                             CALL FAR PTR BCD_CLEAR
0272 C7069C000000          360                             MOV DS:MAX_INPUT_SIZE, 0
                           361                             
0278 9A5F04----     R      362                             CALL FAR PTR CLEAR_TEMP_BCD
                           363                             
027D C706E6000100          364                             MOV DS:CANCEL_FLAG, 1
0283 E98D00                365                             JMP UPDATE_7SEG2
                           366                             
0286                       367     SCROLL_LEFT:
0286 803E790015            368                             CMP DS:REG_AL, 21
028B 753D                  369                             JNE SCROLL_RIGHT
028D 833E610006            370                             CMP DS:KEYPAD_INDEX, 6
0292 7E7F                  371                             JLE UPDATE_7SEG2
0294 833EA80000            372                             CMP DS:SCROLL_LEN, 0
0299 7478                  373                             JE UPDATE_7SEG2
029B FF0EA800              374                             DEC DS:SCROLL_LEN
029F FF0EAC00              375                             DEC DS:DECIMAL_INDEX
02A3 FF0E6100              376                             DEC DS:KEYPAD_INDEX
02A7 8B1E6100              377                             MOV BX, DS:KEYPAD_INDEX
02AB 8A4751                378                             MOV AL, DS:KEYPAD_INPUT[BX]
02AE A27900                379                             MOV DS:REG_AL, AL
02B1 C706AA000100          380                             MOV DS:DAC_DISABLE, 1
02B7 9ACC05----     R      381                             CALL FAR PTR BCD_UPDATE
02BC C706AA000000          382                             MOV DS:DAC_DISABLE, 0
02C2 C606790015            383                             MOV DS:REG_AL, 21
02C7 EB4A90                384                             JMP UPDATE_7SEG2
                           385     
02CA                       386     SCROLL_RIGHT:
02CA 803E790013            387                             CMP DS:REG_AL, 19
02CF 7545                  388                             JNE LANG_TOGGLE
02D1 833E610006            389                             CMP DS:KEYPAD_INDEX, 6
02D6 7E3B                  390                             JLE UPDATE_7SEG2
02D8 A16100                391                             MOV AX, DS:KEYPAD_INDEX
02DB 2D0600                392                             SUB AX, 6
02DE 3906A800              393                             CMP DS:SCROLL_LEN, AX
02E2 742F                  394                             JE UPDATE_7SEG2
02E4 FF06A800              395                             INC DS:SCROLL_LEN
02E8 FF06AC00              396                             INC DS:DECIMAL_INDEX
02EC FF0E6100              397                             DEC DS:KEYPAD_INDEX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    02:42:25  12/07/;3  PAGE    9


LOC  OBJ                  LINE     SOURCE

02F0 8B1E6100              398                             MOV BX, DS:KEYPAD_INDEX
02F4 8A4751                399                             MOV AL, DS:KEYPAD_INPUT[BX]
02F7 A27900                400                             MOV DS:REG_AL, AL
02FA C706AA000100          401                             MOV DS:DAC_DISABLE, 1
0300 9ACC05----     R      402                             CALL FAR PTR BCD_UPDATE
0305 C706AA000000          403                             MOV DS:DAC_DISABLE, 0
030B C606790013            404                             MOV DS:REG_AL, 19
0310 EB0190                405                             JMP UPDATE_7SEG2
                           406                             
0313 E9D800                407     UPDATE_7SEG2: JMP UPDATE_7SEG
                           408     
0316                       409     LANG_TOGGLE:
0316 803E790012            410                             CMP DS:REG_AL, 18
031B 7537                  411                             JNE QTY_PROMPT
031D 833EAE0001            412                             CMP DS:LANG_FLAG, 1
0322 75EF                  413                             JNE UPDATE_7SEG2
0324 A16400                414                             MOV AX, DS:DAC_BASE
0327 3D0040                415                             CMP AX, 4000H
032A 7406                  416                             JE MANDRIN
032C B80040                417                             MOV AX, 4000H
032F EB0490                418                             JMP SEND_TOGGLE
0332                       419             MANDRIN:
0332 B80065                420                             MOV AX, 6500H
0335                       421             SEND_TOGGLE:
0335 A36400                422                             MOV DS:DAC_BASE, AX
0338 BB0000                423                             MOV BX, 0
033B C6878D0021            424                             MOV DS:SEND_BUFFER[BX], '!'
0340 43                    425                             INC BX
0341 C6878D002F            426                             MOV DS:SEND_BUFFER[BX], '/'
0346 C7069A000200          427                             MOV DS:SEND_BUFFER_LEN, 2
034C C6068C0001            428                             MOV DS:SEND_FLAG, 1
0351 E99A00                429                             JMP UPDATE_7SEG
0354                       430     QTY_PROMPT:
0354 803E790016            431                             CMP DS:REG_AL, 22
0359 7527                  432                             JNE QUANTITY
035B 833EC80001            433                             CMP DS:CASH_FLAG, 1
0360 7420                  434                             JE QUANTITY
0362 833E610008            435                             CMP DS:KEYPAD_INDEX, 8
0367 7519                  436                             JNE  QUANTITY
                           437                             ; CMP DS:MAX_INPUT_SIZE, 8
                           438                             ; JNE QUANTITY
0369 9AEB04----     R      439                             CALL FAR PTR UPDATE_SEND_BUFFER
036E 9AA105----     R      440                             CALL FAR PTR BCD_CLEAR
0373 C7069C000200          441                             MOV DS:MAX_INPUT_SIZE, 2
0379 C7069E000100          442                             MOV DS:QTY_FLAG, 1
037F EB6D90                443                             JMP UPDATE_7SEG
                           444                     
0382                       445     QUANTITY:
0382 833E610000            446                             CMP DS:KEYPAD_INDEX, 0
0387 7465                  447                             JE  UPDATE_7SEG
                           448                             
0389 803E79000E            449                             CMP DS:REG_AL, 14
038E 755E                  450                             JNE UPDATE_7SEG
                           451                             
0390 833EF80001            452                             CMP DS:TROLLEY_ID, 1
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    02:42:25  12/07/;3  PAGE   10


LOC  OBJ                  LINE     SOURCE

0395 752C                  453                             JNE NORMAL_UPDATE
                           454                             
0397 833E610006            455                             CMP DS:KEYPAD_INDEX, 6
039C 7525                  456                             JNE NORMAL_UPDATE
                           457                             
039E 9A2C04----     R      458                             CALL FAR PTR UPDATE_TROLLEY_ID
                           459                             
03A3 C706F8000000          460                             MOV DS:TROLLEY_ID, 0
03A9 C6068C0001            461                             MOV DS:SEND_FLAG, 1
03AE C706EA000000          462                             MOV DS:DATA_ENTER, 0
03B4 C706E6000000          463                             MOV DS:CANCEL_FLAG, 0
03BA C706C8000100          464                             MOV DS:CASH_FLAG, 1
03C0 EB2C90                465                             JMP UPDATE_7SEG
                           466                             
03C3                       467                     NORMAL_UPDATE:  
03C3 833E9E0001            468                             CMP DS:QTY_FLAG, 1
03C8 7524                  469                             JNE UPDATE_7SEG
                           470                             
03CA C706EA000000          471                             MOV DS:DATA_ENTER, 0
                           472                             
03D0 C706E6000000          473                             MOV DS:CANCEL_FLAG, 0
                           474                     
03D6 9A9A04----     R      475                             CALL FAR PTR UPDATE_THE_QUANTITY
                           476                                             
03DB C6068C0001            477                             MOV DS:SEND_FLAG, 1
                           478                             
03E0 C7069E000000          479                             MOV DS:QTY_FLAG, 0
03E6 9AA105----     R      480                             CALL FAR PTR BCD_CLEAR
03EB EB0190                481                             JMP UPDATE_7SEG
                           482                             
                           483     
03EE                       484     UPDATE_7SEG:
03EE 803E790009            485                             CMP DS:REG_AL, 9
03F3 7F0C                  486                             JG SET_PRESS_FLAG
                           487                             
03F5 833EEA0001            488                             CMP DS:DATA_ENTER, 1
03FA 7505                  489                             JNE SET_PRESS_FLAG
                           490                             
03FC 9ACC05----     R      491                             CALL FAR PTR BCD_UPDATE
                           492                             
0401                       493     SET_PRESS_FLAG:
0401 C6067D0001            494                             MOV DS:LONG_PRESS_FLAG, 1
0406 EB1F90                495                             JMP RETURN
                           496             
0409                       497     KEYPAD_2: 
0409 800679000F            498                 ADD DS:REG_AL,0FH
040E E97BFC                499                             JMP NXTCOL
0411 C606790000            500     ZERO_PRINT: MOV DS:REG_AL,00H
0416 E973FC                501                             JMP NXTCOL
0419 802E790006            502     SUBTRACT:   SUB DS:REG_AL,06H
041E 8ADD                  503                             MOV BL,CH
0420 FE0E7A00              504                             DEC DS:REG_BH
0424 E949FC                505                             JMP NXTROW
                           506             
                           507             
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    02:42:25  12/07/;3  PAGE   11


LOC  OBJ                  LINE     SOURCE

0427                       508     RETURN:
0427 5A                    509                             POP DX
0428 59                    510                             POP CX
0429 5B                    511                             POP BX
042A 58                    512                             POP AX
042B CB                    513                             RET
                           514     
                           515     KEYPAD_LOOP ENDP
                           516     
042C                       517     UPDATE_TROLLEY_ID PROC FAR
042C 50                    518     PUSH AX
042D 53                    519     PUSH BX
042E 51                    520     PUSH CX
042F 52                    521     PUSH DX
0430 BB0000                522             MOV BX, 0
0433 C6878D005E            523             MOV DS:SEND_BUFFER[BX], '^'
0438 B90600                524             MOV CX, 6
043B                       525             UPDATE_TROLLEY_BUFFER:
043B BB0600                526                     MOV BX, 6
043E 2BD9                  527                     SUB BX, CX
                           528                     
0440 8A4751                529                     MOV AL, DS:KEYPAD_INPUT[BX]
                           530                     
0443 43                    531                     INC BX
0444 0430                  532                     ADD AL, 30H
0446 88878D00              533                     MOV DS:SEND_BUFFER[BX], AL
044A E2EF                  534             LOOP UPDATE_TROLLEY_BUFFER
                           535             
044C BB0700                536             MOV BX, 7
044F C6878D002F            537             MOV DS:SEND_BUFFER[BX], '/'
                           538             
0454 C7069A000800          539             MOV DS:SEND_BUFFER_LEN, 8
                           540     
045A 5A                    541     POP DX
045B 59                    542     POP CX
045C 5B                    543     POP BX
045D 58                    544     POP AX
045E CB                    545     RET
                           546     UPDATE_TROLLEY_ID ENDP
                           547     
045F                       548     CLEAR_TEMP_BCD PROC FAR
045F 50                    549     PUSH AX
0460 53                    550     PUSH BX
0461 51                    551     PUSH CX
0462 52                    552     PUSH DX
                           553     
0463 BB0000                554             MOV BX, 0
0466 C687BA002D            555             MOV DS:TEMP_BCD_ARR[BX], '-'
046B 43                    556             INC BX
046C C687BA002D            557             MOV DS:TEMP_BCD_ARR[BX], '-'
0471 43                    558             INC BX
0472 C687BA002D            559             MOV DS:TEMP_BCD_ARR[BX], '-'
0477 43                    560             INC BX
0478 C687BA002D            561             MOV DS:TEMP_BCD_ARR[BX], '-'
047D 43                    562             INC BX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    02:42:25  12/07/;3  PAGE   12


LOC  OBJ                  LINE     SOURCE

047E C687BA002D            563             MOV DS:TEMP_BCD_ARR[BX], '-'
0483 43                    564             INC BX
0484 C687BA002D            565             MOV DS:TEMP_BCD_ARR[BX], '-'
0489 43                    566             INC BX
048A C687BA002D            567             MOV DS:TEMP_BCD_ARR[BX], '-'
048F 43                    568             INC BX
0490 C687BA002D            569             MOV DS:TEMP_BCD_ARR[BX], '-'
                           570             
0495 5A                    571     POP DX
0496 59                    572     POP CX
0497 5B                    573     POP BX
0498 58                    574     POP AX
0499 CB                    575     RET
                           576     CLEAR_TEMP_BCD ENDP
                           577     
                           578     
049A                       579     UPDATE_THE_QUANTITY PROC FAR
049A 50                    580     PUSH AX
049B 53                    581     PUSH BX
049C 51                    582     PUSH CX
049D 52                    583     PUSH DX
049E 8B0E6100              584             MOV CX, DS:KEYPAD_INDEX
04A2 BB0000                585             MOV BX, 0
04A5 BA0000                586             MOV DX, 0
04A8                       587             UPD_QTY:
04A8 A1B200                588                     MOV AX, DS:QTY
04AB 53                    589                     PUSH BX
04AC BB0A00                590                     MOV BX, 10
04AF F7E3                  591                     MUL BX
04B1 5B                    592                     POP BX
04B2 8A5751                593                     MOV DL, DS:KEYPAD_INPUT[BX]
04B5 03C2                  594                     ADD AX, DX
04B7 A3B200                595                     MOV DS:QTY, AX
04BA 43                    596                     INC BX
04BB E2EB                  597             LOOP UPD_QTY
                           598             
04BD 8B0E6100              599             MOV CX, DS:KEYPAD_INDEX
04C1 8B1E9A00              600             MOV BX, DS:SEND_BUFFER_LEN
                           601             
04C5                       602             UPD_BUFFER:
04C5 53                    603                     PUSH BX
04C6 8B1E6100              604                     MOV BX, DS:KEYPAD_INDEX
04CA 2BD9                  605                     SUB BX, CX
04CC 8A4751                606                     MOV AL, DS:KEYPAD_INPUT[BX]
04CF 5B                    607                     POP BX
04D0 0430                  608                     ADD AL, 30H
04D2 88878D00              609                     MOV DS:SEND_BUFFER[BX], AL
                           610                     
04D6 43                    611                     INC BX
04D7 FF069A00              612                     INC DS:SEND_BUFFER_LEN
04DB E2E8                  613             LOOP UPD_BUFFER
                           614             
04DD C6878D002F            615             MOV DS:SEND_BUFFER[BX], '/'
04E2 FF069A00              616             INC DS:SEND_BUFFER_LEN
                           617                     
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    02:42:25  12/07/;3  PAGE   13


LOC  OBJ                  LINE     SOURCE

04E6 5A                    618     POP DX
04E7 59                    619     POP CX
04E8 5B                    620     POP BX
04E9 58                    621     POP AX
                           622     
04EA CB                    623     RET
                           624     UPDATE_THE_QUANTITY ENDP
                           625     
04EB                       626     UPDATE_SEND_BUFFER PROC FAR
04EB 50                    627     PUSH AX
04EC 53                    628     PUSH BX
04ED 51                    629     PUSH CX
04EE 52                    630     PUSH DX
                           631     
04EF 8B0E6100              632             MOV CX, DS:KEYPAD_INDEX
04F3 83F900                633             CMP CX, 0
04F6 7435                  634             JE END_UPD_BUFFER
04F8 83C102                635             ADD CX, 2
04FB 890E9A00              636             MOV DS:SEND_BUFFER_LEN, CX
04FF BB0000                637             MOV BX, 0
0502                       638             BUFFER_LOOP:
0502 83FB00                639                     CMP BX, 0
0505 7508                  640                     JNE ASTERISK
0507 C6878D007E            641                     MOV DS:SEND_BUFFER[BX], '~'
050C EB1C90                642                     JMP END_BUFFER
050F                       643             ASTERISK:
050F A16100                644                     MOV AX, DS:KEYPAD_INDEX
0512 40                    645                     INC AX
0513 3BD8                  646                     CMP BX, AX
0515 7508                  647                     JNE CONT
0517 C6878D002A            648                     MOV DS:SEND_BUFFER[BX], '*'
051C EB0C90                649                     JMP END_BUFFER
051F                       650             CONT:
051F 4B                    651                     DEC BX
0520 8A4751                652                     MOV AL, DS:KEYPAD_INPUT[BX]
0523 0430                  653                     ADD AL, 30H
0525 43                    654                     INC BX
0526 88878D00              655                     MOV DS:SEND_BUFFER[BX], AL
                           656                     
052A                       657             END_BUFFER:
052A 43                    658                     INC BX
052B E2D5                  659             LOOP BUFFER_LOOP
052D                       660     END_UPD_BUFFER:
052D 5A                    661     POP DX
052E 59                    662     POP CX
052F 5B                    663     POP BX
0530 58                    664     POP AX
0531 CB                    665     RET
                           666     UPDATE_SEND_BUFFER ENDP
                           667     
0532                       668     BCD_BACKSPACE PROC FAR
                           669     
0532 50                    670     PUSH AX
0533 53                    671     PUSH BX
0534 51                    672     PUSH CX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    02:42:25  12/07/;3  PAGE   14


LOC  OBJ                  LINE     SOURCE

0535 52                    673     PUSH DX
                           674     
0536 8A167900              675             MOV DL, DS:REG_AL
053A 833E610000            676             CMP DS:KEYPAD_INDEX, 0
053F 7457                  677             JE RETURN_BACK
                           678             
0541 BB0600                679             MOV BX, 6
0544                       680             BCD_CLEAR_LOOP:
0544 4B                    681                     DEC BX
0545 C647592D              682                     MOV DS:BCD_MESSAGE[BX], '-'
0549 43                    683                     INC BX
054A 4B                    684                     DEC BX
054B 75F7                  685             JNZ BCD_CLEAR_LOOP
                           686             
054D 833E610001            687             CMP DS:KEYPAD_INDEX, 1
0552 7E2C                  688             JLE less_than_two
                           689             
0554 FF0E6100              690             DEC DS:KEYPAD_INDEX
0558 FF0E6100              691             DEC DS:KEYPAD_INDEX
055C 8B1E6100              692             MOV BX, DS:KEYPAD_INDEX
0560 8A4751                693             MOV AL, DS:KEYPAD_INPUT[BX]
0563 A27900                694             MOV DS:REG_AL, AL
0566 C706A8000000          695             MOV DS:SCROLL_LEN, 0
056C C706AA000100          696             MOV DS:DAC_DISABLE, 1
0572 9ACC05----     R      697             CALL FAR PTR BCD_UPDATE
0577 C706AA000000          698             MOV DS:DAC_DISABLE, 0
057D EB1990                699             JMP RETURN_BACK
                           700             
0580                       701     less_than_two:
0580 FF0E6100              702             DEC DS:KEYPAD_INDEX
0584 C60679002D            703             MOV DS:REG_AL, '-'
0589 C706A8000000          704             MOV DS:SCROLL_LEN, 0
058F 9ACC05----     R      705             CALL FAR PTR BCD_UPDATE
0594 FF0E6100              706             DEC DS:KEYPAD_INDEX
                           707             
0598                       708     RETURN_BACK:
0598 88167900              709             MOV DS:REG_AL, DL
059C 5A                    710     POP DX
059D 59                    711     POP CX
059E 5B                    712     POP BX
059F 58                    713     POP AX
                           714     
05A0 CB                    715     RET
                           716     BCD_BACKSPACE ENDP
                           717     
05A1                       718     BCD_CLEAR PROC FAR
05A1 50                    719     PUSH AX
05A2 53                    720     PUSH BX
05A3 51                    721     PUSH CX
05A4 52                    722     PUSH DX
05A5 BB0800                723             MOV BX, 8
05A8                       724             CLEAR_LOOP:
05A8 C6475100              725             MOV DS:KEYPAD_INPUT[BX], 0
05AC 4B                    726             DEC BX
05AD 75F9                  727             JNZ CLEAR_LOOP
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    02:42:25  12/07/;3  PAGE   15


LOC  OBJ                  LINE     SOURCE

                           728             
05AF BB0600                729             MOV BX, 6
05B2                       730             CLEAR_LOOP2:
05B2 4B                    731                     DEC BX
05B3 C647592D              732                     MOV DS:BCD_MESSAGE[BX], '-'
05B7 43                    733                     INC BX
05B8 4B                    734                     DEC BX
05B9 75F7                  735             JNZ CLEAR_LOOP2
                           736     
05BB C70661000000          737             MOV DS:KEYPAD_INDEX, 0
05C1 C706A8000000          738             MOV DS:SCROLL_LEN, 0
05C7 5A                    739     POP DX
05C8 59                    740     POP CX
05C9 5B                    741     POP BX
05CA 58                    742     POP AX
05CB CB                    743     RET
                           744     BCD_CLEAR ENDP
                           745     
05CC                       746     BCD_UPDATE PROC FAR
05CC 50                    747     PUSH AX
05CD 53                    748     PUSH BX
05CE 51                    749     PUSH CX
05CF 52                    750     PUSH DX
05D0 A19C00                751                     MOV AX, DS:MAX_INPUT_SIZE
05D3 39066100              752                     CMP DS:KEYPAD_INDEX, AX
05D7 7D5A                  753                     JGE BCD_RET
                           754                     
05D9 8A0E7900              755                     MOV CL, DS:REG_AL
05DD 80F909                756                     CMP CL, 9
05E0 7F0C                  757                     JG SKIP_PAST
05E2 833EAA0001            758                     CMP DS:DAC_DISABLE, 1
05E7 7405                  759                     JE SKIP_PAST
05E9 9A3806----     R      760                     CALL FAR PTR DAC_UPDATE
                           761     
05EE                       762     SKIP_PAST:              
05EE 8A0E7900              763                     MOV CL, DS:REG_AL
                           764     
05F2 8B1E6100              765                     MOV BX, DS:KEYPAD_INDEX
                           766                             
05F6 884F51                767                     MOV DS:KEYPAD_INPUT[BX], CL
                           768                             
05F9 FF066100              769                     INC DS:KEYPAD_INDEX
                           770                             
05FD 8B1E6100              771                     MOV BX, DS:KEYPAD_INDEX
                           772                     
0601 A1A800                773                     MOV AX, DS:SCROLL_LEN
0604 2BD8                  774                     SUB BX, AX
                           775                     
0606 8B166100              776                     MOV DX, DS:KEYPAD_INDEX
060A 83FA06                777                     CMP DX, 6
060D 7E03                  778                     JLE update_display
060F BA0600                779                     MOV DX, 6
                           780                     
0612                       781             update_display:
                           782             
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    02:42:25  12/07/;3  PAGE   16


LOC  OBJ                  LINE     SOURCE

0612 B90500                783                     MOV CX, 5
0615 4B                    784                     DEC BX
0616 8A4751                785                     MOV AL, DS:KEYPAD_INPUT[BX]
0619 43                    786                     INC BX
                           787                             
061A 52                    788                     PUSH DX
061B 8B166100              789                     MOV DX, DS:KEYPAD_INDEX
061F 2B16A800              790                     SUB DX, DS:SCROLL_LEN
                           791                     
0623 2BD3                  792                     SUB DX, BX
                           793                             
0625 53                    794                     PUSH BX
                           795                             
0626 2BCA                  796                     SUB CX, DX
0628 8BD9                  797                     MOV BX, CX
062A 884759                798                     MOV DS:BCD_MESSAGE[BX], AL
                           799                             
062D 5B                    800                     POP BX
062E 5A                    801                     POP DX
                           802             
062F 4B                    803                     DEC BX
0630 4A                    804                     DEC DX
0631 75DF                  805             JNZ update_display
                           806     
0633                       807             BCD_RET:
0633 5A                    808                     POP DX
0634 59                    809                     POP CX
0635 5B                    810                     POP BX
0636 58                    811                     POP AX
0637 CB                    812     RET
                           813     BCD_UPDATE ENDP
                           814     
0638                       815     DAC_UPDATE PROC FAR
0638 50                    816             PUSH AX
0639 53                    817             PUSH BX
063A 51                    818             PUSH CX
063B 52                    819             PUSH DX
                           820             
063C BB0000                821             MOV BX, 0
063F 8A1E7500              822             MOV BL, DS:DAC_LEN
0643 A07900                823             MOV AL, DS:REG_AL
                           824             
0646 884766                825             MOV DS:DAC_ADDR[BX], AL
                           826             
0649 FE067500              827             INC DS:DAC_LEN
                           828     
064D 5A                    829             POP DX
064E 59                    830             POP CX
064F 5B                    831             POP BX
0650 58                    832             POP AX
0651 CB                    833     RET
                           834     DAC_UPDATE ENDP
                           835               
0652                       836     DEBOUNCE PROC FAR
0652 51                    837                       PUSH CX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    02:42:25  12/07/;3  PAGE   17


LOC  OBJ                  LINE     SOURCE

                           838                       
0653 B94C09                839                       MOV CX, 094CH
0656 90                    840     BACK:     NOP
0657 E2FD                  841                       LOOP BACK
0659 59                    842                       POP CX
065A CB                    843                       RET
                           844     DEBOUNCE  ENDP
                           845     
065B                       846     SEND_INPUT PROC FAR
065B 50                    847     PUSH AX
065C 53                    848     PUSH BX
065D 51                    849     PUSH CX
065E 52                    850     PUSH DX
065F BB0000                851             MOV BX, 0
0662 8B0E9A00              852             MOV CX, DS:SEND_BUFFER_LEN
                           853             
0666                       854             S_BUFF:
0666 8A878D00              855                     MOV AL, DS:SEND_BUFFER[BX]
066A 9A0000----     E      856                     CALL FAR PTR PRINT_CHAR
066F 43                    857                     INC BX
0670 E2F4                  858             LOOP S_BUFF
                           859             
0672                       860     SEND_INPUT_END:
0672 5A                    861     POP DX
0673 59                    862     POP CX
0674 5B                    863     POP BX
0675 58                    864     POP AX
0676 CB                    865     RET
                           866     SEND_INPUT ENDP
                           867     
0677                       868     TAKE_CASH PROC FAR
0677 50                    869     PUSH AX
0678 53                    870     PUSH BX
0679 51                    871     PUSH CX
067A 52                    872     PUSH DX
                           873             
067B B90000                874             MOV CX, 0
067E B108                  875             MOV CL, 8
0680                       876             CLEAR_CASH_AMT:
0680 8BD9                  877                     MOV BX, CX
0682 4B                    878                     DEC BX
0683 C687CA0000            879                     MOV DS:CASH_AMT[BX], 0
0688 E2F6                  880             LOOP CLEAR_CASH_AMT
                           881             
068A 8B0E6100              882             MOV CX, DS:KEYPAD_INDEX
068E BA0600                883             MOV DX, 6
                           884             
0691                       885             UPDATE_CASH_AMT:
0691 8BD9                  886                     MOV BX, CX
0693 4B                    887                     DEC BX
                           888                     
0694 33C0                  889                     XOR AX, AX
0696 8A4751                890                     MOV AL, DS:KEYPAD_INPUT[BX]
                           891                     
0699 8BDA                  892                     MOV BX, DX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    02:42:25  12/07/;3  PAGE   18


LOC  OBJ                  LINE     SOURCE

069B 4B                    893                     DEC BX
069C 8887CA00              894                     MOV DS:CASH_AMT[BX], AL
                           895                     
06A0 4A                    896                     DEC DX
06A1 E2EE                  897             LOOP UPDATE_CASH_AMT
                           898             
06A3 C706E2000100          899             MOV DS:CASH_OK_FLAG, 1
06A9 C706E4000700          900             MOV DS:BORROW_POSITION, 7
06AF B90800                901             MOV CX, 8
06B2                       902             CHECK_CASH:
06B2 BB0800                903                     MOV BX, 8
06B5 2BD9                  904                     SUB BX, CX
06B7 B80000                905                     MOV AX, 0
06BA 8A87BA00              906                     MOV AL, DS:TEMP_BCD_ARR[BX]
06BE 8A97CA00              907                     MOV DL, DS:CASH_AMT[BX]
06C2 3AD0                  908                     CMP DL, AL
06C4 741A                  909                     JE NEXT_CASH_DIGIT
                           910                     
06C6 3AD0                  911                     CMP DL, AL
06C8 7C0D                  912                     JL CASH_NOT_OK
                           913                     
06CA C706E2000100          914                     MOV DS:CASH_OK_FLAG, 1
06D0 891EE400              915                     MOV DS:BORROW_POSITION, BX
                           916                     
06D4 EB0C90                917                     JMP CHEK_CASH_DONE
                           918                     
06D7                       919                     CASH_NOT_OK:
06D7 C706E2000000          920                     MOV DS:CASH_OK_FLAG, 0
06DD EB0390                921                     JMP CHEK_CASH_DONE
                           922                     
06E0                       923             NEXT_CASH_DIGIT:
06E0 E2D0                  924             LOOP CHECK_CASH
                           925             
06E2                       926     CHEK_CASH_DONE:
                           927             
06E2 833EE20001            928             CMP DS:CASH_OK_FLAG, 1
06E7 7464                  929             JE CONTINUE_CASH
06E9 B90800                930             MOV CX, 8
06EC C70661000000          931             MOV DS:KEYPAD_INDEX, 0
06F2 C706AC000300          932             MOV DS:DECIMAL_INDEX, 3
06F8                       933             RETAIN_BCD:
06F8 BB0800                934                     MOV BX, 8
06FB 2BD9                  935                     SUB BX, CX
                           936                     
06FD 8A87BA00              937                     MOV AL, DS:TEMP_BCD_ARR[BX]
0701 A27900                938                     MOV DS:REG_AL, AL
                           939                     
0704 C706AA000100          940                     MOV DS:DAC_DISABLE, 1
070A 9ACC05----     R      941                     CALL FAR PTR BCD_UPDATE
070F C706AA000000          942                     MOV DS:DAC_DISABLE, 0
0715 E2E1                  943             LOOP RETAIN_BCD
0717 813E64000040          944             CMP DS:DAC_BASE, 4000H
071D 7517                  945             JNE MANDARIN_CASH
                           946             
071F C606790023            947             MOV DS:REG_AL, 35
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    02:42:25  12/07/;3  PAGE   19


LOC  OBJ                  LINE     SOURCE

0724 9A3806----     R      948             CALL FAR PTR DAC_UPDATE
0729 C606790024            949             MOV DS:REG_AL, 36
072E 9A3806----     R      950             CALL FAR PTR DAC_UPDATE
0733 E9AC00                951             JMP CASH_OVER
                           952             
0736                       953     MANDARIN_CASH:
0736 C606790012            954             MOV DS:REG_AL, 18
073B 9A3806----     R      955             CALL FAR PTR DAC_UPDATE
0740 C606790013            956             MOV DS:REG_AL, 19
0745 9A3806----     R      957             CALL FAR PTR DAC_UPDATE
074A E99500                958             JMP CASH_OVER
                           959             
074D                       960     CONTINUE_CASH:
074D 8B1EE400              961             MOV BX, DS:BORROW_POSITION
0751 B90700                962             MOV CX, 7
0754 2BCB                  963             SUB CX, BX
0756 83F900                964             CMP CX, 0
0759 740C                  965             JE BEGIN_SUB
                           966             
075B                       967             ADJUST_PLACES:
075B FE8FCA00              968                     DEC DS:CASH_AMT[BX]
075F 43                    969                     INC BX
0760 8087CA000A            970                     ADD DS:CASH_AMT[BX], 10
0765 E2F4                  971             LOOP ADJUST_PLACES
                           972             
0767                       973     BEGIN_SUB:
0767 B90800                974             MOV CX, 8
076A                       975             CALC_CHANGE:
076A BB0800                976                     MOV BX, 8
076D 2BD9                  977                     SUB BX, CX
076F B80000                978                     MOV AX, 0
0772 8A87CA00              979                     MOV AL, DS:CASH_AMT[BX]
0776 BA0000                980                     MOV DX, 0
0779 8A97BA00              981                     MOV DL, DS:TEMP_BCD_ARR[BX]
077D 2BC2                  982                     SUB AX, DX
077F 8987D200              983                     MOV DS:TEMP_CASH_ARR[BX], AX
0783 E2E5                  984             LOOP CALC_CHANGE
                           985             
0785 B90800                986             MOV CX, 8
0788                       987             FIX_DIGITS:
0788 8BD9                  988             MOV BX, CX
078A 4B                    989             DEC BX
                           990             
078B 8B87D200              991             MOV AX, DS:TEMP_CASH_ARR[BX]
078F 3C0A                  992             CMP AL, 10
0791 7C0A                  993             JL NEXT_DIGIT_TO_FIX
                           994             
0793 83AFD2000A            995             SUB DS:TEMP_CASH_ARR[BX], 10
                           996             
0798 4B                    997             DEC BX
0799 FF87D200              998             INC DS:TEMP_CASH_ARR[BX]
                           999             
079D                      1000             NEXT_DIGIT_TO_FIX:
                          1001             
079D E2E9                 1002             LOOP FIX_DIGITS
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    02:42:25  12/07/;3  PAGE   20


LOC  OBJ                  LINE     SOURCE

                          1003             
079F B90800               1004             MOV CX, 8
07A2 C70661000000         1005             MOV DS:KEYPAD_INDEX, 0
07A8 C706AC000300         1006             MOV DS:DECIMAL_INDEX, 3
07AE                      1007             UPDATE_BCD_TO_CASH:
07AE BB0800               1008                     MOV BX, 8
07B1 2BD9                 1009                     SUB BX, CX
07B3 8B87D200             1010                     MOV AX, DS:TEMP_CASH_ARR[BX]
07B7 8887BA00             1011                     MOV DS:TEMP_BCD_ARR[BX], AL
07BB A27900               1012                     MOV DS:REG_AL, AL
07BE C706AA000100         1013                     MOV DS:DAC_DISABLE, 1
07C4 9ACC05----     R     1014                     CALL FAR PTR BCD_UPDATE
07C9 C706AA000000         1015                     MOV DS:DAC_DISABLE, 0
07CF E2DD                 1016             LOOP UPDATE_BCD_TO_CASH
                          1017             
07D1 9AE707----     R     1018             CALL FAR PTR CALC_DAC
                          1019             
07D6 C706C8000000         1020             MOV DS:CASH_FLAG, 0
07DC C706E8000100         1021             MOV DS:TRANSACTION_OVER, 1
                          1022             
07E2                      1023     CASH_OVER:
07E2 5A                   1024     POP DX
07E3 59                   1025     POP CX
07E4 5B                   1026     POP BX
07E5 58                   1027     POP AX
                          1028     
07E6 CB                   1029     RET
                          1030     TAKE_CASH ENDP
                          1031     
07E7                      1032     CALC_DAC PROC FAR
07E7 50                   1033     PUSH AX
07E8 53                   1034     PUSH BX
07E9 51                   1035     PUSH CX
07EA 52                   1036     PUSH DX
07EB 813E64000040         1037             CMP DS:DAC_BASE, 4000H
07F1 7403                 1038             JE ENGLISH_DAC
07F3 E98E01               1039             JMP MANDARIN_DAC
                          1040             
07F6                      1041     ENGLISH_DAC:
07F6 C706C4000000         1042             MOV DS:CENT_FLAG, 0
07FC C706C2000000         1043             MOV DS:THOUSAND_FLAG, 0
0802 C706C6000000         1044             MOV DS:DOLLAR_FLAG,     0
0808 BB0000               1045             MOV BX, 0
080B 8A87BA00             1046             MOV AL, DS:TEMP_BCD_ARR[BX]
080F A27900               1047             MOV DS:REG_AL, AL
0812 3C00                 1048             CMP AL, 0
0814 7415                 1049             JE NEXT_PLACE
0816 C706C6000100         1050             MOV DS:DOLLAR_FLAG, 1
081C 9A3806----     R     1051             CALL FAR PTR DAC_UPDATE
0821 C60679001C           1052             MOV DS:REG_AL, 28
0826 9A3806----     R     1053             CALL FAR PTR DAC_UPDATE
                          1054             
082B                      1055     NEXT_PLACE:     
082B 43                   1056             INC BX
082C 8A87BA00             1057             MOV AL, DS:TEMP_BCD_ARR[BX]
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    02:42:25  12/07/;3  PAGE   21


LOC  OBJ                  LINE     SOURCE

0830 3C01                 1058             CMP AL, 1
0832 751E                 1059             JNE NOT_1
0834 C706C6000100         1060             MOV DS:DOLLAR_FLAG, 1
083A 43                   1061             INC BX
083B 8A87BA00             1062             MOV AL, DS:TEMP_BCD_ARR[BX]
083F 040A                 1063             ADD AL, 10
0841 A27900               1064             MOV DS:REG_AL, AL
0844 9A3806----     R     1065             CALL FAR PTR DAC_UPDATE
0849 C706C2000100         1066             MOV DS:THOUSAND_FLAG, 1
084F EB3890               1067             JMP HUNDREDS_PLACE
0852                      1068     NOT_1:
0852 3C00                 1069             CMP AL, 0
0854 7416                 1070             JE NEXT_PLACE_1
0856 C706C6000100         1071             MOV DS:DOLLAR_FLAG, 1
085C C706C2000100         1072             MOV DS:THOUSAND_FLAG, 1
0862 0412                 1073             ADD AL, 18
0864 A27900               1074             MOV DS:REG_AL, AL
0867 9A3806----     R     1075             CALL FAR PTR DAC_UPDATE
086C                      1076     NEXT_PLACE_1:
086C 43                   1077             INC BX
086D 8A87BA00             1078             MOV AL, DS:TEMP_BCD_ARR[BX]
0871 3C00                 1079             CMP AL, 0
0873 7414                 1080             JE HUNDREDS_PLACE
0875 C706C6000100         1081             MOV DS:DOLLAR_FLAG, 1
087B C706C2000100         1082             MOV DS:THOUSAND_FLAG, 1
0881 A27900               1083             MOV DS:REG_AL, AL
0884 9A3806----     R     1084             CALL FAR PTR DAC_UPDATE
                          1085     
0889                      1086     HUNDREDS_PLACE:
0889 833EC20000           1087             CMP DS:THOUSAND_FLAG, 0
088E 7410                 1088             JE NEXT_PLACE_2
0890 C60679001D           1089             MOV DS:REG_AL, 29
0895 9A3806----     R     1090             CALL FAR PTR DAC_UPDATE
089A C706C2000000         1091             MOV DS:THOUSAND_FLAG, 0
                          1092             
08A0                      1093     NEXT_PLACE_2:
08A0 43                   1094             INC BX
08A1 8A87BA00             1095             MOV AL, DS:TEMP_BCD_ARR[BX]
08A5 3C00                 1096             CMP AL, 0
08A7 7418                 1097             JE NEXT_PLACE_3
08A9 C706C6000100         1098             MOV DS:DOLLAR_FLAG, 1
08AF A27900               1099             MOV DS:REG_AL, AL
08B2 9A3806----     R     1100             CALL FAR PTR DAC_UPDATE
08B7 C60679001C           1101             MOV DS:REG_AL, 28
08BC 9A3806----     R     1102             CALL FAR PTR DAC_UPDATE
                          1103             
08C1                      1104     NEXT_PLACE_3:   
08C1 43                   1105             INC BX
08C2 8A87BA00             1106             MOV AL, DS:TEMP_BCD_ARR[BX]
08C6 3C01                 1107             CMP AL, 1
08C8 7518                 1108             JNE NOT_1_2
08CA C706C6000100         1109             MOV DS:DOLLAR_FLAG, 1
08D0 43                   1110             INC BX
08D1 8A87BA00             1111             MOV AL, DS:TEMP_BCD_ARR[BX]
08D5 040A                 1112             ADD AL, 10
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    02:42:25  12/07/;3  PAGE   22


LOC  OBJ                  LINE     SOURCE

08D7 A27900               1113             MOV DS:REG_AL, AL
08DA 9A3806----     R     1114             CALL FAR PTR DAC_UPDATE
08DF EB2C90               1115             JMP DECIMAL_DAC
08E2                      1116     NOT_1_2:
08E2 3C00                 1117             CMP AL, 0
08E4 7410                 1118             JE NEXT_PLACE_4
08E6 C706C6000100         1119             MOV DS:DOLLAR_FLAG, 1
08EC 0412                 1120             ADD AL, 18
08EE A27900               1121             MOV DS:REG_AL, AL
08F1 9A3806----     R     1122             CALL FAR PTR DAC_UPDATE
08F6                      1123     NEXT_PLACE_4:
08F6 43                   1124             INC BX
08F7 8A87BA00             1125             MOV AL, DS:TEMP_BCD_ARR[BX]
08FB 3C00                 1126             CMP AL, 0
08FD 740E                 1127             JE DECIMAL_DAC
08FF C706C6000100         1128             MOV DS:DOLLAR_FLAG, 1
0905 A27900               1129             MOV DS:REG_AL, AL
0908 9A3806----     R     1130             CALL FAR PTR DAC_UPDATE
                          1131             
090D                      1132     DECIMAL_DAC:
090D 833EC60000           1133             CMP DS:DOLLAR_FLAG, 0
0912 740A                 1134             JE DECIMAL_DAC_CONT
0914 C60679001E           1135             MOV DS:REG_AL, 30
0919 9A3806----     R     1136             CALL FAR PTR DAC_UPDATE
                          1137             
091E                      1138     DECIMAL_DAC_CONT:
091E 43                   1139             INC BX
091F 8A87BA00             1140             MOV AL, DS:TEMP_BCD_ARR[BX]
0923 3C01                 1141             CMP AL, 1
0925 7518                 1142             JNE NOT_1_3
0927 43                   1143             INC BX
0928 C706C4000100         1144             MOV DS:CENT_FLAG, 1
092E 8A87BA00             1145             MOV AL, DS:TEMP_BCD_ARR[BX]
0932 040A                 1146             ADD AL, 10
0934 A27900               1147             MOV DS:REG_AL, AL
0937 9A3806----     R     1148             CALL FAR PTR DAC_UPDATE
093C EB2C90               1149             JMP ENGLISH_END
                          1150             
093F                      1151     NOT_1_3:
093F 3C00                 1152             CMP AL, 0
0941 7410                 1153             JE NEXT_PLACE_5
0943 C706C4000100         1154             MOV DS:CENT_FLAG, 1
0949 0412                 1155             ADD AL, 18
094B A27900               1156             MOV DS:REG_AL, AL
094E 9A3806----     R     1157             CALL FAR PTR DAC_UPDATE
                          1158             
0953                      1159     NEXT_PLACE_5:
0953 43                   1160             INC BX
0954 8A87BA00             1161             MOV AL, DS:TEMP_BCD_ARR[BX]
0958 3C00                 1162             CMP AL, 0
095A 740E                 1163             JE ENGLISH_END
095C C706C4000100         1164             MOV DS:CENT_FLAG, 1
0962 A27900               1165             MOV DS:REG_AL, AL
0965 9A3806----     R     1166             CALL FAR PTR DAC_UPDATE
                          1167             
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    02:42:25  12/07/;3  PAGE   23


LOC  OBJ                  LINE     SOURCE

096A                      1168     ENGLISH_END:
096A 833EC40000           1169             CMP DS:CENT_FLAG, 0
096F 7410                 1170             JE ENGLISH_END2
0971 C60679001F           1171             MOV DS:REG_AL, 31
0976 9A3806----     R     1172             CALL FAR PTR DAC_UPDATE
097B C706C4000000         1173             MOV DS:CENT_FLAG, 0
0981                      1174     ENGLISH_END2:
0981 E94F01               1175             JMP CONT_BCD_UPD_1
                          1176             
0984                      1177     MANDARIN_DAC:
0984 C706C4000000         1178             MOV DS:CENT_FLAG, 0
098A C706C2000000         1179             MOV DS:THOUSAND_FLAG, 0
0990 C706C6000000         1180             MOV DS:DOLLAR_FLAG,     0
0996 BB0000               1181             MOV BX, 0
0999 8A87BA00             1182             MOV AL, DS:TEMP_BCD_ARR[BX]
099D 3C00                 1183             CMP AL, 0
099F 741E                 1184             JE NEXT_PLACE_6
09A1 C706C6000100         1185             MOV DS:DOLLAR_FLAG, 1
09A7 C706C2000100         1186             MOV DS:THOUSAND_FLAG, 1
09AD A27900               1187             MOV DS:REG_AL, AL
09B0 9A3806----     R     1188             CALL FAR PTR DAC_UPDATE
09B5 C60679000B           1189             MOV DS:REG_AL, 11
09BA 9A3806----     R     1190             CALL FAR PTR DAC_UPDATE
                          1191             
09BF                      1192     NEXT_PLACE_6:
09BF 43                   1193             INC BX
09C0 8A87BA00             1194             MOV AL, DS:TEMP_BCD_ARR[BX]
09C4 3C00                 1195             CMP AL, 0
09C6 741E                 1196             JE NEXT_PLACE_7
09C8 C706C6000100         1197             MOV DS:DOLLAR_FLAG, 1
09CE C706C2000100         1198             MOV DS:THOUSAND_FLAG, 1
09D4 A27900               1199             MOV DS:REG_AL, AL
09D7 9A3806----     R     1200             CALL FAR PTR DAC_UPDATE
09DC C60679000A           1201             MOV DS:REG_AL, 10
09E1 9A3806----     R     1202             CALL FAR PTR DAC_UPDATE
                          1203             
09E6                      1204     NEXT_PLACE_7:
09E6 43                   1205             INC BX
09E7 8A87BA00             1206             MOV AL, DS:TEMP_BCD_ARR[BX]
09EB 3C00                 1207             CMP AL, 0
09ED 7414                 1208             JE NEXT_PLACE_8
09EF C706C6000100         1209             MOV DS:DOLLAR_FLAG, 1
09F5 C706C2000100         1210             MOV DS:THOUSAND_FLAG, 1
09FB A27900               1211             MOV DS:REG_AL, AL
09FE 9A3806----     R     1212             CALL FAR PTR DAC_UPDATE
                          1213     
0A03                      1214     NEXT_PLACE_8:
0A03 833EC20000           1215             CMP DS:THOUSAND_FLAG, 0
0A08 7410                 1216             JE IGNORE_THOUSAND
0A0A C60679000C           1217             MOV DS:REG_AL, 12
0A0F 9A3806----     R     1218             CALL FAR PTR DAC_UPDATE
0A14 C706C2000000         1219             MOV DS:THOUSAND_FLAG, 0
                          1220             
0A1A                      1221     IGNORE_THOUSAND:
0A1A 43                   1222             INC BX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    02:42:25  12/07/;3  PAGE   24


LOC  OBJ                  LINE     SOURCE

0A1B 8A87BA00             1223             MOV AL, DS:TEMP_BCD_ARR[BX]
0A1F 3C00                 1224             CMP AL, 0
0A21 7418                 1225             JE NEXT_PLACE_9
0A23 C706C6000100         1226             MOV DS:DOLLAR_FLAG, 1
0A29 A27900               1227             MOV DS:REG_AL, AL
0A2C 9A3806----     R     1228             CALL FAR PTR DAC_UPDATE
0A31 C60679000B           1229             MOV DS:REG_AL, 11
0A36 9A3806----     R     1230             CALL FAR PTR DAC_UPDATE
                          1231             
0A3B                      1232     NEXT_PLACE_9:
0A3B 43                   1233             INC BX
0A3C 8A87BA00             1234             MOV AL, DS:TEMP_BCD_ARR[BX]
0A40 3C00                 1235             CMP AL, 0
0A42 7418                 1236             JE NEXT_PLACE_10
0A44 C706C6000100         1237             MOV DS:DOLLAR_FLAG, 1
0A4A A27900               1238             MOV DS:REG_AL, AL
0A4D 9A3806----     R     1239             CALL FAR PTR DAC_UPDATE
0A52 C60679000A           1240             MOV DS:REG_AL, 10
0A57 9A3806----     R     1241             CALL FAR PTR DAC_UPDATE
                          1242             
0A5C                      1243     NEXT_PLACE_10:
0A5C 43                   1244             INC BX
0A5D 8A87BA00             1245             MOV AL, DS:TEMP_BCD_ARR[BX]
0A61 3C00                 1246             CMP AL, 0
0A63 740E                 1247             JE MANDARIN_DEC
0A65 C706C6000100         1248             MOV DS:DOLLAR_FLAG, 1
0A6B A27900               1249             MOV DS:REG_AL, AL
0A6E 9A3806----     R     1250             CALL FAR PTR DAC_UPDATE
                          1251             
0A73                      1252     MANDARIN_DEC:
0A73 833EC60000           1253             CMP DS:DOLLAR_FLAG, 0
0A78 740A                 1254             JE MANDARIN_DAC_CONT
0A7A C60679000D           1255             MOV DS:REG_AL, 13
0A7F 9A3806----     R     1256             CALL FAR PTR DAC_UPDATE
0A84                      1257     MANDARIN_DAC_CONT:
0A84 43                   1258             INC BX
0A85 8A87BA00             1259             MOV AL, DS:TEMP_BCD_ARR[BX]
0A89 3C00                 1260             CMP AL, 0
0A8B 7418                 1261             JE NEXT_PLACE_11
0A8D C706C4000100         1262             MOV DS:CENT_FLAG, 1
0A93 A27900               1263             MOV DS:REG_AL, AL
0A96 9A3806----     R     1264             CALL FAR PTR DAC_UPDATE
0A9B C60679000A           1265             MOV DS:REG_AL, 10
0AA0 9A3806----     R     1266             CALL FAR PTR DAC_UPDATE
                          1267             
0AA5                      1268     NEXT_PLACE_11:
                          1269     
0AA5 43                   1270             INC BX
0AA6 8A87BA00             1271             MOV AL, DS:TEMP_BCD_ARR[BX]
0AAA 3C00                 1272             CMP AL, 0
0AAC 740E                 1273             JE CONT_BCD_UPD
0AAE C706C4000100         1274             MOV DS:CENT_FLAG, 1
0AB4 A27900               1275             MOV DS:REG_AL, AL
0AB7 9A3806----     R     1276             CALL FAR PTR DAC_UPDATE
                          1277             
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    02:42:25  12/07/;3  PAGE   25


LOC  OBJ                  LINE     SOURCE

0ABC                      1278     CONT_BCD_UPD:
0ABC 833EC40000           1279             CMP DS:CENT_FLAG, 0
0AC1 7410                 1280             JE CONT_BCD_UPD_1
0AC3 C60679000E           1281             MOV DS:REG_AL, 14
0AC8 9A3806----     R     1282             CALL FAR PTR DAC_UPDATE
0ACD C706C4000000         1283             MOV DS:CENT_FLAG, 0
                          1284     
0AD3                      1285     CONT_BCD_UPD_1:
                          1286             
0AD3 5A                   1287     POP DX
0AD4 59                   1288     POP CX
0AD5 5B                   1289     POP BX
0AD6 58                   1290     POP AX
0AD7 CB                   1291     RET
                          1292     CALC_DAC ENDP
                          1293     
0AD8                      1294     CALC_UPD_PRICE PROC FAR
0AD8 50                   1295     PUSH AX
0AD9 53                   1296     PUSH BX
0ADA 51                   1297     PUSH CX
0ADB 52                   1298     PUSH DX
0ADC 833EB20000           1299             CMP DS:QTY, 0
0AE1 7503                 1300             JNE CHECK_PRICE_ZERO
0AE3 E92B01               1301             JMP CALC_END
0AE6                      1302     CHECK_PRICE_ZERO:
0AE6 833EB00000           1303             CMP DS:PRICE, 0
0AEB 7503                 1304             JNE START_CALC
0AED E92101               1305             JMP CALC_END
0AF0                      1306     START_CALC:
0AF0 BA0000               1307             MOV DX, 0
0AF3 A1B000               1308             MOV AX, DS:PRICE
0AF6 8B1EB200             1309             MOV BX, DS:QTY
0AFA F7E3                 1310             MUL BX
                          1311             
0AFC BB6400               1312             MOV BX, 100
0AFF F7F3                 1313             DIV BX
0B01 A3B000               1314             MOV DS:PRICE, AX
0B04 A1B800               1315             MOV AX, DS:TOTAL_PRICE_DEC
0B07 03C2                 1316             ADD AX, DX
0B09 3D6400               1317             CMP AX, 100
0B0C 7C07                 1318             JL NON_DECIMAL
0B0E FF06B600             1319             INC DS:TOTAL_PRICE_L
0B12 2D6400               1320             SUB AX, 100
                          1321             
0B15                      1322     NON_DECIMAL:    
0B15 A3B800               1323             MOV DS:TOTAL_PRICE_DEC, AX
0B18 A1B600               1324             MOV AX, DS:TOTAL_PRICE_L
0B1B 8B1EB000             1325             MOV BX, DS:PRICE
0B1F 03C3                 1326             ADD AX, BX
0B21 7304                 1327             JNC update_normal
0B23 FF06B400             1328             INC DS:TOTAL_PRICE_U
                          1329             
0B27                      1330     update_normal:
0B27 A3B600               1331             MOV DS:TOTAL_PRICE_L, AX
                          1332             
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    02:42:25  12/07/;3  PAGE   26


LOC  OBJ                  LINE     SOURCE

0B2A BA0000               1333             MOV DX, 0
                          1334             ;CMP DS:TOTAL_PRICE_DEC, 9
                          1335             ;JG DECIMAL_CONT
                          1336             ;MOV CX, 10
                          1337             ;MOV AX, DS:TOTAL_PRICE_DEC
                          1338             ;MUL CX
                          1339             ;MOV DS:TOTAL_PRICE_DEC, AX
                          1340     ;DECIMAL_CONT:
0B2D A1B800               1341             MOV AX, DS:TOTAL_PRICE_DEC
0B30 B90A00               1342             MOV CX, 10
0B33 F7F1                 1343             DIV CX
                          1344             
0B35 BB0700               1345             MOV BX, 7
0B38 8897BA00             1346             MOV DS:TEMP_BCD_ARR[BX], DL
0B3C 4B                   1347             DEC BX
0B3D 8887BA00             1348             MOV DS:TEMP_BCD_ARR[BX], AL
                          1349             
0B41 BB0600               1350             MOV BX, 6
0B44 A1B600               1351             MOV AX, DS:TOTAL_PRICE_L
                          1352             
0B47                      1353             TEMP_UPD_LOOP:
0B47 BA0000               1354                     MOV DX, 0
0B4A B90A00               1355                     MOV CX, 10
0B4D F7F1                 1356                     DIV CX
                          1357                     
0B4F 4B                   1358                     DEC BX
0B50 8897BA00             1359                     MOV DS:TEMP_BCD_ARR[BX], DL
0B54 43                   1360                     INC BX
                          1361                     
0B55 4B                   1362                     DEC BX
                          1363                     
0B56 75EF                 1364             JNZ TEMP_UPD_LOOP
                          1365             
0B58 8B0EB400             1366             MOV CX, DS:TOTAL_PRICE_U
0B5C 83F900               1367             CMP CX, 0
0B5F 7478                 1368             JE upd_dac_part
0B61                      1369             ADD_EXTRA_PART:
0B61 BB0500               1370                     MOV BX, 5
0B64 8A87BA00             1371                     MOV AL, DS:TEMP_BCD_ARR[BX]
0B68 0406                 1372                     ADD AL, 6
0B6A 3C09                 1373                     CMP AL, 9
0B6C 7E08                 1374                     JLE CONT_DIGIT_1
0B6E 2C0A                 1375                     SUB AL, 10
0B70 4B                   1376                     DEC BX
0B71 FE87BA00             1377                     INC DS:TEMP_BCD_ARR[BX]
0B75 43                   1378                     INC BX
0B76                      1379             CONT_DIGIT_1:
0B76 8887BA00             1380                     MOV DS:TEMP_BCD_ARR[BX], AL
0B7A 4B                   1381                     DEC BX
                          1382                     
0B7B 8A87BA00             1383                     MOV AL, DS:TEMP_BCD_ARR[BX]
0B7F 0403                 1384                     ADD AL, 3
0B81 3C09                 1385                     CMP AL, 9
0B83 7E08                 1386                     JLE CONT_DIGIT_2
0B85 2C0A                 1387                     SUB AL, 10
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    02:42:25  12/07/;3  PAGE   27


LOC  OBJ                  LINE     SOURCE

0B87 4B                   1388                     DEC BX
0B88 FE87BA00             1389                     INC DS:TEMP_BCD_ARR[BX]
0B8C 43                   1390                     INC BX
0B8D                      1391             CONT_DIGIT_2:
0B8D 8887BA00             1392                     MOV DS:TEMP_BCD_ARR[BX], AL
0B91 4B                   1393                     DEC BX
                          1394                     
0B92 8A87BA00             1395                     MOV AL, DS:TEMP_BCD_ARR[BX]
0B96 0405                 1396                     ADD AL, 5
0B98 3C09                 1397                     CMP AL, 9
0B9A 7E08                 1398                     JLE CONT_DIGIT_3
0B9C 2C0A                 1399                     SUB AL, 10
0B9E 4B                   1400                     DEC BX
0B9F FE87BA00             1401                     INC DS:TEMP_BCD_ARR[BX]
0BA3 43                   1402                     INC BX
0BA4                      1403             CONT_DIGIT_3:
0BA4 8887BA00             1404                     MOV DS:TEMP_BCD_ARR[BX], AL
0BA8 4B                   1405                     DEC BX
                          1406                     
                          1407                     
0BA9 8A87BA00             1408                     MOV AL, DS:TEMP_BCD_ARR[BX]
0BAD 0405                 1409                     ADD AL, 5
0BAF 3C09                 1410                     CMP AL, 9
0BB1 7E08                 1411                     JLE CONT_DIGIT_4
0BB3 2C0A                 1412                     SUB AL, 10
0BB5 4B                   1413                     DEC BX
0BB6 FE87BA00             1414                     INC DS:TEMP_BCD_ARR[BX]
0BBA 43                   1415                     INC BX
0BBB                      1416             CONT_DIGIT_4:
0BBB 8887BA00             1417                     MOV DS:TEMP_BCD_ARR[BX], AL
0BBF 4B                   1418                     DEC BX
                          1419                     
0BC0 8A87BA00             1420                     MOV AL, DS:TEMP_BCD_ARR[BX]
0BC4 0406                 1421                     ADD AL, 6
0BC6 3C09                 1422                     CMP AL, 9
0BC8 7E08                 1423                     JLE CONT_DIGIT_5
0BCA 2C0A                 1424                     SUB AL, 10
0BCC 4B                   1425                     DEC BX
0BCD FE87BA00             1426                     INC DS:TEMP_BCD_ARR[BX]
0BD1 43                   1427                     INC BX
0BD2                      1428             CONT_DIGIT_5:
0BD2 8887BA00             1429                     MOV DS:TEMP_BCD_ARR[BX], AL
0BD6 4B                   1430                     DEC BX
                          1431                     
0BD7 E288                 1432             LOOP ADD_EXTRA_PART
                          1433             
0BD9                      1434     upd_dac_part:
0BD9 9AE707----     R     1435             CALL FAR PTR CALC_DAC
                          1436     
0BDE 9AA105----     R     1437             CALL FAR PTR BCD_CLEAR
0BE3 C70661000000         1438             MOV DS:KEYPAD_INDEX, 0
0BE9 C706AC000300         1439             MOV DS:DECIMAL_INDEX, 3
0BEF B90800               1440             MOV CX, 8
0BF2                      1441             UPD_BCD:
0BF2 BB0800               1442                     MOV BX, 8
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    02:42:25  12/07/;3  PAGE   28


LOC  OBJ                  LINE     SOURCE

0BF5 2BD9                 1443                     SUB BX, CX
0BF7 8A87BA00             1444                     MOV AL, DS:TEMP_BCD_ARR[BX]
0BFB A27900               1445                     MOV DS:REG_AL, AL
0BFE C706AA000100         1446                     MOV DS:DAC_DISABLE, 1
0C04 9ACC05----     R     1447                     CALL FAR PTR BCD_UPDATE
0C09 C706AA000000         1448                     MOV DS:DAC_DISABLE, 0
0C0F E2E1                 1449             LOOP UPD_BCD
                          1450             
0C11                      1451     CALC_END:
0C11 833EB00000           1452             CMP DS:PRICE, 0
0C16 7403                 1453             JE RETAIN_BCD_VALUE
0C18 EB2F90               1454             JMP END_CALC_BCD_DAC
                          1455             
0C1B                      1456     RETAIN_BCD_VALUE:       
0C1B C70661000000         1457             MOV DS:KEYPAD_INDEX, 0
0C21 C706AC000300         1458             MOV DS:DECIMAL_INDEX, 3
0C27 B90800               1459             MOV CX, 8
0C2A                      1460             UPD_BCD1:
0C2A BB0800               1461                     MOV BX, 8
0C2D 2BD9                 1462                     SUB BX, CX
0C2F 8A87BA00             1463                     MOV AL, DS:TEMP_BCD_ARR[BX]
0C33 A27900               1464                     MOV DS:REG_AL, AL
0C36 C706AA000100         1465                     MOV DS:DAC_DISABLE, 1
0C3C 9ACC05----     R     1466                     CALL FAR PTR BCD_UPDATE
0C41 C706AA000000         1467                     MOV DS:DAC_DISABLE, 0
0C47 E2E1                 1468             LOOP UPD_BCD1
                          1469     
0C49                      1470     END_CALC_BCD_DAC:
0C49 C706B0000000         1471             MOV DS:PRICE, 0
0C4F C706B2000000         1472             MOV DS:QTY, 0
0C55 5A                   1473     POP DX
0C56 59                   1474     POP CX
0C57 5B                   1475     POP BX
0C58 58                   1476     POP AX
0C59 CB                   1477     RET
                          1478     CALC_UPD_PRICE ENDP
                          1479     
0C5A                      1480     UPDATE_TROLLEY PROC FAR
0C5A 50                   1481     PUSH AX
0C5B 53                   1482     PUSH BX
0C5C 51                   1483     PUSH CX
0C5D 52                   1484     PUSH DX
0C5E B90800               1485             MOV CX, 8
0C61                      1486             CLEAR_TEMP_BCD_TROLLEY:
0C61 8BD9                 1487                     MOV BX, CX
0C63 4B                   1488                     DEC BX
0C64 C687BA0000           1489                     MOV DS:TEMP_BCD_ARR[BX], 0
0C69 E2F6                 1490             LOOP CLEAR_TEMP_BCD_TROLLEY
                          1491             
0C6B 8B0EF400             1492             MOV CX, DS:TROLLEY_INDEX
0C6F BA0800               1493             MOV DX, 8
                          1494             
0C72                      1495             UPD_TROLLEY_PRICE:
0C72 8BD9                 1496                     MOV BX, CX
0C74 4B                   1497                     DEC BX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    02:42:25  12/07/;3  PAGE   29


LOC  OBJ                  LINE     SOURCE

                          1498                     
0C75 8A87EC00             1499                     MOV AL, DS:TROLLEY_ARRAY[BX]
                          1500                     
0C79 8BDA                 1501                     MOV BX, DX
0C7B 4B                   1502                     DEC BX
                          1503                     
0C7C 8887BA00             1504                     MOV DS:TEMP_BCD_ARR[BX], AL
                          1505                     
0C80 4A                   1506                     DEC DX
0C81 E2EF                 1507             LOOP UPD_TROLLEY_PRICE
                          1508             
0C83 B90800               1509             MOV CX, 8
0C86 C70661000000         1510             MOV DS:KEYPAD_INDEX, 0
0C8C                      1511             UPDATE_TROLLEY_PRICE_DISPLAY:
0C8C BB0800               1512                     MOV BX, 8
0C8F 2BD9                 1513                     SUB BX, CX
0C91 8A87BA00             1514                     MOV AL, DS:TEMP_BCD_ARR[BX]
0C95 A27900               1515                     MOV DS:REG_AL, AL
0C98 C706AA000100         1516                     MOV DS:DAC_DISABLE, 1
0C9E 9ACC05----     R     1517                     CALL FAR PTR BCD_UPDATE
0CA3 C706AA000000         1518                     MOV DS:DAC_DISABLE, 0
0CA9 E2E1                 1519             LOOP UPDATE_TROLLEY_PRICE_DISPLAY
                          1520             
0CAB 9AE707----     R     1521             CALL FAR PTR CALC_DAC
                          1522     
0CB0 5A                   1523     POP DX
0CB1 59                   1524     POP CX
0CB2 5B                   1525     POP BX
0CB3 5A                   1526     POP DX
0CB4 CB                   1527     RET
                          1528     UPDATE_TROLLEY ENDP
                          1529     ; ^^^^^^^^^^^^^^^ End of User main routine ^^^^^^^^^^^^^^^^^^^^^^^^^
0CB5                      1530     SERIAL_REC_ACTION       PROC    FAR
0CB5 51                   1531                     PUSH    CX
0CB6 53                   1532                     PUSH    BX
0CB7 1E                   1533                     PUSH    DS
                          1534                     
0CB8 BB----         R     1535                     MOV     BX,DATA_SEG             ;initialize data segment register
0CBB 8EDB                 1536                     MOV     DS,BX
                          1537                     
0CBD 803E8B0001           1538                     CMP DS:REPLY_FLAG, 1
0CC2 7557                 1539                     JNE next_id1
                          1540                     
0CC4 803E8C0001           1541                     CMP DS:SEND_FLAG, 1
0CC9 7453                 1542                     JE send_input_across1
                          1543                     
0CCB 833EA00001           1544                     CMP DS:RECEIVE_FLAG, 1
0CD0 754F                 1545                     JNE terminate_session3
                          1546                     
0CD2 3C2F                 1547                     CMP AL, '/'
0CD4 752C                 1548                     JNE CHECK_SEND
0CD6 C706A4000000         1549                     MOV DS:PRICE_FLAG, 0
0CDC C706A0000000         1550                     MOV DS:RECEIVE_FLAG, 0
0CE2 C706AE000100         1551                     MOV DS:LANG_FLAG, 1
0CE8 833EF60000           1552                     CMP DS:TROLLEY_FLAG, 0
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    02:42:25  12/07/;3  PAGE   30


LOC  OBJ                  LINE     SOURCE

0CED 7405                 1553                     JE TROLLEY_UPD_SKIP
0CEF 9A5A0C----     R     1554                     CALL FAR PTR UPDATE_TROLLEY
0CF4                      1555             TROLLEY_UPD_SKIP:
0CF4 C706F6000000         1556                     MOV DS:TROLLEY_FLAG, 0
0CFA 9AD80A----     R     1557                     CALL FAR PTR CALC_UPD_PRICE
0CFF EB2090               1558                     JMP terminate_session3
                          1559             
0D02                      1560             CHECK_SEND:
0D02 3C26                 1561                     CMP AL, '&'
0D04 751E                 1562                     JNE TROLLEY_PRICE
0D06 C706A4000100         1563                     MOV DS:PRICE_FLAG, 1
0D0C C70661000000         1564                     MOV DS:KEYPAD_INDEX, 0
0D12 C7069C000800         1565                     MOV DS:MAX_INPUT_SIZE, 8
0D18 E9AF00               1566                     JMP id_skip2
                          1567             
                          1568             
0D1B                      1569             next_id1:
0D1B E9AF00               1570                     JMP next_id
                          1571                     
0D1E                      1572             send_input_across1:
0D1E E98D00               1573                     JMP send_input_across
                          1574             
0D21                      1575             terminate_session3:
0D21 E9A300               1576                     JMP terminate_session2
                          1577             
                          1578                     
0D24                      1579             TROLLEY_PRICE:
0D24 3C2B                 1580                     CMP AL, '+'
0D26 7515                 1581                     JNE receive_price
0D28 C7069C000800         1582                     MOV DS:MAX_INPUT_SIZE, 8
0D2E C706F6000100         1583                     MOV DS:TROLLEY_FLAG, 1
0D34 C706F4000000         1584                     MOV DS:TROLLEY_INDEX, 0
0D3A E98D00               1585                     JMP id_skip2
                          1586                     
0D3D                      1587             receive_price:
0D3D 3C23                 1588                     CMP AL, '#'
0D3F 750F                 1589                     JNE check_price
0D41 C706A2000100         1590                     MOV DS:DAC_FLAG, 1
0D47 C706A4000000         1591                     MOV DS:PRICE_FLAG, 0
0D4D EB7B90               1592                     JMP id_skip2
                          1593             
0D50                      1594             check_price:    
                          1595             
0D50 833EA40001           1596                     CMP DS:PRICE_FLAG, 1
0D55 7440                 1597                     JE update_price_value
                          1598                     
0D57 833EF60001           1599                     CMP DS:TROLLEY_FLAG, 1
0D5C 7428                 1600                     JE update_trolley_arr
                          1601                     
0D5E 833EA20001           1602                     CMP DS:DAC_FLAG, 1
0D63 7403                 1603                     JE dac_change
0D65 EB6390               1604                     JMP id_skip2
                          1605     
0D68                      1606             dac_change:
0D68 8A1E7900             1607                     MOV BL, DS:REG_AL
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    02:42:25  12/07/;3  PAGE   31


LOC  OBJ                  LINE     SOURCE

0D6C 2C30                 1608                     SUB AL, 30H
0D6E A27900               1609                     MOV DS:REG_AL, AL
0D71 9A3806----     R     1610                     CALL FAR PTR DAC_UPDATE
0D76 881E7900             1611                     MOV DS:REG_AL, BL
0D7A C706A2000000         1612                     MOV DS:DAC_FLAG, 0
0D80 EB4890               1613                     JMP id_skip2
                          1614             
                          1615     
0D83 EB4590               1616             id_skip3: JMP id_skip2
                          1617             
0D86                      1618             update_trolley_arr:
0D86 8B1EF400             1619                     MOV BX, DS:TROLLEY_INDEX
0D8A 2C30                 1620                     SUB AL, 30H
0D8C 8887EC00             1621                     MOV DS:TROLLEY_ARRAY[BX], AL
0D90 FF06F400             1622                     INC DS:TROLLEY_INDEX
0D94 EB3490               1623                     JMP id_skip2
                          1624                     
0D97                      1625             update_price_value:
0D97 2C30                 1626                     SUB AL, 30H
0D99 B90000               1627                     MOV CX, 0
0D9C 8AC8                 1628                     MOV CL, AL
0D9E A1B000               1629                     MOV AX, DS:PRICE
0DA1 BB0A00               1630                     MOV BX, 10
0DA4 F7E3                 1631                     MUL BX
                          1632                     
0DA6 03C1                 1633                     ADD AX, CX
0DA8 A3B000               1634                     MOV DS:PRICE, AX
0DAB EB1D90               1635                     JMP id_skip2
                          1636                     
0DAE                      1637             send_input_across:
0DAE 9A5B06----     R     1638                     CALL FAR PTR SEND_INPUT
                          1639                     
0DB3 C7069A000000         1640                     MOV DS:SEND_BUFFER_LEN, 0
                          1641                     
0DB9 C6068C0000           1642                     MOV DS:SEND_FLAG, 0
                          1643                     
0DBE C706A0000100         1644                     MOV DS:RECEIVE_FLAG, 1
                          1645                     
0DC4 EB0490               1646                     JMP id_skip2
                          1647                     
0DC7 EB3E90               1648                     terminate_session2: JMP terminate_session
0DCA EB6790               1649                     id_skip2: JMP id_skip
                          1650                     
0DCD                      1651             next_id:
                          1652                     
0DCD 803E810001           1653                     CMP DS:ID_FLAG_r, 1
0DD2 7513                 1654                     JNE id_flag_label
0DD4 38067F00             1655                     CMP DS:MY_ID[1], AL
0DD8 7559                 1656                     JNE id_skip
                          1657                     ;start writing to pc
0DDA C6068B0001           1658                     MOV DS:REPLY_FLAG, 1
0DDF C606810000           1659                     MOV DS:ID_FLAG_r, 0
0DE4 EB4D90               1660                     JMP id_skip
                          1661             
0DE7                      1662             id_flag_label:
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    02:42:25  12/07/;3  PAGE   32


LOC  OBJ                  LINE     SOURCE

                          1663             
0DE7 803E800001           1664                     CMP DS:ID_FLAG_@, 1
0DEC 7539                 1665                     JNE protocol_rec
0DEE 3C72                 1666                     CMP AL,'r'
0DF0 750D                 1667                     JNE id_not_r
0DF2 C606810001           1668                     MOV DS:ID_FLAG_r,1
0DF7 C606800000           1669                     MOV DS:ID_FLAG_@, 0
0DFC EB3590               1670                     JMP S_RET
0DFF                      1671             id_not_r:
0DFF C606800000           1672                     MOV DS:ID_FLAG_@, 0
0E04 EB2D90               1673                     JMP id_skip
                          1674             
0E07                      1675             terminate_session:
0E07 C606810000           1676                     MOV DS:ID_FLAG_r, 0
0E0C 33DB                 1677                     XOR BX,BX
0E0E                      1678             start_send1:
0E0E 50                   1679                     PUSH AX
0E0F 33C0                 1680                     XOR AX,AX
0E11 8A878600             1681                     MOV AL, DS:FAIL_MESSAGE[BX]
0E15 9A0000----     E     1682                     CALL FAR PTR PRINT_CHAR
0E1A 58                   1683                     POP AX
0E1B C6068B0000           1684                     MOV DS:REPLY_FLAG, 0
0E20 43                   1685                     INC BX
0E21 3A1E8A00             1686                     CMP BL, DS:FAIL_COUNT
0E25 75E7                 1687                     JNE start_send1
                          1688                     
0E27                      1689             protocol_rec:
0E27 3C40                 1690                     CMP AL,'@'
0E29 7508                 1691                     JNE id_skip
0E2B C606800001           1692                     MOV DS:ID_FLAG_@,1
0E30 EB0190               1693                     JMP S_RET
                          1694                     
0E33                      1695             id_skip:
                          1696                     ; JMP S_RET
                          1697             
                          1698                     ; CMP   AL,'<'
                          1699                     ; JNE   S_FAST
                          1700     
                          1701                     ; INC   DS:T_COUNT_SET
                          1702                     ; INC   DS:T_COUNT_SET
                          1703     
                          1704                     ; JMP   S_NEXT0
                          1705     ; S_FAST:
                          1706                     ; CMP   AL,'>'
                          1707                     ; JNE   S_RET
                          1708     
                          1709                     ; DEC   DS:T_COUNT_SET
                          1710                     ; DEC   DS:T_COUNT_SET
                          1711     
                          1712     ; S_NEXT0:
                          1713                     ; MOV   CX,22                   ;initialize counter for message
                          1714                     ; MOV   BX,0
                          1715     
                          1716     ; S_NEXT1:      MOV     AL,DS:REC_MESS[BX]      ;print message
                          1717                     ; call  FAR ptr print_char
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    02:42:25  12/07/;3  PAGE   33


LOC  OBJ                  LINE     SOURCE

                          1718                     ; INC   BX
                          1719                     ; LOOP  S_NEXT1
                          1720     
                          1721                     ; MOV   AL,DS:T_COUNT_SET       ;print current period of timer0
                          1722                     ; CALL  FAR PTR PRINT_2HEX
0E33                      1723     S_RET:
0E33 1F                   1724                     POP     DS
0E34 5B                   1725                     POP     BX
0E35 59                   1726                     POP     CX
0E36 CB                   1727                     RET
                          1728     SERIAL_REC_ACTION       ENDP
                          1729     
0E37                      1730     TIMER2_ACTION   PROC    FAR
0E37 50                   1731                     PUSH    AX
0E38 1E                   1732                     PUSH    DS
0E39 53                   1733                     PUSH    BX
0E3A 51                   1734                     PUSH    CX
0E3B 52                   1735                     PUSH    DX
                          1736                     
                          1737                     
0E3C B8----         R     1738                     MOV     AX,DATA_SEG
0E3F 8ED8                 1739                     MOV     DS,AX
                          1740             
0E41 FE0E1600             1741                     DEC     DS:T_COUNT
0E45 754A                 1742                     JNZ     T_NEXT1
0E47 A01700               1743                     MOV     AL,DS:T_COUNT_SET
0E4A A21600               1744                     MOV     DS:T_COUNT,AL
                          1745     
0E4D                      1746     T_NEXT0:
                          1747                     
0E4D 33DB                 1748                     XOR BX, BX
0E4F 8A1E6000             1749                     MOV BL, DS:BCD_INDEX
0E53 8A4759               1750                     MOV AL, DS:BCD_MESSAGE[BX]
                          1751                     
0E56 3B1EAC00             1752                     CMP BX, DS:DECIMAL_INDEX
0E5A 7506                 1753                     JNE CALL_FUNC
0E5C C706A6000100         1754                     MOV DS:DECIMAL_FLAG, 1
0E62                      1755     CALL_FUNC:
0E62 9A020F----     R     1756                     CALL FAR PTR BCD_TO_7SEG
0E67 C706A6000000         1757                     MOV DS:DECIMAL_FLAG, 0
                          1758     
0E6D BA0002               1759                     MOV DX, 200H
0E70 EE                   1760                     OUT DX, AL
                          1761                     
0E71 A05F00               1762                     MOV AL, DS:ENABLE_BYTE
0E74 BA8001               1763                     MOV DX, 180H
0E77 EE                   1764                     OUT DX, AL
                          1765                     
                          1766     
0E78 FE066000             1767                     INC DS:BCD_INDEX
0E7C D0065F00             1768                     ROL DS:ENABLE_BYTE, 1
0E80 803E5F00BF           1769                     CMP DS:ENABLE_BYTE, 10111111b
0E85 750A                 1770                     JNE T_NEXT1
0E87 C6065F00FE           1771                     MOV DS:ENABLE_BYTE, 11111110b 
0E8C C606600000           1772                     MOV DS:BCD_INDEX, 0
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    02:42:25  12/07/;3  PAGE   34


LOC  OBJ                  LINE     SOURCE

                          1773     
                          1774                     
0E91                      1775     T_NEXT1:
0E91 803E750000           1776                     CMP DS:DAC_LEN, 0
0E96 743C                 1777                     JE ISR_END
                          1778                     
                          1779                     
0E98 8B367600             1780                     MOV SI, DS:SI_PTR
                          1781                             
0E9C BB0000               1782                     MOV BX, 0
0E9F 33C0                 1783                     XOR AX, AX
0EA1 8A4766               1784                     MOV AL, DS:DAC_ADDR[BX]
                          1785                     
0EA4 BB0001               1786                     MOV BX, 100H
0EA7 F7E3                 1787                     MUL BX
                          1788                     
0EA9 8B166400             1789                     MOV DX, DS:DAC_BASE
0EAD 03D0                 1790                     ADD DX, AX
                          1791                     
0EAF 1E                   1792                     PUSH DS
0EB0 8EDA                 1793                     MOV DS, DX
                          1794                     
0EB2 8B04                 1795                     MOV AX, [SI]
                          1796                     
0EB4 BA1001               1797                     MOV DX, 110H
0EB7 EE                   1798                     OUT DX, AL
                          1799                     
0EB8 1F                   1800                     POP DS
                          1801                     
0EB9 FF067600             1802                     INC DS:SI_PTR
0EBD 813E76000010         1803                     CMP DS:SI_PTR, 1000H
0EC3 750F                 1804                     JNE ISR_END
                          1805                     
0EC5 C70676000000         1806                     MOV DS:SI_PTR, 0
0ECB FE0E7500             1807                     DEC DS:DAC_LEN
0ECF 9ADA0E----     R     1808                     CALL FAR PTR DAC_SHIFT
                          1809                     
0ED4                      1810     ISR_END:
                          1811                     
0ED4 5A                   1812                     POP DX
0ED5 59                   1813                     POP     CX
0ED6 5B                   1814                     POP     BX
0ED7 1F                   1815                     POP     DS
0ED8 58                   1816                     POP AX
0ED9 CB                   1817                     RET
                          1818     TIMER2_ACTION   ENDP
                          1819     
                          1820     
0EDA                      1821     DAC_SHIFT PROC FAR
0EDA 50                   1822             PUSH AX
0EDB 53                   1823             PUSH BX
0EDC 51                   1824             PUSH CX
0EDD 52                   1825             PUSH DX
                          1826     
0EDE 33C9                 1827             XOR CX, CX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    02:42:25  12/07/;3  PAGE   35


LOC  OBJ                  LINE     SOURCE

0EE0 8A0E7500             1828             MOV CL, DS:DAC_LEN
0EE4 80F900               1829             CMP CL, 0
0EE7 7414                 1830             JE END_SHIFT
                          1831     
0EE9                      1832             SHIFT_LOOP:
                          1833     
0EE9 33DB                 1834             XOR BX, BX
0EEB 8A1E7500             1835             MOV BL, DS:DAC_LEN
0EEF 2BD9                 1836             SUB BX, CX
0EF1 43                   1837             INC BX
                          1838             
0EF2 33D2                 1839             XOR DX, DX
0EF4 8A5766               1840             MOV DL, DS:DAC_ADDR[BX]
0EF7 4B                   1841             DEC BX
0EF8 885766               1842             MOV DS:DAC_ADDR[BX], DL
                          1843     
0EFB E2EC                 1844             LOOP SHIFT_LOOP
                          1845             
0EFD                      1846             END_SHIFT:
0EFD 5A                   1847             POP DX
0EFE 59                   1848             POP CX
0EFF 5B                   1849             POP BX
0F00 58                   1850             POP AX
0F01 CB                   1851             RET
                          1852     DAC_SHIFT ENDP
                          1853     
0F02                      1854     BCD_TO_7SEG PROC FAR
                          1855     
0F02 53                   1856             PUSH BX
0F03 51                   1857             PUSH CX
0F04 52                   1858             PUSH DX
                          1859             
0F05 3C00                 1860             CMP AL, 0
0F07 7511                 1861             JNE one
0F09 833EA60001           1862             CMP DS:DECIMAL_FLAG, 1
0F0E 7405                 1863             JE decimal0
0F10 B03F                 1864             MOV AL, 00111111b
0F12 E9D700               1865             JMP endfunc
0F15                      1866     decimal0:
0F15 B0BF                 1867             MOV AL, 10111111b
0F17 E9D200               1868             JMP endfunc
                          1869             
0F1A                      1870             one:
0F1A 3C01                 1871             CMP AL, 1
0F1C 7511                 1872             JNE two
0F1E 833EA60001           1873             CMP DS:DECIMAL_FLAG, 1
0F23 7405                 1874             JE decimal1
0F25 B006                 1875             MOV AL, 00000110b
0F27 E9C200               1876             JMP endfunc
0F2A                      1877     decimal1:
0F2A B086                 1878             MOV AL, 10000110b
0F2C E9BD00               1879             JMP endfunc
                          1880             
0F2F                      1881             two:
0F2F 3C02                 1882             CMP AL,2
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    02:42:25  12/07/;3  PAGE   36


LOC  OBJ                  LINE     SOURCE

0F31 7511                 1883             JNE three
0F33 833EA60001           1884             CMP DS:DECIMAL_FLAG, 1
0F38 7405                 1885             JE decimal2
0F3A B05B                 1886             MOV AL, 01011011b
0F3C E9AD00               1887             JMP endfunc
0F3F                      1888     decimal2:
0F3F B0DB                 1889             MOV AL, 11011011b
0F41 E9A800               1890             JMP endfunc
                          1891             
0F44                      1892             three:
0F44 3C03                 1893             CMP AL,3
0F46 7511                 1894             JNE four
0F48 833EA60001           1895             CMP DS:DECIMAL_FLAG, 1
0F4D 7405                 1896             JE decimal3
0F4F B04F                 1897             MOV AL, 01001111b
0F51 E99800               1898             JMP endfunc
0F54                      1899     decimal3:
0F54 B0CF                 1900             MOV AL, 11001111b
0F56 E99300               1901             JMP endfunc
                          1902             
0F59                      1903             four:
0F59 3C04                 1904             CMP AL,4
0F5B 7511                 1905             JNE five
0F5D 833EA60001           1906             CMP DS:DECIMAL_FLAG, 1
0F62 7405                 1907             JE decimal4
0F64 B066                 1908             MOV AL, 01100110b
0F66 E98300               1909             JMP endfunc
0F69                      1910     decimal4:
0F69 B0E6                 1911             MOV AL, 11100110b
0F6B EB7F90               1912             JMP endfunc
                          1913             
0F6E                      1914             five:
0F6E 3C05                 1915             CMP AL,5
0F70 7511                 1916             JNE six
0F72 833EA60001           1917             CMP DS:DECIMAL_FLAG, 1
0F77 7405                 1918             JE decimal5
0F79 B06D                 1919             MOV AL, 01101101b
0F7B EB6F90               1920             JMP endfunc
0F7E                      1921     decimal5:
0F7E B0ED                 1922             MOV AL, 11101101b
0F80 EB6A90               1923             JMP endfunc
                          1924             
0F83                      1925             six:
0F83 3C06                 1926             CMP AL,6
0F85 7511                 1927             JNE seven
0F87 833EA60001           1928             CMP DS:DECIMAL_FLAG, 1
0F8C 7405                 1929             JE decimal6
0F8E B07D                 1930             MOV AL, 01111101b
0F90 EB5A90               1931             JMP endfunc
0F93                      1932     decimal6:
0F93 B0FD                 1933             MOV AL, 11111101b
0F95 EB5590               1934             JMP endfunc
                          1935             
0F98                      1936             seven:
0F98 3C07                 1937             CMP AL,7
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    02:42:25  12/07/;3  PAGE   37


LOC  OBJ                  LINE     SOURCE

0F9A 7511                 1938             JNE eight
0F9C 833EA60001           1939             CMP DS:DECIMAL_FLAG, 1
0FA1 7405                 1940             JE decimal7
0FA3 B007                 1941             MOV AL, 00000111b
0FA5 EB4590               1942             JMP endfunc
0FA8                      1943     decimal7:
0FA8 B087                 1944             MOV AL, 10000111b
0FAA EB4090               1945             JMP endfunc
                          1946             
0FAD                      1947             eight:
0FAD 3C08                 1948             CMP AL,8
0FAF 7511                 1949             JNE nine
0FB1 833EA60001           1950             CMP DS:DECIMAL_FLAG, 1
0FB6 7405                 1951             JE decimal8
0FB8 B07F                 1952             MOV AL, 01111111b
0FBA EB3090               1953             JMP endfunc
0FBD                      1954     decimal8:
0FBD B0FF                 1955             MOV AL, 11111111b
0FBF EB2B90               1956             JMP endfunc
                          1957             
0FC2                      1958             nine:
0FC2 3C09                 1959             CMP AL,9
0FC4 7511                 1960             JNE hifn
0FC6 833EA60001           1961             CMP DS:DECIMAL_FLAG, 1
0FCB 7405                 1962             JE decimal9
0FCD B06F                 1963             MOV AL, 01101111b
0FCF EB1B90               1964             JMP endfunc
0FD2                      1965     decimal9:
0FD2 B0EF                 1966             MOV AL, 11101111b
0FD4 EB1690               1967             JMP endfunc
                          1968             
0FD7                      1969             hifn:
0FD7 3C2D                 1970             CMP AL,'-'
0FD9 7511                 1971             JNE endfunc
0FDB 833EA60001           1972             CMP DS:DECIMAL_FLAG, 1
0FE0 7405                 1973             JE decimal10
0FE2 B040                 1974             MOV AL, 01000000b
0FE4 EB0690               1975             JMP endfunc
0FE7                      1976     decimal10:
0FE7 B0C0                 1977             MOV AL, 11000000b
0FE9 EB0190               1978             JMP endfunc
                          1979             
0FEC                      1980             endfunc:
0FEC 5A                   1981             POP DX
0FED 59                   1982             POP CX
0FEE 5B                   1983             POP BX
                          1984     
0FEF CB                   1985     RET
                          1986     BCD_TO_7SEG ENDP
                          1987     
----                      1988     CODE_SEG        ENDS
                          1989     END

ASSEMBLY COMPLETE, NO ERRORS FOUND
