8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    13:38:09  11/18/;3  PAGE    1


DOS 5.0 (038-N) 8086/87/88/186 MACRO ASSEMBLER V3.1 ASSEMBLY OF MODULE TIMER
OBJECT MODULE PLACED IN TIMER.OBJ
ASSEMBLER INVOKED BY:  D:\ASM86.EXE TIMER.ASM


LOC  OBJ                  LINE     SOURCE

                             1 +1  $MOD186
                             2 +1  $EP
                             3     NAME TIMER
                             4     ; Main program for uPD70208 microcomputer system
                             5     ;
                             6     ; Author:       Dr Tay Teng Tiow
                             7     ; Address:      Department of Electrical Engineering 
                             8     ;               National University of Singapore
                             9     ;               10, Kent Ridge Crescent
                            10     ;               Singapore 0511. 
                            11     ; Date:         6th September 1991
                            12     ;
                            13     ; This file contains proprietory information and cannot be copied 
                            14     ; or distributed without prior permission from the author.
                            15     ; =========================================================================
                            16     
                            17     public  serial_rec_action, timer2_action
                            18     extrn   print_char:far, print_2hex:far, iodefine:far
                            19     extrn   set_timer2:far
                            20     
                            21     ;IO Setup for 80C188 
  FFA0                      22             UMCR    EQU    0FFA0H ; Upper Memory Control Register
  FFA2                      23             LMCR    EQU    0FFA2H ; Lower Memory control Register         
  FFA4                      24             PCSBA   EQU    0FFA4H ; Peripheral Chip Select Base Address
  FFA8                      25             MPCS    EQU    0FFA8H ; MMCS and PCS Alter Control Register
  0080                      26             A_8255  EQU    0080H
  0081                      27             B_8255  EQU    0081H
  0082                      28             C_8255  EQU    0082H
  0083                      29             CWR_8255  EQU    0083H
  FF38                      30             INT0CON  EQU   0FF38H
  FF22                      31             EOI EQU 0FF22H
  FF28                      32             IMASK EQU 0FF28H
  FFA6                      33             MMCS    EQU    0FFA6H 
  4000                      34             DAC EQU 4000H
                            35     
                            36     
----                        37     STACK_SEG       SEGMENT
0000 (512                   38                     DB      512 DUP(?)
     ??
     )
0200                        39             TOS     LABEL   WORD
----                        40     STACK_SEG       ENDS
                            41     
                            42     
----                        43     DATA_SEG        SEGMENT
0000 0A                     44             TIMER0_MESS             DB      10,13,'TIMER2 INTERRUPT    '
0001 0D
0002 54494D45523220
     494E5445525255
     505420202020
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    13:38:09  11/18/;3  PAGE    2


LOC  OBJ                  LINE     SOURCE

0016 18                     45             T_COUNT                 DB      24
0017 18                     46             T_COUNT_SET             DB      24
0018 0A                     47             REC_MESS                DB      10,13,'Period of timer0 =     '
0019 0D
001A 506572696F6420
     6F662074696D65
     7230203D202020
     2020
0031 (32                    48             MESSAGE         DB  32 dup('h')
     68
     )
0051 00                     49             KEYPAD_INPUT    DB  0,0,0,0,0,0,0,0
0052 00
0053 00
0054 00
0055 00
0056 00
0057 00
0058 00
0059 2D                     50             BCD_MESSAGE     DB  '-','-','-','-','-','-'
005A 2D
005B 2D
005C 2D
005D 2D
005E 2D
005F FE                     51             ENABLE_BYTE     DB  11111110b
0060 00                     52             BCD_INDEX       DB  0
0061 0000                   53             KEYPAD_INDEX    DW      0
0063 20                     54             M_SIZE                  DB  32
0064 0040                   55             DAC_BASE        DW  4000H
0066 (15                    56             DAC_ADDR        DB  15 dup(0) 
     00
     )
0075 00                     57             DAC_LEN         DB  0
0076 0000                   58             SI_PTR          DW  0
0078 ??                     59             CHAR                    DB  ?
0079 ??                     60             REG_AL                  DB  ?
007A ??                     61             REG_BH                  DB  ?
007B ??                     62             REG_CL                  DB  ?
007C 00                     63             FLAG            DB  0
007D 00                     64             LONG_PRESS_FLAG DB      0
007E 7231                   65             MY_ID                   DB      'r1'
0080 00                     66             ID_FLAG_@               DB      0
0081 00                     67             ID_FLAG_r               DB      0
0082 4072312F               68             REPLY_MESSAGE   DB      '@r1/'
0086 40302F                 69             FAIL_MESSAGE    DB '@0/'
0089 04                     70             REPLY_COUNT             DB      4
008A 03                     71             FAIL_COUNT              DB      3
008B 00                     72             REPLY_FLAG              DB      0
008C 00                     73             SEND_FLAG       DB  0
008D (13                    74             SEND_BUFFER     DB  13 dup(0)
     00
     )
009A 0000                   75             SEND_BUFFER_LEN DW      0
009C 0000                   76             MAX_INPUT_SIZE  DW      0
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    13:38:09  11/18/;3  PAGE    3


LOC  OBJ                  LINE     SOURCE

009E 0000                   77             QTY_FLAG                DW      0
00A0 0000                   78             RECEIVE_FLAG    DW      0
00A2 0000                   79             DAC_FLAG                DW      0
00A4 0000                   80             PRICE_FLAG      DW      0
00A6 0100                   81             DECIMAL_FLAG    DW      1
00A8 0000                   82             SCROLL_LEN      DW      0
00AA 0000                   83             DAC_DISABLE     DW  0
00AC 0300                   84             DECIMAL_INDEX   DW  3
----                        85     DATA_SEG        ENDS
                            86     
                            87     
----                        88     CODE_SEG        SEGMENT
                            89     
                            90             PUBLIC          START
                            91     
                            92     ASSUME  CS:CODE_SEG, SS:STACK_SEG
                            93     
0000                        94     START:
                            95     ;initialize stack area
0000 B8----         R       96                     MOV     AX,STACK_SEG            
0003 8ED0                   97                     MOV     SS,AX
0005 368B260002             98                     MOV     SP,TOS
                            99                     
                           100     ; Initialize the on-chip pheripherals
000A 9A0000----     E      101                     CALL    FAR PTR IODEFINE
                           102                     
000F 9A0000----     E      103     call set_timer2
0014 FB                    104                    STI
                           105     
                           106     ; ^^^^^^^^^^^^^^^^^  Start of User Main Routine  ^^^^^^^^^^^^^^^^^^
                           107     
                           108     ;Initialize MMCS
                           109             
0015 BAA6FF                110             MOV DX, MMCS
0018 B80340                111             MOV AX, 4003H
001B EF                    112             OUT DX, AX
                           113     
                           114     ; Initialize MPCS to MAP peripheral to IO address
                           115             
001C BAA8FF                116             MOV DX, MPCS
001F B88320                117             MOV AX, 2083H
0022 EF                    118             OUT DX, AX
                           119        
                           120     ; PCSBA initial, set the parallel port start from 00H
0023 BAA4FF                121             MOV DX, PCSBA
0026 B80300                122             MOV AX, 0003H ; Peripheral starting address 00H no READY, No Waits
0029 EF                    123             OUT DX, AX
                           124     
                           125     ; Initialize LMCS 
002A BAA2FF                126         MOV DX, LMCR
002D B8C401                127         MOV AX, 01C4H  ; Starting address 1FFFH, 8K, No waits, last shoud be 5H for 1 wai
                                   ts      
0030 EF                    128         OUT DX, AX
                           129             
0031 B8----         R      130             MOV AX, DATA_SEG
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    13:38:09  11/18/;3  PAGE    4


LOC  OBJ                  LINE     SOURCE

0034 8ED8                  131             MOV DS, AX
                           132                              
0036 BA8300                133             MOV DX, CWR_8255
0039 B88200                134             MOV AX, 0082h
003C EF                    135             OUT DX, AX
                           136             
003D                       137     NEXT:
003D 9A4400----     R      138             CALL FAR PTR KEYPAD_LOOP
                           139             
0042 EBF9                  140     JMP NEXT
                           141     
0044                       142     KEYPAD_LOOP PROC FAR
0044 50                    143     PUSH AX
0045 53                    144     PUSH BX
0046 51                    145     PUSH CX
0047 52                    146     PUSH DX
                           147             
0048 9AED03----     R      148                             CALL FAR PTR DEBOUNCE           
                           149                             
004D C606790003            150     WAIT_1:         MOV DS:REG_AL, 03H
0052 BB0000                151                         MOV BX, 0000H
0055 BA8200                152                         MOV DX,C_8255
0058 8AC3                  153                         MOV AL,BL
005A EE                    154                         OUT DX,AL
                           155                        
005B BA8100                156                         MOV DX,B_8255
005E EC                    157                         IN AL,DX
005F 8AD8                  158                         MOV BL,AL  
0061 80E3FC                159                         AND BL,0FCH
0064 80FBFC                160                         CMP BL,0FCH
                           161                      
0067 7449                  162                     JE LONG_PRESS
                           163                             
0069 B3FE                  164                         MOV BL, 0FEH
006B C6067A0004            165                         MOV DS:REG_BH, 04H
                           166                        
0070                       167     NXTROW: 
0070 C0C307                168                     ROL BL,07H
0073 8AEB                  169                             MOV CH,BL
0075 BA8200                170                             MOV DX,C_8255
0078 8AC3                  171                             MOV AL,BL
007A EE                    172                             OUT DX,AL
                           173                             
007B BA8100                174                             MOV DX,B_8255
007E EC                    175                             IN AL,DX
007F 8AD8                  176                             MOV BL,AL
0081 80E3FC                177                             AND BL,0FCH
0084 C6067B0006            178                             MOV DS:REG_CL,06H
0089 C0DB02                179                             RCR BL,02H
008C D0DB                  180     NXTCOL:         RCR BL,01H
008E 732A                  181                             JNC CODEKY
0090 FE0E7900              182                             DEC DS:REG_AL
0094 FE0E7B00              183                             DEC DS:REG_CL
0098 803E7B0003            184                             CMP DS:REG_CL,03H
009D 746A                  185                             JE KEYPAD3
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    13:38:09  11/18/;3  PAGE    5


LOC  OBJ                  LINE     SOURCE

                           186                             
009F 803E7B0000            187                             CMP DS:REG_CL, 0H
00A4 7460                  188                             JE SUBTRACT2
00A6 EBE4                  189                             JMP NXTCOL
                           190                             
00A8 8ADD                  191                             MOV BL,CH
00AA FE0E7A00              192                             DEC DS:REG_BH
00AE 75C0                  193                             JNZ NXTROW
00B0 EB9B                  194                             JMP WAIT_1
                           195                             
00B2                       196     LONG_PRESS:
00B2 C6067D0000            197                             MOV DS:LONG_PRESS_FLAG, 0
00B7 EB5390                198                             JMP RETURN2
00BA                       199     CODEKY:
00BA 803E79000B            200                         CMP DS:REG_AL, 11
00BF 7505                  201                             JNE bcd_upd
00C1 C606790000            202                             MOV DS:REG_AL, 0
                           203                             
00C6                       204     bcd_upd:
00C6 803E7D0000            205                             CMP DS:LONG_PRESS_FLAG, 0
00CB 753F                  206                             JNE RETURN2
                           207                             
00CD 803E79000A            208                             CMP DS:REG_AL, 10
00D2 7508                  209                             JNE BACKSPACE
00D4 9A3C03----     R      210                             CALL FAR PTR BCD_CLEAR
00D9 E9E300                211                             JMP UPDATE_7SEG2
                           212                             
00DC 803E79000C            213     BACKSPACE:      CMP DS:REG_AL, 12
00E1 7508                  214                             JNE ENTER_DATA
00E3 9ACD02----     R      215                             CALL FAR PTR BCD_BACKSPACE
00E8 E9D400                216                             JMP UPDATE_7SEG2
                           217     
00EB 803E79000D            218     ENTER_DATA:     CMP DS:REG_AL, 13
00F0 751D                  219                             JNE END_TRANS
00F2 9A3C03----     R      220                             CALL FAR PTR BCD_CLEAR
00F7 C706AC000600          221                             MOV DS:DECIMAL_INDEX, 6
00FD C7069C000800          222                             MOV DS:MAX_INPUT_SIZE, 8
0103 E9B900                223                             JMP UPDATE_7SEG2
                           224     
0106 E93801                225     SUBTRACT2:   JMP SUBTRACT
                           226     
0109 E92501                227     KEYPAD3:        JMP KEYPAD_2
                           228     
010C E94001                229     RETURN2:    JMP RETURN
                           230                             
010F 803E790010            231     END_TRANS:      CMP DS:REG_AL, 16
0114 751C                  232                             JNE SCROLL_LEFT
0116 BB0000                233                             MOV BX, 0
0119 C6878D0024            234                             MOV DS:SEND_BUFFER[BX], '$'
011E 43                    235                             INC BX
011F C6878D002F            236                             MOV DS:SEND_BUFFER[BX], '/'
0124 C7069A000200          237                             MOV DS:SEND_BUFFER_LEN, 2
012A C6068C0001            238                             MOV DS:SEND_FLAG, 1
012F E98D00                239                             JMP UPDATE_7SEG2
                           240                             
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    13:38:09  11/18/;3  PAGE    6


LOC  OBJ                  LINE     SOURCE

                           241                             
0132                       242     SCROLL_LEFT:
0132 803E790015            243                             CMP DS:REG_AL, 21
0137 753D                  244                             JNE SCROLL_RIGHT
0139 833E610006            245                             CMP DS:KEYPAD_INDEX, 6
013E 7E7F                  246                             JLE UPDATE_7SEG2
0140 833EA80000            247                             CMP DS:SCROLL_LEN, 0
0145 7478                  248                             JE UPDATE_7SEG2
0147 FF0EA800              249                             DEC DS:SCROLL_LEN
014B FF0EAC00              250                             DEC DS:DECIMAL_INDEX
014F FF0E6100              251                             DEC DS:KEYPAD_INDEX
0153 8B1E6100              252                             MOV BX, DS:KEYPAD_INDEX
0157 8A4751                253                             MOV AL, DS:KEYPAD_INPUT[BX]
015A A27900                254                             MOV DS:REG_AL, AL
015D C706AA000100          255                             MOV DS:DAC_DISABLE, 1
0163 9A6703----     R      256                             CALL FAR PTR BCD_UPDATE
0168 C706AA000000          257                             MOV DS:DAC_DISABLE, 0
016E C606790015            258                             MOV DS:REG_AL, 21
0173 EB4A90                259                             JMP UPDATE_7SEG2
                           260     
                           261     
                           262     
0176                       263     SCROLL_RIGHT:
0176 803E790013            264                             CMP DS:REG_AL, 19
017B 7545                  265                             JNE QTY_PROMPT
017D 833E610006            266                             CMP DS:KEYPAD_INDEX, 6
0182 7E3B                  267                             JLE UPDATE_7SEG2
0184 A16100                268                             MOV AX, DS:KEYPAD_INDEX
0187 2D0600                269                             SUB AX, 6
018A 3906A800              270                             CMP DS:SCROLL_LEN, AX
018E 742F                  271                             JE UPDATE_7SEG2
0190 FF06A800              272                             INC DS:SCROLL_LEN
0194 FF06AC00              273                             INC DS:DECIMAL_INDEX
0198 FF0E6100              274                             DEC DS:KEYPAD_INDEX
019C 8B1E6100              275                             MOV BX, DS:KEYPAD_INDEX
01A0 8A4751                276                             MOV AL, DS:KEYPAD_INPUT[BX]
01A3 A27900                277                             MOV DS:REG_AL, AL
01A6 C706AA000100          278                             MOV DS:DAC_DISABLE, 1
01AC 9A6703----     R      279                             CALL FAR PTR BCD_UPDATE
01B1 C706AA000000          280                             MOV DS:DAC_DISABLE, 0
01B7 C606790013            281                             MOV DS:REG_AL, 19
01BC EB0190                282                             JMP UPDATE_7SEG2
                           283                             
01BF EB5C90                284     UPDATE_7SEG2: JMP UPDATE_7SEG
                           285     
01C2                       286     QTY_PROMPT:
01C2 833E610008            287                             CMP DS:KEYPAD_INDEX, 8
01C7 7527                  288                             JNE  QUANTITY
01C9 803E790016            289                             CMP DS:REG_AL, 22
01CE 7520                  290                             JNE QUANTITY
01D0 833E9C0008            291                             CMP DS:MAX_INPUT_SIZE, 8
01D5 7519                  292                             JNE QUANTITY
01D7 9A8602----     R      293                             CALL FAR PTR UPDATE_SEND_BUFFER
01DC 9A3C03----     R      294                             CALL FAR PTR BCD_CLEAR
01E1 C7069C000200          295                             MOV DS:MAX_INPUT_SIZE, 2
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    13:38:09  11/18/;3  PAGE    7


LOC  OBJ                  LINE     SOURCE

01E7 C7069E000100          296                             MOV DS:QTY_FLAG, 1
01ED EB2E90                297                             JMP UPDATE_7SEG
                           298                     
01F0                       299     QUANTITY:
01F0 833E610000            300                             CMP DS:KEYPAD_INDEX, 0
01F5 7426                  301                             JE  UPDATE_7SEG
                           302                             
01F7 803E79000E            303                             CMP DS:REG_AL, 14
01FC 751F                  304                             JNE UPDATE_7SEG
                           305                             
01FE 833E9E0001            306                             CMP DS:QTY_FLAG, 1
0203 7518                  307                             JNE UPDATE_7SEG
                           308                             
0205 9A5402----     R      309                             CALL FAR PTR UPDATE_THE_QUANTITY
                           310                                             
020A C6068C0001            311                             MOV DS:SEND_FLAG, 1
                           312                             
020F C7069E000000          313                             MOV DS:QTY_FLAG, 0
0215 9A3C03----     R      314                             CALL FAR PTR BCD_CLEAR
                           315                                     
021A EB0190                316                             JMP UPDATE_7SEG
                           317                             
                           318     
021D                       319     UPDATE_7SEG:
021D 803E790009            320                             CMP DS:REG_AL, 9
0222 7F05                  321                             JG SET_PRESS_FLAG
                           322                             
0224 9A6703----     R      323                             CALL FAR PTR BCD_UPDATE
                           324                             
0229                       325     SET_PRESS_FLAG:
0229 C6067D0001            326                             MOV DS:LONG_PRESS_FLAG, 1
022E EB1F90                327                             JMP RETURN
                           328             
0231                       329     KEYPAD_2: 
0231 800679000F            330                 ADD DS:REG_AL,0FH
0236 E953FE                331                             JMP NXTCOL
0239 C606790000            332     ZERO_PRINT: MOV DS:REG_AL,00H
023E E94BFE                333                             JMP NXTCOL
0241 802E790006            334     SUBTRACT:   SUB DS:REG_AL,06H
0246 8ADD                  335                             MOV BL,CH
0248 FE0E7A00              336                             DEC DS:REG_BH
024C E921FE                337                             JMP NXTROW
                           338             
                           339             
024F                       340     RETURN:
024F 5A                    341                             POP DX
0250 59                    342                             POP CX
0251 5B                    343                             POP BX
0252 58                    344                             POP AX
0253 CB                    345                             RET
                           346     
                           347     KEYPAD_LOOP ENDP
                           348     
0254                       349     UPDATE_THE_QUANTITY PROC FAR
0254 50                    350     PUSH AX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    13:38:09  11/18/;3  PAGE    8


LOC  OBJ                  LINE     SOURCE

0255 53                    351     PUSH BX
0256 51                    352     PUSH CX
0257 52                    353     PUSH DX
0258 8B0E6100              354             MOV CX, DS:KEYPAD_INDEX
025C 8B1E9A00              355             MOV BX, DS:SEND_BUFFER_LEN
                           356             
0260                       357             UPD_QTY:
0260 53                    358                     PUSH BX
0261 8B1E6100              359                     MOV BX, DS:KEYPAD_INDEX
0265 2BD9                  360                     SUB BX, CX
0267 8A4751                361                     MOV AL, DS:KEYPAD_INPUT[BX]
026A 5B                    362                     POP BX
026B 0430                  363                     ADD AL, 30H
026D 88878D00              364                     MOV DS:SEND_BUFFER[BX], AL
                           365                     
0271 43                    366                     INC BX
0272 FF069A00              367                     INC DS:SEND_BUFFER_LEN
                           368                     
0276 E2E8                  369             LOOP UPD_QTY
0278 C6878D002F            370                     MOV DS:SEND_BUFFER[BX], '/'
027D FF069A00              371                     INC DS:SEND_BUFFER_LEN
                           372     
0281 5A                    373     POP DX
0282 59                    374     POP CX
0283 5B                    375     POP BX
0284 58                    376     POP AX
                           377     
0285 CB                    378     RET
                           379     UPDATE_THE_QUANTITY ENDP
                           380     
0286                       381     UPDATE_SEND_BUFFER PROC FAR
0286 50                    382     PUSH AX
0287 53                    383     PUSH BX
0288 51                    384     PUSH CX
0289 52                    385     PUSH DX
                           386     
028A 8B0E6100              387             MOV CX, DS:KEYPAD_INDEX
028E 83F900                388             CMP CX, 0
0291 7435                  389             JE END_UPD_BUFFER
0293 83C102                390             ADD CX, 2
0296 890E9A00              391             MOV DS:SEND_BUFFER_LEN, CX
029A BB0000                392             MOV BX, 0
029D                       393             BUFFER_LOOP:
029D 83FB00                394                     CMP BX, 0
02A0 7508                  395                     JNE ASTRISK
02A2 C6878D007E            396                     MOV DS:SEND_BUFFER[BX], '~'
02A7 EB1C90                397                     JMP END_BUFFER
02AA                       398             ASTRISK:
02AA A16100                399                     MOV AX, DS:KEYPAD_INDEX
02AD 40                    400                     INC AX
02AE 3BD8                  401                     CMP BX, AX
02B0 7508                  402                     JNE CONT
02B2 C6878D002A            403                     MOV DS:SEND_BUFFER[BX], '*'
02B7 EB0C90                404                     JMP END_BUFFER
02BA                       405             CONT:
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    13:38:09  11/18/;3  PAGE    9


LOC  OBJ                  LINE     SOURCE

02BA 4B                    406                     DEC BX
02BB 8A4751                407                     MOV AL, DS:KEYPAD_INPUT[BX]
02BE 0430                  408                     ADD AL, 30H
02C0 43                    409                     INC BX
02C1 88878D00              410                     MOV DS:SEND_BUFFER[BX], AL
                           411                     
02C5                       412             END_BUFFER:
02C5 43                    413                     INC BX
02C6 E2D5                  414             LOOP BUFFER_LOOP
02C8                       415     END_UPD_BUFFER:
02C8 5A                    416     POP DX
02C9 59                    417     POP CX
02CA 5B                    418     POP BX
02CB 58                    419     POP AX
02CC CB                    420     RET
                           421     UPDATE_SEND_BUFFER ENDP
                           422     
02CD                       423     BCD_BACKSPACE PROC FAR
                           424     
02CD 50                    425     PUSH AX
02CE 53                    426     PUSH BX
02CF 51                    427     PUSH CX
02D0 52                    428     PUSH DX
                           429     
02D1 8A167900              430             MOV DL, DS:REG_AL
02D5 833E610000            431             CMP DS:KEYPAD_INDEX, 0
02DA 7457                  432             JE RETURN_BACK
                           433             
02DC BB0600                434             MOV BX, 6
02DF                       435             BCD_CLEAR_LOOP:
02DF 4B                    436                     DEC BX
02E0 C647592D              437                     MOV DS:BCD_MESSAGE[BX], '-'
02E4 43                    438                     INC BX
02E5 4B                    439                     DEC BX
02E6 75F7                  440             JNZ BCD_CLEAR_LOOP
                           441             
02E8 833E610001            442             CMP DS:KEYPAD_INDEX, 1
02ED 7E2C                  443             JLE less_than_two
                           444             
02EF FF0E6100              445             DEC DS:KEYPAD_INDEX
02F3 FF0E6100              446             DEC DS:KEYPAD_INDEX
02F7 8B1E6100              447             MOV BX, DS:KEYPAD_INDEX
02FB 8A4751                448             MOV AL, DS:KEYPAD_INPUT[BX]
02FE A27900                449             MOV DS:REG_AL, AL
0301 C706A8000000          450             MOV DS:SCROLL_LEN, 0
0307 C706AA000100          451             MOV DS:DAC_DISABLE, 1
030D 9A6703----     R      452             CALL FAR PTR BCD_UPDATE
0312 C706AA000000          453             MOV DS:DAC_DISABLE, 0
0318 EB1990                454             JMP RETURN_BACK
                           455             
031B                       456     less_than_two:
031B FF0E6100              457             DEC DS:KEYPAD_INDEX
031F C60679002D            458             MOV DS:REG_AL, '-'
0324 C706A8000000          459             MOV DS:SCROLL_LEN, 0
032A 9A6703----     R      460             CALL FAR PTR BCD_UPDATE
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    13:38:09  11/18/;3  PAGE   10


LOC  OBJ                  LINE     SOURCE

032F FF0E6100              461             DEC DS:KEYPAD_INDEX
                           462             
0333                       463     RETURN_BACK:
0333 88167900              464             MOV DS:REG_AL, DL
0337 5A                    465     POP DX
0338 59                    466     POP CX
0339 5B                    467     POP BX
033A 58                    468     POP AX
                           469     
033B CB                    470     RET
                           471     BCD_BACKSPACE ENDP
                           472     
033C                       473     BCD_CLEAR PROC FAR
033C 50                    474     PUSH AX
033D 53                    475     PUSH BX
033E 51                    476     PUSH CX
033F 52                    477     PUSH DX
0340 BB0800                478             MOV BX, 8
0343                       479             CLEAR_LOOP:
0343 C6475100              480             MOV DS:KEYPAD_INPUT[BX], 0
0347 4B                    481             DEC BX
0348 75F9                  482             JNZ CLEAR_LOOP
                           483             
034A BB0600                484             MOV BX, 6
034D                       485             CLEAR_LOOP2:
034D 4B                    486                     DEC BX
034E C647592D              487                     MOV DS:BCD_MESSAGE[BX], '-'
0352 43                    488                     INC BX
0353 4B                    489                     DEC BX
0354 75F7                  490             JNZ CLEAR_LOOP2
                           491     
0356 C70661000000          492             MOV DS:KEYPAD_INDEX, 0
035C C706A8000000          493             MOV DS:SCROLL_LEN, 0
0362 5A                    494     POP DX
0363 59                    495     POP CX
0364 5B                    496     POP BX
0365 58                    497     POP AX
0366 CB                    498     RET
                           499     BCD_CLEAR ENDP
                           500     
0367                       501     BCD_UPDATE PROC FAR
0367 50                    502     PUSH AX
0368 53                    503     PUSH BX
0369 51                    504     PUSH CX
036A 52                    505     PUSH DX
036B A19C00                506                     MOV AX, DS:MAX_INPUT_SIZE
036E 39066100              507                     CMP DS:KEYPAD_INDEX, AX
0372 745A                  508                     JE BCD_RET
                           509                     
0374 8A0E7900              510                     MOV CL, DS:REG_AL
0378 80F909                511                     CMP CL, 9
037B 7F0C                  512                     JG SKIP_PAST
037D 833EAA0001            513                     CMP DS:DAC_DISABLE, 1
0382 7405                  514                     JE SKIP_PAST
0384 9AD303----     R      515                     CALL FAR PTR DAC_UPDATE
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    13:38:09  11/18/;3  PAGE   11


LOC  OBJ                  LINE     SOURCE

                           516     
0389                       517     SKIP_PAST:              
0389 8A0E7900              518                     MOV CL, DS:REG_AL
                           519     
038D 8B1E6100              520                     MOV BX, DS:KEYPAD_INDEX
                           521                             
0391 884F51                522                     MOV DS:KEYPAD_INPUT[BX], CL
                           523                             
0394 FF066100              524                     INC DS:KEYPAD_INDEX
                           525                             
0398 8B1E6100              526                     MOV BX, DS:KEYPAD_INDEX
                           527                     
039C A1A800                528                     MOV AX, DS:SCROLL_LEN
039F 2BD8                  529                     SUB BX, AX
                           530                     
03A1 8B166100              531                     MOV DX, DS:KEYPAD_INDEX
03A5 83FA06                532                     CMP DX, 6
03A8 7E03                  533                     JLE update_display
03AA BA0600                534                     MOV DX, 6
                           535                     
03AD                       536             update_display:
                           537             
03AD B90500                538                     MOV CX, 5
03B0 4B                    539                     DEC BX
03B1 8A4751                540                     MOV AL, DS:KEYPAD_INPUT[BX]
03B4 43                    541                     INC BX
                           542                             
03B5 52                    543                     PUSH DX
03B6 8B166100              544                     MOV DX, DS:KEYPAD_INDEX
03BA 2B16A800              545                     SUB DX, DS:SCROLL_LEN
                           546                     
03BE 2BD3                  547                     SUB DX, BX
                           548                             
03C0 53                    549                     PUSH BX
                           550                             
03C1 2BCA                  551                     SUB CX, DX
03C3 8BD9                  552                     MOV BX, CX
03C5 884759                553                     MOV DS:BCD_MESSAGE[BX], AL
                           554                             
03C8 5B                    555                     POP BX
03C9 5A                    556                     POP DX
                           557             
03CA 4B                    558                     DEC BX
03CB 4A                    559                     DEC DX
03CC 75DF                  560             JNZ update_display
                           561     
03CE                       562             BCD_RET:
03CE 5A                    563                     POP DX
03CF 59                    564                     POP CX
03D0 5B                    565                     POP BX
03D1 58                    566                     POP AX
03D2 CB                    567     RET
                           568     BCD_UPDATE ENDP
                           569     
03D3                       570     DAC_UPDATE PROC FAR
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    13:38:09  11/18/;3  PAGE   12


LOC  OBJ                  LINE     SOURCE

03D3 50                    571             PUSH AX
03D4 53                    572             PUSH BX
03D5 51                    573             PUSH CX
03D6 52                    574             PUSH DX
                           575             
03D7 BB0000                576             MOV BX, 0
03DA 8A1E7500              577             MOV BL, DS:DAC_LEN
03DE A07900                578             MOV AL, DS:REG_AL
                           579             
03E1 884766                580             MOV DS:DAC_ADDR[BX], AL
                           581             
03E4 FE067500              582             INC DS:DAC_LEN
                           583     
03E8 5A                    584             POP DX
03E9 59                    585             POP CX
03EA 5B                    586             POP BX
03EB 58                    587             POP AX
03EC CB                    588     RET
                           589     DAC_UPDATE ENDP
                           590               
03ED                       591     DEBOUNCE PROC FAR
03ED 51                    592                       PUSH CX
                           593                       
03EE B94C09                594                       MOV CX, 094CH
03F1 90                    595     BACK:     NOP
03F2 E2FD                  596                       LOOP BACK
03F4 59                    597                       POP CX
03F5 CB                    598                       RET
                           599     DEBOUNCE  ENDP
                           600     
03F6                       601     SEND_INPUT PROC FAR
03F6 50                    602     PUSH AX
03F7 53                    603     PUSH BX
03F8 51                    604     PUSH CX
03F9 52                    605     PUSH DX
03FA BB0000                606             MOV BX, 0
03FD 8B0E9A00              607             MOV CX, DS:SEND_BUFFER_LEN
                           608             
0401                       609             S_BUFF:
0401 8A878D00              610                     MOV AL, DS:SEND_BUFFER[BX]
0405 9A0000----     E      611                     CALL FAR PTR PRINT_CHAR
040A 43                    612                     INC BX
040B E2F4                  613             LOOP S_BUFF
                           614             
040D                       615     SEND_INPUT_END:
040D 5A                    616     POP DX
040E 59                    617     POP CX
040F 5B                    618     POP BX
0410 58                    619     POP AX
0411 CB                    620     RET
                           621     SEND_INPUT ENDP
                           622     ; ^^^^^^^^^^^^^^^ End of User main routine ^^^^^^^^^^^^^^^^^^^^^^^^^
0412                       623     SERIAL_REC_ACTION       PROC    FAR
0412 51                    624                     PUSH    CX
0413 53                    625                     PUSH    BX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    13:38:09  11/18/;3  PAGE   13


LOC  OBJ                  LINE     SOURCE

0414 1E                    626                     PUSH    DS
                           627                     
0415 BB----         R      628                     MOV     BX,DATA_SEG             ;initialize data segment register
0418 8EDB                  629                     MOV     DS,BX
                           630                     
041A 803E8B0001            631                     CMP DS:REPLY_FLAG, 1
041F 757C                  632                     JNE next_id1
                           633                     
0421 803E8C0001            634                     CMP DS:SEND_FLAG, 1
0426 7478                  635                     JE send_input_across1
                           636                     
0428 833EA00001            637                     CMP DS:RECEIVE_FLAG, 1
042D 7574                  638                     JNE terminate_session3
                           639                     
042F 3C2F                  640                     CMP AL, '/'
0431 750F                  641                     JNE CHECK_SEND
0433 C706A4000000          642                     MOV DS:PRICE_FLAG, 0
0439 C706A0000000          643                     MOV DS:RECEIVE_FLAG, 0
043F E99C00                644                     JMP terminate_session2
                           645             
0442                       646             CHECK_SEND:
0442 3C26                  647                     CMP AL, '&'
0444 7515                  648                     JNE receive_price
0446 C706A4000100          649                     MOV DS:PRICE_FLAG, 1
044C C70661000000          650                     MOV DS:KEYPAD_INDEX, 0
0452 C7069C000800          651                     MOV DS:MAX_INPUT_SIZE, 8
0458 E98600                652                     JMP id_skip2
                           653                     
045B                       654             receive_price:
045B 3C23                  655                     CMP AL, '#'
045D 750F                  656                     JNE check_price
045F C706A2000100          657                     MOV DS:DAC_FLAG, 1
0465 C706A4000000          658                     MOV DS:PRICE_FLAG, 0
046B EB7490                659                     JMP id_skip2
                           660             
046E                       661             check_price:    
                           662             
046E 833EA40001            663                     CMP DS:PRICE_FLAG, 1
0473 7431                  664                     JE update_keypad_input
                           665                     
0475 833EA20001            666                     CMP DS:DAC_FLAG, 1
047A 7403                  667                     JE dac_change
047C EB6390                668                     JMP id_skip2
                           669                     
047F                       670             dac_change:
047F 8A1E7900              671                     MOV BL, DS:REG_AL
0483 2C30                  672                     SUB AL, 30H
0485 A27900                673                     MOV DS:REG_AL, AL
0488 9AD303----     R      674                     CALL FAR PTR DAC_UPDATE
048D 881E7900              675                     MOV DS:REG_AL, BL
0491 C706A2000000          676                     MOV DS:DAC_FLAG, 0
0497 EB4890                677                     JMP id_skip2
                           678                     
049A EB4590                679             id_skip3: JMP id_skip2
                           680             
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    13:38:09  11/18/;3  PAGE   14


LOC  OBJ                  LINE     SOURCE

049D                       681             next_id1:
049D EB4590                682                     JMP next_id
04A0                       683             send_input_across1:
04A0 EB2390                684                     JMP send_input_across
04A3                       685             terminate_session3:
04A3 EB3990                686                     JMP terminate_session2
                           687                     
04A6                       688             update_keypad_input:
04A6 2C30                  689                     SUB AL, 30H
04A8 A27900                690                     MOV DS:REG_AL, AL
04AB C706AC000300          691                     MOV DS:DECIMAL_INDEX, 3
04B1 C706AA000100          692                     MOV DS:DAC_DISABLE, 1
04B7 9A6703----     R      693                     CALL FAR PTR BCD_UPDATE
04BC C706AA000000          694                     MOV DS:DAC_DISABLE, 0
04C2 EB1D90                695                     JMP id_skip2
                           696                     
04C5                       697             send_input_across:
04C5 9AF603----     R      698                     CALL FAR PTR SEND_INPUT
                           699                     
04CA C7069A000000          700                     MOV DS:SEND_BUFFER_LEN, 0
                           701                     
04D0 C6068C0000            702                     MOV DS:SEND_FLAG, 0
                           703                     
04D5 C706A0000100          704                     MOV DS:RECEIVE_FLAG, 1
                           705                     
04DB EB0490                706                     JMP id_skip2
                           707                     
04DE EB3E90                708                     terminate_session2: JMP terminate_session
04E1 EB6790                709                     id_skip2: JMP id_skip
                           710                     
04E4                       711             next_id:
                           712                     
04E4 803E810001            713                     CMP DS:ID_FLAG_r, 1
04E9 7513                  714                     JNE id_flag_label
04EB 38067F00              715                     CMP DS:MY_ID[1], AL
04EF 7559                  716                     JNE id_skip
                           717                     ;start writing to pc
04F1 C6068B0001            718                     MOV DS:REPLY_FLAG, 1
04F6 C606810000            719                     MOV DS:ID_FLAG_r, 0
04FB EB4D90                720                     JMP id_skip
                           721             
04FE                       722             id_flag_label:
                           723             
04FE 803E800001            724                     CMP DS:ID_FLAG_@, 1
0503 7539                  725                     JNE protocol_rec
0505 3C72                  726                     CMP AL,'r'
0507 750D                  727                     JNE id_not_r
0509 C606810001            728                     MOV DS:ID_FLAG_r,1
050E C606800000            729                     MOV DS:ID_FLAG_@, 0
0513 EB6C90                730                     JMP S_RET
0516                       731             id_not_r:
0516 C606800000            732                     MOV DS:ID_FLAG_@, 0
051B EB2D90                733                     JMP id_skip
                           734             
051E                       735             terminate_session:
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    13:38:09  11/18/;3  PAGE   15


LOC  OBJ                  LINE     SOURCE

051E C606810000            736                     MOV DS:ID_FLAG_r, 0
0523 33DB                  737                     XOR BX,BX
0525                       738             start_send1:
0525 50                    739                     PUSH AX
0526 33C0                  740                     XOR AX,AX
0528 8A878600              741                     MOV AL, DS:FAIL_MESSAGE[BX]
052C 9A0000----     E      742                     CALL FAR PTR PRINT_CHAR
0531 58                    743                     POP AX
0532 C6068B0000            744                     MOV DS:REPLY_FLAG, 0
0537 43                    745                     INC BX
0538 3A1E8A00              746                     CMP BL, DS:FAIL_COUNT
053C 75E7                  747                     JNE start_send1
                           748                     
053E                       749             protocol_rec:
053E 3C40                  750                     CMP AL,'@'
0540 7508                  751                     JNE id_skip
0542 C606800001            752                     MOV DS:ID_FLAG_@,1
0547 EB3890                753                     JMP S_RET
                           754                     
054A                       755             id_skip:
054A EB3590                756                     JMP S_RET
                           757             
054D 3C3C                  758                     CMP     AL,'<'
054F 750B                  759                     JNE     S_FAST
                           760     
0551 FE061700              761                     INC     DS:T_COUNT_SET
0555 FE061700              762                     INC     DS:T_COUNT_SET
                           763     
0559 EB0D90                764                     JMP     S_NEXT0
055C                       765     S_FAST:
055C 3C3E                  766                     CMP     AL,'>'
055E 7521                  767                     JNE     S_RET
                           768     
0560 FE0E1700              769                     DEC     DS:T_COUNT_SET
0564 FE0E1700              770                     DEC     DS:T_COUNT_SET
                           771     
0568                       772     S_NEXT0:
0568 B91600                773                     MOV     CX,22                   ;initialize counter for message
056B BB0000                774                     MOV     BX,0
                           775     
056E 8A4718                776     S_NEXT1:        MOV     AL,DS:REC_MESS[BX]      ;print message
0571 9A0000----     E      777                     call    FAR ptr print_char
0576 43                    778                     INC     BX
0577 E2F5                  779                     LOOP    S_NEXT1
                           780     
0579 A01700                781                     MOV     AL,DS:T_COUNT_SET       ;print current period of timer0
057C 9A0000----     E      782                     CALL    FAR PTR PRINT_2HEX
0581                       783     S_RET:
0581 1F                    784                     POP     DS
0582 5B                    785                     POP     BX
0583 59                    786                     POP     CX
0584 CB                    787                     RET
                           788     SERIAL_REC_ACTION       ENDP
                           789     
0585                       790     TIMER2_ACTION   PROC    FAR
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    13:38:09  11/18/;3  PAGE   16


LOC  OBJ                  LINE     SOURCE

0585 50                    791                     PUSH    AX
0586 1E                    792                     PUSH    DS
0587 53                    793                     PUSH    BX
0588 51                    794                     PUSH    CX
0589 52                    795                     PUSH    DX
                           796                     
                           797                     
058A B8----         R      798                     MOV     AX,DATA_SEG
058D 8ED8                  799                     MOV     DS,AX
                           800             
058F FE0E1600              801                     DEC     DS:T_COUNT
0593 754A                  802                     JNZ     T_NEXT1
0595 A01700                803                     MOV     AL,DS:T_COUNT_SET
0598 A21600                804                     MOV     DS:T_COUNT,AL
                           805     
059B                       806     T_NEXT0:
059B A05F00                807                     MOV AL, DS:ENABLE_BYTE
059E BA8001                808                     MOV DX, 180H
05A1 EE                    809                     OUT DX, AL
                           810                     
05A2 33DB                  811                     XOR BX, BX
05A4 8A1E6000              812                     MOV BL, DS:BCD_INDEX
05A8 8A4759                813                     MOV AL, DS:BCD_MESSAGE[BX]
                           814                     
05AB 3B1EAC00              815                     CMP BX, DS:DECIMAL_INDEX
05AF 7506                  816                     JNE CALL_FUNC
05B1 C706A6000100          817                     MOV DS:DECIMAL_FLAG, 1
05B7                       818     CALL_FUNC:
05B7 9A5006----     R      819                     CALL FAR PTR BCD_TO_7SEG
05BC C706A6000000          820                     MOV DS:DECIMAL_FLAG, 0
                           821     
05C2 BA0002                822                     MOV DX, 200H
05C5 EE                    823                     OUT DX, AL
                           824     
05C6 FE066000              825                     INC DS:BCD_INDEX
05CA D0065F00              826                     ROL DS:ENABLE_BYTE, 1
05CE 803E5F00BF            827                     CMP DS:ENABLE_BYTE, 10111111b
05D3 750A                  828                     JNE T_NEXT1
05D5 C6065F00FE            829                     MOV DS:ENABLE_BYTE, 11111110b 
05DA C606600000            830                     MOV DS:BCD_INDEX, 0
                           831     
                           832                     
05DF                       833     T_NEXT1:
05DF 803E750000            834                     CMP DS:DAC_LEN, 0
05E4 743C                  835                     JE ISR_END
                           836                     
                           837                     
05E6 8B367600              838                     MOV SI, DS:SI_PTR
                           839                             
05EA BB0000                840                     MOV BX, 0
05ED 33C0                  841                     XOR AX, AX
05EF 8A4766                842                     MOV AL, DS:DAC_ADDR[BX]
                           843                     
05F2 BB0001                844                     MOV BX, 100H
05F5 F7E3                  845                     MUL BX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    13:38:09  11/18/;3  PAGE   17


LOC  OBJ                  LINE     SOURCE

                           846                     
05F7 8B166400              847                     MOV DX, DS:DAC_BASE
05FB 03D0                  848                     ADD DX, AX
                           849                     
05FD 1E                    850                     PUSH DS
05FE 8EDA                  851                     MOV DS, DX
                           852                     
0600 8B04                  853                     MOV AX, [SI]
                           854                     
0602 BA1001                855                     MOV DX, 110H
0605 EE                    856                     OUT DX, AL
                           857                     
0606 1F                    858                     POP DS
                           859                     
0607 FF067600              860                     INC DS:SI_PTR
060B 813E76000010          861                     CMP DS:SI_PTR, 1000H
0611 750F                  862                     JNE ISR_END
                           863                     
0613 C70676000000          864                     MOV DS:SI_PTR, 0
0619 FE0E7500              865                     DEC DS:DAC_LEN
061D 9A2806----     R      866                     CALL FAR PTR DAC_SHIFT
                           867                     
0622                       868     ISR_END:
                           869                     
0622 5A                    870                     POP DX
0623 59                    871                     POP     CX
0624 5B                    872                     POP     BX
0625 1F                    873                     POP     DS
0626 58                    874                     POP AX
0627 CB                    875                     RET
                           876     TIMER2_ACTION   ENDP
                           877     
                           878     
0628                       879     DAC_SHIFT PROC FAR
0628 50                    880             PUSH AX
0629 53                    881             PUSH BX
062A 51                    882             PUSH CX
062B 52                    883             PUSH DX
                           884     
062C 33C9                  885             XOR CX, CX
062E 8A0E7500              886             MOV CL, DS:DAC_LEN
0632 80F900                887             CMP CL, 0
0635 7414                  888             JE END_SHIFT
                           889     
0637                       890             SHIFT_LOOP:
                           891     
0637 33DB                  892             XOR BX, BX
0639 8A1E7500              893             MOV BL, DS:DAC_LEN
063D 2BD9                  894             SUB BX, CX
063F 43                    895             INC BX
                           896             
0640 33D2                  897             XOR DX, DX
0642 8A5766                898             MOV DL, DS:DAC_ADDR[BX]
0645 4B                    899             DEC BX
0646 885766                900             MOV DS:DAC_ADDR[BX], DL
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    13:38:09  11/18/;3  PAGE   18


LOC  OBJ                  LINE     SOURCE

                           901     
0649 E2EC                  902             LOOP SHIFT_LOOP
                           903             
064B                       904             END_SHIFT:
064B 5A                    905             POP DX
064C 59                    906             POP CX
064D 5B                    907             POP BX
064E 58                    908             POP AX
064F CB                    909             RET
                           910     DAC_SHIFT ENDP
                           911     
0650                       912     BCD_TO_7SEG PROC FAR
                           913     
0650 53                    914             PUSH BX
0651 51                    915             PUSH CX
0652 52                    916             PUSH DX
                           917             
0653 3C00                  918             CMP AL, 0
0655 7511                  919             JNE one
0657 833EA60001            920             CMP DS:DECIMAL_FLAG, 1
065C 7405                  921             JE decimal0
065E B03F                  922             MOV AL, 00111111b
0660 E9D700                923             JMP endfunc
0663                       924     decimal0:
0663 B0BF                  925             MOV AL, 10111111b
0665 E9D200                926             JMP endfunc
                           927             
0668                       928             one:
0668 3C01                  929             CMP AL, 1
066A 7511                  930             JNE two
066C 833EA60001            931             CMP DS:DECIMAL_FLAG, 1
0671 7405                  932             JE decimal1
0673 B006                  933             MOV AL, 00000110b
0675 E9C200                934             JMP endfunc
0678                       935     decimal1:
0678 B086                  936             MOV AL, 10000110b
067A E9BD00                937             JMP endfunc
                           938             
067D                       939             two:
067D 3C02                  940             CMP AL,2
067F 7511                  941             JNE three
0681 833EA60001            942             CMP DS:DECIMAL_FLAG, 1
0686 7405                  943             JE decimal2
0688 B05B                  944             MOV AL, 01011011b
068A E9AD00                945             JMP endfunc
068D                       946     decimal2:
068D B0DB                  947             MOV AL, 11011011b
068F E9A800                948             JMP endfunc
                           949             
0692                       950             three:
0692 3C03                  951             CMP AL,3
0694 7511                  952             JNE four
0696 833EA60001            953             CMP DS:DECIMAL_FLAG, 1
069B 7405                  954             JE decimal3
069D B04F                  955             MOV AL, 01001111b
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    13:38:09  11/18/;3  PAGE   19


LOC  OBJ                  LINE     SOURCE

069F E99800                956             JMP endfunc
06A2                       957     decimal3:
06A2 B0CF                  958             MOV AL, 11001111b
06A4 E99300                959             JMP endfunc
                           960             
06A7                       961             four:
06A7 3C04                  962             CMP AL,4
06A9 7511                  963             JNE five
06AB 833EA60001            964             CMP DS:DECIMAL_FLAG, 1
06B0 7405                  965             JE decimal4
06B2 B066                  966             MOV AL, 01100110b
06B4 E98300                967             JMP endfunc
06B7                       968     decimal4:
06B7 B0E6                  969             MOV AL, 11100110b
06B9 EB7F90                970             JMP endfunc
                           971             
06BC                       972             five:
06BC 3C05                  973             CMP AL,5
06BE 7511                  974             JNE six
06C0 833EA60001            975             CMP DS:DECIMAL_FLAG, 1
06C5 7405                  976             JE decimal5
06C7 B06D                  977             MOV AL, 01101101b
06C9 EB6F90                978             JMP endfunc
06CC                       979     decimal5:
06CC B0ED                  980             MOV AL, 11101101b
06CE EB6A90                981             JMP endfunc
                           982             
06D1                       983             six:
06D1 3C06                  984             CMP AL,6
06D3 7511                  985             JNE seven
06D5 833EA60001            986             CMP DS:DECIMAL_FLAG, 1
06DA 7405                  987             JE decimal6
06DC B07D                  988             MOV AL, 01111101b
06DE EB5A90                989             JMP endfunc
06E1                       990     decimal6:
06E1 B0FD                  991             MOV AL, 11111101b
06E3 EB5590                992             JMP endfunc
                           993             
06E6                       994             seven:
06E6 3C07                  995             CMP AL,7
06E8 7511                  996             JNE eight
06EA 833EA60001            997             CMP DS:DECIMAL_FLAG, 1
06EF 7405                  998             JE decimal7
06F1 B007                  999             MOV AL, 00000111b
06F3 EB4590               1000             JMP endfunc
06F6                      1001     decimal7:
06F6 B087                 1002             MOV AL, 10000111b
06F8 EB4090               1003             JMP endfunc
                          1004             
06FB                      1005             eight:
06FB 3C08                 1006             CMP AL,8
06FD 7511                 1007             JNE nine
06FF 833EA60001           1008             CMP DS:DECIMAL_FLAG, 1
0704 7405                 1009             JE decimal8
0706 B07F                 1010             MOV AL, 01111111b
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    13:38:09  11/18/;3  PAGE   20


LOC  OBJ                  LINE     SOURCE

0708 EB3090               1011             JMP endfunc
070B                      1012     decimal8:
070B B0FF                 1013             MOV AL, 11111111b
070D EB2B90               1014             JMP endfunc
                          1015             
0710                      1016             nine:
0710 3C09                 1017             CMP AL,9
0712 7511                 1018             JNE hifn
0714 833EA60001           1019             CMP DS:DECIMAL_FLAG, 1
0719 7405                 1020             JE decimal9
071B B06F                 1021             MOV AL, 01101111b
071D EB1B90               1022             JMP endfunc
0720                      1023     decimal9:
0720 B0EF                 1024             MOV AL, 11101111b
0722 EB1690               1025             JMP endfunc
                          1026             
0725                      1027             hifn:
0725 3C2D                 1028             CMP AL,'-'
0727 7511                 1029             JNE endfunc
0729 833EA60001           1030             CMP DS:DECIMAL_FLAG, 1
072E 7405                 1031             JE decimal10
0730 B040                 1032             MOV AL, 01000000b
0732 EB0690               1033             JMP endfunc
0735                      1034     decimal10:
0735 B0C0                 1035             MOV AL, 11000000b
0737 EB0190               1036             JMP endfunc
                          1037             
073A                      1038             endfunc:
073A 5A                   1039             POP DX
073B 59                   1040             POP CX
073C 5B                   1041             POP BX
                          1042     
073D CB                   1043     RET
                          1044     BCD_TO_7SEG ENDP
                          1045     
----                      1046     CODE_SEG        ENDS
                          1047     END

ASSEMBLY COMPLETE, NO ERRORS FOUND
