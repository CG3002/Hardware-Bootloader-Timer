8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:10:15  12/07/;3  PAGE    1


DOS 5.0 (038-N) 8086/87/88/186 MACRO ASSEMBLER V3.1 ASSEMBLY OF MODULE TIMER
OBJECT MODULE PLACED IN TIMER.OBJ
ASSEMBLER INVOKED BY:  D:\ASM86.EXE TIMER.ASM


LOC  OBJ                  LINE     SOURCE

                             1 +1  $MOD186
                             2 +1  $EP
                             3     NAME TIMER
                             4     ; Main program for uPD70208 microcomputer system
                             5     ;
                             6     ; Author:       Dr Tay Teng Tiow
                             7     ; Address:      Department of Electrical Engineering 
                             8     ;               National University of Singapore
                             9     ;               10, Kent Ridge Crescent
                            10     ;               Singapore 0511. 
                            11     ; Date:         6th September 1991
                            12     ;
                            13     ; This file contains proprietory information and cannot be copied 
                            14     ; or distributed without prior permission from the author.
                            15     ; =========================================================================
                            16     
                            17     public  serial_rec_action, timer2_action
                            18     extrn   print_char:far, print_2hex:far, iodefine:far
                            19     extrn   set_timer2:far
                            20     
                            21     ;IO Setup for 80C188 
  FFA0                      22             UMCR    EQU    0FFA0H ; Upper Memory Control Register
  FFA2                      23             LMCR    EQU    0FFA2H ; Lower Memory control Register         
  FFA4                      24             PCSBA   EQU    0FFA4H ; Peripheral Chip Select Base Address
  FFA8                      25             MPCS    EQU    0FFA8H ; MMCS and PCS Alter Control Register
  0080                      26             A_8255  EQU    0080H
  0081                      27             B_8255  EQU    0081H
  0082                      28             C_8255  EQU    0082H
  0083                      29             CWR_8255  EQU    0083H
  FF38                      30             INT0CON  EQU   0FF38H
  FF22                      31             EOI EQU 0FF22H
  FF28                      32             IMASK EQU 0FF28H
  FFA6                      33             MMCS    EQU    0FFA6H 
  4000                      34             DAC EQU 4000H
                            35     
                            36     
----                        37     STACK_SEG       SEGMENT
0000 (512                   38                     DB      512 DUP(?)
     ??
     )
0200                        39             TOS     LABEL   WORD
----                        40     STACK_SEG       ENDS
                            41     
                            42     
----                        43     DATA_SEG        SEGMENT
0000 0A                     44             TIMER0_MESS             DB      10,13,'TIMER2 INTERRUPT    '
0001 0D
0002 54494D45523220
     494E5445525255
     505420202020
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:10:15  12/07/;3  PAGE    2


LOC  OBJ                  LINE     SOURCE

0016 18                     45             T_COUNT                 DB      24
0017 18                     46             T_COUNT_SET             DB      24
0018 0A                     47             REC_MESS                DB      10,13,'Period of timer0 =     '
0019 0D
001A 506572696F6420
     6F662074696D65
     7230203D202020
     2020
0031 (32                    48             MESSAGE         DB  32 dup('h')
     68
     )
0051 00                     49             KEYPAD_INPUT    DB  0,0,0,0,0,0,0,0
0052 00
0053 00
0054 00
0055 00
0056 00
0057 00
0058 00
0059 2D                     50             BCD_MESSAGE     DB  '-','-','-','-','-','-'
005A 2D
005B 2D
005C 2D
005D 2D
005E 2D
005F FE                     51             ENABLE_BYTE     DB  11111110b
0060 00                     52             BCD_INDEX       DB  0
0061 0000                   53             KEYPAD_INDEX    DW      0
0063 20                     54             M_SIZE                  DB  32
0064 0040                   55             DAC_BASE        DW  4000H
0066 (15                    56             DAC_ADDR        DB  15 dup(0) 
     00
     )
0075 00                     57             DAC_LEN         DB  0
0076 0000                   58             SI_PTR          DW  0
0078 ??                     59             CHAR                    DB  ?
0079 ??                     60             REG_AL                  DB  ?
007A ??                     61             REG_BH                  DB  ?
007B ??                     62             REG_CL                  DB  ?
007C 00                     63             FLAG            DB  0
007D 00                     64             LONG_PRESS_FLAG DB      0
007E 7231                   65             MY_ID                   DB      'r1'
0080 00                     66             ID_FLAG_@               DB      0
0081 00                     67             ID_FLAG_r               DB      0
0082 4072312F               68             REPLY_MESSAGE   DB      '@r1/'
0086 40302F                 69             FAIL_MESSAGE    DB '@0/'
0089 04                     70             REPLY_COUNT             DB      4
008A 03                     71             FAIL_COUNT              DB      3
008B 00                     72             REPLY_FLAG              DB      0
008C 00                     73             SEND_FLAG       DB  0
008D (13                    74             SEND_BUFFER     DB  13 dup(0)
     00
     )
009A 0000                   75             SEND_BUFFER_LEN DW      0
009C 0000                   76             MAX_INPUT_SIZE  DW      0
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:10:15  12/07/;3  PAGE    3


LOC  OBJ                  LINE     SOURCE

009E 0000                   77             QTY_FLAG                DW      0
00A0 0000                   78             RECEIVE_FLAG    DW      0
00A2 0000                   79             DAC_FLAG                DW      0
00A4 0000                   80             PRICE_FLAG      DW      0
00A6 0100                   81             DECIMAL_FLAG    DW      1
00A8 0000                   82             SCROLL_LEN      DW      0
00AA 0000                   83             DAC_DISABLE     DW  0
00AC 0300                   84             DECIMAL_INDEX   DW  3
00AE 0100                   85             LANG_FLAG       DW  1
00B0 0000                   86             PRICE                   DW      0
00B2 0000                   87             QTY                             DW      0
00B4 0000                   88             TOTAL_PRICE_U   DW      0
00B6 0000                   89             TOTAL_PRICE_L   DW      0
00B8 0000                   90             TOTAL_PRICE_DEC DW      0
00BA (8                     91             TEMP_BCD_ARR    DB  8 dup(0)
     00
     )
00C2 0000                   92             THOUSAND_FLAG   DW  0
00C4 0000                   93             CENT_FLAG               DW      0
00C6 0000                   94             DOLLAR_FLAG             DW      0
00C8 0000                   95             CASH_FLAG               DW      0
00CA (8                     96             CASH_AMT        DB  8 dup(0)
     00
     )
00D2 (8                     97             TEMP_CASH_ARR   DW  8 dup(0)
     0000
     )
00E2 0000                   98             CASH_OK_FLAG    DW  0
00E4 0000                   99             BORROW_POSITION DW  0
00E6 0100                  100             CANCEL_FLAG             DW  1
00E8 0000                  101             TRANSACTION_OVER DW 0
00EA 0100                  102             DATA_ENTER              DW  1
00EC (8                    103             TROLLEY_ARRAY   DB  8 dup(0)
     00
     )
00F4 0000                  104             TROLLEY_INDEX   DW  0
00F6 0000                  105             TROLLEY_FLAG    DW  0
00F8 0000                  106             TROLLEY_ID              DW  0
00FA 0000                  107             TROLLEY_DISABLED DW 0
----                       108     DATA_SEG        ENDS
                           109     
                           110     
----                       111     CODE_SEG        SEGMENT
                           112     
                           113             PUBLIC          START
                           114     
                           115     ASSUME  CS:CODE_SEG, SS:STACK_SEG
                           116     
0000                       117     START:
                           118     ;initialize stack area
0000 B8----         R      119                     MOV     AX,STACK_SEG            
0003 8ED0                  120                     MOV     SS,AX
0005 368B260002            121                     MOV     SP,TOS
                           122                     
                           123     ; Initialize the on-chip pheripherals
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:10:15  12/07/;3  PAGE    4


LOC  OBJ                  LINE     SOURCE

000A 9A0000----     E      124                     CALL    FAR PTR IODEFINE
                           125                     
000F 9A0000----     E      126     call set_timer2
0014 FB                    127                    STI
                           128     
                           129     ; ^^^^^^^^^^^^^^^^^  Start of User Main Routine  ^^^^^^^^^^^^^^^^^^
                           130     
                           131     ;Initialize MMCS
                           132             
0015 BAA6FF                133             MOV DX, MMCS
0018 B80340                134             MOV AX, 4003H
001B EF                    135             OUT DX, AX
                           136     
                           137     ; Initialize MPCS to MAP peripheral to IO address
                           138             
001C BAA8FF                139             MOV DX, MPCS
001F B88320                140             MOV AX, 2083H
0022 EF                    141             OUT DX, AX
                           142        
                           143     ; PCSBA initial, set the parallel port start from 00H
0023 BAA4FF                144             MOV DX, PCSBA
0026 B80300                145             MOV AX, 0003H ; Peripheral starting address 00H no READY, No Waits
0029 EF                    146             OUT DX, AX
                           147     
                           148     ; Initialize LMCS 
002A BAA2FF                149         MOV DX, LMCR
002D B8C401                150         MOV AX, 01C4H  ; Starting address 1FFFH, 8K, No waits, last shoud be 5H for 1 wai
                                   ts      
0030 EF                    151         OUT DX, AX
                           152             
0031 B8----         R      153             MOV AX, DATA_SEG
0034 8ED8                  154             MOV DS, AX
                           155                              
0036 BA8300                156             MOV DX, CWR_8255
0039 B88200                157             MOV AX, 0082h
003C EF                    158             OUT DX, AX
                           159             
003D                       160     NEXT:
003D 9A4400----     R      161             CALL FAR PTR KEYPAD_LOOP
                           162             
0042 EBF9                  163     JMP NEXT
                           164     
0044                       165     KEYPAD_LOOP PROC FAR
0044 50                    166     PUSH AX
0045 53                    167     PUSH BX
0046 51                    168     PUSH CX
0047 52                    169     PUSH DX
                           170             
0048 9A6506----     R      171                             CALL FAR PTR DEBOUNCE           
                           172                             
004D C606790003            173     WAIT_1:         MOV DS:REG_AL, 03H
0052 BB0000                174                         MOV BX, 0000H
0055 BA8200                175                         MOV DX,C_8255
0058 8AC3                  176                         MOV AL,BL
005A EE                    177                         OUT DX,AL
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:10:15  12/07/;3  PAGE    5


LOC  OBJ                  LINE     SOURCE

                           178                        
005B BA8100                179                         MOV DX,B_8255
005E EC                    180                         IN AL,DX
005F 8AD8                  181                         MOV BL,AL  
0061 80E3FC                182                         AND BL,0FCH
0064 80FBFC                183                         CMP BL,0FCH
                           184                      
0067 744F                  185                     JE LONG_PRESS
                           186                             
0069 B3FE                  187                         MOV BL, 0FEH
006B C6067A0004            188                         MOV DS:REG_BH, 04H
                           189                        
0070                       190     NXTROW: 
0070 C0C307                191                     ROL BL,07H
0073 8AEB                  192                             MOV CH,BL
0075 BA8200                193                             MOV DX,C_8255
0078 8AC3                  194                             MOV AL,BL
007A EE                    195                             OUT DX,AL
                           196                             
007B BA8100                197                             MOV DX,B_8255
007E EC                    198                             IN AL,DX
007F 8AD8                  199                             MOV BL,AL
0081 80E3FC                200                             AND BL,0FCH
0084 C6067B0006            201                             MOV DS:REG_CL,06H
0089 C0DB02                202                             RCR BL,02H
008C D0DB                  203     NXTCOL:         RCR BL,01H
008E 7330                  204                             JNC CODEKY
0090 FE0E7900              205                             DEC DS:REG_AL
0094 FE0E7B00              206                             DEC DS:REG_CL
0098 803E7B0003            207                             CMP DS:REG_CL,03H
009D 7413                  208                             JE KEYPAD4
                           209                             
009F 803E7B0000            210                             CMP DS:REG_CL, 0H
00A4 740F                  211                             JE SUBTRACT3
00A6 EBE4                  212                             JMP NXTCOL
                           213                             
00A8 8ADD                  214                             MOV BL,CH
00AA FE0E7A00              215                             DEC DS:REG_BH
00AE 75C0                  216                             JNZ NXTROW
00B0 EB9B                  217                             JMP WAIT_1
                           218                             
00B2 EB7290                219     KEYPAD4:    JMP KEYPAD3
00B5 EB7290                220     SUBTRACT3:  JMP SUBTRACT2
                           221                             
00B8                       222     LONG_PRESS:
00B8 C6067D0000            223                             MOV DS:LONG_PRESS_FLAG, 0
00BD EB6D90                224                             JMP RETURN2
00C0                       225     CODEKY:
00C0 803E79000B            226                         CMP DS:REG_AL, 11
00C5 7505                  227                             JNE bcd_upd
00C7 C606790000            228                             MOV DS:REG_AL, 0
                           229                             
00CC                       230     bcd_upd:
00CC 803E7D0000            231                             CMP DS:LONG_PRESS_FLAG, 0
00D1 7559                  232                             JNE RETURN2
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:10:15  12/07/;3  PAGE    6


LOC  OBJ                  LINE     SOURCE

                           233                             
00D3 803E790011            234                             CMP DS:REG_AL, 17
00D8 7555                  235                             JNE ENTER_CASH
                           236                             
00DA 833EFA0001            237                             CMP DS:TROLLEY_DISABLED, 1
00DF 7442                  238                             JE SKIP_ENTER_DATA1
                           239                             
00E1 833EC80001            240                             CMP DS:CASH_FLAG, 1
00E6 743B                  241                             JE SKIP_ENTER_DATA1
00E8 9AB405----     R      242                             CALL FAR PTR BCD_CLEAR
                           243                             
00ED 833EE80000            244                             CMP DS:TRANSACTION_OVER, 0
00F2 7405                  245                             JE NO_RESET_NEEDED1
                           246                             
00F4 9A7204----     R      247                             CALL FAR PTR CLEAR_TEMP_BCD
                           248                             
00F9                       249             NO_RESET_NEEDED1:
00F9 C706EA000100          250                             MOV DS:DATA_ENTER, 1
00FF C706AC000600          251                             MOV DS:DECIMAL_INDEX, 6
0105 C7069C000600          252                             MOV DS:MAX_INPUT_SIZE, 6
010B C706F8000100          253                             MOV DS:TROLLEY_ID, 1
0111 C706AE000000          254                             MOV DS:LANG_FLAG, 0
0117 C706C8000000          255                             MOV DS:CASH_FLAG, 0
011D C706E8000000          256                             MOV DS:TRANSACTION_OVER, 0
0123                       257             SKIP_ENTER_DATA1:
0123 E9FA01                258                             JMP UPDATE_7SEG2
                           259                             
0126 E9F302                260     KEYPAD3:        JMP KEYPAD_2
                           261                             
0129 E90003                262     SUBTRACT2:   JMP SUBTRACT
                           263     
012C E90B03                264     RETURN2:    JMP RETURN
                           265                             
                           266                             
012F                       267     ENTER_CASH:     
012F 803E790014            268                             CMP DS:REG_AL, 20
0134 7521                  269                             JNE SEND_CASH
0136 833EC80000            270                             CMP DS:CASH_FLAG, 0
013B 7417                  271                             JE SKIP_CASH
013D C706EA000100          272                             MOV DS:DATA_ENTER, 1
0143 9AB405----     R      273                             CALL FAR PTR BCD_CLEAR
0148 C7069C000800          274                             MOV DS:MAX_INPUT_SIZE, 8
014E C706AC000600          275                             MOV DS:DECIMAL_INDEX, 6
0154                       276                     SKIP_CASH:
0154 E9C901                277                             JMP UPDATE_7SEG2
                           278                             
0157                       279     SEND_CASH:
0157 803E790017            280                             CMP DS:REG_AL, 23
015C 751C                  281                             JNE CLEAR_BUTTON
015E 833EC80000            282                             CMP DS:CASH_FLAG, 0
0163 7412                  283                             JE SKIP_SEND_CASH
0165 833E610000            284                             CMP DS:KEYPAD_INDEX, 0
016A 740B                  285                             JE SKIP_SEND_CASH
016C C706EA000000          286                             MOV DS:DATA_ENTER, 0
0172 9A8A06----     R      287                             CALL FAR PTR TAKE_CASH
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:10:15  12/07/;3  PAGE    7


LOC  OBJ                  LINE     SOURCE

0177                       288                     SKIP_SEND_CASH:
0177 E9A601                289                             JMP UPDATE_7SEG2
                           290                             
017A                       291     CLEAR_BUTTON:
017A 803E79000A            292                             CMP DS:REG_AL, 10
017F 7508                  293                             JNE BACKSPACE
0181 9AB405----     R      294                             CALL FAR PTR BCD_CLEAR
0186 E99701                295                             JMP UPDATE_7SEG2
                           296                             
0189 803E79000C            297     BACKSPACE:      CMP DS:REG_AL, 12
018E 7508                  298                             JNE ENTER_DATA
0190 9A4505----     R      299                             CALL FAR PTR BCD_BACKSPACE
0195 E98801                300                             JMP UPDATE_7SEG2
                           301     
0198 803E79000D            302     ENTER_DATA:     CMP DS:REG_AL, 13
019D 753F                  303                             JNE END_TRANS
019F 833EC80001            304                             CMP DS:CASH_FLAG, 1
01A4 7435                  305                             JE SKIP_ENTER_DATA
01A6 9AB405----     R      306                             CALL FAR PTR BCD_CLEAR
                           307                             
01AB 833EE80000            308                             CMP DS:TRANSACTION_OVER, 0
01B0 7405                  309                             JE NO_RESET_NEEDED
                           310                             
01B2 9A7204----     R      311                             CALL FAR PTR CLEAR_TEMP_BCD
                           312                             
01B7                       313             NO_RESET_NEEDED:
01B7 C706EA000100          314                             MOV DS:DATA_ENTER, 1
01BD C706AC000600          315                             MOV DS:DECIMAL_INDEX, 6
01C3 C7069C000800          316                             MOV DS:MAX_INPUT_SIZE, 8
01C9 C706AE000000          317                             MOV DS:LANG_FLAG, 0
01CF C706C8000000          318                             MOV DS:CASH_FLAG, 0
01D5 C706E8000000          319                             MOV DS:TRANSACTION_OVER, 0
01DB                       320             SKIP_ENTER_DATA:
01DB E94201                321                             JMP UPDATE_7SEG2
                           322                             
01DE 803E790010            323     END_TRANS:      CMP DS:REG_AL, 16
01E3 7553                  324                             JNE CANCEL_TRANS
01E5 833EF80001            325                             CMP DS:TROLLEY_ID, 1
01EA 7449                  326                             JE END_TRANS_CONT
01EC 833EC80001            327                             CMP DS:CASH_FLAG, 1
01F1 7442                  328                             JE END_TRANS_CONT
01F3 833EE80000            329                             CMP DS:TRANSACTION_OVER, 0
01F8 7403                  330                             JE TRANSACTION_NOT_OVER
01FA E92301                331                             JMP UPDATE_7SEG2
01FD                       332     TRANSACTION_NOT_OVER:
01FD BB0000                333                             MOV BX, 0
0200 C6878D0024            334                             MOV DS:SEND_BUFFER[BX], '$'
0205 43                    335                             INC BX
0206 C6878D002F            336                             MOV DS:SEND_BUFFER[BX], '/'
020B C7069A000200          337                             MOV DS:SEND_BUFFER_LEN, 2
0211 C6068C0001            338                             MOV DS:SEND_FLAG, 1
0216 C706B8000000          339                             MOV DS:TOTAL_PRICE_DEC, 0
021C C706B6000000          340                             MOV DS:TOTAL_PRICE_L, 0
0222 C706B4000000          341                             MOV DS:TOTAL_PRICE_U, 0
0228 833EE60001            342                             CMP DS:CANCEL_FLAG, 1
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:10:15  12/07/;3  PAGE    8


LOC  OBJ                  LINE     SOURCE

022D 7406                  343                             JE END_TRANS_CONT
022F C706C8000100          344                             MOV DS:CASH_FLAG, 1
0235                       345                     END_TRANS_CONT:
0235 E9E800                346                             JMP UPDATE_7SEG2
                           347                             
0238                       348     CANCEL_TRANS:   
0238 803E79000F            349                             CMP DS:REG_AL, 15
023D 7554                  350                             JNE SCROLL_LEFT
023F 833EC80001            351                             CMP DS:CASH_FLAG, 1
0244 7503                  352                             JNE CONT_CANCEL
0246 E9D700                353                             JMP UPDATE_7SEG2
0249                       354                     CONT_CANCEL:
0249 BB0000                355                             MOV BX, 0
024C C6878D003F            356                             MOV DS:SEND_BUFFER[BX], '?'
0251 43                    357                             INC BX
0252 C6878D002F            358                             MOV DS:SEND_BUFFER[BX], '/'
0257 C7069A000200          359                             MOV DS:SEND_BUFFER_LEN, 2
025D C6068C0001            360                             MOV DS:SEND_FLAG, 1
0262 C706B8000000          361                             MOV DS:TOTAL_PRICE_DEC, 0
0268 C706B6000000          362                             MOV DS:TOTAL_PRICE_L, 0
026E C706B4000000          363                             MOV DS:TOTAL_PRICE_U, 0
0274 C706AC000300          364                             MOV DS:DECIMAL_INDEX, 3
027A 9AB405----     R      365                             CALL FAR PTR BCD_CLEAR
027F C7069C000000          366                             MOV DS:MAX_INPUT_SIZE, 0
                           367                             
0285 9A7204----     R      368                             CALL FAR PTR CLEAR_TEMP_BCD
                           369                             
028A C706E6000100          370                             MOV DS:CANCEL_FLAG, 1
0290 E98D00                371                             JMP UPDATE_7SEG2
                           372                             
0293                       373     SCROLL_LEFT:
0293 803E790015            374                             CMP DS:REG_AL, 21
0298 753D                  375                             JNE SCROLL_RIGHT
029A 833E610006            376                             CMP DS:KEYPAD_INDEX, 6
029F 7E7F                  377                             JLE UPDATE_7SEG2
02A1 833EA80000            378                             CMP DS:SCROLL_LEN, 0
02A6 7478                  379                             JE UPDATE_7SEG2
02A8 FF0EA800              380                             DEC DS:SCROLL_LEN
02AC FF0EAC00              381                             DEC DS:DECIMAL_INDEX
02B0 FF0E6100              382                             DEC DS:KEYPAD_INDEX
02B4 8B1E6100              383                             MOV BX, DS:KEYPAD_INDEX
02B8 8A4751                384                             MOV AL, DS:KEYPAD_INPUT[BX]
02BB A27900                385                             MOV DS:REG_AL, AL
02BE C706AA000100          386                             MOV DS:DAC_DISABLE, 1
02C4 9ADF05----     R      387                             CALL FAR PTR BCD_UPDATE
02C9 C706AA000000          388                             MOV DS:DAC_DISABLE, 0
02CF C606790015            389                             MOV DS:REG_AL, 21
02D4 EB4A90                390                             JMP UPDATE_7SEG2
                           391     
02D7                       392     SCROLL_RIGHT:
02D7 803E790013            393                             CMP DS:REG_AL, 19
02DC 7545                  394                             JNE LANG_TOGGLE
02DE 833E610006            395                             CMP DS:KEYPAD_INDEX, 6
02E3 7E3B                  396                             JLE UPDATE_7SEG2
02E5 A16100                397                             MOV AX, DS:KEYPAD_INDEX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:10:15  12/07/;3  PAGE    9


LOC  OBJ                  LINE     SOURCE

02E8 2D0600                398                             SUB AX, 6
02EB 3906A800              399                             CMP DS:SCROLL_LEN, AX
02EF 742F                  400                             JE UPDATE_7SEG2
02F1 FF06A800              401                             INC DS:SCROLL_LEN
02F5 FF06AC00              402                             INC DS:DECIMAL_INDEX
02F9 FF0E6100              403                             DEC DS:KEYPAD_INDEX
02FD 8B1E6100              404                             MOV BX, DS:KEYPAD_INDEX
0301 8A4751                405                             MOV AL, DS:KEYPAD_INPUT[BX]
0304 A27900                406                             MOV DS:REG_AL, AL
0307 C706AA000100          407                             MOV DS:DAC_DISABLE, 1
030D 9ADF05----     R      408                             CALL FAR PTR BCD_UPDATE
0312 C706AA000000          409                             MOV DS:DAC_DISABLE, 0
0318 C606790013            410                             MOV DS:REG_AL, 19
031D EB0190                411                             JMP UPDATE_7SEG2
                           412                             
0320 E9DE00                413     UPDATE_7SEG2: JMP UPDATE_7SEG
                           414     
0323                       415     LANG_TOGGLE:
0323 803E790012            416                             CMP DS:REG_AL, 18
0328 7537                  417                             JNE QTY_PROMPT
032A 833EAE0001            418                             CMP DS:LANG_FLAG, 1
032F 75EF                  419                             JNE UPDATE_7SEG2
0331 A16400                420                             MOV AX, DS:DAC_BASE
0334 3D0040                421                             CMP AX, 4000H
0337 7406                  422                             JE MANDRIN
0339 B80040                423                             MOV AX, 4000H
033C EB0490                424                             JMP SEND_TOGGLE
033F                       425             MANDRIN:
033F B80065                426                             MOV AX, 6500H
0342                       427             SEND_TOGGLE:
0342 A36400                428                             MOV DS:DAC_BASE, AX
0345 BB0000                429                             MOV BX, 0
0348 C6878D0021            430                             MOV DS:SEND_BUFFER[BX], '!'
034D 43                    431                             INC BX
034E C6878D002F            432                             MOV DS:SEND_BUFFER[BX], '/'
0353 C7069A000200          433                             MOV DS:SEND_BUFFER_LEN, 2
0359 C6068C0001            434                             MOV DS:SEND_FLAG, 1
035E E9A000                435                             JMP UPDATE_7SEG
0361                       436     QTY_PROMPT:
0361 803E790016            437                             CMP DS:REG_AL, 22
0366 7527                  438                             JNE QUANTITY
0368 833EC80001            439                             CMP DS:CASH_FLAG, 1
036D 7420                  440                             JE QUANTITY
036F 833E610008            441                             CMP DS:KEYPAD_INDEX, 8
0374 7519                  442                             JNE  QUANTITY
                           443                             ; CMP DS:MAX_INPUT_SIZE, 8
                           444                             ; JNE QUANTITY
0376 9AFE04----     R      445                             CALL FAR PTR UPDATE_SEND_BUFFER
037B 9AB405----     R      446                             CALL FAR PTR BCD_CLEAR
0380 C7069C000200          447                             MOV DS:MAX_INPUT_SIZE, 2
0386 C7069E000100          448                             MOV DS:QTY_FLAG, 1
038C EB7390                449                             JMP UPDATE_7SEG
                           450                     
038F                       451     QUANTITY:
038F 833E610000            452                             CMP DS:KEYPAD_INDEX, 0
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:10:15  12/07/;3  PAGE   10


LOC  OBJ                  LINE     SOURCE

0394 746B                  453                             JE  UPDATE_7SEG
                           454                             
0396 803E79000E            455                             CMP DS:REG_AL, 14
039B 7564                  456                             JNE UPDATE_7SEG
                           457                             
039D 833EF80001            458                             CMP DS:TROLLEY_ID, 1
03A2 752C                  459                             JNE NORMAL_UPDATE
                           460                             
03A4 833E610006            461                             CMP DS:KEYPAD_INDEX, 6
03A9 7525                  462                             JNE NORMAL_UPDATE
                           463                             
03AB 9A3F04----     R      464                             CALL FAR PTR UPDATE_TROLLEY_ID
                           465                             
03B0 C706F8000000          466                             MOV DS:TROLLEY_ID, 0
03B6 C6068C0001            467                             MOV DS:SEND_FLAG, 1
03BB C706EA000000          468                             MOV DS:DATA_ENTER, 0
03C1 C706E6000000          469                             MOV DS:CANCEL_FLAG, 0
03C7 C706C8000100          470                             MOV DS:CASH_FLAG, 1
                           471                             
03CD EB3290                472                             JMP UPDATE_7SEG
                           473                             
03D0                       474                     NORMAL_UPDATE:  
03D0 833E9E0001            475                             CMP DS:QTY_FLAG, 1
03D5 752A                  476                             JNE UPDATE_7SEG
                           477                             
03D7 C706EA000000          478                             MOV DS:DATA_ENTER, 0
                           479                             
03DD C706E6000000          480                             MOV DS:CANCEL_FLAG, 0
                           481                     
03E3 9AAD04----     R      482                             CALL FAR PTR UPDATE_THE_QUANTITY
                           483                             
03E8 C706FA000100          484                             MOV DS:TROLLEY_DISABLED, 1
03EE C6068C0001            485                             MOV DS:SEND_FLAG, 1
                           486                             
03F3 C7069E000000          487                             MOV DS:QTY_FLAG, 0
03F9 9AB405----     R      488                             CALL FAR PTR BCD_CLEAR
03FE EB0190                489                             JMP UPDATE_7SEG
                           490                             
                           491     
0401                       492     UPDATE_7SEG:
0401 803E790009            493                             CMP DS:REG_AL, 9
0406 7F0C                  494                             JG SET_PRESS_FLAG
                           495                             
0408 833EEA0001            496                             CMP DS:DATA_ENTER, 1
040D 7505                  497                             JNE SET_PRESS_FLAG
                           498                             
040F 9ADF05----     R      499                             CALL FAR PTR BCD_UPDATE
                           500                             
0414                       501     SET_PRESS_FLAG:
0414 C6067D0001            502                             MOV DS:LONG_PRESS_FLAG, 1
0419 EB1F90                503                             JMP RETURN
                           504             
041C                       505     KEYPAD_2: 
041C 800679000F            506                 ADD DS:REG_AL,0FH
0421 E968FC                507                             JMP NXTCOL
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:10:15  12/07/;3  PAGE   11


LOC  OBJ                  LINE     SOURCE

0424 C606790000            508     ZERO_PRINT: MOV DS:REG_AL,00H
0429 E960FC                509                             JMP NXTCOL
042C 802E790006            510     SUBTRACT:   SUB DS:REG_AL,06H
0431 8ADD                  511                             MOV BL,CH
0433 FE0E7A00              512                             DEC DS:REG_BH
0437 E936FC                513                             JMP NXTROW
                           514             
                           515             
043A                       516     RETURN:
043A 5A                    517                             POP DX
043B 59                    518                             POP CX
043C 5B                    519                             POP BX
043D 58                    520                             POP AX
043E CB                    521                             RET
                           522     
                           523     KEYPAD_LOOP ENDP
                           524     
043F                       525     UPDATE_TROLLEY_ID PROC FAR
043F 50                    526     PUSH AX
0440 53                    527     PUSH BX
0441 51                    528     PUSH CX
0442 52                    529     PUSH DX
0443 BB0000                530             MOV BX, 0
0446 C6878D005E            531             MOV DS:SEND_BUFFER[BX], '^'
044B B90600                532             MOV CX, 6
044E                       533             UPDATE_TROLLEY_BUFFER:
044E BB0600                534                     MOV BX, 6
0451 2BD9                  535                     SUB BX, CX
                           536                     
0453 8A4751                537                     MOV AL, DS:KEYPAD_INPUT[BX]
                           538                     
0456 43                    539                     INC BX
0457 0430                  540                     ADD AL, 30H
0459 88878D00              541                     MOV DS:SEND_BUFFER[BX], AL
045D E2EF                  542             LOOP UPDATE_TROLLEY_BUFFER
                           543             
045F BB0700                544             MOV BX, 7
0462 C6878D002F            545             MOV DS:SEND_BUFFER[BX], '/'
                           546             
0467 C7069A000800          547             MOV DS:SEND_BUFFER_LEN, 8
                           548     
046D 5A                    549     POP DX
046E 59                    550     POP CX
046F 5B                    551     POP BX
0470 58                    552     POP AX
0471 CB                    553     RET
                           554     UPDATE_TROLLEY_ID ENDP
                           555     
0472                       556     CLEAR_TEMP_BCD PROC FAR
0472 50                    557     PUSH AX
0473 53                    558     PUSH BX
0474 51                    559     PUSH CX
0475 52                    560     PUSH DX
                           561     
0476 BB0000                562             MOV BX, 0
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:10:15  12/07/;3  PAGE   12


LOC  OBJ                  LINE     SOURCE

0479 C687BA002D            563             MOV DS:TEMP_BCD_ARR[BX], '-'
047E 43                    564             INC BX
047F C687BA002D            565             MOV DS:TEMP_BCD_ARR[BX], '-'
0484 43                    566             INC BX
0485 C687BA002D            567             MOV DS:TEMP_BCD_ARR[BX], '-'
048A 43                    568             INC BX
048B C687BA002D            569             MOV DS:TEMP_BCD_ARR[BX], '-'
0490 43                    570             INC BX
0491 C687BA002D            571             MOV DS:TEMP_BCD_ARR[BX], '-'
0496 43                    572             INC BX
0497 C687BA002D            573             MOV DS:TEMP_BCD_ARR[BX], '-'
049C 43                    574             INC BX
049D C687BA002D            575             MOV DS:TEMP_BCD_ARR[BX], '-'
04A2 43                    576             INC BX
04A3 C687BA002D            577             MOV DS:TEMP_BCD_ARR[BX], '-'
                           578             
04A8 5A                    579     POP DX
04A9 59                    580     POP CX
04AA 5B                    581     POP BX
04AB 58                    582     POP AX
04AC CB                    583     RET
                           584     CLEAR_TEMP_BCD ENDP
                           585     
                           586     
04AD                       587     UPDATE_THE_QUANTITY PROC FAR
04AD 50                    588     PUSH AX
04AE 53                    589     PUSH BX
04AF 51                    590     PUSH CX
04B0 52                    591     PUSH DX
04B1 8B0E6100              592             MOV CX, DS:KEYPAD_INDEX
04B5 BB0000                593             MOV BX, 0
04B8 BA0000                594             MOV DX, 0
04BB                       595             UPD_QTY:
04BB A1B200                596                     MOV AX, DS:QTY
04BE 53                    597                     PUSH BX
04BF BB0A00                598                     MOV BX, 10
04C2 F7E3                  599                     MUL BX
04C4 5B                    600                     POP BX
04C5 8A5751                601                     MOV DL, DS:KEYPAD_INPUT[BX]
04C8 03C2                  602                     ADD AX, DX
04CA A3B200                603                     MOV DS:QTY, AX
04CD 43                    604                     INC BX
04CE E2EB                  605             LOOP UPD_QTY
                           606             
04D0 8B0E6100              607             MOV CX, DS:KEYPAD_INDEX
04D4 8B1E9A00              608             MOV BX, DS:SEND_BUFFER_LEN
                           609             
04D8                       610             UPD_BUFFER:
04D8 53                    611                     PUSH BX
04D9 8B1E6100              612                     MOV BX, DS:KEYPAD_INDEX
04DD 2BD9                  613                     SUB BX, CX
04DF 8A4751                614                     MOV AL, DS:KEYPAD_INPUT[BX]
04E2 5B                    615                     POP BX
04E3 0430                  616                     ADD AL, 30H
04E5 88878D00              617                     MOV DS:SEND_BUFFER[BX], AL
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:10:15  12/07/;3  PAGE   13


LOC  OBJ                  LINE     SOURCE

                           618                     
04E9 43                    619                     INC BX
04EA FF069A00              620                     INC DS:SEND_BUFFER_LEN
04EE E2E8                  621             LOOP UPD_BUFFER
                           622             
04F0 C6878D002F            623             MOV DS:SEND_BUFFER[BX], '/'
04F5 FF069A00              624             INC DS:SEND_BUFFER_LEN
                           625                     
04F9 5A                    626     POP DX
04FA 59                    627     POP CX
04FB 5B                    628     POP BX
04FC 58                    629     POP AX
                           630     
04FD CB                    631     RET
                           632     UPDATE_THE_QUANTITY ENDP
                           633     
04FE                       634     UPDATE_SEND_BUFFER PROC FAR
04FE 50                    635     PUSH AX
04FF 53                    636     PUSH BX
0500 51                    637     PUSH CX
0501 52                    638     PUSH DX
                           639     
0502 8B0E6100              640             MOV CX, DS:KEYPAD_INDEX
0506 83F900                641             CMP CX, 0
0509 7435                  642             JE END_UPD_BUFFER
050B 83C102                643             ADD CX, 2
050E 890E9A00              644             MOV DS:SEND_BUFFER_LEN, CX
0512 BB0000                645             MOV BX, 0
0515                       646             BUFFER_LOOP:
0515 83FB00                647                     CMP BX, 0
0518 7508                  648                     JNE ASTERISK
051A C6878D007E            649                     MOV DS:SEND_BUFFER[BX], '~'
051F EB1C90                650                     JMP END_BUFFER
0522                       651             ASTERISK:
0522 A16100                652                     MOV AX, DS:KEYPAD_INDEX
0525 40                    653                     INC AX
0526 3BD8                  654                     CMP BX, AX
0528 7508                  655                     JNE CONT
052A C6878D002A            656                     MOV DS:SEND_BUFFER[BX], '*'
052F EB0C90                657                     JMP END_BUFFER
0532                       658             CONT:
0532 4B                    659                     DEC BX
0533 8A4751                660                     MOV AL, DS:KEYPAD_INPUT[BX]
0536 0430                  661                     ADD AL, 30H
0538 43                    662                     INC BX
0539 88878D00              663                     MOV DS:SEND_BUFFER[BX], AL
                           664                     
053D                       665             END_BUFFER:
053D 43                    666                     INC BX
053E E2D5                  667             LOOP BUFFER_LOOP
0540                       668     END_UPD_BUFFER:
0540 5A                    669     POP DX
0541 59                    670     POP CX
0542 5B                    671     POP BX
0543 58                    672     POP AX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:10:15  12/07/;3  PAGE   14


LOC  OBJ                  LINE     SOURCE

0544 CB                    673     RET
                           674     UPDATE_SEND_BUFFER ENDP
                           675     
0545                       676     BCD_BACKSPACE PROC FAR
                           677     
0545 50                    678     PUSH AX
0546 53                    679     PUSH BX
0547 51                    680     PUSH CX
0548 52                    681     PUSH DX
                           682     
0549 8A167900              683             MOV DL, DS:REG_AL
054D 833E610000            684             CMP DS:KEYPAD_INDEX, 0
0552 7457                  685             JE RETURN_BACK
                           686             
0554 BB0600                687             MOV BX, 6
0557                       688             BCD_CLEAR_LOOP:
0557 4B                    689                     DEC BX
0558 C647592D              690                     MOV DS:BCD_MESSAGE[BX], '-'
055C 43                    691                     INC BX
055D 4B                    692                     DEC BX
055E 75F7                  693             JNZ BCD_CLEAR_LOOP
                           694             
0560 833E610001            695             CMP DS:KEYPAD_INDEX, 1
0565 7E2C                  696             JLE less_than_two
                           697             
0567 FF0E6100              698             DEC DS:KEYPAD_INDEX
056B FF0E6100              699             DEC DS:KEYPAD_INDEX
056F 8B1E6100              700             MOV BX, DS:KEYPAD_INDEX
0573 8A4751                701             MOV AL, DS:KEYPAD_INPUT[BX]
0576 A27900                702             MOV DS:REG_AL, AL
0579 C706A8000000          703             MOV DS:SCROLL_LEN, 0
057F C706AA000100          704             MOV DS:DAC_DISABLE, 1
0585 9ADF05----     R      705             CALL FAR PTR BCD_UPDATE
058A C706AA000000          706             MOV DS:DAC_DISABLE, 0
0590 EB1990                707             JMP RETURN_BACK
                           708             
0593                       709     less_than_two:
0593 FF0E6100              710             DEC DS:KEYPAD_INDEX
0597 C60679002D            711             MOV DS:REG_AL, '-'
059C C706A8000000          712             MOV DS:SCROLL_LEN, 0
05A2 9ADF05----     R      713             CALL FAR PTR BCD_UPDATE
05A7 FF0E6100              714             DEC DS:KEYPAD_INDEX
                           715             
05AB                       716     RETURN_BACK:
05AB 88167900              717             MOV DS:REG_AL, DL
05AF 5A                    718     POP DX
05B0 59                    719     POP CX
05B1 5B                    720     POP BX
05B2 58                    721     POP AX
                           722     
05B3 CB                    723     RET
                           724     BCD_BACKSPACE ENDP
                           725     
05B4                       726     BCD_CLEAR PROC FAR
05B4 50                    727     PUSH AX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:10:15  12/07/;3  PAGE   15


LOC  OBJ                  LINE     SOURCE

05B5 53                    728     PUSH BX
05B6 51                    729     PUSH CX
05B7 52                    730     PUSH DX
05B8 BB0800                731             MOV BX, 8
05BB                       732             CLEAR_LOOP:
05BB C6475100              733             MOV DS:KEYPAD_INPUT[BX], 0
05BF 4B                    734             DEC BX
05C0 75F9                  735             JNZ CLEAR_LOOP
                           736             
05C2 BB0600                737             MOV BX, 6
05C5                       738             CLEAR_LOOP2:
05C5 4B                    739                     DEC BX
05C6 C647592D              740                     MOV DS:BCD_MESSAGE[BX], '-'
05CA 43                    741                     INC BX
05CB 4B                    742                     DEC BX
05CC 75F7                  743             JNZ CLEAR_LOOP2
                           744     
05CE C70661000000          745             MOV DS:KEYPAD_INDEX, 0
05D4 C706A8000000          746             MOV DS:SCROLL_LEN, 0
05DA 5A                    747     POP DX
05DB 59                    748     POP CX
05DC 5B                    749     POP BX
05DD 58                    750     POP AX
05DE CB                    751     RET
                           752     BCD_CLEAR ENDP
                           753     
05DF                       754     BCD_UPDATE PROC FAR
05DF 50                    755     PUSH AX
05E0 53                    756     PUSH BX
05E1 51                    757     PUSH CX
05E2 52                    758     PUSH DX
05E3 A19C00                759                     MOV AX, DS:MAX_INPUT_SIZE
05E6 39066100              760                     CMP DS:KEYPAD_INDEX, AX
05EA 7D5A                  761                     JGE BCD_RET
                           762                     
05EC 8A0E7900              763                     MOV CL, DS:REG_AL
05F0 80F909                764                     CMP CL, 9
05F3 7F0C                  765                     JG SKIP_PAST
05F5 833EAA0001            766                     CMP DS:DAC_DISABLE, 1
05FA 7405                  767                     JE SKIP_PAST
05FC 9A4B06----     R      768                     CALL FAR PTR DAC_UPDATE
                           769     
0601                       770     SKIP_PAST:              
0601 8A0E7900              771                     MOV CL, DS:REG_AL
                           772     
0605 8B1E6100              773                     MOV BX, DS:KEYPAD_INDEX
                           774                             
0609 884F51                775                     MOV DS:KEYPAD_INPUT[BX], CL
                           776                             
060C FF066100              777                     INC DS:KEYPAD_INDEX
                           778                             
0610 8B1E6100              779                     MOV BX, DS:KEYPAD_INDEX
                           780                     
0614 A1A800                781                     MOV AX, DS:SCROLL_LEN
0617 2BD8                  782                     SUB BX, AX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:10:15  12/07/;3  PAGE   16


LOC  OBJ                  LINE     SOURCE

                           783                     
0619 8B166100              784                     MOV DX, DS:KEYPAD_INDEX
061D 83FA06                785                     CMP DX, 6
0620 7E03                  786                     JLE update_display
0622 BA0600                787                     MOV DX, 6
                           788                     
0625                       789             update_display:
                           790             
0625 B90500                791                     MOV CX, 5
0628 4B                    792                     DEC BX
0629 8A4751                793                     MOV AL, DS:KEYPAD_INPUT[BX]
062C 43                    794                     INC BX
                           795                             
062D 52                    796                     PUSH DX
062E 8B166100              797                     MOV DX, DS:KEYPAD_INDEX
0632 2B16A800              798                     SUB DX, DS:SCROLL_LEN
                           799                     
0636 2BD3                  800                     SUB DX, BX
                           801                             
0638 53                    802                     PUSH BX
                           803                             
0639 2BCA                  804                     SUB CX, DX
063B 8BD9                  805                     MOV BX, CX
063D 884759                806                     MOV DS:BCD_MESSAGE[BX], AL
                           807                             
0640 5B                    808                     POP BX
0641 5A                    809                     POP DX
                           810             
0642 4B                    811                     DEC BX
0643 4A                    812                     DEC DX
0644 75DF                  813             JNZ update_display
                           814     
0646                       815             BCD_RET:
0646 5A                    816                     POP DX
0647 59                    817                     POP CX
0648 5B                    818                     POP BX
0649 58                    819                     POP AX
064A CB                    820     RET
                           821     BCD_UPDATE ENDP
                           822     
064B                       823     DAC_UPDATE PROC FAR
064B 50                    824             PUSH AX
064C 53                    825             PUSH BX
064D 51                    826             PUSH CX
064E 52                    827             PUSH DX
                           828             
064F BB0000                829             MOV BX, 0
0652 8A1E7500              830             MOV BL, DS:DAC_LEN
0656 A07900                831             MOV AL, DS:REG_AL
                           832             
0659 884766                833             MOV DS:DAC_ADDR[BX], AL
                           834             
065C FE067500              835             INC DS:DAC_LEN
                           836     
0660 5A                    837             POP DX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:10:15  12/07/;3  PAGE   17


LOC  OBJ                  LINE     SOURCE

0661 59                    838             POP CX
0662 5B                    839             POP BX
0663 58                    840             POP AX
0664 CB                    841     RET
                           842     DAC_UPDATE ENDP
                           843               
0665                       844     DEBOUNCE PROC FAR
0665 51                    845                       PUSH CX
                           846                       
0666 B94C09                847                       MOV CX, 094CH
0669 90                    848     BACK:     NOP
066A E2FD                  849                       LOOP BACK
066C 59                    850                       POP CX
066D CB                    851                       RET
                           852     DEBOUNCE  ENDP
                           853     
066E                       854     SEND_INPUT PROC FAR
066E 50                    855     PUSH AX
066F 53                    856     PUSH BX
0670 51                    857     PUSH CX
0671 52                    858     PUSH DX
0672 BB0000                859             MOV BX, 0
0675 8B0E9A00              860             MOV CX, DS:SEND_BUFFER_LEN
                           861             
0679                       862             S_BUFF:
0679 8A878D00              863                     MOV AL, DS:SEND_BUFFER[BX]
067D 9A0000----     E      864                     CALL FAR PTR PRINT_CHAR
0682 43                    865                     INC BX
0683 E2F4                  866             LOOP S_BUFF
                           867             
0685                       868     SEND_INPUT_END:
0685 5A                    869     POP DX
0686 59                    870     POP CX
0687 5B                    871     POP BX
0688 58                    872     POP AX
0689 CB                    873     RET
                           874     SEND_INPUT ENDP
                           875     
068A                       876     TAKE_CASH PROC FAR
068A 50                    877     PUSH AX
068B 53                    878     PUSH BX
068C 51                    879     PUSH CX
068D 52                    880     PUSH DX
                           881             
068E B90000                882             MOV CX, 0
0691 B108                  883             MOV CL, 8
0693                       884             CLEAR_CASH_AMT:
0693 8BD9                  885                     MOV BX, CX
0695 4B                    886                     DEC BX
0696 C687CA0000            887                     MOV DS:CASH_AMT[BX], 0
069B E2F6                  888             LOOP CLEAR_CASH_AMT
                           889             
069D 8B0E6100              890             MOV CX, DS:KEYPAD_INDEX
06A1 BA0600                891             MOV DX, 6
                           892             
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:10:15  12/07/;3  PAGE   18


LOC  OBJ                  LINE     SOURCE

06A4                       893             UPDATE_CASH_AMT:
06A4 8BD9                  894                     MOV BX, CX
06A6 4B                    895                     DEC BX
                           896                     
06A7 33C0                  897                     XOR AX, AX
06A9 8A4751                898                     MOV AL, DS:KEYPAD_INPUT[BX]
                           899                     
06AC 8BDA                  900                     MOV BX, DX
06AE 4B                    901                     DEC BX
06AF 8887CA00              902                     MOV DS:CASH_AMT[BX], AL
                           903                     
06B3 4A                    904                     DEC DX
06B4 E2EE                  905             LOOP UPDATE_CASH_AMT
                           906             
06B6 C706E2000100          907             MOV DS:CASH_OK_FLAG, 1
06BC C706E4000700          908             MOV DS:BORROW_POSITION, 7
06C2 B90800                909             MOV CX, 8
06C5                       910             CHECK_CASH:
06C5 BB0800                911                     MOV BX, 8
06C8 2BD9                  912                     SUB BX, CX
06CA B80000                913                     MOV AX, 0
06CD 8A87BA00              914                     MOV AL, DS:TEMP_BCD_ARR[BX]
06D1 8A97CA00              915                     MOV DL, DS:CASH_AMT[BX]
06D5 3AD0                  916                     CMP DL, AL
06D7 741A                  917                     JE NEXT_CASH_DIGIT
                           918                     
06D9 3AD0                  919                     CMP DL, AL
06DB 7C0D                  920                     JL CASH_NOT_OK
                           921                     
06DD C706E2000100          922                     MOV DS:CASH_OK_FLAG, 1
06E3 891EE400              923                     MOV DS:BORROW_POSITION, BX
                           924                     
06E7 EB0C90                925                     JMP CHEK_CASH_DONE
                           926                     
06EA                       927                     CASH_NOT_OK:
06EA C706E2000000          928                     MOV DS:CASH_OK_FLAG, 0
06F0 EB0390                929                     JMP CHEK_CASH_DONE
                           930                     
06F3                       931             NEXT_CASH_DIGIT:
06F3 E2D0                  932             LOOP CHECK_CASH
                           933             
06F5                       934     CHEK_CASH_DONE:
                           935             
06F5 833EE20001            936             CMP DS:CASH_OK_FLAG, 1
06FA 7464                  937             JE CONTINUE_CASH
06FC B90800                938             MOV CX, 8
06FF C70661000000          939             MOV DS:KEYPAD_INDEX, 0
0705 C706AC000300          940             MOV DS:DECIMAL_INDEX, 3
070B                       941             RETAIN_BCD:
070B BB0800                942                     MOV BX, 8
070E 2BD9                  943                     SUB BX, CX
                           944                     
0710 8A87BA00              945                     MOV AL, DS:TEMP_BCD_ARR[BX]
0714 A27900                946                     MOV DS:REG_AL, AL
                           947                     
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:10:15  12/07/;3  PAGE   19


LOC  OBJ                  LINE     SOURCE

0717 C706AA000100          948                     MOV DS:DAC_DISABLE, 1
071D 9ADF05----     R      949                     CALL FAR PTR BCD_UPDATE
0722 C706AA000000          950                     MOV DS:DAC_DISABLE, 0
0728 E2E1                  951             LOOP RETAIN_BCD
072A 813E64000040          952             CMP DS:DAC_BASE, 4000H
0730 7517                  953             JNE MANDARIN_CASH
                           954             
0732 C606790023            955             MOV DS:REG_AL, 35
0737 9A4B06----     R      956             CALL FAR PTR DAC_UPDATE
073C C606790024            957             MOV DS:REG_AL, 36
0741 9A4B06----     R      958             CALL FAR PTR DAC_UPDATE
0746 E9AC00                959             JMP CASH_OVER
                           960             
0749                       961     MANDARIN_CASH:
0749 C606790012            962             MOV DS:REG_AL, 18
074E 9A4B06----     R      963             CALL FAR PTR DAC_UPDATE
0753 C606790013            964             MOV DS:REG_AL, 19
0758 9A4B06----     R      965             CALL FAR PTR DAC_UPDATE
075D E99500                966             JMP CASH_OVER
                           967             
0760                       968     CONTINUE_CASH:
0760 8B1EE400              969             MOV BX, DS:BORROW_POSITION
0764 B90700                970             MOV CX, 7
0767 2BCB                  971             SUB CX, BX
0769 83F900                972             CMP CX, 0
076C 740C                  973             JE BEGIN_SUB
                           974             
076E                       975             ADJUST_PLACES:
076E FE8FCA00              976                     DEC DS:CASH_AMT[BX]
0772 43                    977                     INC BX
0773 8087CA000A            978                     ADD DS:CASH_AMT[BX], 10
0778 E2F4                  979             LOOP ADJUST_PLACES
                           980             
077A                       981     BEGIN_SUB:
077A B90800                982             MOV CX, 8
077D                       983             CALC_CHANGE:
077D BB0800                984                     MOV BX, 8
0780 2BD9                  985                     SUB BX, CX
0782 B80000                986                     MOV AX, 0
0785 8A87CA00              987                     MOV AL, DS:CASH_AMT[BX]
0789 BA0000                988                     MOV DX, 0
078C 8A97BA00              989                     MOV DL, DS:TEMP_BCD_ARR[BX]
0790 2BC2                  990                     SUB AX, DX
0792 8987D200              991                     MOV DS:TEMP_CASH_ARR[BX], AX
0796 E2E5                  992             LOOP CALC_CHANGE
                           993             
0798 B90800                994             MOV CX, 8
079B                       995             FIX_DIGITS:
079B 8BD9                  996             MOV BX, CX
079D 4B                    997             DEC BX
                           998             
079E 8B87D200              999             MOV AX, DS:TEMP_CASH_ARR[BX]
07A2 3C0A                 1000             CMP AL, 10
07A4 7C0A                 1001             JL NEXT_DIGIT_TO_FIX
                          1002             
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:10:15  12/07/;3  PAGE   20


LOC  OBJ                  LINE     SOURCE

07A6 83AFD2000A           1003             SUB DS:TEMP_CASH_ARR[BX], 10
                          1004             
07AB 4B                   1005             DEC BX
07AC FF87D200             1006             INC DS:TEMP_CASH_ARR[BX]
                          1007             
07B0                      1008             NEXT_DIGIT_TO_FIX:
                          1009             
07B0 E2E9                 1010             LOOP FIX_DIGITS
                          1011             
07B2 B90800               1012             MOV CX, 8
07B5 C70661000000         1013             MOV DS:KEYPAD_INDEX, 0
07BB C706AC000300         1014             MOV DS:DECIMAL_INDEX, 3
07C1                      1015             UPDATE_BCD_TO_CASH:
07C1 BB0800               1016                     MOV BX, 8
07C4 2BD9                 1017                     SUB BX, CX
07C6 8B87D200             1018                     MOV AX, DS:TEMP_CASH_ARR[BX]
07CA 8887BA00             1019                     MOV DS:TEMP_BCD_ARR[BX], AL
07CE A27900               1020                     MOV DS:REG_AL, AL
07D1 C706AA000100         1021                     MOV DS:DAC_DISABLE, 1
07D7 9ADF05----     R     1022                     CALL FAR PTR BCD_UPDATE
07DC C706AA000000         1023                     MOV DS:DAC_DISABLE, 0
07E2 E2DD                 1024             LOOP UPDATE_BCD_TO_CASH
                          1025             
07E4 9AFA07----     R     1026             CALL FAR PTR CALC_DAC
                          1027             
07E9 C706C8000000         1028             MOV DS:CASH_FLAG, 0
07EF C706E8000100         1029             MOV DS:TRANSACTION_OVER, 1
                          1030             
07F5                      1031     CASH_OVER:
07F5 5A                   1032     POP DX
07F6 59                   1033     POP CX
07F7 5B                   1034     POP BX
07F8 58                   1035     POP AX
                          1036     
07F9 CB                   1037     RET
                          1038     TAKE_CASH ENDP
                          1039     
07FA                      1040     CALC_DAC PROC FAR
07FA 50                   1041     PUSH AX
07FB 53                   1042     PUSH BX
07FC 51                   1043     PUSH CX
07FD 52                   1044     PUSH DX
07FE 813E64000040         1045             CMP DS:DAC_BASE, 4000H
0804 7403                 1046             JE ENGLISH_DAC
0806 E98E01               1047             JMP MANDARIN_DAC
                          1048             
0809                      1049     ENGLISH_DAC:
0809 C706C4000000         1050             MOV DS:CENT_FLAG, 0
080F C706C2000000         1051             MOV DS:THOUSAND_FLAG, 0
0815 C706C6000000         1052             MOV DS:DOLLAR_FLAG,     0
081B BB0000               1053             MOV BX, 0
081E 8A87BA00             1054             MOV AL, DS:TEMP_BCD_ARR[BX]
0822 A27900               1055             MOV DS:REG_AL, AL
0825 3C00                 1056             CMP AL, 0
0827 7415                 1057             JE NEXT_PLACE
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:10:15  12/07/;3  PAGE   21


LOC  OBJ                  LINE     SOURCE

0829 C706C6000100         1058             MOV DS:DOLLAR_FLAG, 1
082F 9A4B06----     R     1059             CALL FAR PTR DAC_UPDATE
0834 C60679001C           1060             MOV DS:REG_AL, 28
0839 9A4B06----     R     1061             CALL FAR PTR DAC_UPDATE
                          1062             
083E                      1063     NEXT_PLACE:     
083E 43                   1064             INC BX
083F 8A87BA00             1065             MOV AL, DS:TEMP_BCD_ARR[BX]
0843 3C01                 1066             CMP AL, 1
0845 751E                 1067             JNE NOT_1
0847 C706C6000100         1068             MOV DS:DOLLAR_FLAG, 1
084D 43                   1069             INC BX
084E 8A87BA00             1070             MOV AL, DS:TEMP_BCD_ARR[BX]
0852 040A                 1071             ADD AL, 10
0854 A27900               1072             MOV DS:REG_AL, AL
0857 9A4B06----     R     1073             CALL FAR PTR DAC_UPDATE
085C C706C2000100         1074             MOV DS:THOUSAND_FLAG, 1
0862 EB3890               1075             JMP HUNDREDS_PLACE
0865                      1076     NOT_1:
0865 3C00                 1077             CMP AL, 0
0867 7416                 1078             JE NEXT_PLACE_1
0869 C706C6000100         1079             MOV DS:DOLLAR_FLAG, 1
086F C706C2000100         1080             MOV DS:THOUSAND_FLAG, 1
0875 0412                 1081             ADD AL, 18
0877 A27900               1082             MOV DS:REG_AL, AL
087A 9A4B06----     R     1083             CALL FAR PTR DAC_UPDATE
087F                      1084     NEXT_PLACE_1:
087F 43                   1085             INC BX
0880 8A87BA00             1086             MOV AL, DS:TEMP_BCD_ARR[BX]
0884 3C00                 1087             CMP AL, 0
0886 7414                 1088             JE HUNDREDS_PLACE
0888 C706C6000100         1089             MOV DS:DOLLAR_FLAG, 1
088E C706C2000100         1090             MOV DS:THOUSAND_FLAG, 1
0894 A27900               1091             MOV DS:REG_AL, AL
0897 9A4B06----     R     1092             CALL FAR PTR DAC_UPDATE
                          1093     
089C                      1094     HUNDREDS_PLACE:
089C 833EC20000           1095             CMP DS:THOUSAND_FLAG, 0
08A1 7410                 1096             JE NEXT_PLACE_2
08A3 C60679001D           1097             MOV DS:REG_AL, 29
08A8 9A4B06----     R     1098             CALL FAR PTR DAC_UPDATE
08AD C706C2000000         1099             MOV DS:THOUSAND_FLAG, 0
                          1100             
08B3                      1101     NEXT_PLACE_2:
08B3 43                   1102             INC BX
08B4 8A87BA00             1103             MOV AL, DS:TEMP_BCD_ARR[BX]
08B8 3C00                 1104             CMP AL, 0
08BA 7418                 1105             JE NEXT_PLACE_3
08BC C706C6000100         1106             MOV DS:DOLLAR_FLAG, 1
08C2 A27900               1107             MOV DS:REG_AL, AL
08C5 9A4B06----     R     1108             CALL FAR PTR DAC_UPDATE
08CA C60679001C           1109             MOV DS:REG_AL, 28
08CF 9A4B06----     R     1110             CALL FAR PTR DAC_UPDATE
                          1111             
08D4                      1112     NEXT_PLACE_3:   
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:10:15  12/07/;3  PAGE   22


LOC  OBJ                  LINE     SOURCE

08D4 43                   1113             INC BX
08D5 8A87BA00             1114             MOV AL, DS:TEMP_BCD_ARR[BX]
08D9 3C01                 1115             CMP AL, 1
08DB 7518                 1116             JNE NOT_1_2
08DD C706C6000100         1117             MOV DS:DOLLAR_FLAG, 1
08E3 43                   1118             INC BX
08E4 8A87BA00             1119             MOV AL, DS:TEMP_BCD_ARR[BX]
08E8 040A                 1120             ADD AL, 10
08EA A27900               1121             MOV DS:REG_AL, AL
08ED 9A4B06----     R     1122             CALL FAR PTR DAC_UPDATE
08F2 EB2C90               1123             JMP DECIMAL_DAC
08F5                      1124     NOT_1_2:
08F5 3C00                 1125             CMP AL, 0
08F7 7410                 1126             JE NEXT_PLACE_4
08F9 C706C6000100         1127             MOV DS:DOLLAR_FLAG, 1
08FF 0412                 1128             ADD AL, 18
0901 A27900               1129             MOV DS:REG_AL, AL
0904 9A4B06----     R     1130             CALL FAR PTR DAC_UPDATE
0909                      1131     NEXT_PLACE_4:
0909 43                   1132             INC BX
090A 8A87BA00             1133             MOV AL, DS:TEMP_BCD_ARR[BX]
090E 3C00                 1134             CMP AL, 0
0910 740E                 1135             JE DECIMAL_DAC
0912 C706C6000100         1136             MOV DS:DOLLAR_FLAG, 1
0918 A27900               1137             MOV DS:REG_AL, AL
091B 9A4B06----     R     1138             CALL FAR PTR DAC_UPDATE
                          1139             
0920                      1140     DECIMAL_DAC:
0920 833EC60000           1141             CMP DS:DOLLAR_FLAG, 0
0925 740A                 1142             JE DECIMAL_DAC_CONT
0927 C60679001E           1143             MOV DS:REG_AL, 30
092C 9A4B06----     R     1144             CALL FAR PTR DAC_UPDATE
                          1145             
0931                      1146     DECIMAL_DAC_CONT:
0931 43                   1147             INC BX
0932 8A87BA00             1148             MOV AL, DS:TEMP_BCD_ARR[BX]
0936 3C01                 1149             CMP AL, 1
0938 7518                 1150             JNE NOT_1_3
093A 43                   1151             INC BX
093B C706C4000100         1152             MOV DS:CENT_FLAG, 1
0941 8A87BA00             1153             MOV AL, DS:TEMP_BCD_ARR[BX]
0945 040A                 1154             ADD AL, 10
0947 A27900               1155             MOV DS:REG_AL, AL
094A 9A4B06----     R     1156             CALL FAR PTR DAC_UPDATE
094F EB2C90               1157             JMP ENGLISH_END
                          1158             
0952                      1159     NOT_1_3:
0952 3C00                 1160             CMP AL, 0
0954 7410                 1161             JE NEXT_PLACE_5
0956 C706C4000100         1162             MOV DS:CENT_FLAG, 1
095C 0412                 1163             ADD AL, 18
095E A27900               1164             MOV DS:REG_AL, AL
0961 9A4B06----     R     1165             CALL FAR PTR DAC_UPDATE
                          1166             
0966                      1167     NEXT_PLACE_5:
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:10:15  12/07/;3  PAGE   23


LOC  OBJ                  LINE     SOURCE

0966 43                   1168             INC BX
0967 8A87BA00             1169             MOV AL, DS:TEMP_BCD_ARR[BX]
096B 3C00                 1170             CMP AL, 0
096D 740E                 1171             JE ENGLISH_END
096F C706C4000100         1172             MOV DS:CENT_FLAG, 1
0975 A27900               1173             MOV DS:REG_AL, AL
0978 9A4B06----     R     1174             CALL FAR PTR DAC_UPDATE
                          1175             
097D                      1176     ENGLISH_END:
097D 833EC40000           1177             CMP DS:CENT_FLAG, 0
0982 7410                 1178             JE ENGLISH_END2
0984 C60679001F           1179             MOV DS:REG_AL, 31
0989 9A4B06----     R     1180             CALL FAR PTR DAC_UPDATE
098E C706C4000000         1181             MOV DS:CENT_FLAG, 0
0994                      1182     ENGLISH_END2:
0994 E94F01               1183             JMP CONT_BCD_UPD_1
                          1184             
0997                      1185     MANDARIN_DAC:
0997 C706C4000000         1186             MOV DS:CENT_FLAG, 0
099D C706C2000000         1187             MOV DS:THOUSAND_FLAG, 0
09A3 C706C6000000         1188             MOV DS:DOLLAR_FLAG,     0
09A9 BB0000               1189             MOV BX, 0
09AC 8A87BA00             1190             MOV AL, DS:TEMP_BCD_ARR[BX]
09B0 3C00                 1191             CMP AL, 0
09B2 741E                 1192             JE NEXT_PLACE_6
09B4 C706C6000100         1193             MOV DS:DOLLAR_FLAG, 1
09BA C706C2000100         1194             MOV DS:THOUSAND_FLAG, 1
09C0 A27900               1195             MOV DS:REG_AL, AL
09C3 9A4B06----     R     1196             CALL FAR PTR DAC_UPDATE
09C8 C60679000B           1197             MOV DS:REG_AL, 11
09CD 9A4B06----     R     1198             CALL FAR PTR DAC_UPDATE
                          1199             
09D2                      1200     NEXT_PLACE_6:
09D2 43                   1201             INC BX
09D3 8A87BA00             1202             MOV AL, DS:TEMP_BCD_ARR[BX]
09D7 3C00                 1203             CMP AL, 0
09D9 741E                 1204             JE NEXT_PLACE_7
09DB C706C6000100         1205             MOV DS:DOLLAR_FLAG, 1
09E1 C706C2000100         1206             MOV DS:THOUSAND_FLAG, 1
09E7 A27900               1207             MOV DS:REG_AL, AL
09EA 9A4B06----     R     1208             CALL FAR PTR DAC_UPDATE
09EF C60679000A           1209             MOV DS:REG_AL, 10
09F4 9A4B06----     R     1210             CALL FAR PTR DAC_UPDATE
                          1211             
09F9                      1212     NEXT_PLACE_7:
09F9 43                   1213             INC BX
09FA 8A87BA00             1214             MOV AL, DS:TEMP_BCD_ARR[BX]
09FE 3C00                 1215             CMP AL, 0
0A00 7414                 1216             JE NEXT_PLACE_8
0A02 C706C6000100         1217             MOV DS:DOLLAR_FLAG, 1
0A08 C706C2000100         1218             MOV DS:THOUSAND_FLAG, 1
0A0E A27900               1219             MOV DS:REG_AL, AL
0A11 9A4B06----     R     1220             CALL FAR PTR DAC_UPDATE
                          1221     
0A16                      1222     NEXT_PLACE_8:
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:10:15  12/07/;3  PAGE   24


LOC  OBJ                  LINE     SOURCE

0A16 833EC20000           1223             CMP DS:THOUSAND_FLAG, 0
0A1B 7410                 1224             JE IGNORE_THOUSAND
0A1D C60679000C           1225             MOV DS:REG_AL, 12
0A22 9A4B06----     R     1226             CALL FAR PTR DAC_UPDATE
0A27 C706C2000000         1227             MOV DS:THOUSAND_FLAG, 0
                          1228             
0A2D                      1229     IGNORE_THOUSAND:
0A2D 43                   1230             INC BX
0A2E 8A87BA00             1231             MOV AL, DS:TEMP_BCD_ARR[BX]
0A32 3C00                 1232             CMP AL, 0
0A34 7418                 1233             JE NEXT_PLACE_9
0A36 C706C6000100         1234             MOV DS:DOLLAR_FLAG, 1
0A3C A27900               1235             MOV DS:REG_AL, AL
0A3F 9A4B06----     R     1236             CALL FAR PTR DAC_UPDATE
0A44 C60679000B           1237             MOV DS:REG_AL, 11
0A49 9A4B06----     R     1238             CALL FAR PTR DAC_UPDATE
                          1239             
0A4E                      1240     NEXT_PLACE_9:
0A4E 43                   1241             INC BX
0A4F 8A87BA00             1242             MOV AL, DS:TEMP_BCD_ARR[BX]
0A53 3C00                 1243             CMP AL, 0
0A55 7418                 1244             JE NEXT_PLACE_10
0A57 C706C6000100         1245             MOV DS:DOLLAR_FLAG, 1
0A5D A27900               1246             MOV DS:REG_AL, AL
0A60 9A4B06----     R     1247             CALL FAR PTR DAC_UPDATE
0A65 C60679000A           1248             MOV DS:REG_AL, 10
0A6A 9A4B06----     R     1249             CALL FAR PTR DAC_UPDATE
                          1250             
0A6F                      1251     NEXT_PLACE_10:
0A6F 43                   1252             INC BX
0A70 8A87BA00             1253             MOV AL, DS:TEMP_BCD_ARR[BX]
0A74 3C00                 1254             CMP AL, 0
0A76 740E                 1255             JE MANDARIN_DEC
0A78 C706C6000100         1256             MOV DS:DOLLAR_FLAG, 1
0A7E A27900               1257             MOV DS:REG_AL, AL
0A81 9A4B06----     R     1258             CALL FAR PTR DAC_UPDATE
                          1259             
0A86                      1260     MANDARIN_DEC:
0A86 833EC60000           1261             CMP DS:DOLLAR_FLAG, 0
0A8B 740A                 1262             JE MANDARIN_DAC_CONT
0A8D C60679000D           1263             MOV DS:REG_AL, 13
0A92 9A4B06----     R     1264             CALL FAR PTR DAC_UPDATE
0A97                      1265     MANDARIN_DAC_CONT:
0A97 43                   1266             INC BX
0A98 8A87BA00             1267             MOV AL, DS:TEMP_BCD_ARR[BX]
0A9C 3C00                 1268             CMP AL, 0
0A9E 7418                 1269             JE NEXT_PLACE_11
0AA0 C706C4000100         1270             MOV DS:CENT_FLAG, 1
0AA6 A27900               1271             MOV DS:REG_AL, AL
0AA9 9A4B06----     R     1272             CALL FAR PTR DAC_UPDATE
0AAE C60679000A           1273             MOV DS:REG_AL, 10
0AB3 9A4B06----     R     1274             CALL FAR PTR DAC_UPDATE
                          1275             
0AB8                      1276     NEXT_PLACE_11:
                          1277     
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:10:15  12/07/;3  PAGE   25


LOC  OBJ                  LINE     SOURCE

0AB8 43                   1278             INC BX
0AB9 8A87BA00             1279             MOV AL, DS:TEMP_BCD_ARR[BX]
0ABD 3C00                 1280             CMP AL, 0
0ABF 740E                 1281             JE CONT_BCD_UPD
0AC1 C706C4000100         1282             MOV DS:CENT_FLAG, 1
0AC7 A27900               1283             MOV DS:REG_AL, AL
0ACA 9A4B06----     R     1284             CALL FAR PTR DAC_UPDATE
                          1285             
0ACF                      1286     CONT_BCD_UPD:
0ACF 833EC40000           1287             CMP DS:CENT_FLAG, 0
0AD4 7410                 1288             JE CONT_BCD_UPD_1
0AD6 C60679000E           1289             MOV DS:REG_AL, 14
0ADB 9A4B06----     R     1290             CALL FAR PTR DAC_UPDATE
0AE0 C706C4000000         1291             MOV DS:CENT_FLAG, 0
                          1292     
0AE6                      1293     CONT_BCD_UPD_1:
                          1294             
0AE6 5A                   1295     POP DX
0AE7 59                   1296     POP CX
0AE8 5B                   1297     POP BX
0AE9 58                   1298     POP AX
0AEA CB                   1299     RET
                          1300     CALC_DAC ENDP
                          1301     
0AEB                      1302     CALC_UPD_PRICE PROC FAR
0AEB 50                   1303     PUSH AX
0AEC 53                   1304     PUSH BX
0AED 51                   1305     PUSH CX
0AEE 52                   1306     PUSH DX
0AEF 833EB20000           1307             CMP DS:QTY, 0
0AF4 7503                 1308             JNE CHECK_PRICE_ZERO
0AF6 E92B01               1309             JMP CALC_END
0AF9                      1310     CHECK_PRICE_ZERO:
0AF9 833EB00000           1311             CMP DS:PRICE, 0
0AFE 7503                 1312             JNE START_CALC
0B00 E92101               1313             JMP CALC_END
0B03                      1314     START_CALC:
0B03 BA0000               1315             MOV DX, 0
0B06 A1B000               1316             MOV AX, DS:PRICE
0B09 8B1EB200             1317             MOV BX, DS:QTY
0B0D F7E3                 1318             MUL BX
                          1319             
0B0F BB6400               1320             MOV BX, 100
0B12 F7F3                 1321             DIV BX
0B14 A3B000               1322             MOV DS:PRICE, AX
0B17 A1B800               1323             MOV AX, DS:TOTAL_PRICE_DEC
0B1A 03C2                 1324             ADD AX, DX
0B1C 3D6400               1325             CMP AX, 100
0B1F 7C07                 1326             JL NON_DECIMAL
0B21 FF06B600             1327             INC DS:TOTAL_PRICE_L
0B25 2D6400               1328             SUB AX, 100
                          1329             
0B28                      1330     NON_DECIMAL:    
0B28 A3B800               1331             MOV DS:TOTAL_PRICE_DEC, AX
0B2B A1B600               1332             MOV AX, DS:TOTAL_PRICE_L
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:10:15  12/07/;3  PAGE   26


LOC  OBJ                  LINE     SOURCE

0B2E 8B1EB000             1333             MOV BX, DS:PRICE
0B32 03C3                 1334             ADD AX, BX
0B34 7304                 1335             JNC update_normal
0B36 FF06B400             1336             INC DS:TOTAL_PRICE_U
                          1337             
0B3A                      1338     update_normal:
0B3A A3B600               1339             MOV DS:TOTAL_PRICE_L, AX
                          1340             
0B3D BA0000               1341             MOV DX, 0
                          1342             ;CMP DS:TOTAL_PRICE_DEC, 9
                          1343             ;JG DECIMAL_CONT
                          1344             ;MOV CX, 10
                          1345             ;MOV AX, DS:TOTAL_PRICE_DEC
                          1346             ;MUL CX
                          1347             ;MOV DS:TOTAL_PRICE_DEC, AX
                          1348     ;DECIMAL_CONT:
0B40 A1B800               1349             MOV AX, DS:TOTAL_PRICE_DEC
0B43 B90A00               1350             MOV CX, 10
0B46 F7F1                 1351             DIV CX
                          1352             
0B48 BB0700               1353             MOV BX, 7
0B4B 8897BA00             1354             MOV DS:TEMP_BCD_ARR[BX], DL
0B4F 4B                   1355             DEC BX
0B50 8887BA00             1356             MOV DS:TEMP_BCD_ARR[BX], AL
                          1357             
0B54 BB0600               1358             MOV BX, 6
0B57 A1B600               1359             MOV AX, DS:TOTAL_PRICE_L
                          1360             
0B5A                      1361             TEMP_UPD_LOOP:
0B5A BA0000               1362                     MOV DX, 0
0B5D B90A00               1363                     MOV CX, 10
0B60 F7F1                 1364                     DIV CX
                          1365                     
0B62 4B                   1366                     DEC BX
0B63 8897BA00             1367                     MOV DS:TEMP_BCD_ARR[BX], DL
0B67 43                   1368                     INC BX
                          1369                     
0B68 4B                   1370                     DEC BX
                          1371                     
0B69 75EF                 1372             JNZ TEMP_UPD_LOOP
                          1373             
0B6B 8B0EB400             1374             MOV CX, DS:TOTAL_PRICE_U
0B6F 83F900               1375             CMP CX, 0
0B72 7478                 1376             JE upd_dac_part
0B74                      1377             ADD_EXTRA_PART:
0B74 BB0500               1378                     MOV BX, 5
0B77 8A87BA00             1379                     MOV AL, DS:TEMP_BCD_ARR[BX]
0B7B 0406                 1380                     ADD AL, 6
0B7D 3C09                 1381                     CMP AL, 9
0B7F 7E08                 1382                     JLE CONT_DIGIT_1
0B81 2C0A                 1383                     SUB AL, 10
0B83 4B                   1384                     DEC BX
0B84 FE87BA00             1385                     INC DS:TEMP_BCD_ARR[BX]
0B88 43                   1386                     INC BX
0B89                      1387             CONT_DIGIT_1:
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:10:15  12/07/;3  PAGE   27


LOC  OBJ                  LINE     SOURCE

0B89 8887BA00             1388                     MOV DS:TEMP_BCD_ARR[BX], AL
0B8D 4B                   1389                     DEC BX
                          1390                     
0B8E 8A87BA00             1391                     MOV AL, DS:TEMP_BCD_ARR[BX]
0B92 0403                 1392                     ADD AL, 3
0B94 3C09                 1393                     CMP AL, 9
0B96 7E08                 1394                     JLE CONT_DIGIT_2
0B98 2C0A                 1395                     SUB AL, 10
0B9A 4B                   1396                     DEC BX
0B9B FE87BA00             1397                     INC DS:TEMP_BCD_ARR[BX]
0B9F 43                   1398                     INC BX
0BA0                      1399             CONT_DIGIT_2:
0BA0 8887BA00             1400                     MOV DS:TEMP_BCD_ARR[BX], AL
0BA4 4B                   1401                     DEC BX
                          1402                     
0BA5 8A87BA00             1403                     MOV AL, DS:TEMP_BCD_ARR[BX]
0BA9 0405                 1404                     ADD AL, 5
0BAB 3C09                 1405                     CMP AL, 9
0BAD 7E08                 1406                     JLE CONT_DIGIT_3
0BAF 2C0A                 1407                     SUB AL, 10
0BB1 4B                   1408                     DEC BX
0BB2 FE87BA00             1409                     INC DS:TEMP_BCD_ARR[BX]
0BB6 43                   1410                     INC BX
0BB7                      1411             CONT_DIGIT_3:
0BB7 8887BA00             1412                     MOV DS:TEMP_BCD_ARR[BX], AL
0BBB 4B                   1413                     DEC BX
                          1414                     
                          1415                     
0BBC 8A87BA00             1416                     MOV AL, DS:TEMP_BCD_ARR[BX]
0BC0 0405                 1417                     ADD AL, 5
0BC2 3C09                 1418                     CMP AL, 9
0BC4 7E08                 1419                     JLE CONT_DIGIT_4
0BC6 2C0A                 1420                     SUB AL, 10
0BC8 4B                   1421                     DEC BX
0BC9 FE87BA00             1422                     INC DS:TEMP_BCD_ARR[BX]
0BCD 43                   1423                     INC BX
0BCE                      1424             CONT_DIGIT_4:
0BCE 8887BA00             1425                     MOV DS:TEMP_BCD_ARR[BX], AL
0BD2 4B                   1426                     DEC BX
                          1427                     
0BD3 8A87BA00             1428                     MOV AL, DS:TEMP_BCD_ARR[BX]
0BD7 0406                 1429                     ADD AL, 6
0BD9 3C09                 1430                     CMP AL, 9
0BDB 7E08                 1431                     JLE CONT_DIGIT_5
0BDD 2C0A                 1432                     SUB AL, 10
0BDF 4B                   1433                     DEC BX
0BE0 FE87BA00             1434                     INC DS:TEMP_BCD_ARR[BX]
0BE4 43                   1435                     INC BX
0BE5                      1436             CONT_DIGIT_5:
0BE5 8887BA00             1437                     MOV DS:TEMP_BCD_ARR[BX], AL
0BE9 4B                   1438                     DEC BX
                          1439                     
0BEA E288                 1440             LOOP ADD_EXTRA_PART
                          1441             
0BEC                      1442     upd_dac_part:
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:10:15  12/07/;3  PAGE   28


LOC  OBJ                  LINE     SOURCE

0BEC 9AFA07----     R     1443             CALL FAR PTR CALC_DAC
                          1444     
0BF1 9AB405----     R     1445             CALL FAR PTR BCD_CLEAR
0BF6 C70661000000         1446             MOV DS:KEYPAD_INDEX, 0
0BFC C706AC000300         1447             MOV DS:DECIMAL_INDEX, 3
0C02 B90800               1448             MOV CX, 8
0C05                      1449             UPD_BCD:
0C05 BB0800               1450                     MOV BX, 8
0C08 2BD9                 1451                     SUB BX, CX
0C0A 8A87BA00             1452                     MOV AL, DS:TEMP_BCD_ARR[BX]
0C0E A27900               1453                     MOV DS:REG_AL, AL
0C11 C706AA000100         1454                     MOV DS:DAC_DISABLE, 1
0C17 9ADF05----     R     1455                     CALL FAR PTR BCD_UPDATE
0C1C C706AA000000         1456                     MOV DS:DAC_DISABLE, 0
0C22 E2E1                 1457             LOOP UPD_BCD
                          1458             
0C24                      1459     CALC_END:
0C24 833EB00000           1460             CMP DS:PRICE, 0
0C29 7403                 1461             JE RETAIN_BCD_VALUE
0C2B EB2F90               1462             JMP END_CALC_BCD_DAC
                          1463             
0C2E                      1464     RETAIN_BCD_VALUE:       
0C2E C70661000000         1465             MOV DS:KEYPAD_INDEX, 0
0C34 C706AC000300         1466             MOV DS:DECIMAL_INDEX, 3
0C3A B90800               1467             MOV CX, 8
0C3D                      1468             UPD_BCD1:
0C3D BB0800               1469                     MOV BX, 8
0C40 2BD9                 1470                     SUB BX, CX
0C42 8A87BA00             1471                     MOV AL, DS:TEMP_BCD_ARR[BX]
0C46 A27900               1472                     MOV DS:REG_AL, AL
0C49 C706AA000100         1473                     MOV DS:DAC_DISABLE, 1
0C4F 9ADF05----     R     1474                     CALL FAR PTR BCD_UPDATE
0C54 C706AA000000         1475                     MOV DS:DAC_DISABLE, 0
0C5A E2E1                 1476             LOOP UPD_BCD1
                          1477     
0C5C                      1478     END_CALC_BCD_DAC:
0C5C C706B0000000         1479             MOV DS:PRICE, 0
0C62 C706B2000000         1480             MOV DS:QTY, 0
0C68 5A                   1481     POP DX
0C69 59                   1482     POP CX
0C6A 5B                   1483     POP BX
0C6B 58                   1484     POP AX
0C6C CB                   1485     RET
                          1486     CALC_UPD_PRICE ENDP
                          1487     
0C6D                      1488     UPDATE_TROLLEY PROC FAR
0C6D 50                   1489     PUSH AX
0C6E 53                   1490     PUSH BX
0C6F 51                   1491     PUSH CX
0C70 52                   1492     PUSH DX
0C71 B90800               1493             MOV CX, 8
0C74                      1494             CLEAR_TEMP_BCD_TROLLEY:
0C74 8BD9                 1495                     MOV BX, CX
0C76 4B                   1496                     DEC BX
0C77 C687BA0000           1497                     MOV DS:TEMP_BCD_ARR[BX], 0
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:10:15  12/07/;3  PAGE   29


LOC  OBJ                  LINE     SOURCE

0C7C E2F6                 1498             LOOP CLEAR_TEMP_BCD_TROLLEY
                          1499             
0C7E 8B0EF400             1500             MOV CX, DS:TROLLEY_INDEX
0C82 BA0800               1501             MOV DX, 8
                          1502             
0C85                      1503             UPD_TROLLEY_PRICE:
0C85 8BD9                 1504                     MOV BX, CX
0C87 4B                   1505                     DEC BX
                          1506                     
0C88 8A87EC00             1507                     MOV AL, DS:TROLLEY_ARRAY[BX]
                          1508                     
0C8C 8BDA                 1509                     MOV BX, DX
0C8E 4B                   1510                     DEC BX
                          1511                     
0C8F 8887BA00             1512                     MOV DS:TEMP_BCD_ARR[BX], AL
                          1513                     
0C93 4A                   1514                     DEC DX
0C94 E2EF                 1515             LOOP UPD_TROLLEY_PRICE
                          1516             
0C96 B90800               1517             MOV CX, 8
0C99 C70661000000         1518             MOV DS:KEYPAD_INDEX, 0
0C9F                      1519             UPDATE_TROLLEY_PRICE_DISPLAY:
0C9F BB0800               1520                     MOV BX, 8
0CA2 2BD9                 1521                     SUB BX, CX
0CA4 8A87BA00             1522                     MOV AL, DS:TEMP_BCD_ARR[BX]
0CA8 A27900               1523                     MOV DS:REG_AL, AL
0CAB C706AA000100         1524                     MOV DS:DAC_DISABLE, 1
0CB1 9ADF05----     R     1525                     CALL FAR PTR BCD_UPDATE
0CB6 C706AA000000         1526                     MOV DS:DAC_DISABLE, 0
0CBC E2E1                 1527             LOOP UPDATE_TROLLEY_PRICE_DISPLAY
                          1528             
0CBE 9AFA07----     R     1529             CALL FAR PTR CALC_DAC
                          1530     
0CC3 5A                   1531     POP DX
0CC4 59                   1532     POP CX
0CC5 5B                   1533     POP BX
0CC6 5A                   1534     POP DX
0CC7 CB                   1535     RET
                          1536     UPDATE_TROLLEY ENDP
                          1537     ; ^^^^^^^^^^^^^^^ End of User main routine ^^^^^^^^^^^^^^^^^^^^^^^^^
0CC8                      1538     SERIAL_REC_ACTION       PROC    FAR
0CC8 51                   1539                     PUSH    CX
0CC9 53                   1540                     PUSH    BX
0CCA 1E                   1541                     PUSH    DS
                          1542                     
0CCB BB----         R     1543                     MOV     BX,DATA_SEG             ;initialize data segment register
0CCE 8EDB                 1544                     MOV     DS,BX
                          1545                     
0CD0 803E8B0001           1546                     CMP DS:REPLY_FLAG, 1
0CD5 7557                 1547                     JNE next_id1
                          1548                     
0CD7 803E8C0001           1549                     CMP DS:SEND_FLAG, 1
0CDC 7453                 1550                     JE send_input_across1
                          1551                     
0CDE 833EA00001           1552                     CMP DS:RECEIVE_FLAG, 1
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:10:15  12/07/;3  PAGE   30


LOC  OBJ                  LINE     SOURCE

0CE3 754F                 1553                     JNE terminate_session3
                          1554                     
0CE5 3C2F                 1555                     CMP AL, '/'
0CE7 752C                 1556                     JNE CHECK_SEND
0CE9 C706A4000000         1557                     MOV DS:PRICE_FLAG, 0
0CEF C706A0000000         1558                     MOV DS:RECEIVE_FLAG, 0
0CF5 C706AE000100         1559                     MOV DS:LANG_FLAG, 1
0CFB 833EF60000           1560                     CMP DS:TROLLEY_FLAG, 0
0D00 7405                 1561                     JE TROLLEY_UPD_SKIP
0D02 9A6D0C----     R     1562                     CALL FAR PTR UPDATE_TROLLEY
0D07                      1563             TROLLEY_UPD_SKIP:
0D07 C706F6000000         1564                     MOV DS:TROLLEY_FLAG, 0
0D0D 9AEB0A----     R     1565                     CALL FAR PTR CALC_UPD_PRICE
0D12 EB2090               1566                     JMP terminate_session3
                          1567             
0D15                      1568             CHECK_SEND:
0D15 3C26                 1569                     CMP AL, '&'
0D17 751E                 1570                     JNE TROLLEY_PRICE
0D19 C706A4000100         1571                     MOV DS:PRICE_FLAG, 1
0D1F C70661000000         1572                     MOV DS:KEYPAD_INDEX, 0
0D25 C7069C000800         1573                     MOV DS:MAX_INPUT_SIZE, 8
0D2B E9AF00               1574                     JMP id_skip2
                          1575             
                          1576             
0D2E                      1577             next_id1:
0D2E E9AF00               1578                     JMP next_id
                          1579                     
0D31                      1580             send_input_across1:
0D31 E98D00               1581                     JMP send_input_across
                          1582             
0D34                      1583             terminate_session3:
0D34 E9A300               1584                     JMP terminate_session2
                          1585             
                          1586                     
0D37                      1587             TROLLEY_PRICE:
0D37 3C2B                 1588                     CMP AL, '+'
0D39 7515                 1589                     JNE receive_price
0D3B C7069C000800         1590                     MOV DS:MAX_INPUT_SIZE, 8
0D41 C706F6000100         1591                     MOV DS:TROLLEY_FLAG, 1
0D47 C706F4000000         1592                     MOV DS:TROLLEY_INDEX, 0
0D4D E98D00               1593                     JMP id_skip2
                          1594                     
0D50                      1595             receive_price:
0D50 3C23                 1596                     CMP AL, '#'
0D52 750F                 1597                     JNE check_price
0D54 C706A2000100         1598                     MOV DS:DAC_FLAG, 1
0D5A C706A4000000         1599                     MOV DS:PRICE_FLAG, 0
0D60 EB7B90               1600                     JMP id_skip2
                          1601             
0D63                      1602             check_price:    
                          1603             
0D63 833EA40001           1604                     CMP DS:PRICE_FLAG, 1
0D68 7440                 1605                     JE update_price_value
                          1606                     
0D6A 833EF60001           1607                     CMP DS:TROLLEY_FLAG, 1
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:10:15  12/07/;3  PAGE   31


LOC  OBJ                  LINE     SOURCE

0D6F 7428                 1608                     JE update_trolley_arr
                          1609                     
0D71 833EA20001           1610                     CMP DS:DAC_FLAG, 1
0D76 7403                 1611                     JE dac_change
0D78 EB6390               1612                     JMP id_skip2
                          1613     
0D7B                      1614             dac_change:
0D7B 8A1E7900             1615                     MOV BL, DS:REG_AL
0D7F 2C30                 1616                     SUB AL, 30H
0D81 A27900               1617                     MOV DS:REG_AL, AL
0D84 9A4B06----     R     1618                     CALL FAR PTR DAC_UPDATE
0D89 881E7900             1619                     MOV DS:REG_AL, BL
0D8D C706A2000000         1620                     MOV DS:DAC_FLAG, 0
0D93 EB4890               1621                     JMP id_skip2
                          1622             
                          1623     
0D96 EB4590               1624             id_skip3: JMP id_skip2
                          1625             
0D99                      1626             update_trolley_arr:
0D99 8B1EF400             1627                     MOV BX, DS:TROLLEY_INDEX
0D9D 2C30                 1628                     SUB AL, 30H
0D9F 8887EC00             1629                     MOV DS:TROLLEY_ARRAY[BX], AL
0DA3 FF06F400             1630                     INC DS:TROLLEY_INDEX
0DA7 EB3490               1631                     JMP id_skip2
                          1632                     
0DAA                      1633             update_price_value:
0DAA 2C30                 1634                     SUB AL, 30H
0DAC B90000               1635                     MOV CX, 0
0DAF 8AC8                 1636                     MOV CL, AL
0DB1 A1B000               1637                     MOV AX, DS:PRICE
0DB4 BB0A00               1638                     MOV BX, 10
0DB7 F7E3                 1639                     MUL BX
                          1640                     
0DB9 03C1                 1641                     ADD AX, CX
0DBB A3B000               1642                     MOV DS:PRICE, AX
0DBE EB1D90               1643                     JMP id_skip2
                          1644                     
0DC1                      1645             send_input_across:
0DC1 9A6E06----     R     1646                     CALL FAR PTR SEND_INPUT
                          1647                     
0DC6 C7069A000000         1648                     MOV DS:SEND_BUFFER_LEN, 0
                          1649                     
0DCC C6068C0000           1650                     MOV DS:SEND_FLAG, 0
                          1651                     
0DD1 C706A0000100         1652                     MOV DS:RECEIVE_FLAG, 1
                          1653                     
0DD7 EB0490               1654                     JMP id_skip2
                          1655                     
0DDA EB3E90               1656                     terminate_session2: JMP terminate_session
0DDD EB6790               1657                     id_skip2: JMP id_skip
                          1658                     
0DE0                      1659             next_id:
                          1660                     
0DE0 803E810001           1661                     CMP DS:ID_FLAG_r, 1
0DE5 7513                 1662                     JNE id_flag_label
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:10:15  12/07/;3  PAGE   32


LOC  OBJ                  LINE     SOURCE

0DE7 38067F00             1663                     CMP DS:MY_ID[1], AL
0DEB 7559                 1664                     JNE id_skip
                          1665                     ;start writing to pc
0DED C6068B0001           1666                     MOV DS:REPLY_FLAG, 1
0DF2 C606810000           1667                     MOV DS:ID_FLAG_r, 0
0DF7 EB4D90               1668                     JMP id_skip
                          1669             
0DFA                      1670             id_flag_label:
                          1671             
0DFA 803E800001           1672                     CMP DS:ID_FLAG_@, 1
0DFF 7539                 1673                     JNE protocol_rec
0E01 3C72                 1674                     CMP AL,'r'
0E03 750D                 1675                     JNE id_not_r
0E05 C606810001           1676                     MOV DS:ID_FLAG_r,1
0E0A C606800000           1677                     MOV DS:ID_FLAG_@, 0
0E0F EB3590               1678                     JMP S_RET
0E12                      1679             id_not_r:
0E12 C606800000           1680                     MOV DS:ID_FLAG_@, 0
0E17 EB2D90               1681                     JMP id_skip
                          1682             
0E1A                      1683             terminate_session:
0E1A C606810000           1684                     MOV DS:ID_FLAG_r, 0
0E1F 33DB                 1685                     XOR BX,BX
0E21                      1686             start_send1:
0E21 50                   1687                     PUSH AX
0E22 33C0                 1688                     XOR AX,AX
0E24 8A878600             1689                     MOV AL, DS:FAIL_MESSAGE[BX]
0E28 9A0000----     E     1690                     CALL FAR PTR PRINT_CHAR
0E2D 58                   1691                     POP AX
0E2E C6068B0000           1692                     MOV DS:REPLY_FLAG, 0
0E33 43                   1693                     INC BX
0E34 3A1E8A00             1694                     CMP BL, DS:FAIL_COUNT
0E38 75E7                 1695                     JNE start_send1
                          1696                     
0E3A                      1697             protocol_rec:
0E3A 3C40                 1698                     CMP AL,'@'
0E3C 7508                 1699                     JNE id_skip
0E3E C606800001           1700                     MOV DS:ID_FLAG_@,1
0E43 EB0190               1701                     JMP S_RET
                          1702                     
0E46                      1703             id_skip:
                          1704                     ; JMP S_RET
                          1705             
                          1706                     ; CMP   AL,'<'
                          1707                     ; JNE   S_FAST
                          1708     
                          1709                     ; INC   DS:T_COUNT_SET
                          1710                     ; INC   DS:T_COUNT_SET
                          1711     
                          1712                     ; JMP   S_NEXT0
                          1713     ; S_FAST:
                          1714                     ; CMP   AL,'>'
                          1715                     ; JNE   S_RET
                          1716     
                          1717                     ; DEC   DS:T_COUNT_SET
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:10:15  12/07/;3  PAGE   33


LOC  OBJ                  LINE     SOURCE

                          1718                     ; DEC   DS:T_COUNT_SET
                          1719     
                          1720     ; S_NEXT0:
                          1721                     ; MOV   CX,22                   ;initialize counter for message
                          1722                     ; MOV   BX,0
                          1723     
                          1724     ; S_NEXT1:      MOV     AL,DS:REC_MESS[BX]      ;print message
                          1725                     ; call  FAR ptr print_char
                          1726                     ; INC   BX
                          1727                     ; LOOP  S_NEXT1
                          1728     
                          1729                     ; MOV   AL,DS:T_COUNT_SET       ;print current period of timer0
                          1730                     ; CALL  FAR PTR PRINT_2HEX
0E46                      1731     S_RET:
0E46 1F                   1732                     POP     DS
0E47 5B                   1733                     POP     BX
0E48 59                   1734                     POP     CX
0E49 CB                   1735                     RET
                          1736     SERIAL_REC_ACTION       ENDP
                          1737     
0E4A                      1738     TIMER2_ACTION   PROC    FAR
0E4A 50                   1739                     PUSH    AX
0E4B 1E                   1740                     PUSH    DS
0E4C 53                   1741                     PUSH    BX
0E4D 51                   1742                     PUSH    CX
0E4E 52                   1743                     PUSH    DX
                          1744                     
                          1745                     
0E4F B8----         R     1746                     MOV     AX,DATA_SEG
0E52 8ED8                 1747                     MOV     DS,AX
                          1748             
0E54 FE0E1600             1749                     DEC     DS:T_COUNT
0E58 754A                 1750                     JNZ     T_NEXT1
0E5A A01700               1751                     MOV     AL,DS:T_COUNT_SET
0E5D A21600               1752                     MOV     DS:T_COUNT,AL
                          1753     
0E60                      1754     T_NEXT0:
                          1755                     
0E60 33DB                 1756                     XOR BX, BX
0E62 8A1E6000             1757                     MOV BL, DS:BCD_INDEX
0E66 8A4759               1758                     MOV AL, DS:BCD_MESSAGE[BX]
                          1759                     
0E69 3B1EAC00             1760                     CMP BX, DS:DECIMAL_INDEX
0E6D 7506                 1761                     JNE CALL_FUNC
0E6F C706A6000100         1762                     MOV DS:DECIMAL_FLAG, 1
0E75                      1763     CALL_FUNC:
0E75 9A150F----     R     1764                     CALL FAR PTR BCD_TO_7SEG
0E7A C706A6000000         1765                     MOV DS:DECIMAL_FLAG, 0
                          1766     
0E80 BA0002               1767                     MOV DX, 200H
0E83 EE                   1768                     OUT DX, AL
                          1769                     
0E84 A05F00               1770                     MOV AL, DS:ENABLE_BYTE
0E87 BA8001               1771                     MOV DX, 180H
0E8A EE                   1772                     OUT DX, AL
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:10:15  12/07/;3  PAGE   34


LOC  OBJ                  LINE     SOURCE

                          1773                     
                          1774     
0E8B FE066000             1775                     INC DS:BCD_INDEX
0E8F D0065F00             1776                     ROL DS:ENABLE_BYTE, 1
0E93 803E5F00BF           1777                     CMP DS:ENABLE_BYTE, 10111111b
0E98 750A                 1778                     JNE T_NEXT1
0E9A C6065F00FE           1779                     MOV DS:ENABLE_BYTE, 11111110b 
0E9F C606600000           1780                     MOV DS:BCD_INDEX, 0
                          1781     
                          1782                     
0EA4                      1783     T_NEXT1:
0EA4 803E750000           1784                     CMP DS:DAC_LEN, 0
0EA9 743C                 1785                     JE ISR_END
                          1786                     
                          1787                     
0EAB 8B367600             1788                     MOV SI, DS:SI_PTR
                          1789                             
0EAF BB0000               1790                     MOV BX, 0
0EB2 33C0                 1791                     XOR AX, AX
0EB4 8A4766               1792                     MOV AL, DS:DAC_ADDR[BX]
                          1793                     
0EB7 BB0001               1794                     MOV BX, 100H
0EBA F7E3                 1795                     MUL BX
                          1796                     
0EBC 8B166400             1797                     MOV DX, DS:DAC_BASE
0EC0 03D0                 1798                     ADD DX, AX
                          1799                     
0EC2 1E                   1800                     PUSH DS
0EC3 8EDA                 1801                     MOV DS, DX
                          1802                     
0EC5 8B04                 1803                     MOV AX, [SI]
                          1804                     
0EC7 BA1001               1805                     MOV DX, 110H
0ECA EE                   1806                     OUT DX, AL
                          1807                     
0ECB 1F                   1808                     POP DS
                          1809                     
0ECC FF067600             1810                     INC DS:SI_PTR
0ED0 813E76000010         1811                     CMP DS:SI_PTR, 1000H
0ED6 750F                 1812                     JNE ISR_END
                          1813                     
0ED8 C70676000000         1814                     MOV DS:SI_PTR, 0
0EDE FE0E7500             1815                     DEC DS:DAC_LEN
0EE2 9AED0E----     R     1816                     CALL FAR PTR DAC_SHIFT
                          1817                     
0EE7                      1818     ISR_END:
                          1819                     
0EE7 5A                   1820                     POP DX
0EE8 59                   1821                     POP     CX
0EE9 5B                   1822                     POP     BX
0EEA 1F                   1823                     POP     DS
0EEB 58                   1824                     POP AX
0EEC CB                   1825                     RET
                          1826     TIMER2_ACTION   ENDP
                          1827     
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:10:15  12/07/;3  PAGE   35


LOC  OBJ                  LINE     SOURCE

                          1828     
0EED                      1829     DAC_SHIFT PROC FAR
0EED 50                   1830             PUSH AX
0EEE 53                   1831             PUSH BX
0EEF 51                   1832             PUSH CX
0EF0 52                   1833             PUSH DX
                          1834     
0EF1 33C9                 1835             XOR CX, CX
0EF3 8A0E7500             1836             MOV CL, DS:DAC_LEN
0EF7 80F900               1837             CMP CL, 0
0EFA 7414                 1838             JE END_SHIFT
                          1839     
0EFC                      1840             SHIFT_LOOP:
                          1841     
0EFC 33DB                 1842             XOR BX, BX
0EFE 8A1E7500             1843             MOV BL, DS:DAC_LEN
0F02 2BD9                 1844             SUB BX, CX
0F04 43                   1845             INC BX
                          1846             
0F05 33D2                 1847             XOR DX, DX
0F07 8A5766               1848             MOV DL, DS:DAC_ADDR[BX]
0F0A 4B                   1849             DEC BX
0F0B 885766               1850             MOV DS:DAC_ADDR[BX], DL
                          1851     
0F0E E2EC                 1852             LOOP SHIFT_LOOP
                          1853             
0F10                      1854             END_SHIFT:
0F10 5A                   1855             POP DX
0F11 59                   1856             POP CX
0F12 5B                   1857             POP BX
0F13 58                   1858             POP AX
0F14 CB                   1859             RET
                          1860     DAC_SHIFT ENDP
                          1861     
0F15                      1862     BCD_TO_7SEG PROC FAR
                          1863     
0F15 53                   1864             PUSH BX
0F16 51                   1865             PUSH CX
0F17 52                   1866             PUSH DX
                          1867             
0F18 3C00                 1868             CMP AL, 0
0F1A 7511                 1869             JNE one
0F1C 833EA60001           1870             CMP DS:DECIMAL_FLAG, 1
0F21 7405                 1871             JE decimal0
0F23 B03F                 1872             MOV AL, 00111111b
0F25 E9D700               1873             JMP endfunc
0F28                      1874     decimal0:
0F28 B0BF                 1875             MOV AL, 10111111b
0F2A E9D200               1876             JMP endfunc
                          1877             
0F2D                      1878             one:
0F2D 3C01                 1879             CMP AL, 1
0F2F 7511                 1880             JNE two
0F31 833EA60001           1881             CMP DS:DECIMAL_FLAG, 1
0F36 7405                 1882             JE decimal1
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:10:15  12/07/;3  PAGE   36


LOC  OBJ                  LINE     SOURCE

0F38 B006                 1883             MOV AL, 00000110b
0F3A E9C200               1884             JMP endfunc
0F3D                      1885     decimal1:
0F3D B086                 1886             MOV AL, 10000110b
0F3F E9BD00               1887             JMP endfunc
                          1888             
0F42                      1889             two:
0F42 3C02                 1890             CMP AL,2
0F44 7511                 1891             JNE three
0F46 833EA60001           1892             CMP DS:DECIMAL_FLAG, 1
0F4B 7405                 1893             JE decimal2
0F4D B05B                 1894             MOV AL, 01011011b
0F4F E9AD00               1895             JMP endfunc
0F52                      1896     decimal2:
0F52 B0DB                 1897             MOV AL, 11011011b
0F54 E9A800               1898             JMP endfunc
                          1899             
0F57                      1900             three:
0F57 3C03                 1901             CMP AL,3
0F59 7511                 1902             JNE four
0F5B 833EA60001           1903             CMP DS:DECIMAL_FLAG, 1
0F60 7405                 1904             JE decimal3
0F62 B04F                 1905             MOV AL, 01001111b
0F64 E99800               1906             JMP endfunc
0F67                      1907     decimal3:
0F67 B0CF                 1908             MOV AL, 11001111b
0F69 E99300               1909             JMP endfunc
                          1910             
0F6C                      1911             four:
0F6C 3C04                 1912             CMP AL,4
0F6E 7511                 1913             JNE five
0F70 833EA60001           1914             CMP DS:DECIMAL_FLAG, 1
0F75 7405                 1915             JE decimal4
0F77 B066                 1916             MOV AL, 01100110b
0F79 E98300               1917             JMP endfunc
0F7C                      1918     decimal4:
0F7C B0E6                 1919             MOV AL, 11100110b
0F7E EB7F90               1920             JMP endfunc
                          1921             
0F81                      1922             five:
0F81 3C05                 1923             CMP AL,5
0F83 7511                 1924             JNE six
0F85 833EA60001           1925             CMP DS:DECIMAL_FLAG, 1
0F8A 7405                 1926             JE decimal5
0F8C B06D                 1927             MOV AL, 01101101b
0F8E EB6F90               1928             JMP endfunc
0F91                      1929     decimal5:
0F91 B0ED                 1930             MOV AL, 11101101b
0F93 EB6A90               1931             JMP endfunc
                          1932             
0F96                      1933             six:
0F96 3C06                 1934             CMP AL,6
0F98 7511                 1935             JNE seven
0F9A 833EA60001           1936             CMP DS:DECIMAL_FLAG, 1
0F9F 7405                 1937             JE decimal6
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:10:15  12/07/;3  PAGE   37


LOC  OBJ                  LINE     SOURCE

0FA1 B07D                 1938             MOV AL, 01111101b
0FA3 EB5A90               1939             JMP endfunc
0FA6                      1940     decimal6:
0FA6 B0FD                 1941             MOV AL, 11111101b
0FA8 EB5590               1942             JMP endfunc
                          1943             
0FAB                      1944             seven:
0FAB 3C07                 1945             CMP AL,7
0FAD 7511                 1946             JNE eight
0FAF 833EA60001           1947             CMP DS:DECIMAL_FLAG, 1
0FB4 7405                 1948             JE decimal7
0FB6 B007                 1949             MOV AL, 00000111b
0FB8 EB4590               1950             JMP endfunc
0FBB                      1951     decimal7:
0FBB B087                 1952             MOV AL, 10000111b
0FBD EB4090               1953             JMP endfunc
                          1954             
0FC0                      1955             eight:
0FC0 3C08                 1956             CMP AL,8
0FC2 7511                 1957             JNE nine
0FC4 833EA60001           1958             CMP DS:DECIMAL_FLAG, 1
0FC9 7405                 1959             JE decimal8
0FCB B07F                 1960             MOV AL, 01111111b
0FCD EB3090               1961             JMP endfunc
0FD0                      1962     decimal8:
0FD0 B0FF                 1963             MOV AL, 11111111b
0FD2 EB2B90               1964             JMP endfunc
                          1965             
0FD5                      1966             nine:
0FD5 3C09                 1967             CMP AL,9
0FD7 7511                 1968             JNE hifn
0FD9 833EA60001           1969             CMP DS:DECIMAL_FLAG, 1
0FDE 7405                 1970             JE decimal9
0FE0 B06F                 1971             MOV AL, 01101111b
0FE2 EB1B90               1972             JMP endfunc
0FE5                      1973     decimal9:
0FE5 B0EF                 1974             MOV AL, 11101111b
0FE7 EB1690               1975             JMP endfunc
                          1976             
0FEA                      1977             hifn:
0FEA 3C2D                 1978             CMP AL,'-'
0FEC 7511                 1979             JNE endfunc
0FEE 833EA60001           1980             CMP DS:DECIMAL_FLAG, 1
0FF3 7405                 1981             JE decimal10
0FF5 B040                 1982             MOV AL, 01000000b
0FF7 EB0690               1983             JMP endfunc
0FFA                      1984     decimal10:
0FFA B0C0                 1985             MOV AL, 11000000b
0FFC EB0190               1986             JMP endfunc
                          1987             
0FFF                      1988             endfunc:
0FFF 5A                   1989             POP DX
1000 59                   1990             POP CX
1001 5B                   1991             POP BX
                          1992     
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    03:10:15  12/07/;3  PAGE   38


LOC  OBJ                  LINE     SOURCE

1002 CB                   1993     RET
                          1994     BCD_TO_7SEG ENDP
                          1995     
----                      1996     CODE_SEG        ENDS
                          1997     END

ASSEMBLY COMPLETE, NO ERRORS FOUND
